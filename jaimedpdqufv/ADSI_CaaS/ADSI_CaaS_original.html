<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/4cf2300e9c8272f7-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/de70bee13400563f.css?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/4095ef47de7c7e40.css?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-acbbbb548492d4a6.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW"/><script src="/_next/static/chunks/4bd1b696-cebf68b71ed1e85d.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/1684-442180a3c1eb747d.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/main-app-8ab5af3d6b81086e.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/4420-863691215dce8f1b.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/6417-34cc3208366c5e5f.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/4348-824485747071bae4.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/3224-7e9887ea92eab174.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/6967-c4b815e71e97ed18.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/app/layout-37a15e31a18fac3d.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/7bf36345-06f80506190927ed.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/c16f53c3-1a60b9b77b3e1d4b.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/2249-342d7235b3a68051.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/9970-31fea4ade6367f07.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/1769-6bbc7ae2dcadfa9c.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/655-b5574efc1f81bad2.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/4154-f7634cd651686b21.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/3639-53d40fa063db1a39.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/8613-82346d348221c557.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/4870-3ddb59732948b175.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/app/%5Borg%5D/%5Brepo%5D/%5B%5B...wikiRoutes%5D%5D/page-78fac26cbb8eb9a1.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/3449-c19b920c18258c30.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/7553-2bb9c132a5788553.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/1127-b475c4cc62d0a830.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/736-90a1c8956f4d3102.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script src="/_next/static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-99964eedd99460bc.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><meta name="next-size-adjust" content=""/><title>jaimedpdqufv/ADSI_CaaS | DeepWiki</title><meta name="description" content="This page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how "/><meta property="og:title" content="jaimedpdqufv/ADSI_CaaS | DeepWiki"/><meta property="og:description" content="This page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how "/><meta property="og:url" content="https://deepwiki.com/jaimedpdqufv/ADSI_CaaS"/><meta property="og:site_name" content="DeepWiki"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary"/><meta name="twitter:title" content="jaimedpdqufv/ADSI_CaaS | DeepWiki"/><meta name="twitter:description" content="This page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how "/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="48x48"/><link rel="icon" href="/icon.png?66aaf51e0e68c818" type="image/png" sizes="16x16"/><link rel="apple-touch-icon" href="/apple-icon.png?a4f658907db0ab87" type="image/png" sizes="180x180"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" noModule=""></script></head><body class="__variable_188709 font-geist-sans relative min-h-screen __variable_9a8899 bg-background antialiased"><section aria-label="Notifications alt+T" tabindex="-1" aria-live="polite" aria-relevant="additions text" aria-atomic="false"></section><script>((e,t,r,n,o,a,i,s)=>{let l=document.documentElement,u=["light","dark"];function c(t){var r;(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&a?o.map(e=>a[e]||e):o;r?(l.classList.remove(...n),l.classList.add(a&&a[t]?a[t]:t)):l.setAttribute(e,t)}),r=t,s&&u.includes(r)&&(l.style.colorScheme=r)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=i&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","light",null,["light","dark"],null,true,true)</script><!--$--><div class="flex min-h-screen w-full flex-col text-white" id="codebase-wiki-repo-page"><div class="bg-background border-b-border sticky top-0 z-30 border-b border-dashed"><div class="font-geist-mono relative flex h-8 items-center justify-center text-xs font-medium sm:hidden"><div class="powered-by-devin-gradient absolute inset-0 z-[-1] h-8 w-full"></div><a class="flex items-center gap-2" href="/private-repo"><svg class="size-3 [&amp;_path]:stroke-0 [&amp;_path]:animate-[custom-pulse_1.8s_infinite_var(--delay,0s)]" xmlns="http://www.w3.org/2000/svg" viewBox="110 110 460 500"><path style="fill:#21c19a" class="[--delay:0.6s]" d="M418.73,332.37c9.84-5.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95,15.95-27.63Z"></path><path style="fill:#3969ca" d="M141.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style="fill:#0294de" class="[--delay:1.2s]" d="M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22Z"></path></svg>Index your code with Devin</a></div><div class="container-wrapper"><div class="container mx-auto flex w-full flex-row items-center gap-2 py-4 md:py-6"><a class="flex items-center gap-3" href="/"><span class="text-base font-medium leading-none md:text-lg hidden sm:block">DeepWiki</span></a><div class="flex-1"><div class="flex flex-row items-center gap-2"><a class="block text-xs font-medium leading-none text-white sm:hidden md:text-lg" href="/">DeepWiki</a><p class="text-sm font-normal leading-none md:text-lg"><a href="https://github.com/jaimedpdqufv/ADSI_CaaS" target="_blank" rel="noopener noreferrer" title="Open repository" class="text-muted-foreground hover:text-muted-foreground/80 group inline-flex items-center gap-1 transition-colors">jaimedpdqufv/ADSI_CaaS<!-- --> <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="opacity-0 transition-opacity group-hover:opacity-100"><path d="M224,104a8,8,0,0,1-16,0V59.32l-66.33,66.34a8,8,0,0,1-11.32-11.32L196.68,48H152a8,8,0,0,1,0-16h64a8,8,0,0,1,8,8Zm-40,24a8,8,0,0,0-8,8v72H48V80h72a8,8,0,0,0,0-16H48A16,16,0,0,0,32,80V208a16,16,0,0,0,16,16H176a16,16,0,0,0,16-16V136A8,8,0,0,0,184,128Z"></path></svg></a></p></div></div><div class="flex items-center gap-4"><a class="group hidden items-center gap-1.5 md:flex" href="/private-repo"><div class="relative"><span class="text-foreground/70 group-hover:text-foreground text-xs font-light transition-colors">Index your code with</span><div class="bg-foreground/30 absolute bottom-0 left-0 h-[1px] w-0 transition-all duration-300 group-hover:w-full"></div></div><div class="flex items-center gap-1 transition-transform duration-300 group-hover:translate-x-0.5"><svg class="size-4 transform transition-transform duration-700 group-hover:rotate-180 [&amp;_path]:stroke-0" xmlns="http://www.w3.org/2000/svg" viewBox="110 110 460 500"><path style="fill:#21c19a" class="" d="M418.73,332.37c9.84-5.68,22.07-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.58,1.06.19.06.37.11.55.16.87.21,1.76.34,2.65.35.04,0,.08.02.13.02.1,0,.19-.03.29-.04.83-.02,1.64-.13,2.45-.32.14-.03.28-.05.42-.09.87-.24,1.7-.59,2.5-1.03.08-.04.17-.06.25-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.06,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.57-1.06-.19-.06-.37-.11-.56-.16-.88-.21-1.76-.34-2.65-.34-.13,0-.26.02-.4.02-.84.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.24.1.8.44,1.64.79,2.5,1.03.14.04.28.06.42.09.81.19,1.62.3,2.45.32.1,0,.19.04.29.04.04,0,.08-.02.13-.02.89,0,1.77-.13,2.65-.35.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.58-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-.08-.04-.16-.06-.24-.1-.8-.44-1.64-.8-2.51-1.04-.13-.04-.26-.05-.39-.09-.82-.2-1.65-.31-2.49-.33-.13,0-.25-.02-.38-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.75.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.07,5.68-31.9,0-9.84-5.68-15.95-16.27-15.95-27.63s6.11-21.95,15.95-27.63Z"></path><path style="fill:#3969ca" d="M141.09,317.65l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c.08-.04.13-.11.2-.16.78-.48,1.51-1.02,2.15-1.66.1-.1.18-.21.28-.31.57-.6,1.08-1.26,1.51-1.97.07-.12.15-.22.22-.34.44-.77.77-1.6,1.03-2.47.05-.19.1-.37.14-.56.22-.89.37-1.81.37-2.76v-29.43c0-11.36,6.11-21.95,15.96-27.63s22.06-5.68,31.91,0l25.49,14.71c.82.48,1.69.8,2.57,1.06.19.06.37.11.56.16.87.21,1.76.34,2.64.35.04,0,.09.02.13.02.1,0,.19-.04.29-.04.83-.02,1.65-.13,2.45-.32.14-.03.28-.05.41-.09.87-.24,1.71-.6,2.51-1.04.08-.04.16-.06.24-.1l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-.08.04-.13.11-.2.16-.78.48-1.51,1.02-2.15,1.66-.1.1-.18.21-.28.31-.57.6-1.08,1.26-1.51,1.97-.07.12-.15.22-.22.34-.44.77-.77,1.6-1.03,2.47-.05.19-.1.37-.14.56-.22.89-.37,1.81-.37,2.76v29.43c0,11.36-6.11,21.95-15.95,27.63-9.84,5.68-22.07,5.68-31.91,0l-25.49-14.71c-.82-.48-1.69-.8-2.58-1.06-.19-.06-.37-.11-.55-.16-.88-.21-1.76-.34-2.65-.35-.13,0-.26.02-.4.02-.83.02-1.66.13-2.47.32-.13.03-.27.05-.4.09-.87.24-1.71.6-2.51,1.04-.08.04-.16.06-.24.1l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22Z"></path><path style="fill:#0294de" class="" d="M396.88,484.35l-50.97-29.43c-.08-.04-.17-.06-.24-.1-.8-.44-1.64-.79-2.51-1.03-.14-.04-.27-.06-.41-.09-.81-.19-1.64-.3-2.47-.32-.13,0-.26-.02-.39-.02-.89,0-1.78.13-2.66.35-.18.04-.36.1-.54.15-.88.26-1.76.59-2.58,1.07l-25.49,14.72c-9.84,5.68-22.06,5.68-31.9,0-9.84-5.68-15.96-16.27-15.96-27.63v-29.43c0-.95-.15-1.87-.37-2.76-.05-.19-.09-.37-.14-.56-.25-.86-.59-1.69-1.03-2.47-.07-.12-.15-.22-.22-.34-.43-.71-.94-1.37-1.51-1.97-.1-.1-.18-.21-.28-.31-.65-.63-1.37-1.18-2.15-1.66-.07-.04-.13-.11-.2-.16l-50.97-29.43c-3.65-2.11-8.15-2.11-11.81,0l-50.97,29.43c-3.65,2.11-5.9,6.01-5.9,10.22v58.86c0,4.22,2.25,8.11,5.9,10.22l50.97,29.43c.08.04.17.06.25.1.8.44,1.63.79,2.5,1.03.14.04.29.06.43.09.8.19,1.61.3,2.43.32.1,0,.2.04.3.04.04,0,.09-.02.13-.02.88,0,1.77-.13,2.64-.34.19-.04.37-.1.56-.16.88-.26,1.75-.59,2.57-1.06l25.49-14.71c9.84-5.68,22.06-5.68,31.91,0,9.84,5.68,15.95,16.27,15.95,27.63v29.43c0,.95.15,1.87.37,2.76.05.19.09.37.14.56.25.86.59,1.69,1.03,2.47.07.12.15.22.22.34.43.71.94,1.37,1.51,1.97.1.1.18.21.28.31.65.63,1.37,1.18,2.15,1.66.07.04.13.11.2.16l50.97,29.43c1.83,1.05,3.86,1.58,5.9,1.58s4.08-.53,5.9-1.58l50.97-29.43c3.65-2.11,5.9-6.01,5.9-10.22v-58.86c0-4.22-2.25-8.11-5.9-10.22Z"></path></svg><span class="text-sm font-medium">Devin</span></div></a><button aria-label="Edit Wiki" class="flex items-center rounded-md cursor-pointer transition-all border border-border bg-surface hover:border-border-hover hover:bg-component disabled:cursor-default disabled:opacity-50 disabled:hover:border-border disabled:hover:bg-surface gap-2 px-3 py-1.5 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 256 256"><path d="M227.32,73.37,182.63,28.69a16,16,0,0,0-22.63,0L36.69,152A15.86,15.86,0,0,0,32,163.31V208a16,16,0,0,0,16,16H216a8,8,0,0,0,0-16H115.32l112-112A16,16,0,0,0,227.32,73.37ZM92.69,208H48V163.31l88-88L180.69,120ZM192,108.69,147.32,64l24-24L216,84.69Z"></path></svg>Edit Wiki</button><button class="flex items-center rounded-md !text-white cursor-pointer transition-all border bg-blue-500 hover:bg-blue-600 border-blue-500 hover:border-blue-600 dark:bg-blue-900 dark:hover:bg-blue-800 dark:border-blue-900 dark:hover:border-blue-800 disabled:cursor-default disabled:opacity-50 disabled:hover:bg-blue-500 disabled:hover:border-blue-500 dark:disabled:hover:bg-blue-900 dark:disabled:hover:border-blue-900 gap-1.5 px-3 py-1.5 text-sm" aria-label="Share" data-state="closed" data-slot="tooltip-trigger"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg><span>Share</span></button><div class="h-8 w-8"></div></div></div></div></div><!--$--><div class="w-full flex-1"><div class="container-wrapper relative mx-auto h-full px-0"><div class="container relative mx-auto flex h-full w-full flex-col gap-0 max-md:!px-0 md:flex-row md:gap-6 lg:gap-10"><div class="border-r-border hidden max-h-screen border-r border-dashed py-6 pr-4 transition-[border-radius] md:sticky md:left-0 md:top-20 md:block md:h-[calc(100vh-82px)] md:w-64 md:flex-shrink-0 md:overflow-y-auto lg:py-9 xl:w-72"><div class="flex h-full w-full max-w-full flex-shrink-0 flex-col overflow-hidden" style="scrollbar-color:var(--color-border) transparent"><div class="flex-shrink-0 px-2"><div class="text-secondary pb-1 text-xs">Last indexed: <!-- -->28 November 2025<!-- --> (<a href="https://github.com/jaimedpdqufv/ADSI_CaaS/commits/003b3aa6" target="_blank" rel="noopener noreferrer">003b3a</a>)</div></div><ul class="flex-1 flex-shrink-0 space-y-1 overflow-y-auto py-1" style="scrollbar-width:none"><li style="padding-left:0"><a data-selected="true" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/1-overview">Overview</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/2-business-model-and-concept">Business Model and Concept</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/2.1-platform-base-and-optional-services">Platform Base and Optional Services</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/2.2-key-actors-and-system-boundaries">Key Actors and System Boundaries</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/2.3-business-rules-and-policies">Business Rules and Policies</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/3-system-architecture">System Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/3.1-high-level-architecture">High-Level Architecture</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/3.2-core-technical-components">Core Technical Components</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/3.3-integration-architecture">Integration Architecture</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/4-customer-journey">Customer Journey</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/4.1-vehicle-purchase-and-delivery-process">Vehicle Purchase and Delivery Process</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/4.2-service-acquisition-and-management">Service Acquisition and Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/4.3-customer-facing-platforms">Customer-Facing Platforms</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/5-external-system-integrations">External System Integrations</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/5.1-factory-integration">Factory Integration</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/5.2-vss-(vehicle-service-system)-integration">VSS (Vehicle Service System) Integration</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/5.3-vehicle-communication-(iot-and-ota)">Vehicle Communication (IoT and OTA)</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/5.4-payment-gateway-integration">Payment Gateway Integration</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/5.5-administrative-registration-integration">Administrative Registration Integration</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/6-service-lifecycle-management">Service Lifecycle Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/6.1-service-catalog-and-pricing">Service Catalog and Pricing</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/6.2-ota-service-activation">OTA Service Activation</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/6.3-maintenance-linked-service-access">Maintenance-Linked Service Access</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/6.4-service-cancellation-and-refunds">Service Cancellation and Refunds</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/7-payment-and-billing">Payment and Billing</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/7.1-payment-types-and-flows">Payment Types and Flows</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/7.2-risk-management-and-settlement">Risk Management and Settlement</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/8-operational-processes">Operational Processes</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/8.1-sales-and-order-management">Sales and Order Management</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/8.2-manufacturing-and-delivery-workflow">Manufacturing and Delivery Workflow</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/8.3-maintenance-management">Maintenance Management</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/9-failure-handling-and-edge-cases">Failure Handling and Edge Cases</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/9.1-ota-activation-failures">OTA Activation Failures</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/9.2-payment-failure-scenarios">Payment Failure Scenarios</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/9.3-delivery-and-transport-issues">Delivery and Transport Issues</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/9.4-special-scenarios-(theft-warranty-loss)">Special Scenarios (Theft, Warranty Loss)</a></li><li style="padding-left:0"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/10-technical-reference">Technical Reference</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/10.1-api-documentation-guidelines">API Documentation Guidelines</a></li><li style="padding-left:12px"><a data-selected="false" class="hover:bg-hover block w-full rounded px-2 py-1.5 text-left text-sm transition-none text-secondary data-[selected=true]:bg-hover data-[selected=true]:text-primary font-normal data-[selected=true]:font-normal" href="/jaimedpdqufv/ADSI_CaaS/10.2-key-terminology-and-glossary">Key Terminology and Glossary</a></li></ul></div></div><div class="flex h-full flex-1 flex-col overflow-hidden"><div class="bg-background border-b-border sticky top-0 z-10 border-b border-dashed md:hidden"><div class="flex cursor-pointer items-center gap-2 p-3"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 256 256" class="transition-transform"><path d="M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"></path></svg><span class="truncate text-base font-normal">Menu</span></div></div><div class="relative flex-1 overflow-y-auto px-3 pt-3 md:rounded-md md:px-0 md:pt-0 [&amp;_::selection]:bg-purple-500/40" style="scrollbar-color:var(--color-night) transparent"><div class="pb-30 mx-auto max-w-2xl md:pb-40 md:pt-6 lg:pt-8"><div class="prose prose-invert dark:prose-invert prose-headings:text-inherit prose-p:text-inherit max-w-none"><div><div class="prose-custom prose-custom-md prose-custom-gray !max-w-none text-neutral-300 [overflow-wrap:anywhere]"><h1 id="overview" class="group" data-header="true">Overview<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h1>
<details>
<summary>Relevant source files</summary>
<ul>
<li><a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/enunciado.md" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>enunciado.md</span></a></li>
<li><a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4] rounded-r"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span></a></li>
</ul>
</details>
<h2 id="purpose-and-scope" class="group" data-header="true">Purpose and Scope<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>This page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how CaaS enables dynamic vehicle feature management through Over-The-Air (OTA) configuration.</p>
<p>For detailed information about specific topics:</p>
<ul>
<li>Business model and revenue streams: see <a href="/jaimedpdqufv/ADSI_CaaS/2-business-model-and-concept" class="text-neutral-300 hover:text-neutral-200 hover:underline">Business Model and Concept</a></li>
<li>Complete customer journey workflows: see <a href="/jaimedpdqufv/ADSI_CaaS/4-customer-journey" class="text-neutral-300 hover:text-neutral-200 hover:underline">Customer Journey</a></li>
<li>External system integration details: see <a href="/jaimedpdqufv/ADSI_CaaS/5-external-system-integrations" class="text-neutral-300 hover:text-neutral-200 hover:underline">External System Integrations</a></li>
<li>Technical architecture specifications: see <a href="/jaimedpdqufv/ADSI_CaaS/3-system-architecture" class="text-neutral-300 hover:text-neutral-200 hover:underline">System Architecture</a></li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/enunciado.md#L1-L23" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>enunciado.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">1-23</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L1-L104" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">1-104</span></a></p>
<hr/>
<h2 id="what-is-car-as-a-service-caas" class="group" data-header="true">What is Car as a Service (CaaS)?<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>CaaS is an automotive sales and service platform that implements a pay-per-use business model for vehicle features. The system enables customers to purchase a base vehicle platform and dynamically activate or deactivate optional features on-demand throughout the vehicle&#x27;s lifecycle.</p>
<p><strong>Core Capabilities:</strong></p>
<ul>
<li>Vehicle sales and order management integrated with manufacturing facilities</li>
<li>Dynamic feature activation via OTA configuration</li>
<li>Subscription and one-time payment processing for vehicle services</li>
<li>Real-time vehicle connectivity through IoT infrastructure</li>
<li>Maintenance tracking and service eligibility management</li>
<li>Customer self-service through web and mobile platforms</li>
</ul>
<p><strong>Technical Foundation:</strong>
The system leverages pre-installed vehicle firmware where all functionality exists in a dormant state. CaaS activates or deactivates features remotely without requiring physical workshop visits or software updates.</p>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/enunciado.md#L1-L7" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>enunciado.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">1-7</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L54-L56" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">54-56</span></a></p>
<hr/>
<h2 id="system-boundaries-and-external-actors" class="group" data-header="true">System Boundaries and External Actors<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>The CaaS platform operates as the central orchestration system between multiple external actors and infrastructure components. Understanding what is inside versus outside the system is critical for architectural clarity.</p>
<h3 id="system-context-diagram" class="group" data-header="true">System Context Diagram<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<h3 id="key-architectural-decisions" class="group" data-header="true">Key Architectural Decisions<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>

































































<table><thead><tr><th>Boundary</th><th>Entity</th><th>Classification</th><th>Rationale</th></tr></thead><tbody><tr><td><strong>External</strong></td><td>Customers</td><td>Actor</td><td>Users who purchase and use services; not part of system implementation</td></tr><tr><td><strong>External</strong></td><td>Dealership Employees</td><td>Actor</td><td>Use intranet to register sales but are not system components</td></tr><tr><td><strong>External</strong></td><td>Factory</td><td>Actor</td><td>Separate legal/operational entity with its own systems</td></tr><tr><td><strong>External</strong></td><td>Workshops</td><td>Actor</td><td>Independent service providers using VSS system</td></tr><tr><td><strong>Internal</strong></td><td>Intranet, Web, Mobile</td><td>System Components</td><td>Access channels we develop and maintain</td></tr><tr><td><strong>Internal</strong></td><td>Core Services</td><td>System Components</td><td>Business logic we implement</td></tr><tr><td><strong>Internal</strong></td><td>OTA Engine</td><td>System Component</td><td>Feature activation logic we implement</td></tr><tr><td><strong>Infrastructure</strong></td><td>IoT Network</td><td>Managed Asset</td><td>Communication infrastructure owned by CaaS organization</td></tr><tr><td><strong>Infrastructure</strong></td><td>Vehicles</td><td>Managed Asset</td><td>Physical assets we sell but remain connected to our systems</td></tr></tbody></table>
<p><strong>Critical Distinction:</strong> Vehicles are <strong>not actors</strong>they are infrastructure components that receive configurations and report status. They do not initiate use cases; customers and employees do.</p>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L11-L16" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">11-16</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/enunciado.md#L8-L9" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>enunciado.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">8-9</span></a></p>
<hr/>
<h2 id="core-business-concept-platform-base-optional-services" class="group" data-header="true">Core Business Concept: Platform Base + Optional Services<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<h3 id="the-two-tier-model" class="group" data-header="true">The Two-Tier Model<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<h3 id="service-characteristics" class="group" data-header="true">Service Characteristics<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>









































<table><thead><tr><th>Service Type</th><th>Payment Model</th><th>Duration</th><th>Example</th></tr></thead><tbody><tr><td><strong>Plataforma Base</strong></td><td>One-time purchase</td><td>Vehicle lifetime</td><td>Basic operational vehicle with essential features</td></tr><tr><td><strong>Initial Bundle</strong></td><td>Included in vehicle purchase</td><td>Per plan comercial</td><td>Customer may purchase base + some options upfront</td></tr><tr><td><strong>Temporary Service</strong></td><td>Pay-per-use</td><td>Fixed duration (days/months)</td><td>50% power increase for 1 month</td></tr><tr><td><strong>Permanent Service</strong></td><td>Pay-per-use</td><td>Vehicle lifetime</td><td>Highway autonomous driving</td></tr><tr><td><strong>Recurring Subscription</strong></td><td>Mes vencido (post-paid)</td><td>Monthly renewable</td><td>Entertainment streaming services</td></tr></tbody></table>
<h3 id="available-options-opciones-disponibles" class="group" data-header="true">Available Options (Opciones Disponibles)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>The system supports various categories of optional services, all pre-installed in vehicle firmware:</p>
<ul>
<li><strong>Performance enhancements</strong>: Power increases (e.g., 50% boost)</li>
<li><strong>Autonomous driving</strong>: Highway autopilot, parking assist</li>
<li><strong>Traction modes</strong>: Off-road, snow, sport configurations</li>
<li><strong>Climate systems</strong>: Advanced HVAC, seat heating/cooling</li>
<li><strong>Entertainment</strong>: Streaming services, premium audio</li>
<li><strong>Driver assistance</strong>: Lane keeping, adaptive cruise control</li>
</ul>
<p><strong>Technical Implementation:</strong> All functionality exists in the vehicle firmware. CaaS only activates/deactivates features remotelyno software updates are required for service delivery.</p>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/enunciado.md#L3-L5" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>enunciado.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">3-5</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L54-L56" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">54-56</span></a></p>
<hr/>
<h2 id="high-level-component-architecture" class="group" data-header="true">High-Level Component Architecture<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<h3 id="main-subsystems" class="group" data-header="true">Main Subsystems<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<h3 id="component-responsibilities" class="group" data-header="true">Component Responsibilities<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>






































































<table><thead><tr><th>Component</th><th>Primary Responsibility</th><th>Key Interactions</th></tr></thead><tbody><tr><td><strong>Web Platform</strong></td><td>Customer self-service portal for browsing and purchasing services</td><td>Accesses Expediente de Compra, Service Catalog</td></tr><tr><td><strong>Mobile Application</strong></td><td>Customer app for services + direct vehicle control</td><td>Accesses Expediente, communicates directly with vehicle</td></tr><tr><td><strong>Corporate Intranet</strong></td><td>Dealership interface for registering vehicle sales</td><td>Creates orders, registers customer data</td></tr><tr><td><strong>Order Management</strong></td><td>Handles vehicle reservations, factory orders, and delivery tracking</td><td>Factory API (sync orders), Admin API (registration)</td></tr><tr><td><strong>Service Catalog</strong></td><td>Manages available options, pricing, and eligibility rules</td><td>VSS (maintenance checks), Payment processing</td></tr><tr><td><strong>Payment Processing</strong></td><td>Processes reservations, final payments, and service payments</td><td>Payment Gateway, triggers OTA activation</td></tr><tr><td><strong>Expediente de Compra</strong></td><td>Central customer data repository containing purchase history, manuals, invoices</td><td>All customer-facing channels</td></tr><tr><td><strong>OTA Activation Engine</strong></td><td>Delivers services via remote configuration with retry logic</td><td>IoT Gateway, Configuration Repository</td></tr><tr><td><strong>Notification Engine</strong></td><td>Multi-channel notifications (email, app push, vehicle display)</td><td>Receives events from all subsystems</td></tr><tr><td><strong>IoT Gateway</strong></td><td>Single point of vehicle communication</td><td>Vehicle fleet via IoT Network</td></tr><tr><td><strong>Factory Integration</strong></td><td>Synchronous order placement + asynchronous status updates</td><td>Factory Order API</td></tr><tr><td><strong>VSS Integration</strong></td><td>Queries maintenance status to gate service availability</td><td>VSS System (read-only)</td></tr></tbody></table>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/enunciado.md#L8-L22" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>enunciado.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">8-22</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L31-L56" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">31-56</span></a></p>
<hr/>
<h2 id="integration-architecture-and-communication-patterns" class="group" data-header="true">Integration Architecture and Communication Patterns<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<h3 id="external-system-communication-model" class="group" data-header="true">External System Communication Model<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<h3 id="integration-pattern-summary" class="group" data-header="true">Integration Pattern Summary<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>




































































<table><thead><tr><th>External System</th><th>Direction</th><th>Pattern</th><th>Sync/Async</th><th>Notes</th></tr></thead><tbody><tr><td><strong>Factory API</strong></td><td>CaaS  Factory</td><td>Request-Response</td><td>Synchronous</td><td>Order placement with immediate confirmation</td></tr><tr><td><strong>Factory API</strong></td><td>Factory  CaaS</td><td>Webhook</td><td>Asynchronous</td><td>Manufacturing status updates (in progress, ready, shipped)</td></tr><tr><td><strong>API IoT</strong></td><td>CaaS  Vehicles</td><td>Command Push</td><td>Asynchronous</td><td>OTA configuration commands via IoT network</td></tr><tr><td><strong>API IoT</strong></td><td>Vehicles  CaaS</td><td>Status Pull</td><td>Synchronous</td><td>Telemetry and health status queries</td></tr><tr><td><strong>VSS System</strong></td><td>CaaS  VSS</td><td>Query</td><td>Synchronous</td><td>Read-only maintenance status checks</td></tr><tr><td><strong>Payment Gateway</strong></td><td>CaaS  Gateway</td><td>Request-Response</td><td>Synchronous</td><td>Payment initiation</td></tr><tr><td><strong>Payment Gateway</strong></td><td>Gateway  CaaS</td><td>Webhook</td><td>Asynchronous</td><td>Settlement confirmation (CaaS assumes risk)</td></tr><tr><td><strong>Admin API</strong></td><td>CaaS  Government</td><td>Request-Response</td><td>Synchronous</td><td>Vehicle registration (blocking operation)</td></tr></tbody></table>
<h3 id="critical-integration-constraints" class="group" data-header="true">Critical Integration Constraints<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ol>
<li>
<p><strong>API IoT is Pre-existing:</strong> The IoT API is already documented, tested, and ready for CaaS. It was developed in a previous project and cannot be modified. Any integration issues are attributed to the previous project, not CaaS.</p>
</li>
<li>
<p><strong>VSS is External:</strong> The Vehicle Service System (VSS) is maintained independently by workshops. CaaS queries it but does not write to it. Vehicles do not self-report maintenance status via IoT.</p>
</li>
<li>
<p><strong>Asynchronous Risk Assumption:</strong> CaaS delivers services immediately after payment initiation, before bank settlement is confirmed. This optimizes customer experience but requires risk management processes.</p>
</li>
<li>
<p><strong>Factory Hybrid Model:</strong> Order placement is synchronous (immediate confirmation), but manufacturing status arrives asynchronously via webhooks as production progresses.</p>
</li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L31-L44" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">31-44</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L62-L73" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">62-73</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L77-L82" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">77-82</span></a></p>
<hr/>
<h2 id="key-business-rules-and-constraints" class="group" data-header="true">Key Business Rules and Constraints<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<h3 id="user-management" class="group" data-header="true">User Management<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ul>
<li><strong>No Public Registration:</strong> All users must be known and controlled. No self-registration capability exists.</li>
<li><strong>Customer Provisioning:</strong> Customers receive credentials via email after dealership sales registration.</li>
<li><strong>Employee Access:</strong> Dealership employees use corporate intranet with pre-provisioned accounts.</li>
<li><strong>No External SSO:</strong> No integration with Google, Microsoft, or other external identity providers.</li>
</ul>
<h3 id="payment-and-risk" class="group" data-header="true">Payment and Risk<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ul>
<li><strong>Vehicle Purchase:</strong> Requires reservation payment (seal) + final payment before registration.</li>
<li><strong>Service Delivery:</strong> Immediate activation after payment initiation (before settlement confirmation).</li>
<li><strong>Risk Assumption:</strong> CaaS assumes financial risk for asynchronous payment settlement.</li>
<li><strong>Subscription Billing:</strong> Mes vencido (post-paid) modelcharge at month end for consumed services.</li>
</ul>
<h3 id="ota-activation" class="group" data-header="true">OTA Activation<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ul>
<li><strong>Retry Logic:</strong> Failed activations trigger N retry attempts with status monitoring.</li>
<li><strong>No Charge Rule:</strong> If OTA activation fails after all retries, <strong>customer is not charged</strong>.</li>
<li><strong>Technical Support:</strong> Failed activations are escalated to technical support for manual resolution.</li>
<li><strong>Customer Notification:</strong> Customers receive status updates for all activation attempts.</li>
</ul>
<h3 id="maintenance-and-service-access" class="group" data-header="true">Maintenance and Service Access<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ul>
<li><strong>Maintenance Does Not Block Vehicle:</strong> A vehicle cannot be prevented from operating, even if maintenance is overdue.</li>
<li><strong>Service Gating:</strong> Some optional services may be blocked if required maintenance is overdue (safety rationale).</li>
<li><strong>Warranty Loss:</strong> Missing maintenance voids warranty but does not revoke already-purchased services.</li>
<li><strong>VSS as Source of Truth:</strong> Maintenance status is queried from VSS system, not reported by vehicles.</li>
</ul>
<h3 id="cancellation-and-refunds-desistimiento" class="group" data-header="true">Cancellation and Refunds (Desistimiento)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>

























<table><thead><tr><th>Service Duration</th><th>Cancellation Window</th><th>Refund Eligibility</th></tr></thead><tbody><tr><td>&gt; 14 days</td><td>First 14 days</td><td>Full refund (legal requirement)</td></tr><tr><td>&lt; 14 days</td><td>Anytime</td><td>Full refund (legal requirement)</td></tr><tr><td>After window</td><td>Not applicable</td><td>No refund (service consumed)</td></tr></tbody></table>
<ul>
<li><strong>Legal Compliance:</strong> Implements EU distance selling regulations (derecho de desistimiento).</li>
<li><strong>Subscription Cancellation:</strong> Customer can cancel recurring subscriptions anytime; no future charges.</li>
<li><strong>Theft Scenario:</strong> Customer may cancel pending services but cannot refund already-delivered services past the desistimiento period.</li>
</ul>
<h3 id="delivery-and-transport" class="group" data-header="true">Delivery and Transport<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ul>
<li><strong>Failed Home Delivery:</strong> If customer is not present, vehicle returns to dealership for customer pickup.</li>
<li><strong>Never Leave Vehicle Unattended:</strong> Vehicles are never left in the street due to security risks.</li>
<li><strong>Payment Failure Consequences:</strong> If final payment fails, vehicle becomes dealership stock (sin asignar). Customer loses reservation entirely.</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L15-L16" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">15-16</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L24-L28" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">24-28</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L48-L53" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">48-53</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L66-L73" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">66-73</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L84-L96" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">84-96</span></a></p>
<hr/>
<h2 id="end-to-end-process-flow-overview" class="group" data-header="true">End-to-End Process Flow Overview<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>The following diagram captures the complete customer journey from initial purchase through ongoing service lifecycle:</p>
<pre class="px-2 py-1.5 has-[code]:rounded-md has-[code]:!bg-[#e5e5e5] has-[div]:bg-transparent has-[div]:!p-0 has-[code]:text-stone-900 dark:has-[code]:!bg-[#242424] has-[code]:dark:text-white [&amp;_code]:block [&amp;_code]:border-none [&amp;_code]:bg-transparent [&amp;_code]:p-0"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></pre>
<h3 id="process-phases" class="group" data-header="true">Process Phases<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ol>
<li><strong>Sales Registration:</strong> Dealership staff register sale in corporate intranet, capturing customer data and plan comercial.</li>
<li><strong>Order and Manufacturing:</strong> Automatic order placement to factory (synchronous), with asynchronous status updates during production.</li>
<li><strong>Payment and Registration:</strong> Final payment triggers vehicle registration with government administrative bodies.</li>
<li><strong>Delivery:</strong> Home delivery with fallback to dealership pickup if customer unavailable.</li>
<li><strong>Operational Lifecycle:</strong> Continuous cycle of vehicle use and dynamic service activation.</li>
<li><strong>Service Activation:</strong> Maintenance-gated service access with robust OTA retry logic and customer protection (no charge on failure).</li>
<li><strong>Cancellation:</strong> Legal desistimiento (withdrawal) rights based on service duration and timing.</li>
</ol>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/enunciado.md#L8-L22" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>enunciado.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">8-22</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L18-L29" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">18-29</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L48-L53" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">48-53</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L84-L96" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">84-96</span></a></p>
<hr/>
<h2 id="system-characteristics-and-design-principles" class="group" data-header="true">System Characteristics and Design Principles<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<h3 id="architectural-principles" class="group" data-header="true">Architectural Principles<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>


















































<table><thead><tr><th>Principle</th><th>Implementation</th><th>Rationale</th></tr></thead><tbody><tr><td><strong>Customer Protection</strong></td><td>Never charge for failed OTA activations</td><td>Builds trust; meets legal obligations for service delivery</td></tr><tr><td><strong>Risk-Tolerant Delivery</strong></td><td>Activate services before payment settlement</td><td>Optimizes customer experience over financial risk</td></tr><tr><td><strong>Maintenance-Gated Safety</strong></td><td>Block certain services if maintenance overdue</td><td>Safety and liability protection</td></tr><tr><td><strong>Legal Compliance</strong></td><td>Built-in desistimiento (14-day withdrawal)</td><td>EU distance selling regulations</td></tr><tr><td><strong>Single Source of Truth</strong></td><td>Expediente de Compra for customer data</td><td>Consistency across web, mobile, and intranet channels</td></tr><tr><td><strong>Pre-installed Functionality</strong></td><td>All features exist in firmware; activation only</td><td>No software updates required for service delivery</td></tr><tr><td><strong>Asynchronous Manufacturing</strong></td><td>Non-blocking factory status updates</td><td>System remains responsive during long manufacturing cycles</td></tr><tr><td><strong>Retry with Escalation</strong></td><td>N retries before technical support escalation</td><td>Handles transient IoT network failures gracefully</td></tr></tbody></table>
<h3 id="technical-constraints" class="group" data-header="true">Technical Constraints<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ol>
<li><strong>API IoT is Fixed:</strong> Pre-existing, documented, tested. Cannot be modified for CaaS.</li>
<li><strong>No Vehicle Blocking:</strong> Cannot prevent vehicle operation, even for maintenance non-compliance.</li>
<li><strong>VSS is External:</strong> Read-only access to maintenance records; workshops maintain the data.</li>
<li><strong>Multi-Country Registration:</strong> Admin API must support country-specific vehicle registration requirements.</li>
<li><strong>Known Users Only:</strong> No public registration; all users pre-provisioned by dealership or system administrators.</li>
</ol>
<h3 id="scalability-considerations" class="group" data-header="true">Scalability Considerations<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<ul>
<li><strong>IoT Network:</strong> Must handle bidirectional communication with entire vehicle fleet.</li>
<li><strong>Notification Engine:</strong> Multi-channel delivery (email, push, SMS, vehicle display) for all customer events.</li>
<li><strong>Payment Processing:</strong> Supports concurrent transactions for reservations, services, and subscriptions.</li>
<li><strong>Retry Logic:</strong> OTA engine must queue and retry failed activations without blocking other operations.</li>
<li><strong>Asynchronous Integration:</strong> Factory and payment webhooks enable non-blocking external system communication.</li>
</ul>
<p><strong>Sources:</strong> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L11-L16" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">11-16</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L34-L38" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">34-38</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L48-L53" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">48-53</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L66-L73" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">66-73</span></a> <a href="https://github.com/jaimedpdqufv/ADSI_CaaS/blob/003b3aa6/pasame las preguntas y sus respuestas a markdown.md#L77-L82" target="_blank" rel="noopener noreferrer" class="mb-1 mr-1 inline-flex items-stretch font-mono text-xs !no-underline transition-opacity hover:opacity-75"><span class="flex items-center break-all rounded-l px-2 py-1.5 bg-[#e5e5e5] text-[#333333] dark:bg-[#252525] dark:text-[#e4e4e4]"><svg class="mr-1.5 hidden h-3.5 w-3.5 flex-shrink-0 opacity-40 md:block" fill="currentColor" viewBox="0 0 24 24"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"></path></svg>pasame las preguntas y sus respuestas a markdown.md</span><span class="flex flex-shrink-0 items-center rounded-r border-l px-2 py-1.5 border-[#dddddd] bg-[#d8d8d8] text-[#666666] dark:border-[#333333] dark:bg-[#2a2a2a] dark:text-[#888888]">77-82</span></a></p>
<hr/>
<h2 id="document-organization" class="group" data-header="true">Document Organization<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h2>
<p>This wiki is organized hierarchically to guide readers from high-level concepts to detailed technical specifications:</p>
<h3 id="business-context-sections-2x" class="group" data-header="true">Business Context (Sections 2.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Understanding the business model, actors, and policies is essential before diving into technical details. Start here to understand <em>why</em> the system works the way it does.</p>
<h3 id="architecture-sections-3x" class="group" data-header="true">Architecture (Sections 3.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Technical architecture documentation covering system components, integration patterns, and design decisions. Critical for developers and architects.</p>
<h3 id="customer-journey-sections-4x" class="group" data-header="true">Customer Journey (Sections 4.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Process flows and user experience documentation. Explains how customers interact with the system from purchase through service lifecycle.</p>
<h3 id="external-integrations-sections-5x" class="group" data-header="true">External Integrations (Sections 5.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Detailed integration specifications for Factory API, VSS, IoT/OTA, Payment Gateway, and Administrative Registration systems.</p>
<h3 id="service-lifecycle-sections-6x" class="group" data-header="true">Service Lifecycle (Sections 6.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Deep dive into service catalog management, OTA activation, maintenance gating, and cancellation workflows.</p>
<h3 id="payments-sections-7x" class="group" data-header="true">Payments (Sections 7.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Payment types, billing models, risk management, and financial workflows.</p>
<h3 id="operations-sections-8x" class="group" data-header="true">Operations (Sections 8.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>Operational processes including sales, manufacturing, delivery, and maintenance management.</p>
<h3 id="failure-handling-sections-9x" class="group" data-header="true">Failure Handling (Sections 9.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>System behavior in failure scenarios, edge cases, and error recovery procedures.</p>
<h3 id="technical-reference-sections-10x" class="group" data-header="true">Technical Reference (Sections 10.x)<button class="relative ml-2 cursor-pointer align-baseline text-gray-400 opacity-0 transition-opacity hover:text-blue-400 focus:opacity-100 group-hover:opacity-100" aria-label="Copy link to header"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M117.18,188.74a12,12,0,0,1,0,17l-5.12,5.12A58.26,58.26,0,0,1,70.6,228h0A58.62,58.62,0,0,1,29.14,127.92L63.89,93.17a58.64,58.64,0,0,1,98.56,28.11,12,12,0,1,1-23.37,5.44,34.65,34.65,0,0,0-58.22-16.58L46.11,144.89A34.62,34.62,0,0,0,70.57,204h0a34.41,34.41,0,0,0,24.49-10.14l5.11-5.12A12,12,0,0,1,117.18,188.74ZM226.83,45.17a58.65,58.65,0,0,0-82.93,0l-5.11,5.11a12,12,0,0,0,17,17l5.12-5.12a34.63,34.63,0,1,1,49,49L175.1,145.86A34.39,34.39,0,0,1,150.61,156h0a34.63,34.63,0,0,1-33.69-26.72,12,12,0,0,0-23.38,5.44A58.64,58.64,0,0,0,150.56,180h.05a58.28,58.28,0,0,0,41.47-17.17l34.75-34.75a58.62,58.62,0,0,0,0-82.91Z"></path></svg></button></h3>
<p>API documentation guidelines, terminology glossary, and technical reference material.</p>
<p><strong>Sources:</strong> Table of contents provided in prompt</p></div></div></div></div></div></div><div class="hidden overflow-hidden transition-[border-radius] xl:sticky xl:right-0 xl:top-20 xl:block xl:h-[calc(100vh-82px)] xl:w-64 xl:flex-shrink-0 2xl:w-72" style="scrollbar-width:none"><div class="flex max-h-full w-full flex-shrink-0 flex-col py-6 pt-0 text-sm lg:pb-4 lg:pt-8 xl:w-64 2xl:w-72" style="scrollbar-color:var(--color-night) transparent"><div><div class="relative mx-4 my-4 rounded-md border border-neutral-200 bg-neutral-100 p-3 text-sm text-neutral-600 dark:border-neutral-800 dark:bg-neutral-900 dark:text-neutral-400"><button class="absolute right-2 top-2 rounded-sm p-1 opacity-70 transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-neutral-400 focus:ring-offset-2"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 256 256" class="h-4 w-4"><path d="M205.66,194.34a8,8,0,0,1-11.32,11.32L128,139.31,61.66,205.66a8,8,0,0,1-11.32-11.32L116.69,128,50.34,61.66A8,8,0,0,1,61.66,50.34L128,116.69l66.34-66.35a8,8,0,0,1,11.32,11.32L139.31,128Z"></path></svg><span class="sr-only">Dismiss</span></button><p class="text-sm font-medium">Refresh this wiki</p><p class="mt-2 text-sm font-light text-neutral-500 dark:text-neutral-400">This wiki was recently refreshed. Please wait<!-- --> <!-- -->7<!-- --> day<!-- -->s<!-- --> to refresh again.</p></div></div><h3 class="px-4 pb-5 text-lg font-medium leading-none">On this page</h3><ul style="scrollbar-width:none" class="min-h-0 flex-1 space-y-3 overflow-y-auto p-4 pt-0"><li class=""><a href="#overview" class="hover:text-primary pr-1 transition-all text-primary font-medium">Overview</a></li><li class="ml-3"><a href="#purpose-and-scope" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Purpose and Scope</a></li><li class="ml-3"><a href="#what-is-car-as-a-service-caas" class="hover:text-primary pr-1 font-normal transition-all text-secondary">What is Car as a Service (CaaS)?</a></li><li class="ml-3"><a href="#system-boundaries-and-external-actors" class="hover:text-primary pr-1 font-normal transition-all text-secondary">System Boundaries and External Actors</a></li><li class="ml-6"><a href="#system-context-diagram" class="hover:text-primary pr-1 font-normal transition-all text-secondary">System Context Diagram</a></li><li class="ml-6"><a href="#key-architectural-decisions" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Key Architectural Decisions</a></li><li class="ml-3"><a href="#core-business-concept-platform-base-optional-services" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Core Business Concept: Platform Base + Optional Services</a></li><li class="ml-6"><a href="#the-two-tier-model" class="hover:text-primary pr-1 font-normal transition-all text-secondary">The Two-Tier Model</a></li><li class="ml-6"><a href="#service-characteristics" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Service Characteristics</a></li><li class="ml-6"><a href="#available-options-opciones-disponibles" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Available Options (Opciones Disponibles)</a></li><li class="ml-3"><a href="#high-level-component-architecture" class="hover:text-primary pr-1 font-normal transition-all text-secondary">High-Level Component Architecture</a></li><li class="ml-6"><a href="#main-subsystems" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Main Subsystems</a></li><li class="ml-6"><a href="#component-responsibilities" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Component Responsibilities</a></li><li class="ml-3"><a href="#integration-architecture-and-communication-patterns" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Integration Architecture and Communication Patterns</a></li><li class="ml-6"><a href="#external-system-communication-model" class="hover:text-primary pr-1 font-normal transition-all text-secondary">External System Communication Model</a></li><li class="ml-6"><a href="#integration-pattern-summary" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Integration Pattern Summary</a></li><li class="ml-6"><a href="#critical-integration-constraints" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Critical Integration Constraints</a></li><li class="ml-3"><a href="#key-business-rules-and-constraints" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Key Business Rules and Constraints</a></li><li class="ml-6"><a href="#user-management" class="hover:text-primary pr-1 font-normal transition-all text-secondary">User Management</a></li><li class="ml-6"><a href="#payment-and-risk" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Payment and Risk</a></li><li class="ml-6"><a href="#ota-activation" class="hover:text-primary pr-1 font-normal transition-all text-secondary">OTA Activation</a></li><li class="ml-6"><a href="#maintenance-and-service-access" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Maintenance and Service Access</a></li><li class="ml-6"><a href="#cancellation-and-refunds-desistimiento" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Cancellation and Refunds (Desistimiento)</a></li><li class="ml-6"><a href="#delivery-and-transport" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Delivery and Transport</a></li><li class="ml-3"><a href="#end-to-end-process-flow-overview" class="hover:text-primary pr-1 font-normal transition-all text-secondary">End-to-End Process Flow Overview</a></li><li class="ml-6"><a href="#process-phases" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Process Phases</a></li><li class="ml-3"><a href="#system-characteristics-and-design-principles" class="hover:text-primary pr-1 font-normal transition-all text-secondary">System Characteristics and Design Principles</a></li><li class="ml-6"><a href="#architectural-principles" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Architectural Principles</a></li><li class="ml-6"><a href="#technical-constraints" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Technical Constraints</a></li><li class="ml-6"><a href="#scalability-considerations" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Scalability Considerations</a></li><li class="ml-3"><a href="#document-organization" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Document Organization</a></li><li class="ml-6"><a href="#business-context-sections-2x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Business Context (Sections 2.x)</a></li><li class="ml-6"><a href="#architecture-sections-3x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Architecture (Sections 3.x)</a></li><li class="ml-6"><a href="#customer-journey-sections-4x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Customer Journey (Sections 4.x)</a></li><li class="ml-6"><a href="#external-integrations-sections-5x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">External Integrations (Sections 5.x)</a></li><li class="ml-6"><a href="#service-lifecycle-sections-6x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Service Lifecycle (Sections 6.x)</a></li><li class="ml-6"><a href="#payments-sections-7x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Payments (Sections 7.x)</a></li><li class="ml-6"><a href="#operations-sections-8x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Operations (Sections 8.x)</a></li><li class="ml-6"><a href="#failure-handling-sections-9x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Failure Handling (Sections 9.x)</a></li><li class="ml-6"><a href="#technical-reference-sections-10x" class="hover:text-primary pr-1 font-normal transition-all text-secondary">Technical Reference (Sections 10.x)</a></li></ul></div></div><div class="pointer-events-none fixed bottom-2 left-2 right-2 mt-2 md:bottom-4 md:left-0 md:right-0"><div class="z-10 mx-auto max-w-3xl"><!--$!--><template data-dgst="BAILOUT_TO_CLIENT_SIDE_RENDERING"></template><!--/$--></div></div></div></div></div><!--/$--></div><!--/$--><script src="/_next/static/chunks/webpack-acbbbb548492d4a6.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[51709,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4420\",\"static/chunks/4420-863691215dce8f1b.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"6417\",\"static/chunks/6417-34cc3208366c5e5f.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4348\",\"static/chunks/4348-824485747071bae4.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"3224\",\"static/chunks/3224-7e9887ea92eab174.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"6967\",\"static/chunks/6967-c4b815e71e97ed18.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"7177\",\"static/chunks/app/layout-37a15e31a18fac3d.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\"],\"RootProvider\"]\n3:I[87555,[],\"\"]\n4:I[31295,[],\"\"]\n6:I[90894,[],\"ClientPageRoot\"]\n7:I[87667,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4129\",\"static/chunks/7bf36345-06f80506190927ed.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"2545\",\"static/chunks/c16f53c3-1a60b9b77b3e1d4b.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4420\",\"static/chunks/4420-863691215dce8f1b.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"6417\",\"static/chunks/6417-34cc3208366c5e5f.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4348\",\"static/chunks/4348-824485747071bae4.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"3224\",\"static/chunks/3224-7e9887ea92eab174.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"2249\",\"static/chunks/2249-342d7235b3a68051.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"9970\",\"static/chunks/9970-31fea4ade6367f07.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"6967\",\"static/chunks/6967-c4b815e71e97ed18.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"1769\",\"static/chunks/1769-6bbc7ae2dcadfa9c.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"655\",\"static/c"])</script><script>self.__next_f.push([1,"hunks/655-b5574efc1f81bad2.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4154\",\"static/chunks/4154-f7634cd651686b21.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"3639\",\"static/chunks/3639-53d40fa063db1a39.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"8613\",\"static/chunks/8613-82346d348221c557.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4870\",\"static/chunks/4870-3ddb59732948b175.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"3285\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/%5B%5B...wikiRoutes%5D%5D/page-78fac26cbb8eb9a1.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\"],\"default\"]\na:I[59665,[],\"OutletBoundary\"]\nd:I[59665,[],\"ViewportBoundary\"]\nf:I[59665,[],\"MetadataBoundary\"]\n11:I[26614,[],\"\"]\n:HL[\"/_next/static/media/4cf2300e9c8272f7-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/de70bee13400563f.css?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"style\"]\n:HL[\"/_next/static/css/4095ef47de7c7e40.css?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"O81w1W7iIT8XZByyxbXso\",\"p\":\"\",\"c\":[\"\",\"jaimedpdqufv\",\"ADSI_CaaS\",\"\"],\"i\":false,\"f\":[[[\"\",{\"children\":[[\"org\",\"jaimedpdqufv\",\"d\"],{\"children\":[[\"repo\",\"ADSI_CaaS\",\"d\"],{\"children\":[[\"wikiRoutes\",\"\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/de70bee13400563f.css?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/4095ef47de7c7e40.css?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"suppressHydrationWarning\":true,\"children\":[[\"$\",\"head\",null,{}],[\"$\",\"body\",null,{\"className\":\"__variable_188709 font-geist-sans relative min-h-screen __variable_9a8899 bg-background antialiased\",\"children\":[\"$\",\"$L2\",null,{\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]],[]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}]]}],{\"children\":[[\"org\",\"jaimedpdqufv\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[[\"repo\",\"ADSI_CaaS\",\"d\"],[\"$\",\"$1\",\"c\",{\"children\":[null,\"$L5\"]}],{\"children\":[[\"wikiRoutes\",\"\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[[\"$\",\"$L6\",null,{\"Component\":\"$7\",\"searchParams\":{},\"params\":{\"org\":\"jaimedpdqufv\",\"repo\":\"ADSI_CaaS\"},\"promises\":[\"$@8\",\"$@9\"]}],\"$undefined\",null,[\"$\",\"$La\",null,{\"children\":[\"$Lb\",\"$Lc\",null]}]]}],{},null,false]},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"fNOnAXu8bLG7cff5SF6H-\",{\"children\":[[\"$\",\"$Ld\",null,{\"children\":\"$Le\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}],[\"$\",\"$Lf\",null,{\"children\":\"$L10\"}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$11\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"8:{}\n9:{\"org\":\"jaimedpdqufv\",\"repo\":\"ADSI_CaaS\"}\n"])</script><script>self.__next_f.push([1,"e:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"meta\",\"1\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\nb:null\n"])</script><script>self.__next_f.push([1,"12:I[87437,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4420\",\"static/chunks/4420-863691215dce8f1b.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"6417\",\"static/chunks/6417-34cc3208366c5e5f.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4348\",\"static/chunks/4348-824485747071bae4.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"2249\",\"static/chunks/2249-342d7235b3a68051.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"9970\",\"static/chunks/9970-31fea4ade6367f07.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"655\",\"static/chunks/655-b5574efc1f81bad2.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"3449\",\"static/chunks/3449-c19b920c18258c30.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"7553\",\"static/chunks/7553-2bb9c132a5788553.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"1127\",\"static/chunks/1127-b475c4cc62d0a830.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"736\",\"static/chunks/736-90a1c8956f4d3102.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-99964eedd99460bc.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\"],\"HeaderWrapperWithSuspense\"]\n13:I[93403,[\"9453\",\"static/chunks/b1298b8d-549c141f97a3b262.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"8970\",\"static/chunks/378e5a93-3b0f971d3611a8a5.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"1585\",\"static/chunks/f7f68e2d-40290491c524df5c.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4420\",\"static/chunks/4420-863691215dce8f1b.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"6417\",\"static/chunks/6417-34cc3208366c5e5f.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"4348\",\"static/chunks/4348-824485747071bae4.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"2249\",\"static/chunks/2249-342d7235b3a68051.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"9970\",\"static/chunks/9970-31fea4ade6367f07.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"655\",\"static/chunks/655-b5574efc1f81bad2.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpn"])</script><script>self.__next_f.push([1,"p6qW\",\"3449\",\"static/chunks/3449-c19b920c18258c30.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"7553\",\"static/chunks/7553-2bb9c132a5788553.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"1127\",\"static/chunks/1127-b475c4cc62d0a830.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"736\",\"static/chunks/736-90a1c8956f4d3102.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\",\"2933\",\"static/chunks/app/%5Borg%5D/%5Brepo%5D/layout-99964eedd99460bc.js?dpl=dpl_8ho6VV7z6qiasMParf7YFCpnp6qW\"],\"WikiContextProvider\"]\n14:T666e,"])</script><script>self.__next_f.push([1,"# Overview\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how CaaS enables dynamic vehicle feature management through Over-The-Air (OTA) configuration.\n\nFor detailed information about specific topics:\n- Business model and revenue streams: see [Business Model and Concept](#2)\n- Complete customer journey workflows: see [Customer Journey](#4)\n- External system integration details: see [External System Integrations](#5)\n- Technical architecture specifications: see [System Architecture](#3)\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## What is Car as a Service (CaaS)?\n\nCaaS is an automotive sales and service platform that implements a pay-per-use business model for vehicle features. The system enables customers to purchase a base vehicle platform and dynamically activate or deactivate optional features on-demand throughout the vehicle's lifecycle.\n\n**Core Capabilities:**\n- Vehicle sales and order management integrated with manufacturing facilities\n- Dynamic feature activation via OTA configuration\n- Subscription and one-time payment processing for vehicle services\n- Real-time vehicle connectivity through IoT infrastructure\n- Maintenance tracking and service eligibility management\n- Customer self-service through web and mobile platforms\n\n**Technical Foundation:**\nThe system leverages pre-installed vehicle firmware where all functionality exists in a dormant state. CaaS activates or deactivates features remotely without requiring physical workshop visits or software updates.\n\n**Sources:** [enunciado.md:1-7](), [pasame las preguntas y sus respuestas a markdown.md:54-56]()\n\n---\n\n## System Boundaries and External Actors\n\nThe CaaS platform operates as the central orchestration system between multiple external actors and infrastructure components. Understanding what is inside versus outside the system is critical for architectural clarity.\n\n### System Context Diagram\n\n```mermaid\ngraph TB\n    subgraph External[\"External Actors (Outside CaaS)\"]\n        CUSTOMERS[\"Customers\u003cbr/\u003e(Vehicle Purchasers)\"]\n        EMPLOYEES[\"Dealership Employees\u003cbr/\u003e(Sales Staff)\"]\n        FACTORY[\"Factory\u003cbr/\u003e(Manufacturing Facility)\"]\n        WORKSHOPS[\"Workshops\u003cbr/\u003e(Official/Approved)\"]\n        TRANSPORT[\"Transport Companies\u003cbr/\u003e(Subcontractors)\"]\n        ADMIN[\"Administrative Bodies\u003cbr/\u003e(Government Registration)\"]\n    end\n    \n    subgraph CaaS[\"CaaS Platform (Our System)\"]\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Sales Registration)\"]\n        WEB[\"Web Platform\u003cbr/\u003e(Customer Portal)\"]\n        MOBILE[\"Mobile Application\u003cbr/\u003e(Customer App)\"]\n        CORE[\"CaaS Core Services\u003cbr/\u003e(Order, Payment, Service Mgmt)\"]\n        OTA[\"OTA Configuration Engine\u003cbr/\u003e(Remote Activation)\"]\n    end\n    \n    subgraph Infrastructure[\"Vehicle Infrastructure (Assets We Manage)\"]\n        IOT[\"IoT Network\u003cbr/\u003e(Vehicle Connectivity)\"]\n        VEHICLES[\"Vehicle Fleet\u003cbr/\u003e(Connected Vehicles)\"]\n    end\n    \n    subgraph ExtSystems[\"External Systems\"]\n        FACTORY_API[\"Factory Order API\"]\n        VSS[\"VSS System\u003cbr/\u003e(Maintenance Records)\"]\n        PAYMENT_GW[\"Payment Gateway\"]\n        ADMIN_API[\"Registration API\"]\n    end\n    \n    EMPLOYEES --\u003e|\"Register Sales\"| INTRANET\n    CUSTOMERS --\u003e|\"Access Services\"| WEB\n    CUSTOMERS --\u003e|\"Access Services\"| MOBILE\n    \n    INTRANET --\u003e CORE\n    WEB --\u003e CORE\n    MOBILE --\u003e CORE\n    \n    CORE \u003c--\u003e|\"Order Management API\u003cbr/\u003e(Sync + Async)\"| FACTORY_API\n    CORE --\u003e|\"Query Maintenance\"| VSS\n    CORE --\u003e|\"Process Payments\"| PAYMENT_GW\n    CORE --\u003e|\"Register Vehicles\"| ADMIN_API\n    \n    FACTORY_API \u003c--\u003e FACTORY\n    VSS \u003c--\u003e WORKSHOPS\n    ADMIN_API \u003c--\u003e ADMIN\n    \n    CORE --\u003e OTA\n    OTA --\u003e|\"Configuration Commands\"| IOT\n    IOT \u003c--\u003e|\"Status \u0026 Config\"| VEHICLES\n    MOBILE -.-\u003e|\"Direct Link\"| VEHICLES\n    \n    FACTORY --\u003e|\"Ships\"| TRANSPORT\n    TRANSPORT --\u003e|\"Delivers\"| CUSTOMERS\n```\n\n### Key Architectural Decisions\n\n| Boundary | Entity | Classification | Rationale |\n|----------|--------|----------------|-----------|\n| **External** | Customers | Actor | Users who purchase and use services; not part of system implementation |\n| **External** | Dealership Employees | Actor | Use intranet to register sales but are not system components |\n| **External** | Factory | Actor | Separate legal/operational entity with its own systems |\n| **External** | Workshops | Actor | Independent service providers using VSS system |\n| **Internal** | Intranet, Web, Mobile | System Components | Access channels we develop and maintain |\n| **Internal** | Core Services | System Components | Business logic we implement |\n| **Internal** | OTA Engine | System Component | Feature activation logic we implement |\n| **Infrastructure** | IoT Network | Managed Asset | Communication infrastructure owned by CaaS organization |\n| **Infrastructure** | Vehicles | Managed Asset | Physical assets we sell but remain connected to our systems |\n\n**Critical Distinction:** Vehicles are **not actors**they are infrastructure components that receive configurations and report status. They do not initiate use cases; customers and employees do.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:11-16](), [enunciado.md:8-9]()\n\n---\n\n## Core Business Concept: Platform Base + Optional Services\n\n### The Two-Tier Model\n\n```mermaid\ngraph LR\n    subgraph PurchasePhase[\"Purchase Phase\"]\n        SALE[\"Vehicle Sale\"]\n        BASE[\"Plataforma Base\u003cbr/\u003e(Base Platform)\u003cbr/\u003eFully Operational Vehicle\"]\n        INITIAL[\"Optional: Initial Service Bundle\u003cbr/\u003e(Part of Plan Comercial)\"]\n    end\n    \n    subgraph OperationalPhase[\"Operational Phase - Pay Per Use\"]\n        CATALOG[\"Opciones Disponibles\u003cbr/\u003e(Available Options Catalog)\"]\n        TEMP[\"Temporary Services\u003cbr/\u003e(e.g., 1 month 50% power boost)\"]\n        PERM[\"Permanent Services\u003cbr/\u003e(e.g., Lifetime autonomous driving)\"]\n        SUBS[\"Recurring Services\u003cbr/\u003e(e.g., Monthly entertainment package)\"]\n    end\n    \n    SALE --\u003e BASE\n    SALE --\u003e INITIAL\n    BASE --\u003e CATALOG\n    INITIAL --\u003e CATALOG\n    \n    CATALOG --\u003e TEMP\n    CATALOG --\u003e PERM\n    CATALOG --\u003e SUBS\n```\n\n### Service Characteristics\n\n| Service Type | Payment Model | Duration | Example |\n|--------------|---------------|----------|---------|\n| **Plataforma Base** | One-time purchase | Vehicle lifetime | Basic operational vehicle with essential features |\n| **Initial Bundle** | Included in vehicle purchase | Per plan comercial | Customer may purchase base + some options upfront |\n| **Temporary Service** | Pay-per-use | Fixed duration (days/months) | 50% power increase for 1 month |\n| **Permanent Service** | Pay-per-use | Vehicle lifetime | Highway autonomous driving |\n| **Recurring Subscription** | Mes vencido (post-paid) | Monthly renewable | Entertainment streaming services |\n\n### Available Options (Opciones Disponibles)\n\nThe system supports various categories of optional services, all pre-installed in vehicle firmware:\n\n- **Performance enhancements**: Power increases (e.g., 50% boost)\n- **Autonomous driving**: Highway autopilot, parking assist\n- **Traction modes**: Off-road, snow, sport configurations\n- **Climate systems**: Advanced HVAC, seat heating/cooling\n- **Entertainment**: Streaming services, premium audio\n- **Driver assistance**: Lane keeping, adaptive cruise control\n\n**Technical Implementation:** All functionality exists in the vehicle firmware. CaaS only activates/deactivates features remotelyno software updates are required for service delivery.\n\n**Sources:** [enunciado.md:3-5](), [pasame las preguntas y sus respuestas a markdown.md:54-56]()\n\n---\n\n## High-Level Component Architecture\n\n### Main Subsystems\n\n```mermaid\ngraph TB\n    subgraph CustomerChannels[\"Customer Access Channels\"]\n        WEB[\"Web Platform\u003cbr/\u003eCustomer Portal\"]\n        MOBILE[\"Mobile Application\u003cbr/\u003eVehicle Control + Services\"]\n    end\n    \n    subgraph EmployeeChannels[\"Employee Access Channels\"]\n        INTRANET[\"Corporate Intranet\u003cbr/\u003eSales Registration\"]\n    end\n    \n    subgraph CoreBusiness[\"Core Business Logic\"]\n        ORDER_MGT[\"Order Management\u003cbr/\u003eReservations + Factory Orders\"]\n        SERVICE_CAT[\"Service Catalog\u003cbr/\u003eOpciones Disponibles\"]\n        PAYMENT[\"Payment Processing\u003cbr/\u003eReservations, Services, Subscriptions\"]\n        EXPEDIENTE[\"Expediente de Compra\u003cbr/\u003e(Purchase Records)\u003cbr/\u003eManuals, History, Invoices\"]\n        NOTIF[\"Notification Engine\u003cbr/\u003eEmail, App, Vehicle Display\"]\n    end\n    \n    subgraph VehicleOps[\"Vehicle Operations\"]\n        OTA_ENGINE[\"OTA Activation Engine\u003cbr/\u003eFeature Delivery\u003cbr/\u003eRetry Logic\"]\n        CONFIG[\"Configuration Repository\u003cbr/\u003eService Definitions\"]\n        STATUS[\"Vehicle Status Monitor\u003cbr/\u003eTelemetry \u0026 Health\"]\n    end\n    \n    subgraph Integration[\"Integration Layer\"]\n        FACTORY_INT[\"Factory Integration\u003cbr/\u003eOrder API + Status Webhooks\"]\n        VSS_INT[\"VSS Integration\u003cbr/\u003eMaintenance Queries\"]\n        IOT_GW[\"IoT Gateway\u003cbr/\u003eVehicle Communication\"]\n        PAYMENT_INT[\"Payment Gateway Integration\u003cbr/\u003eAsync Settlement\"]\n        ADMIN_INT[\"Admin Registration Integration\u003cbr/\u003eVehicle Matriculation\"]\n    end\n    \n    subgraph DataLayer[\"Data Layer\"]\n        CUSTOMER_DB[(\"Customer Database\")]\n        ORDER_DB[(\"Orders Database\")]\n        SERVICE_DB[(\"Services Database\")]\n        BILLING_DB[(\"Billing Database\")]\n    end\n    \n    WEB --\u003e EXPEDIENTE\n    MOBILE --\u003e EXPEDIENTE\n    INTRANET --\u003e ORDER_MGT\n    \n    EXPEDIENTE --\u003e SERVICE_CAT\n    EXPEDIENTE --\u003e CUSTOMER_DB\n    ORDER_MGT --\u003e FACTORY_INT\n    ORDER_MGT --\u003e ORDER_DB\n    SERVICE_CAT --\u003e PAYMENT\n    PAYMENT --\u003e PAYMENT_INT\n    PAYMENT --\u003e BILLING_DB\n    PAYMENT --\u003e|\"Payment Success\"| OTA_ENGINE\n    \n    OTA_ENGINE --\u003e CONFIG\n    OTA_ENGINE --\u003e IOT_GW\n    OTA_ENGINE --\u003e SERVICE_DB\n    OTA_ENGINE --\u003e NOTIF\n    \n    STATUS --\u003e IOT_GW\n    STATUS --\u003e NOTIF\n    \n    SERVICE_CAT --\u003e VSS_INT\n    ORDER_MGT --\u003e ADMIN_INT\n    FACTORY_INT --\u003e NOTIF\n```\n\n### Component Responsibilities\n\n| Component | Primary Responsibility | Key Interactions |\n|-----------|------------------------|------------------|\n| **Web Platform** | Customer self-service portal for browsing and purchasing services | Accesses Expediente de Compra, Service Catalog |\n| **Mobile Application** | Customer app for services + direct vehicle control | Accesses Expediente, communicates directly with vehicle |\n| **Corporate Intranet** | Dealership interface for registering vehicle sales | Creates orders, registers customer data |\n| **Order Management** | Handles vehicle reservations, factory orders, and delivery tracking | Factory API (sync orders), Admin API (registration) |\n| **Service Catalog** | Manages available options, pricing, and eligibility rules | VSS (maintenance checks), Payment processing |\n| **Payment Processing** | Processes reservations, final payments, and service payments | Payment Gateway, triggers OTA activation |\n| **Expediente de Compra** | Central customer data repository containing purchase history, manuals, invoices | All customer-facing channels |\n| **OTA Activation Engine** | Delivers services via remote configuration with retry logic | IoT Gateway, Configuration Repository |\n| **Notification Engine** | Multi-channel notifications (email, app push, vehicle display) | Receives events from all subsystems |\n| **IoT Gateway** | Single point of vehicle communication | Vehicle fleet via IoT Network |\n| **Factory Integration** | Synchronous order placement + asynchronous status updates | Factory Order API |\n| **VSS Integration** | Queries maintenance status to gate service availability | VSS System (read-only) |\n\n**Sources:** [enunciado.md:8-22](), [pasame las preguntas y sus respuestas a markdown.md:31-56]()\n\n---\n\n## Integration Architecture and Communication Patterns\n\n### External System Communication Model\n\n```mermaid\ngraph LR\n    subgraph CaaSCore[\"CaaS Core\"]\n        CORE[\"Core Services\"]\n    end\n    \n    subgraph FactoryComm[\"Factory Communication\"]\n        CORE --\u003e|\"POST /orders\u003cbr/\u003eSYNCHRONOUS\u003cbr/\u003eOrder Placement\"| FACTORY_API[\"Factory Order API\"]\n        FACTORY_API -.-\u003e|\"POST /webhooks/status\u003cbr/\u003eASYNCHRONOUS\u003cbr/\u003eManufacturing Updates\"| CORE\n    end\n    \n    subgraph VehicleComm[\"Vehicle Communication\"]\n        CORE --\u003e|\"POST /ota/configure\u003cbr/\u003ePush Configuration\"| IOT_API[\"API IoT\u003cbr/\u003e(Pre-existing, Documented)\"]\n        IOT_API --\u003e|\"Push to IoT Network\"| IOT_NET[\"IoT Network\"]\n        IOT_NET \u003c--\u003e|\"Bidirectional\"| VEHICLES[\"Vehicle Fleet\"]\n        VEHICLES --\u003e|\"Status Reports\"| IOT_NET\n        IOT_NET --\u003e|\"GET /vehicles/{id}/status\u003cbr/\u003ePull Telemetry\"| IOT_API\n        IOT_API --\u003e|\"Status Data\"| CORE\n    end\n    \n    subgraph MaintenanceComm[\"Maintenance Communication\"]\n        CORE --\u003e|\"GET /vehicles/{vin}/maintenance\u003cbr/\u003eSYNCHRONOUS\u003cbr/\u003eQuery Status\"| VSS_API[\"VSS API\"]\n    end\n    \n    subgraph PaymentComm[\"Payment Communication\"]\n        CORE --\u003e|\"POST /payments\u003cbr/\u003eInitiate Payment\"| PAY_GW[\"Payment Gateway\"]\n        PAY_GW -.-\u003e|\"POST /webhooks/settlement\u003cbr/\u003eASYNCHRONOUS\u003cbr/\u003eSettlement Notification\"| CORE\n    end\n```\n\n### Integration Pattern Summary\n\n| External System | Direction | Pattern | Sync/Async | Notes |\n|-----------------|-----------|---------|------------|-------|\n| **Factory API** | CaaS  Factory | Request-Response | Synchronous | Order placement with immediate confirmation |\n| **Factory API** | Factory  CaaS | Webhook | Asynchronous | Manufacturing status updates (in progress, ready, shipped) |\n| **API IoT** | CaaS  Vehicles | Command Push | Asynchronous | OTA configuration commands via IoT network |\n| **API IoT** | Vehicles  CaaS | Status Pull | Synchronous | Telemetry and health status queries |\n| **VSS System** | CaaS  VSS | Query | Synchronous | Read-only maintenance status checks |\n| **Payment Gateway** | CaaS  Gateway | Request-Response | Synchronous | Payment initiation |\n| **Payment Gateway** | Gateway  CaaS | Webhook | Asynchronous | Settlement confirmation (CaaS assumes risk) |\n| **Admin API** | CaaS  Government | Request-Response | Synchronous | Vehicle registration (blocking operation) |\n\n### Critical Integration Constraints\n\n1. **API IoT is Pre-existing:** The IoT API is already documented, tested, and ready for CaaS. It was developed in a previous project and cannot be modified. Any integration issues are attributed to the previous project, not CaaS.\n\n2. **VSS is External:** The Vehicle Service System (VSS) is maintained independently by workshops. CaaS queries it but does not write to it. Vehicles do not self-report maintenance status via IoT.\n\n3. **Asynchronous Risk Assumption:** CaaS delivers services immediately after payment initiation, before bank settlement is confirmed. This optimizes customer experience but requires risk management processes.\n\n4. **Factory Hybrid Model:** Order placement is synchronous (immediate confirmation), but manufacturing status arrives asynchronously via webhooks as production progresses.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:31-44](), [pasame las preguntas y sus respuestas a markdown.md:62-73](), [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Key Business Rules and Constraints\n\n### User Management\n\n- **No Public Registration:** All users must be known and controlled. No self-registration capability exists.\n- **Customer Provisioning:** Customers receive credentials via email after dealership sales registration.\n- **Employee Access:** Dealership employees use corporate intranet with pre-provisioned accounts.\n- **No External SSO:** No integration with Google, Microsoft, or other external identity providers.\n\n### Payment and Risk\n\n- **Vehicle Purchase:** Requires reservation payment (seal) + final payment before registration.\n- **Service Delivery:** Immediate activation after payment initiation (before settlement confirmation).\n- **Risk Assumption:** CaaS assumes financial risk for asynchronous payment settlement.\n- **Subscription Billing:** Mes vencido (post-paid) modelcharge at month end for consumed services.\n\n### OTA Activation\n\n- **Retry Logic:** Failed activations trigger N retry attempts with status monitoring.\n- **No Charge Rule:** If OTA activation fails after all retries, **customer is not charged**.\n- **Technical Support:** Failed activations are escalated to technical support for manual resolution.\n- **Customer Notification:** Customers receive status updates for all activation attempts.\n\n### Maintenance and Service Access\n\n- **Maintenance Does Not Block Vehicle:** A vehicle cannot be prevented from operating, even if maintenance is overdue.\n- **Service Gating:** Some optional services may be blocked if required maintenance is overdue (safety rationale).\n- **Warranty Loss:** Missing maintenance voids warranty but does not revoke already-purchased services.\n- **VSS as Source of Truth:** Maintenance status is queried from VSS system, not reported by vehicles.\n\n### Cancellation and Refunds (Desistimiento)\n\n| Service Duration | Cancellation Window | Refund Eligibility |\n|------------------|---------------------|-------------------|\n| \u003e 14 days | First 14 days | Full refund (legal requirement) |\n| \u003c 14 days | Anytime | Full refund (legal requirement) |\n| After window | Not applicable | No refund (service consumed) |\n\n- **Legal Compliance:** Implements EU distance selling regulations (derecho de desistimiento).\n- **Subscription Cancellation:** Customer can cancel recurring subscriptions anytime; no future charges.\n- **Theft Scenario:** Customer may cancel pending services but cannot refund already-delivered services past the desistimiento period.\n\n### Delivery and Transport\n\n- **Failed Home Delivery:** If customer is not present, vehicle returns to dealership for customer pickup.\n- **Never Leave Vehicle Unattended:** Vehicles are never left in the street due to security risks.\n- **Payment Failure Consequences:** If final payment fails, vehicle becomes dealership stock (sin asignar). Customer loses reservation entirely.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16](), [pasame las preguntas y sus respuestas a markdown.md:24-28](), [pasame las preguntas y sus respuestas a markdown.md:48-53](), [pasame las preguntas y sus respuestas a markdown.md:66-73](), [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## End-to-End Process Flow Overview\n\nThe following diagram captures the complete customer journey from initial purchase through ongoing service lifecycle:\n\n```mermaid\nflowchart TD\n    START([\"Dealership Visit\"]) --\u003e SALES[\"Sales Staff Registers Sale\u003cbr/\u003eCorporate Intranet\"]\n    SALES --\u003e RESERVE[\"Customer Pays Reservation\u003cbr/\u003e(Seal)\"]\n    RESERVE --\u003e AUTO_ORDER[\"Automatic Factory Order\u003cbr/\u003evia Factory API (Sync)\"]\n    \n    AUTO_ORDER --\u003e MFG[\"Manufacturing Process\u003cbr/\u003eStatus Notifications (Async)\"]\n    MFG --\u003e READY[\"Vehicle Ready\u003cbr/\u003eCustomer Notified\"]\n    \n    READY --\u003e FINAL_PAY[\"Customer Pays Final Amount\"]\n    FINAL_PAY --\u003e REGISTER[\"Register Vehicle\u003cbr/\u003eAdmin API (Blocking)\"]\n    REGISTER --\u003e TRANSPORT[\"Transport to\u003cbr/\u003eCustomer Address\"]\n    \n    TRANSPORT --\u003e DELIVERY{\"Customer\u003cbr/\u003ePresent?\"}\n    DELIVERY --\u003e|\"No\"| RETURN[\"Return to Dealership\u003cbr/\u003eCustomer Pickup Later\"]\n    DELIVERY --\u003e|\"Yes\"| LINK[\"Link Mobile App\u003cbr/\u003eto Vehicle\"]\n    RETURN --\u003e LINK\n    \n    LINK --\u003e OPERATIONAL[\"Vehicle Operational\u003cbr/\u003ePlataforma Base Active\"]\n    \n    OPERATIONAL --\u003e USE[\"Customer Uses Vehicle\"]\n    USE --\u003e WANT_SERVICE{\"Browse\u003cbr/\u003eServices?\"}\n    \n    WANT_SERVICE --\u003e|\"Yes\"| ACCESS[\"Access Web/Mobile\u003cbr/\u003ePlatform\"]\n    ACCESS --\u003e BROWSE[\"Browse Opciones\u003cbr/\u003eDisponibles\"]\n    \n    BROWSE --\u003e CHECK_MAINT{\"Check VSS:\u003cbr/\u003eMaintenance\u003cbr/\u003eCurrent?\"}\n    CHECK_MAINT --\u003e|\"No (Overdue)\"| BLOCKED[\"Service Blocked\u003cbr/\u003eMust Complete Maintenance\"]\n    CHECK_MAINT --\u003e|\"Yes\"| SELECT[\"Select Service\u003cbr/\u003e\u0026 Duration\"]\n    \n    BLOCKED --\u003e USE\n    SELECT --\u003e PAY[\"Pay for Service\"]\n    PAY --\u003e OTA[\"OTA Activation\u003cbr/\u003evia IoT Network\"]\n    \n    OTA --\u003e SUCCESS{\"Activation\u003cbr/\u003eSuccess?\"}\n    SUCCESS --\u003e|\"Yes\"| NOTIFY_OK[\"Notify Customer\u003cbr/\u003eService Active\"]\n    SUCCESS --\u003e|\"No\"| RETRY{\"Retries\u003cbr/\u003eRemaining?\"}\n    \n    RETRY --\u003e|\"Yes\"| OTA\n    RETRY --\u003e|\"No\"| TECH_SUP[\"Technical Support\u003cbr/\u003eNO CHARGE to Customer\"]\n    \n    NOTIFY_OK --\u003e USE\n    TECH_SUP --\u003e USE\n    WANT_SERVICE --\u003e|\"No\"| USE\n    \n    USE --\u003e CANCEL{\"Cancel\u003cbr/\u003eService?\"}\n    CANCEL --\u003e|\"Within 14 Days\"| REFUND[\"Process Refund\u003cbr/\u003e(Desistimiento)\"]\n    CANCEL --\u003e|\"After 14 Days\"| NO_REFUND[\"No Refund\u003cbr/\u003eService Consumed\"]\n    CANCEL --\u003e|\"No\"| USE\n    \n    REFUND --\u003e USE\n    NO_REFUND --\u003e USE\n```\n\n### Process Phases\n\n1. **Sales Registration:** Dealership staff register sale in corporate intranet, capturing customer data and plan comercial.\n2. **Order and Manufacturing:** Automatic order placement to factory (synchronous), with asynchronous status updates during production.\n3. **Payment and Registration:** Final payment triggers vehicle registration with government administrative bodies.\n4. **Delivery:** Home delivery with fallback to dealership pickup if customer unavailable.\n5. **Operational Lifecycle:** Continuous cycle of vehicle use and dynamic service activation.\n6. **Service Activation:** Maintenance-gated service access with robust OTA retry logic and customer protection (no charge on failure).\n7. **Cancellation:** Legal desistimiento (withdrawal) rights based on service duration and timing.\n\n**Sources:** [enunciado.md:8-22](), [pasame las preguntas y sus respuestas a markdown.md:18-29](), [pasame las preguntas y sus respuestas a markdown.md:48-53](), [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## System Characteristics and Design Principles\n\n### Architectural Principles\n\n| Principle | Implementation | Rationale |\n|-----------|----------------|-----------|\n| **Customer Protection** | Never charge for failed OTA activations | Builds trust; meets legal obligations for service delivery |\n| **Risk-Tolerant Delivery** | Activate services before payment settlement | Optimizes customer experience over financial risk |\n| **Maintenance-Gated Safety** | Block certain services if maintenance overdue | Safety and liability protection |\n| **Legal Compliance** | Built-in desistimiento (14-day withdrawal) | EU distance selling regulations |\n| **Single Source of Truth** | Expediente de Compra for customer data | Consistency across web, mobile, and intranet channels |\n| **Pre-installed Functionality** | All features exist in firmware; activation only | No software updates required for service delivery |\n| **Asynchronous Manufacturing** | Non-blocking factory status updates | System remains responsive during long manufacturing cycles |\n| **Retry with Escalation** | N retries before technical support escalation | Handles transient IoT network failures gracefully |\n\n### Technical Constraints\n\n1. **API IoT is Fixed:** Pre-existing, documented, tested. Cannot be modified for CaaS.\n2. **No Vehicle Blocking:** Cannot prevent vehicle operation, even for maintenance non-compliance.\n3. **VSS is External:** Read-only access to maintenance records; workshops maintain the data.\n4. **Multi-Country Registration:** Admin API must support country-specific vehicle registration requirements.\n5. **Known Users Only:** No public registration; all users pre-provisioned by dealership or system administrators.\n\n### Scalability Considerations\n\n- **IoT Network:** Must handle bidirectional communication with entire vehicle fleet.\n- **Notification Engine:** Multi-channel delivery (email, push, SMS, vehicle display) for all customer events.\n- **Payment Processing:** Supports concurrent transactions for reservations, services, and subscriptions.\n- **Retry Logic:** OTA engine must queue and retry failed activations without blocking other operations.\n- **Asynchronous Integration:** Factory and payment webhooks enable non-blocking external system communication.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:11-16](), [pasame las preguntas y sus respuestas a markdown.md:34-38](), [pasame las preguntas y sus respuestas a markdown.md:48-53](), [pasame las preguntas y sus respuestas a markdown.md:66-73](), [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Document Organization\n\nThis wiki is organized hierarchically to guide readers from high-level concepts to detailed technical specifications:\n\n### Business Context (Sections 2.x)\nUnderstanding the business model, actors, and policies is essential before diving into technical details. Start here to understand *why* the system works the way it does.\n\n### Architecture (Sections 3.x)\nTechnical architecture documentation covering system components, integration patterns, and design decisions. Critical for developers and architects.\n\n### Customer Journey (Sections 4.x)\nProcess flows and user experience documentation. Explains how customers interact with the system from purchase through service lifecycle.\n\n### External Integrations (Sections 5.x)\nDetailed integration specifications for Factory API, VSS, IoT/OTA, Payment Gateway, and Administrative Registration systems.\n\n### Service Lifecycle (Sections 6.x)\nDeep dive into service catalog management, OTA activation, maintenance gating, and cancellation workflows.\n\n### Payments (Sections 7.x)\nPayment types, billing models, risk management, and financial workflows.\n\n### Operations (Sections 8.x)\nOperational processes including sales, manufacturing, delivery, and maintenance management.\n\n### Failure Handling (Sections 9.x)\nSystem behavior in failure scenarios, edge cases, and error recovery procedures.\n\n### Technical Reference (Sections 10.x)\nAPI documentation guidelines, terminology glossary, and technical reference material.\n\n**Sources:** Table of contents provided in prompt"])</script><script>self.__next_f.push([1,"15:T4a8f,"])</script><script>self.__next_f.push([1,"# Business Model and Concept\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document explains the fundamental business model and value proposition of the Car as a Service (CaaS) system. It defines the core revenue streams, service delivery mechanisms, and key differentiators that distinguish CaaS from traditional automotive sales models.\n\n**Scope of this document:**\n- Core CaaS business concept and rationale\n- Revenue model and monetization strategies\n- Value proposition for customers and the business\n- High-level service delivery approach\n\n**Related documentation:**\n- For detailed explanation of platform base and optional services architecture, see [Platform Base and Optional Services](#2.1)\n- For actor definitions and system boundaries, see [Key Actors and System Boundaries](#2.2)\n- For specific business rules and policy details, see [Business Rules and Policies](#2.3)\n- For technical service lifecycle management, see [Service Lifecycle Management](#6)\n\n---\n\n## Core CaaS Business Concept\n\nThe Car as a Service (CaaS) model fundamentally changes the traditional automotive value proposition by separating **vehicle ownership** from **feature usage**. Customers purchase a fully functional base vehicle (plataforma base) and subsequently activate or deactivate optional features (opciones disponibles) on-demand throughout the vehicle's lifecycle.\n\n### Traditional vs. CaaS Model Comparison\n\n| Aspect | Traditional Model | CaaS Model |\n|--------|------------------|------------|\n| **Purchase Decision** | Customer must decide all features upfront | Customer buys base vehicle, decides features later |\n| **Feature Availability** | Fixed at purchase time | Dynamic, activatable on-demand |\n| **Revenue Timing** | One-time sale | Recurring revenue through service usage |\n| **Feature Cost** | Bundled into vehicle price | Pay-per-use (pago por uso) |\n| **Customer Flexibility** | Locked into initial configuration | Try features temporarily or permanently |\n| **Vehicle Preparation** | Features installed physically | All features pre-installed, activated remotely via OTA |\n\n### Key Business Principles\n\n1. **Ownership + Flexibility**: Customer owns the physical vehicle but rents features as needed\n2. **Pre-installed Functionality**: All optional capabilities are embedded in firmware at manufacture; CaaS only activates/deactivates them\n3. **Remote Delivery**: All services delivered via OTA (Over The Air) configuration, never requiring physical workshop visits for feature activation\n4. **Connected Infrastructure**: Every vehicle sold is IoT-connected, enabling remote configuration and status monitoring\n5. **Usage-Based Monetization**: Revenue generated throughout vehicle lifetime, not just at point of sale\n\n**Sources:** [enunciado.md:1-23]()\n\n---\n\n## Value Proposition\n\n### For Customers\n\nThe CaaS model provides multiple value dimensions for vehicle purchasers:\n\n```mermaid\ngraph TD\n    subgraph \"Customer Value Drivers\"\n        A[\"Lower Initial\u003cbr/\u003ePurchase Cost\"]\n        B[\"Try Before\u003cbr/\u003eLong-Term Commit\"]\n        C[\"Situational\u003cbr/\u003eFeature Access\"]\n        D[\"No Workshop\u003cbr/\u003eVisits for Features\"]\n        E[\"Transparent Purchase\u003cbr/\u003eHistory \u0026 Records\"]\n    end\n    \n    A --\u003e F[\"Expediente de Compra\"]\n    B --\u003e G[\"Temporary Service\u003cbr/\u003eActivation\"]\n    C --\u003e H[\"On-Demand\u003cbr/\u003eConfiguration\"]\n    D --\u003e I[\"OTA Activation\u003cbr/\u003eEngine\"]\n    E --\u003e F\n    \n    F --\u003e J[\"CaaS Platform\u003cbr/\u003eCore Services\"]\n    G --\u003e J\n    H --\u003e J\n    I --\u003e J\n    \n    style J fill:#lightgray,stroke:#333,stroke-width:2px\n```\n\n**Customer Benefits:**\n\n| Benefit | Implementation | Business Impact |\n|---------|---------------|-----------------|\n| **Reduced Upfront Cost** | Only pay for plataforma base initially | Lower barrier to entry, expanded market |\n| **Situational Feature Use** | Activate 4WD only for ski trip, not year-round | Customer pays only for actual value received |\n| **Risk-Free Trial** | Test premium features temporarily before permanent purchase | Increases conversion to permanent features |\n| **Simplified Ownership** | All manuals, invoices, service history in Expediente | Reduces customer support burden |\n| **Immediate Delivery** | OTA activation, no dealership visits | Enhanced convenience, customer satisfaction |\n\n### For the Business\n\n```mermaid\ngraph LR\n    subgraph \"Business Value Creation\"\n        V1[\"Recurring Revenue\u003cbr/\u003eStream\"]\n        V2[\"Higher Customer\u003cbr/\u003eLifetime Value\"]\n        V3[\"Manufacturing\u003cbr/\u003eSimplification\"]\n        V4[\"Upsell\u003cbr/\u003eOpportunities\"]\n        V5[\"Usage Data\u003cbr/\u003eIntelligence\"]\n    end\n    \n    V1 --\u003e R[\"Revenue Model\"]\n    V2 --\u003e R\n    V3 --\u003e M[\"Operations\"]\n    V4 --\u003e R\n    V5 --\u003e D[\"Strategic Insights\"]\n    \n    R --\u003e B[\"Business Outcomes\"]\n    M --\u003e B\n    D --\u003e B\n    \n    style B fill:#lightgray,stroke:#333,stroke-width:2px\n```\n\n**Business Advantages:**\n\n1. **Predictable Recurring Revenue**: Services generate ongoing cash flow beyond initial vehicle sale\n2. **Inventory Simplification**: Manufacture single base configuration per model, differentiate in software\n3. **Manufacturing Efficiency**: No need to track hundreds of configuration permutations at factory\n4. **Customer Lock-In**: Once subscribed to features, high switching cost to competitor\n5. **Feature Optimization**: Usage data informs which features to invest in vs. deprecate\n6. **Warranty Management**: Maintenance-linked services enforce proper vehicle care (see [Maintenance-Linked Service Access](#6.3))\n\n**Sources:** [enunciado.md:1-7](), [pasame las preguntas y sus respuestas a markdown.md:77-89]()\n\n---\n\n## Revenue Model\n\nThe CaaS business generates revenue through multiple streams across the vehicle purchase and ownership lifecycle:\n\n### Revenue Streams Diagram\n\n```mermaid\ngraph TD\n    subgraph \"Initial Sale Revenue\"\n        R1[\"Reservation Signal\u003cbr/\u003e(Seal)\"]\n        R2[\"Final Vehicle Payment\u003cbr/\u003e(Pago Final)\"]\n    end\n    \n    subgraph \"Ongoing Service Revenue\"\n        R3[\"One-Time Service\u003cbr/\u003eActivation\"]\n        R4[\"Temporary Service\u003cbr/\u003e(Time-Limited)\"]\n        R5[\"Permanent Service\u003cbr/\u003e(Lifetime)\"]\n        R6[\"Subscription Service\u003cbr/\u003e(Mes Vencido)\"]\n    end\n    \n    subgraph \"Service Packages\"\n        P1[\"Plan Comercial\u003cbr/\u003eBundled Services\"]\n    end\n    \n    R1 --\u003e C[\"Customer Payment\u003cbr/\u003eProcessing\"]\n    R2 --\u003e C\n    R3 --\u003e C\n    R4 --\u003e C\n    R5 --\u003e C\n    R6 --\u003e C\n    P1 --\u003e R2\n    \n    C --\u003e S[\"Service Catalog\u003cbr/\u003ePricing Engine\"]\n    S --\u003e DB[\"Billing Database\"]\n    \n    style C fill:#lightgray,stroke:#333,stroke-width:2px\n    style S fill:#lightgray,stroke:#333,stroke-width:2px\n```\n\n### Revenue Stream Details\n\n| Revenue Stream | Timing | Amount | Characteristics | Related System Component |\n|----------------|--------|--------|-----------------|--------------------------|\n| **Reservation Signal** | At dealership sale | Partial payment | Reserves vehicle, triggers factory order | Order Management API |\n| **Final Vehicle Payment** | Before registration | Remainder of base price + plan comercial | Enables vehicle registration and delivery | Payment Processing |\n| **One-Time Service** | On-demand during ownership | Per-service pricing | Single activation, permanent or temporary | Service Catalog |\n| **Subscription Service** | Monthly recurring | Monthly fee | Billed mes vencido (post-paid) | Subscription Billing Engine |\n| **Plan Comercial Bundle** | Included in initial sale | Bundled with base vehicle | Specific opciones available for vehicle lifetime | Service Configuration Repository |\n\n### Payment Timing Models\n\nThe CaaS system implements different payment timing strategies based on service type:\n\n```mermaid\nsequenceDiagram\n    participant C as Customer\n    participant P as Payment Gateway\n    participant S as CaaS Service\u003cbr/\u003eDelivery\n    participant B as Billing System\n    \n    Note over C,B: One-Time Service Purchase\n    C-\u003e\u003eP: Pay for Service\n    P--\u003e\u003eS: Payment Initiated\u003cbr/\u003e(Async Settlement)\n    S-\u003e\u003eC: Deliver Service Immediately\n    Note over S: CaaS Assumes\u003cbr/\u003eSettlement Risk\n    P-\u003e\u003eB: Confirm Settlement\u003cbr/\u003e(Later)\n    \n    Note over C,B: Subscription Service (Mes Vencido)\n    S-\u003e\u003eC: Service Active Month 1\n    Note over B: Month End\n    B-\u003e\u003eP: Charge for Previous Month\n    P-\u003e\u003eC: Invoice\n    C-\u003e\u003eP: Pay (if continues)\n    P--\u003e\u003eB: Settlement\n    \n    Note over C,B: Vehicle Purchase\n    C-\u003e\u003eP: Reservation Signal\n    P--\u003e\u003eB: Confirm\n    Note over B: Manufacturing Period\n    B-\u003e\u003eC: Request Final Payment\n    C-\u003e\u003eP: Final Payment\n    P--\u003e\u003eB: Confirm\n    Note over B: Enable Registration\n```\n\n**Key Payment Policies:**\n\n1. **Immediate Service Delivery**: Services activated before payment fully settles (CaaS assumes settlement risk for customer experience)\n2. **Mes Vencido Subscriptions**: Monthly subscriptions billed at end of month for consumed services (post-paid model)\n3. **Failed Final Payment**: If customer cannot complete final vehicle payment, vehicle becomes dealership stock (\"sin asignar\")\n4. **OTA Failure Protection**: If service cannot be activated, customer is **never charged** (see [OTA Activation Failures](#9.1))\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:75-96](), [enunciado.md:8-13]()\n\n---\n\n## Service Delivery Model\n\nThe CaaS service delivery model is predicated on remote, automated activation of pre-installed vehicle functionality:\n\n### Service Activation Flow\n\n```mermaid\nflowchart TD\n    START[\"Customer Requests\u003cbr/\u003eService\"] --\u003e CAT[\"Browse Service\u003cbr/\u003eCatalog\"]\n    CAT --\u003e MAINT{\"Maintenance-Linked\u003cbr/\u003eService?\"}\n    \n    MAINT --\u003e|No| PRICE[\"Display Pricing\u003cbr/\u003eOptions\"]\n    MAINT --\u003e|Yes| VSS[\"Query VSS System\u003cbr/\u003eMaintenance Status\"]\n    \n    VSS --\u003e CURRENT{\"Maintenance\u003cbr/\u003eCurrent?\"}\n    CURRENT --\u003e|Yes| PRICE\n    CURRENT --\u003e|No| BLOCK[\"Service Unavailable\u003cbr/\u003eComplete Maintenance First\"]\n    \n    PRICE --\u003e SELECT[\"Customer Selects:\u003cbr/\u003eDuration \u0026 Type\"]\n    SELECT --\u003e PAY[\"Customer Pays\"]\n    \n    PAY --\u003e QUEUE[\"OTA Activation\u003cbr/\u003eQueue\"]\n    QUEUE --\u003e IOT[\"API IoT\u003cbr/\u003eSend Config\"]\n    IOT --\u003e VEHICLE[\"Vehicle Receives\u003cbr/\u003eConfiguration\"]\n    \n    VEHICLE --\u003e SUCCESS{\"Activation\u003cbr/\u003eSuccessful?\"}\n    SUCCESS --\u003e|Yes| NOTIFY[\"Notify Customer\u003cbr/\u003eService Active\"]\n    SUCCESS --\u003e|No| RETRY[\"Retry Logic\u003cbr/\u003eN Attempts\"]\n    \n    RETRY --\u003e FINAL{\"Success After\u003cbr/\u003eRetry?\"}\n    FINAL --\u003e|Yes| NOTIFY\n    FINAL --\u003e|No| SUPPORT[\"Technical Support\u003cbr/\u003eDO NOT CHARGE\"]\n    \n    NOTIFY --\u003e ACTIVE[\"Service Active\u003cbr/\u003ein Vehicle\"]\n    BLOCK --\u003e END[\"Flow Ends\"]\n    SUPPORT --\u003e END\n    ACTIVE --\u003e END\n    \n    style QUEUE fill:#lightgray,stroke:#333,stroke-width:2px\n    style IOT fill:#lightgray,stroke:#333,stroke-width:2px\n    style SUPPORT fill:#lightgray,stroke:#333,stroke-width:2px\n```\n\n### Key Delivery Mechanisms\n\n| Component | Function | Business Rationale |\n|-----------|----------|-------------------|\n| **Service Catalog** | Lists available opciones for each plataforma base | Ensures only compatible services offered |\n| **VSS Integration** | Queries maintenance status before service sale | Protects warranty, ensures safety compliance |\n| **OTA Activation Engine** | Remotely configures vehicle via API IoT | Eliminates workshop visits, instant gratification |\n| **Retry Logic** | Attempts activation multiple times before failure | Maximizes successful delivery rate |\n| **Technical Support Escalation** | Manual intervention when OTA fails | Ensures customer never charged for non-delivered service |\n| **Expediente de Compra** | Customer's consolidated purchase record | Single source of truth for all services, history, invoices |\n\n### Pre-Installed Functionality Model\n\nA critical architectural principle of CaaS is that **all optional features are embedded in vehicle firmware at manufacture**. The CaaS system only activates or deactivates existing functionality; it never installs new software as part of service delivery.\n\n**Business Implications:**\n\n1. **Instant Activation**: No lengthy download or installation process\n2. **Predictable Testing**: All features tested during manufacturing quality assurance\n3. **Reduced Failure Modes**: Activation is simple configuration change, not complex software update\n4. **Manufacturing Cost**: Higher upfront BOM (Bill of Materials) but simplified production\n5. **Security**: No third-party software distribution risk\n\n**Sources:** [enunciado.md:14-23](), [pasame las preguntas y sus respuestas a markdown.md:31-57]()\n\n---\n\n## Business Ecosystem and Boundaries\n\nThe CaaS business model operates within a complex ecosystem of external entities and systems:\n\n### Ecosystem Diagram\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Business\"\n        CAAS[\"CaaS Core\u003cbr/\u003ePlatform\"]\n        WEB[\"Web Platform\u003cbr/\u003eCustomer Portal\"]\n        MOBILE[\"Mobile Application\u003cbr/\u003eDirect Vehicle Link\"]\n        INTRA[\"Corporate Intranet\u003cbr/\u003eSales Registration\"]\n    end\n    \n    subgraph \"Sales Channel\"\n        DEALER[\"Concesionario\u003cbr/\u003e(Dealership)\"]\n        SALES[\"Sales Staff\u003cbr/\u003eRegistro de Venta\"]\n    end\n    \n    subgraph \"Manufacturing\"\n        FACTORY[\"Fbrica\u003cbr/\u003e(Manufacturing)\"]\n        FACTORY_API[\"Factory API\u003cbr/\u003eOrder \u0026 Status\"]\n    end\n    \n    subgraph \"Service Ecosystem\"\n        WORKSHOP[\"Talleres\u003cbr/\u003e(Workshops)\"]\n        VSS[\"VSS System\u003cbr/\u003eService Records\"]\n        TRANSPORT[\"Transport Company\u003cbr/\u003eVehicle Delivery\"]\n    end\n    \n    subgraph \"Customer Domain\"\n        CUSTOMER[\"Customer\u003cbr/\u003eVehicle Owner\"]\n    end\n    \n    subgraph \"Infrastructure\"\n        IOT[\"IoT Network\u003cbr/\u003eVehicle Connectivity\"]\n        PAYMENT[\"Payment Gateway\u003cbr/\u003eCard Processing\"]\n        ADMIN[\"Administrative Bodies\u003cbr/\u003eVehicle Registration\"]\n    end\n    \n    SALES --\u003e INTRA\n    INTRA --\u003e CAAS\n    CAAS --\u003e FACTORY_API\n    FACTORY_API --\u003e FACTORY\n    \n    CUSTOMER --\u003e WEB\n    CUSTOMER --\u003e MOBILE\n    CUSTOMER --\u003e DEALER\n    \n    WEB --\u003e CAAS\n    MOBILE --\u003e CAAS\n    \n    FACTORY --\u003e TRANSPORT\n    TRANSPORT --\u003e DEALER\n    TRANSPORT --\u003e CUSTOMER\n    \n    CUSTOMER --\u003e WORKSHOP\n    WORKSHOP --\u003e VSS\n    CAAS --\u003e VSS\n    \n    CAAS --\u003e IOT\n    IOT --\u003e MOBILE\n    \n    CAAS --\u003e PAYMENT\n    CAAS --\u003e ADMIN\n    \n    style CAAS fill:#lightgray,stroke:#333,stroke-width:3px\n    style CUSTOMER fill:#lightgray,stroke:#333,stroke-width:2px\n```\n\n### Business Entity Roles\n\n| Entity | Role in CaaS Ecosystem | Relationship Type |\n|--------|------------------------|-------------------|\n| **Concesionario (Dealership)** | Sales initiation point, vehicle delivery location | Partner (company-owned or franchised) |\n| **Fbrica (Factory)** | Manufacturing entity, order fulfillment | Internal (same corporate entity as CaaS) |\n| **Customer** | Vehicle owner, service purchaser | Primary external actor |\n| **Sales Staff** | Register sales, capture customer data | Employees (system users) |\n| **Talleres (Workshops)** | Perform maintenance, record service history | Partners (official or authorized) |\n| **VSS System** | Maintenance tracking system | External system (workshop-maintained) |\n| **Transport Company** | Physical vehicle delivery | Subcontractor |\n| **Payment Gateway** | Financial transaction processing | Third-party service |\n| **Administrative Bodies** | Vehicle registration authorities | Government entities (per country) |\n\n### Key Business Boundaries\n\n**What CaaS Controls:**\n- Customer purchase records (Expediente de Compra)\n- Service catalog and pricing (Opciones Disponibles)\n- Vehicle configuration via OTA\n- Payment processing and billing\n- Manufacturing order placement\n- Customer communications and notifications\n\n**What CaaS Does NOT Control:**\n- Manufacturing schedule and capacity (Factory determines)\n- Maintenance execution (Customer decides when/where)\n- Maintenance record-keeping (VSS system, managed by workshops)\n- Vehicle registration process (Administrative bodies)\n- Physical transport logistics (Subcontracted)\n- Payment settlement timing (Asynchronous, bank-controlled)\n\n**Critical Business Constraints:**\n1. **No User Self-Registration**: All customers must be known and vetted (purchased vehicle or are employees)\n2. **Factory API Pre-Exists**: CaaS must use existing factory integration (see [Factory Integration](#5.1))\n3. **API IoT Pre-Exists**: Vehicle communication infrastructure already deployed (see [Vehicle Communication (IoT and OTA)](#5.3))\n4. **Cannot Block Vehicle Operation**: Even if maintenance overdue, vehicle cannot be prevented from driving (legal constraint)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-16, 18-29, 58-73](), [enunciado.md:8-17]()\n\n---\n\n## Business Model Summary\n\nThe CaaS business model represents a fundamental shift in automotive value delivery:\n\n### Core Business Formula\n\n**Traditional Model:**  \n`Revenue = Vehicle Sale Price (one-time)`\n\n**CaaS Model:**  \n`Revenue = Vehicle Base Price + (Service Activations) + (Subscriptions) + Lifetime Value`\n\n### Strategic Advantages\n\n1. **Extended Revenue Timeline**: Generate income throughout vehicle ownership, not just at sale\n2. **Feature Monetization**: Extract value from R\u0026D investment over time through usage fees\n3. **Market Segmentation**: Offer same base vehicle to budget and premium customers, differentiated by activated services\n4. **Customer Data**: Continuous interaction provides insights into feature preferences and usage patterns\n5. **Agile Feature Development**: Can deploy new services remotely to existing vehicle fleet via OTA\n6. **Manufacturing Efficiency**: Simplified production with software-based differentiation\n\n### Risk Factors\n\n| Risk | Mitigation Strategy | Implementation |\n|------|---------------------|----------------|\n| **OTA Activation Failure** | Never charge if service not delivered | Automatic retry + technical support escalation |\n| **Payment Settlement Delay** | Assume settlement risk, deliver immediately | Asynchronous payment processing with reconciliation |\n| **Customer Churn** | 14-day desistimiento (withdrawal) rights | Liberal refund policy for customer confidence |\n| **Maintenance Non-Compliance** | Link premium services to maintenance status | VSS integration gates service availability |\n| **Failed Final Payment** | Vehicle becomes dealership stock | Clear policy: no payment = no delivery, vehicle reused |\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\nFor detailed information on specific aspects of the business model:\n- **Service structure and pricing details**: See [Platform Base and Optional Services](#2.1)\n- **Actor definitions and responsibilities**: See [Key Actors and System Boundaries](#2.2)  \n- **Detailed business rules and policies**: See [Business Rules and Policies](#2.3)\n- **Complete customer journey walkthrough**: See [Customer Journey](#4)\n- **Service lifecycle management**: See [Service Lifecycle Management](#6)\n- **Payment processing details**: See [Payment and Billing](#7)"])</script><script>self.__next_f.push([1,"16:T45bf,"])</script><script>self.__next_f.push([1,"# Platform Base and Optional Services\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page explains the fundamental business concept underlying the Car as a Service (CaaS) system: the separation of vehicle ownership into a **plataforma base** (base platform) that customers purchase outright, and **opciones disponibles** (available options) that can be activated on demand using a **pago por uso** (pay-per-use) model. This architectural decision enables the core value proposition of the CaaS system.\n\nFor information about how services are technically activated via OTA, see [OTA Service Activation](#6.2). For pricing details and catalog structure, see [Service Catalog and Pricing](#6.1). For business rules governing service access, see [Business Rules and Policies](#2.3).\n\n**Sources:** [enunciado.md:1-23]()\n\n---\n\n## Core Concepts\n\n### Plataforma Base (Base Platform)\n\nThe **plataforma base** represents the base vehicle model that a customer purchases and owns. It includes all fundamental characteristics necessary to make the vehicle **fully operational** from the moment of delivery. This is not a limited or demo versionit is a complete, functional vehicle capable of normal operation.\n\nThe base platform serves as:\n- The **minimum viable product** that customers acquire in ownership\n- The **foundation** upon which optional services can be activated\n- A **specific model configuration** (e.g., sedan, SUV, compact) with its own technical specifications\n\n**Key Business Rule:** The base platform is **always included** in any vehicle sale. Customers cannot purchase a vehicle without it, nor can they purchase only optional services without the base platform.\n\n### Opciones Disponibles (Available Options)\n\n**Opciones disponibles** are additional features and capabilities that are **pre-installed in the vehicle hardware** but remain dormant until activated through the CaaS platform. Each base platform has a **specific and predetermined set** of available options that are technically compatible with that model.\n\nExamples of opciones disponibles include:\n\n| Service Category | Example Features |\n|------------------|------------------|\n| **Performance** | 50% power increase |\n| **Autonomous Driving** | Highway autonomous driving capability |\n| **Driver Assistance** | Advanced driver assistance systems (ADAS) |\n| **Traction \u0026 Terrain** | Specific traction modes for different environmental and road surface conditions |\n| **Climate Control** | Different types of climate control systems |\n| **Entertainment** | On-board entertainment services |\n\nThese features are **technologically embedded** in the vehicle but require **software activation** to become usable.\n\n### Pago por Uso (Pay-Per-Use) Model\n\nThe **pago por uso** model is the core revenue mechanism for opciones disponibles. Instead of requiring upfront payment for all features at vehicle purchase time, customers:\n\n1. **Purchase the base platform** outright (traditional ownership model)\n2. **Activate optional services on demand** as needed (pay-per-use model)\n3. **Pay only for the duration they use** each service\n\nThis model provides:\n- **Lower initial purchase price** (only the base platform)\n- **Flexibility** to customize vehicle capabilities based on changing needs\n- **Reduced financial risk** for customers uncertain about feature value\n- **Recurring revenue stream** for the business\n\n**Sources:** [enunciado.md:3-5]()\n\n---\n\n## Service Delivery Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Vehicle Hardware\"\n        BASE[\"Plataforma Base\u003cbr/\u003e(Base Platform)\u003cbr/\u003eAlways Active\"]\n        OPTION1[\"Opcin: Power Boost\u003cbr/\u003ePre-installed\u003cbr/\u003eInitially Dormant\"]\n        OPTION2[\"Opcin: Autonomous Driving\u003cbr/\u003ePre-installed\u003cbr/\u003eInitially Dormant\"]\n        OPTION3[\"Opcin: Climate Control\u003cbr/\u003ePre-installed\u003cbr/\u003eInitially Dormant\"]\n        OPTIONN[\"Opcin: Entertainment\u003cbr/\u003ePre-installed\u003cbr/\u003eInitially Dormant\"]\n    end\n    \n    subgraph \"CaaS Platform\"\n        CATALOG[\"Service Catalog\u003cbr/\u003eOpciones Disponibles\"]\n        PAYMENT[\"Payment Processing\"]\n        OTA[\"OTA Activation System\"]\n    end\n    \n    subgraph \"Customer Interaction\"\n        CUSTOMER[\"Customer\"]\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile Application\"]\n    end\n    \n    BASE -.-\u003e|\"Enables\"| OPTION1\n    BASE -.-\u003e|\"Enables\"| OPTION2\n    BASE -.-\u003e|\"Enables\"| OPTION3\n    BASE -.-\u003e|\"Enables\"| OPTIONN\n    \n    CUSTOMER --\u003e|\"Browse Services\"| WEB\n    CUSTOMER --\u003e|\"Browse Services\"| MOBILE\n    WEB --\u003e CATALOG\n    MOBILE --\u003e CATALOG\n    \n    CATALOG --\u003e|\"Select \u0026 Purchase\"| PAYMENT\n    PAYMENT --\u003e|\"Payment Successful\"| OTA\n    \n    OTA --\u003e|\"Activate Feature\"| OPTION1\n    OTA --\u003e|\"Activate Feature\"| OPTION2\n    OTA --\u003e|\"Activate Feature\"| OPTION3\n    OTA --\u003e|\"Activate Feature\"| OPTIONN\n```\n\n**Architecture Principle: Pre-Installation + Remote Activation**\n\nAll opciones disponibles are **physically present** in the vehicle at delivery time. The vehicle hardware includes sensors, actuators, and computing capabilities for all potential features. However, these features are **software-locked** until activated through the CaaS platform.\n\nThis approach provides:\n- **Instant activation**: No need for physical installation or dealership visit\n- **Reversible changes**: Features can be deactivated if subscription ends\n- **Standardized manufacturing**: All vehicles of a given base platform have identical hardware\n- **Remote delivery**: Services delivered via OTA configuration updates\n\n**Sources:** [enunciado.md:3-7](), [enunciado.md:19-20]()\n\n---\n\n## Service Duration Models\n\nThe CaaS system supports three distinct temporal models for service activation:\n\n```mermaid\ngraph LR\n    subgraph \"Service Duration Types\"\n        TEMP[\"Temporary Service\u003cbr/\u003e(Tiempo Determinado)\u003cbr/\u003eExample: Power boost for 1 month\"]\n        PERM[\"Permanent Service\u003cbr/\u003e(Vida til del Vehculo)\u003cbr/\u003eExample: Autonomous driving forever\"]\n        PLAN[\"Planned/Recurring Service\u003cbr/\u003e(Planificada/Recurrente)\u003cbr/\u003eExample: Climate control every winter\"]\n    end\n    \n    subgraph \"Activation Timing\"\n        NOW[\"Activate Now\u003cbr/\u003e(Immediate)\"]\n        FUTURE[\"Activate Later\u003cbr/\u003e(Scheduled)\"]\n        RECURRING[\"Activate Periodically\u003cbr/\u003e(Recurring Pattern)\"]\n    end\n    \n    TEMP --\u003e NOW\n    TEMP --\u003e FUTURE\n    \n    PERM --\u003e NOW\n    PERM --\u003e FUTURE\n    \n    PLAN --\u003e FUTURE\n    PLAN --\u003e RECURRING\n```\n\n### Temporary Services (Tiempo Determinado)\n\nTemporary services are activated for a **specific time period**, after which they automatically deactivate unless renewed.\n\n**Use Cases:**\n- Customer needs power boost only during summer vacation road trip\n- Customer wants entertainment services for a specific journey\n- Customer testing a feature before committing to permanent purchase\n\n**Business Characteristics:**\n- **Fixed duration pricing**: Customer pays for specific time period (e.g., 1 day, 1 week, 1 month)\n- **Automatic expiration**: System deactivates feature when period ends\n- **Renewable**: Customer can extend or re-purchase\n- **Pro-rated or fixed**: Pricing can be time-based\n\n### Permanent Services (Vida til del Vehculo)\n\nPermanent services remain active **until the end of the vehicle's operational life**.\n\n**Use Cases:**\n- Customer decides autonomous driving is essential\n- Customer permanently wants advanced climate control\n- Customer converts temporary service to permanent after testing\n\n**Business Characteristics:**\n- **One-time payment**: Higher upfront cost compared to temporary\n- **Lifetime activation**: Never expires or requires renewal\n- **Transferable with vehicle**: If vehicle sold, feature remains active\n- **Higher revenue per transaction**: Captures lifetime value upfront\n\n### Planned and Recurring Services (Planificada/Recurrente)\n\nPlanned services are **scheduled for future activation**, either as one-time events or recurring patterns.\n\n**Use Cases:**\n- Customer schedules power boost for upcoming vacation (planned)\n- Customer wants entertainment services every weekend (recurring)\n- Customer needs winter traction mode every winter season (recurring)\n\n**Business Characteristics:**\n- **Future-dated activation**: Service purchased now, activated later\n- **Recurring billing**: For recurring patterns, charged periodically\n- **Subscription-like**: Similar to subscription model but more flexible\n- **Predictable revenue**: Business can forecast recurring service revenue\n\n**Sources:** [enunciado.md:19-21]()\n\n---\n\n## Service Lifecycle State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Available: \"Service in Catalog\"\n    \n    Available --\u003e Selected: \"Customer Browses\u003cbr/\u003e\u0026 Selects\"\n    Selected --\u003e PendingPayment: \"Customer Initiates\u003cbr/\u003ePurchase\"\n    \n    PendingPayment --\u003e Available: \"Payment Fails\"\n    PendingPayment --\u003e PendingActivation: \"Payment Successful\"\n    \n    PendingActivation --\u003e Active: \"OTA Activation\u003cbr/\u003eSuccessful\"\n    PendingActivation --\u003e TechnicalFailure: \"OTA Activation\u003cbr/\u003eFailed\"\n    \n    TechnicalFailure --\u003e Available: \"No Charge to Customer\u003cbr/\u003eService Cancelled\"\n    \n    state Active {\n        [*] --\u003e InUse\n        InUse --\u003e Cancelled: \"Customer Cancels\u003cbr/\u003e(if eligible)\"\n        Cancelled --\u003e Refunded: \"Within Refund Period\"\n        Cancelled --\u003e Expired: \"No Refund Period\"\n    }\n    \n    Active --\u003e Expired: \"Temporary Service\u003cbr/\u003eTime Expires\"\n    Active --\u003e PermanentlyActive: \"Permanent Service\u003cbr/\u003eLifetime Active\"\n    \n    Expired --\u003e Available: \"Can Re-purchase\"\n    Refunded --\u003e Available: \"Can Re-purchase\"\n    \n    PermanentlyActive --\u003e [*]: \"Vehicle End of Life\"\n```\n\n**Key State Transitions:**\n\n- **Available  Selected**: Customer browses service catalog via web or mobile platform\n- **PendingPayment  PendingActivation**: Payment gateway confirms successful transaction\n- **PendingActivation  Active**: OTA system successfully delivers configuration to vehicle\n- **Active  Expired**: For temporary services, system automatically deactivates after duration\n- **Active  Cancelled**: Customer exercises cancellation rights (subject to refund policies)\n- **TechnicalFailure  Available**: If OTA fails, customer is **not charged** and service returns to catalog\n\n**Sources:** [enunciado.md:19-20]()\n\n---\n\n## Relationship to Plan Comercial\n\nWhen a customer purchases a vehicle, they select a **plan comercial** (commercial plan) that defines:\n\n1. **The specific plataforma base** (which model/configuration)\n2. **A set of opciones disponibles that will be included** for the entire service period\n3. **Pricing and payment terms** for the base vehicle\n\n```mermaid\ngraph TB\n    subgraph \"Plan Comercial (Defined at Purchase)\"\n        PC_BASE[\"Plataforma Base\u003cbr/\u003e(Mandatory)\"]\n        PC_INCLUDED[\"Included Opciones\u003cbr/\u003e(Active During Entire Service Period)\"]\n        PC_TERMS[\"Payment Terms\u003cbr/\u003e(Pricing, Warranty, Maintenance)\"]\n    end\n    \n    subgraph \"Post-Purchase (Customer-Driven)\"\n        ADDITIONAL[\"Additional Opciones\u003cbr/\u003e(Purchased On-Demand)\"]\n        TEMP_SERVICES[\"Temporary Activations\"]\n        PERM_SERVICES[\"Permanent Additions\"]\n    end\n    \n    PC_BASE -.-\u003e|\"Enables\"| PC_INCLUDED\n    PC_BASE -.-\u003e|\"Enables\"| ADDITIONAL\n    \n    ADDITIONAL --\u003e TEMP_SERVICES\n    ADDITIONAL --\u003e PERM_SERVICES\n    \n    PC_INCLUDED --\u003e|\"Always Active\"| VEHICLE[\"Customer's Vehicle\"]\n    TEMP_SERVICES --\u003e|\"Time-Limited\"| VEHICLE\n    PERM_SERVICES --\u003e|\"Lifetime\"| VEHICLE\n```\n\n**Distinction:**\n- **Plan Comercial Opciones**: Defined at purchase, included in sale price, remain active throughout vehicle ownership\n- **On-Demand Opciones**: Purchased after vehicle delivery using pago por uso model\n\nThis distinction is important because:\n- **Plan Comercial opciones** do not require payment processing after purchase\n- **On-Demand opciones** require payment, OTA activation, and ongoing billing management\n- Both types share the same **technical delivery mechanism** (OTA activation)\n\n**Sources:** [enunciado.md:9-10]()\n\n---\n\n## Service Catalog Organization\n\nThe service catalog organizes opciones disponibles in a structured hierarchy:\n\n```mermaid\ngraph TB\n    CATALOG[\"Service Catalog\u003cbr/\u003e(Opciones Disponibles)\"]\n    \n    subgraph \"Organization Dimensions\"\n        BY_PLATFORM[\"By Plataforma Base\u003cbr/\u003e(Model-Specific)\"]\n        BY_CATEGORY[\"By Category\u003cbr/\u003e(Performance, Safety, Comfort, etc.)\"]\n        BY_DURATION[\"By Duration Model\u003cbr/\u003e(Temporary, Permanent, Recurring)\"]\n    end\n    \n    CATALOG --\u003e BY_PLATFORM\n    CATALOG --\u003e BY_CATEGORY\n    CATALOG --\u003e BY_DURATION\n    \n    subgraph \"Service Attributes\"\n        COMPAT[\"Hardware Compatibility\u003cbr/\u003e(Which platforms support this?)\"]\n        PRICE[\"Pricing Structure\u003cbr/\u003e(Duration-based rates)\"]\n        MAINT[\"Maintenance Dependencies\u003cbr/\u003e(Requires current maintenance?)\"]\n        TECH[\"Technical Requirements\u003cbr/\u003e(Vehicle software version, etc.)\"]\n    end\n    \n    BY_PLATFORM --\u003e COMPAT\n    BY_CATEGORY --\u003e MAINT\n    BY_DURATION --\u003e PRICE\n    \n    COMPAT --\u003e SERVICE[\"Individual Service\"]\n    PRICE --\u003e SERVICE\n    MAINT --\u003e SERVICE\n    TECH --\u003e SERVICE\n```\n\n**Key Catalog Attributes:**\n\n| Attribute | Description | Example |\n|-----------|-------------|---------|\n| **Service ID** | Unique identifier | `PWR_BOOST_50` |\n| **Service Name** | Customer-facing name | \"50% Power Increase\" |\n| **Category** | Service classification | Performance, Safety, Comfort, Entertainment |\n| **Compatible Platforms** | Which base platforms support this | Platform A, Platform C |\n| **Duration Models** | Supported temporal models | Temporary, Permanent |\n| **Pricing Tiers** | Price by duration | 1 day: 10, 1 month: 50, Permanent: 500 |\n| **Maintenance Dependency** | Requires current maintenance | Yes/No |\n| **Technical Dependencies** | Software/hardware requirements | Min. firmware version 2.3 |\n\n**Sources:** [enunciado.md:3](), [enunciado.md:23]()\n\n---\n\n## Interaction with Vehicle Connectivity\n\nAll vehicles sold through the CaaS system are **connected via IoT network**, enabling:\n\n1. **Service activation delivery**: OTA commands sent to vehicle\n2. **Vehicle status monitoring**: Real-time operational state\n3. **Remote configuration management**: Feature enable/disable\n4. **Telemetry collection**: Usage data for billing and analytics\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant \"CaaS Platform\" as CaaS\n    participant \"IoT Network\" as IoT\n    participant Vehicle\n    \n    Note over Vehicle: All Opciones Pre-installed\u003cbr/\u003ebut Dormant\n    \n    Customer-\u003e\u003eCaaS: Browse Opciones Disponibles\n    CaaS-\u003e\u003eCustomer: Display Available Services\n    Customer-\u003e\u003eCaaS: Select Service + Duration\n    Customer-\u003e\u003eCaaS: Complete Payment\n    \n    CaaS-\u003e\u003eIoT: Send OTA Activation Command\n    IoT-\u003e\u003eVehicle: Deliver Configuration Update\n    Vehicle-\u003e\u003eVehicle: Activate Feature\n    Vehicle-\u003e\u003eIoT: Confirm Activation\n    IoT-\u003e\u003eCaaS: Activation Successful\n    \n    CaaS-\u003e\u003eCustomer: Notify Service Active\n    \n    Note over Vehicle: Feature Now Usable\n    \n    alt Temporary Service\n        Note over Vehicle: After Duration Expires\n        Vehicle-\u003e\u003eVehicle: Auto-Deactivate Feature\n        Vehicle-\u003e\u003eIoT: Report Deactivation\n        IoT-\u003e\u003eCaaS: Service Expired\n        CaaS-\u003e\u003eCustomer: Notify Service Expired\n    end\n```\n\nThe **IoT connectivity** is not optionalit is a **fundamental requirement** for the CaaS business model to function. Vehicles without connectivity cannot receive OTA activations and therefore cannot use on-demand opciones disponibles.\n\n**Sources:** [enunciado.md:7](), [enunciado.md:19-20]()\n\n---\n\n## Business Value Proposition\n\n### For Customers\n\n| Benefit | Description |\n|---------|-------------|\n| **Lower Initial Cost** | Purchase only base platform, not all features upfront |\n| **Flexibility** | Activate features only when needed (vacation, weather, special trips) |\n| **Try Before Buying** | Test temporary activation before permanent purchase |\n| **No Obsolescence** | New features can be added via OTA without hardware upgrades |\n| **Maintenance of Value** | Permanent features add resale value to vehicle |\n\n### For Business\n\n| Benefit | Description |\n|---------|-------------|\n| **Recurring Revenue** | Ongoing service payments beyond initial vehicle sale |\n| **Customer Engagement** | Continuous relationship after purchase |\n| **Upselling Opportunities** | Convert temporary users to permanent purchasers |\n| **Data Collection** | Usage patterns inform product development |\n| **Standardized Manufacturing** | All vehicles have same hardware, reducing complexity |\n| **Reduced Inventory Risk** | Don't need to predict which features customers want at purchase time |\n\n**Sources:** [enunciado.md:1-7]()\n\n---\n\n## Summary\n\nThe **Platform Base and Optional Services** model represents the architectural foundation of the CaaS business:\n\n- **Plataforma Base**: Fully functional vehicle purchased outright\n- **Opciones Disponibles**: Pre-installed features activated on demand\n- **Pago por Uso**: Pay-per-use model for optional services\n- **Three Duration Models**: Temporary, permanent, planned/recurring\n- **OTA Delivery**: Remote activation via IoT network\n- **Flexible Service Catalog**: Organized by platform, category, and duration\n\nThis separation of ownership (base platform) from usage rights (opciones disponibles) enables the core value proposition: customers can **customize their vehicle capabilities dynamically** based on changing needs, while the business generates **recurring revenue** beyond the initial sale.\n\nFor technical implementation details of the service catalog, see [Service Catalog and Pricing](#6.1). For OTA activation mechanics, see [OTA Service Activation](#6.2). For business rules governing service access, see [Business Rules and Policies](#2.3).\n\n**Sources:** [enunciado.md:1-23]()"])</script><script>self.__next_f.push([1,"17:T48d3,"])</script><script>self.__next_f.push([1,"# Key Actors and System Boundaries\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document defines the external actors that interact with the Car as a Service (CaaS) system and establishes clear boundaries between what is inside the CaaS system and what is external to it. Understanding these boundaries is critical for:\n\n- Identifying who initiates interactions with the system\n- Defining integration points with external systems\n- Establishing ownership and responsibility boundaries\n- Distinguishing between actors (external entities) and system components (internal infrastructure)\n\nFor information about how actors engage with specific business processes, see [Customer Journey](#4). For details on integration with external systems, see [External System Integrations](#5).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:10-16]()\n\n## Actor vs. Component: Critical Distinction\n\nA fundamental architectural principle establishes the difference between actors and system components:\n\n**Actor Definition:** An actor is always external to the CaaS system - an entity that receives services from or provides data to the system. Actors initiate interactions but are not part of the system implementation.\n\n**Component Definition:** Components are internal parts of the CaaS system that collaborate to deliver functionality. They are owned, controlled, and maintained by the CaaS platform.\n\n### Critical Clarification: Vehicles are NOT Actors\n\nVehicles are **infrastructure components**, not actors. While vehicles receive configurations and report status, they do not initiate business transactions. Vehicles are part of the technical infrastructure that CaaS manages, similar to databases or message queues.\n\n```mermaid\ngraph TB\n    subgraph External[\"External Actors (Initiate Interactions)\"]\n        CUST[\"Customer\"]\n        EMP[\"Employee\"]\n    end\n    \n    subgraph Infrastructure[\"System Infrastructure (Managed by CaaS)\"]\n        VEHICLE[\"Vehicle Fleet\"]\n        IOT[\"IoT Network\"]\n    end\n    \n    subgraph CaaS[\"CaaS System Boundary\"]\n        PLATFORM[\"CaaS Platform\"]\n    end\n    \n    CUST --\u003e|\"Uses Services\"| PLATFORM\n    EMP --\u003e|\"Manages Operations\"| PLATFORM\n    PLATFORM --\u003e|\"Configures \u0026 Monitors\"| VEHICLE\n    PLATFORM \u003c--\u003e|\"Commands \u0026 Status\"| IOT\n    IOT \u003c--\u003e|\"Telemetry\"| VEHICLE\n    \n    style External fill:#e8f4f8\n    style Infrastructure fill:#fff4e6\n    style CaaS fill:#e8f8e8\n```\n\n**Diagram: Actor vs. Infrastructure Distinction**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:13-14]()\n\n## System Boundary Definition\n\n```mermaid\ngraph TB\n    subgraph EXTERNAL[\"External to CaaS System\"]\n        subgraph ACTORS[\"Human Actors\"]\n            CUST[\"Customer\u003cbr/\u003e(Vehicle Purchaser)\"]\n            SALES[\"Sales Employee\u003cbr/\u003e(Dealership Staff)\"]\n            ADMIN_EMP[\"Administrative Employee\"]\n        end\n        \n        subgraph EXT_SYS[\"External Systems\"]\n            FACTORY_API[\"Factory API\u003cbr/\u003e(Order Management)\"]\n            VSS[\"VSS System\u003cbr/\u003e(Maintenance Records)\"]\n            PAYMENT_GW[\"Payment Gateway\"]\n            ADMIN_BODIES[\"Administrative Bodies\u003cbr/\u003e(Vehicle Registration)\"]\n        end\n        \n        subgraph EXT_ENTITIES[\"External Business Entities\"]\n            FACTORY_ORG[\"Factory Organization\u003cbr/\u003e(Manufacturing)\"]\n            TRANSPORT[\"Transport Company\u003cbr/\u003e(Logistics Subcontractor)\"]\n            WORKSHOPS[\"Official Workshops\u003cbr/\u003e(Maintenance Providers)\"]\n            DEALER[\"Dealership\u003cbr/\u003e(Sales Point)\"]\n        end\n        \n        subgraph INFRA[\"Infrastructure (Managed)\"]\n            IOT_NET[\"IoT Network\u003cbr/\u003e(API IoT)\"]\n            VEHICLES[\"Vehicle Fleet\"]\n        end\n    end\n    \n    subgraph CAAS_BOUNDARY[\"CaaS System Boundary\"]\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile Application\"]\n        INTRANET[\"Corporate Intranet\"]\n        CORE[\"CaaS Core Services\"]\n        EXPEDIENTE[\"Expediente System\"]\n        CATALOG[\"Service Catalog\"]\n        OTA[\"OTA Engine\"]\n        NOTIF[\"Notification Engine\"]\n    end\n    \n    CUST --\u003e WEB\n    CUST --\u003e MOBILE\n    SALES --\u003e INTRANET\n    ADMIN_EMP --\u003e INTRANET\n    \n    WEB --\u003e CORE\n    MOBILE --\u003e CORE\n    INTRANET --\u003e CORE\n    \n    CORE \u003c--\u003e FACTORY_API\n    CORE \u003c--\u003e VSS\n    CORE \u003c--\u003e PAYMENT_GW\n    CORE \u003c--\u003e ADMIN_BODIES\n    CORE \u003c--\u003e IOT_NET\n    \n    FACTORY_API -.-\u003e|\"Owned by\"| FACTORY_ORG\n    WORKSHOPS -.-\u003e|\"Update\"| VSS\n    \n    OTA --\u003e IOT_NET\n    IOT_NET \u003c--\u003e VEHICLES\n```\n\n**Diagram: Complete System Boundary and Context**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:10-16, 20-21, 34-35, 61-64]()\n\n## Actor Classification\n\n| Actor Type | Actor Name | Role | Initiates Interactions | Known/Controlled User |\n|------------|-----------|------|----------------------|---------------------|\n| **Primary Actor** | Customer | Purchases vehicles and services | Yes - via Web/Mobile | Yes - after purchase |\n| **Primary Actor** | Sales Employee | Registers sales in intranet | Yes - via Intranet | Yes - employee account |\n| **Primary Actor** | Administrative Employee | Manages operations and configurations | Yes - via Intranet | Yes - employee account |\n| **External System** | Factory API | Provides manufacturing status | Yes - async notifications | N/A - system integration |\n| **External System** | VSS System | Stores maintenance records | No - queried by CaaS | N/A - system integration |\n| **External System** | Payment Gateway | Processes payments | Yes - async settlement | N/A - system integration |\n| **External System** | Admin Bodies | Vehicle registration services | No - invoked by CaaS | N/A - system integration |\n| **External Entity** | Factory Organization | Manufactures vehicles | No - responds to orders | N/A - business entity |\n| **External Entity** | Transport Company | Delivers vehicles | No - receives instructions | N/A - subcontractor |\n| **External Entity** | Official Workshops | Performs maintenance | No - updates VSS | N/A - service provider |\n| **External Entity** | Dealership | Physical sales location | No - receives vehicles | N/A - business location |\n| **Infrastructure** | IoT Network (API IoT) | Vehicle communication layer | No - receives commands | N/A - technical infrastructure |\n| **Infrastructure** | Vehicle Fleet | Connected vehicles | No - receives configurations | N/A - technical infrastructure |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:10-16, 20-21, 34-35, 61-64, 72-73]()\n\n## Primary Actors: Human Users\n\n### Customer (Cliente)\n\n**Definition:** A person who has purchased a vehicle from the dealership and has been registered in the CaaS system.\n\n**Access Channels:**\n- Web Platform (browser-based access)\n- Mobile Application (linked to vehicle)\n\n**Key Characteristics:**\n- Must be a known, controlled user (no self-registration)\n- Created during sales process by dealership employee\n- Receives credentials via email after registration\n- Can only access their own expediente and purchase history\n\n**Initiated Interactions:**\n- Browse and purchase optional services\n- Manage active subscriptions\n- Request service cancellations (desistimiento)\n- View expediente de compra (purchase records)\n- Link mobile application to vehicle\n\n**Not a Customer:** Dealership visitors who have not completed a purchase are not yet actors in the system until a sale is registered and credentials are issued.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n### Sales Employee (Empleado de Ventas)\n\n**Definition:** Dealership staff member responsible for registering vehicle sales in the corporate intranet.\n\n**Access Channel:**\n- Corporate Intranet (internal system)\n\n**Key Characteristics:**\n- Employee account with specific permissions\n- Works at physical dealership location\n- Initiates customer onboarding process\n\n**Initiated Interactions:**\n- Register new vehicle sale\n- Create customer account and credentials\n- Associate customer with vehicle and plan comercial\n- Trigger factory order via system\n- Manage customer data updates\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n### Administrative Employee (Empleado Administrativo)\n\n**Definition:** Staff member responsible for operational management, configuration, and system administration.\n\n**Access Channel:**\n- Corporate Intranet (internal system)\n\n**Key Characteristics:**\n- Higher privilege employee account\n- Manages system configuration and operational data\n\n**Initiated Interactions:**\n- Configure service catalog (opciones disponibles)\n- Manage pricing and business rules\n- Handle escalated support cases\n- Oversee failed OTA activations\n- Manage inventory (vehicles sin asignar)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n## External Systems\n\n### Factory API (API de Fbrica)\n\n**Relationship:** The factory and CaaS are the **same company** but represent different systems with a formal integration boundary.\n\n**Communication Patterns:**\n- **CaaS  Factory (Synchronous):** Order management initiated by CaaS\n- **Factory  CaaS (Asynchronous):** Manufacturing status notifications via webhooks\n\n**Boundary Rationale:** While organizationally part of the same company, the factory operates independent systems with established APIs. CaaS integrates with these existing factory systems rather than replacing them.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:34-44]()\n\n### VSS System (Vehicle Service System)\n\n**Ownership:** External system maintained by workshop network (official and approved workshops).\n\n**Purpose:** Tracks maintenance history and compliance status for all vehicles.\n\n**Integration Pattern:**\n- **Query-based:** CaaS queries VSS for maintenance status when needed\n- **No direct vehicle reporting:** Vehicles do NOT report maintenance status via IoT\n- **Workshop updates:** Workshops record service completion in VSS\n\n**Why External:** Workshops are independent service providers (not owned by CaaS), and VSS serves as a neutral maintenance record system.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:61-73]()\n\n### Payment Gateway (Pasarela de Pago)\n\n**Ownership:** External third-party payment processor.\n\n**Integration Pattern:**\n- CaaS initiates payment requests\n- Gateway processes card/bank transactions asynchronously\n- CaaS assumes settlement risk (delivers services before confirmation)\n\n**Why External:** Payment processing requires specialized financial infrastructure, regulatory compliance, and banking relationships that are outsourced to specialized providers.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n### Administrative Bodies (Organismos Administrativos)\n\n**Ownership:** Government agencies responsible for vehicle registration.\n\n**Integration Pattern:**\n- CaaS invokes registration API after final payment\n- Synchronous registration process (blocking operation)\n- Country-specific implementations\n\n**Why External:** Government systems are by definition external to private enterprise systems.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n## External Business Entities\n\n### Factory Organization (Organizacin de Fbrica)\n\n**Role:** Manufacturing facility that produces vehicles based on orders.\n\n**Interaction Model:**\n- Receives orders via Factory API\n- Determines delivery dates based on production schedule\n- Ships completed vehicles to transport company\n\n**Boundary Note:** While the factory is part of the same company, the manufacturing organization operates independently with its own systems and processes.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-29, 34-35]()\n\n### Transport Company (Empresa de Transporte)\n\n**Role:** Subcontracted logistics provider for vehicle delivery.\n\n**Interaction Model:**\n- Receives vehicles from factory\n- Delivers to dealership or customer address\n- No direct system integration with CaaS\n- CaaS tracks shipment start (factory) and end (dealership/customer)\n\n**Why Subcontracted:** Logistics is not a core competency; specialized transport companies handle vehicle shipping.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-25]()\n\n### Official Workshops (Talleres Oficiales/Homologados)\n\n**Role:** Authorized service providers for vehicle maintenance.\n\n**Interaction Model:**\n- Customers schedule maintenance independently\n- Workshops record service completion in VSS system\n- No direct integration with CaaS platform\n- CaaS queries VSS to verify maintenance compliance\n\n**Why External:** Workshops are independent businesses providing standardized services across the manufacturer's vehicle network.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:61-64]()\n\n### Dealership (Concesionario)\n\n**Role:** Physical sales location where customers purchase vehicles.\n\n**Interaction Model:**\n- Employees at dealership use CaaS Intranet to register sales\n- Receives vehicles from transport company\n- Serves as pickup location for failed home deliveries\n- Manages inventory of vehicles \"sin asignar\" (unassigned stock)\n\n**Boundary Note:** The dealership is a physical location/organization, while the Corporate Intranet is the CaaS system component that dealership employees use.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-27]()\n\n## Infrastructure Components (Not Actors)\n\n### IoT Network and API IoT\n\n**Nature:** Technical infrastructure layer for vehicle communication.\n\n**Characteristics:**\n- Pre-existing, documented, tested API\n- Enables bidirectional vehicle communication\n- Handles OTA configuration commands\n- Reports vehicle telemetry and status\n\n**Why Not an Actor:** The IoT network is passive infrastructure that receives commands from CaaS and relays them to vehicles. It does not initiate business transactions.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:31-56]()\n\n### Vehicle Fleet\n\n**Nature:** Connected vehicles with pre-installed functionality.\n\n**Characteristics:**\n- Receives configurations remotely via IoT network\n- Reports status and telemetry\n- All functionality pre-installed; CaaS only activates/deactivates features\n- Cannot be blocked from operation (legal/safety requirement)\n\n**Why Not an Actor:** Vehicles are passive recipients of configuration. They do not make decisions or initiate business processes. A vehicle does not \"request\" a service activation - the customer requests it, and the vehicle is configured accordingly.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:13-14, 47-56, 66-70]()\n\n## User Authentication and Access Control\n\n### No Self-Registration or External Authentication\n\nThe CaaS system enforces strict user control:\n\n**Prohibited:**\n- Self-registration by unknown users\n- External authentication providers (Google, Microsoft, etc.)\n- Public access to any system component\n\n**Required:**\n- All customers must be registered by dealership employees\n- All users must be known and controlled entities\n- Credentials issued after vehicle purchase registration\n\n**Rationale:** CaaS is not a public system. It serves specific customers who have purchased vehicles and employees who manage operations. This ensures proper access control, billing relationships, and legal compliance.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n## System Boundary Enforcement\n\n```mermaid\ngraph LR\n    subgraph EXTERNAL_ZONE[\"External Zone (No CaaS Control)\"]\n        FACTORY_ORG[\"Factory\u003cbr/\u003eManufacturing\"]\n        WORKSHOP_NET[\"Workshop\u003cbr/\u003eNetwork\"]\n        PAYMENT_BANK[\"Banks \u0026\u003cbr/\u003ePayment Processors\"]\n        GOVT[\"Government\u003cbr/\u003eAgencies\"]\n    end\n    \n    subgraph INTEGRATION_ZONE[\"Integration Boundary\"]\n        FACTORY_API[\"Factory API\"]\n        VSS_API[\"VSS API\"]\n        PAYMENT_API[\"Payment Gateway API\"]\n        ADMIN_API[\"Admin Registration API\"]\n    end\n    \n    subgraph CAAS_ZONE[\"CaaS Control Zone\"]\n        CAAS_CORE[\"CaaS Platform\"]\n        WEB_APP[\"Web Application\"]\n        MOBILE_APP[\"Mobile Application\"]\n        INTRANET_APP[\"Corporate Intranet\"]\n    end\n    \n    subgraph MANAGED_INFRA[\"Managed Infrastructure\"]\n        IOT[\"API IoT\"]\n        VEHICLES[\"Vehicle Fleet\"]\n    end\n    \n    FACTORY_ORG -.-\u003e|\"Owns\"| FACTORY_API\n    WORKSHOP_NET -.-\u003e|\"Updates\"| VSS_API\n    PAYMENT_BANK -.-\u003e|\"Provides\"| PAYMENT_API\n    GOVT -.-\u003e|\"Operates\"| ADMIN_API\n    \n    FACTORY_API \u003c--\u003e|\"Sync Orders\u003cbr/\u003eAsync Status\"| CAAS_CORE\n    VSS_API \u003c--\u003e|\"Query Maintenance\"| CAAS_CORE\n    PAYMENT_API \u003c--\u003e|\"Process Payments\"| CAAS_CORE\n    ADMIN_API \u003c--\u003e|\"Register Vehicles\"| CAAS_CORE\n    \n    CAAS_CORE --\u003e WEB_APP\n    CAAS_CORE --\u003e MOBILE_APP\n    CAAS_CORE --\u003e INTRANET_APP\n    CAAS_CORE \u003c--\u003e IOT\n    IOT \u003c--\u003e VEHICLES\n```\n\n**Diagram: System Boundary Enforcement and Control Zones**\n\nThe integration boundary is critical: CaaS owns and controls everything within the CaaS Control Zone and Managed Infrastructure. External systems expose APIs but are maintained by external organizations. The integration zone represents the formal contracts/interfaces between CaaS and external systems.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:10-104]()\n\n## Summary: What is Inside vs. Outside CaaS\n\n### Inside CaaS System (Owned and Controlled)\n\n| Component Category | Components |\n|-------------------|------------|\n| **Customer-Facing Applications** | Web Platform, Mobile Application |\n| **Internal Applications** | Corporate Intranet (for employees) |\n| **Core Business Logic** | Order Management, Service Catalog, Payment Processing, OTA Engine, Notification Engine |\n| **Data Stores** | Customer Database, Order Database, Service Database, Billing Database |\n| **Expediente System** | Purchase records, manuals, history, invoices |\n| **Managed Infrastructure** | API IoT interface, Vehicle fleet configuration |\n\n### Outside CaaS System (External Actors and Systems)\n\n| Entity Category | Entities |\n|-----------------|----------|\n| **Human Actors** | Customers, Sales Employees, Administrative Employees |\n| **External Systems** | Factory API, VSS System, Payment Gateway, Administrative Bodies |\n| **Business Entities** | Factory Organization, Transport Company, Official Workshops, Dealerships |\n| **Infrastructure** | IoT Network (managed but not owned), Vehicle electronics (configuration targets) |\n\n**Sources:** All sources from [pasame las preguntas y sus respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"18:T5a7c,"])</script><script>self.__next_f.push([1,"# Business Rules and Policies\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document catalogs the critical business rules, policies, and constraints that govern the CaaS platform's behavior. These rules define how the system manages user access, processes payments, enforces warranty conditions, handles service activations, and ensures legal compliance.\n\nThis page focuses on the **policies and rules themselves**the \"what\" and \"why\" of system behavior. For implementation details of how these rules are applied in specific workflows, see:\n- [Platform Base and Optional Services](#2.1) - Service model details\n- [Key Actors and System Boundaries](#2.2) - Who can and cannot access the system\n- [Service Cancellation and Refunds](#6.4) - Detailed refund processing workflows\n- [Payment Types and Flows](#7.1) - Payment implementation details\n- [OTA Activation Failures](#9.1) - Technical failure handling procedures\n\n---\n\n## User Access and Authentication Rules\n\n### User Registration Policy\n\n**Rule UAR-001: No Public Registration**\n\nThe CaaS platform is a **closed system** with no public registration or self-service account creation. All users must be explicitly provisioned through controlled processes.\n\n**Allowed User Types:**\n- **Customers** who have purchased a vehicle through an authorized dealership\n- **Employees** of the dealership or CaaS organization\n- **Workshop personnel** (for maintenance-related integrations)\n\n**Prohibited:**\n- Social login providers (Google, Microsoft, Facebook, etc.)\n- Single Sign-On (SSO) with external identity providers\n- Self-registration portals or public signup forms\n- Anonymous guest access\n\n**Rationale:** Security, regulatory compliance, and business model requirements mandate that all system users be known, verified, and traceable to a vehicle purchase or employment relationship.\n\n**Enforcement Point:** User authentication systems must validate against internal user repositories only. Any authentication request must resolve to a pre-existing, provisioned account.\n\n```mermaid\nflowchart TD\n    START[\"Authentication Attempt\"] --\u003e CHECK_USER{\"User Exists in\u003cbr/\u003eUser Repository?\"}\n    CHECK_USER --\u003e|\"No\"| REJECT[\"Reject Access\u003cbr/\u003eNo Self-Registration\"]\n    CHECK_USER --\u003e|\"Yes\"| CHECK_TYPE{\"User Type?\"}\n    \n    CHECK_TYPE --\u003e|\"Customer\"| VERIFY_VEHICLE{\"Has Associated\u003cbr/\u003eVehicle Purchase?\"}\n    CHECK_TYPE --\u003e|\"Employee\"| VERIFY_ROLE{\"Has Valid\u003cbr/\u003eEmployment Record?\"}\n    CHECK_TYPE --\u003e|\"Workshop\"| VERIFY_WORKSHOP{\"Authorized\u003cbr/\u003eWorkshop?\"}\n    \n    VERIFY_VEHICLE --\u003e|\"Yes\"| GRANT_CUSTOMER[\"Grant Customer\u003cbr/\u003eAccess Level\"]\n    VERIFY_VEHICLE --\u003e|\"No\"| REJECT\n    \n    VERIFY_ROLE --\u003e|\"Yes\"| GRANT_EMPLOYEE[\"Grant Employee\u003cbr/\u003eAccess Level\"]\n    VERIFY_ROLE --\u003e|\"No\"| REJECT\n    \n    VERIFY_WORKSHOP --\u003e|\"Yes\"| GRANT_WORKSHOP[\"Grant Workshop\u003cbr/\u003eAccess Level\"]\n    VERIFY_WORKSHOP --\u003e|\"No\"| REJECT\n    \n    GRANT_CUSTOMER --\u003e ALLOW[\"Allow Access\"]\n    GRANT_EMPLOYEE --\u003e ALLOW\n    GRANT_WORKSHOP --\u003e ALLOW\n```\n\n**Diagram: User Authentication Decision Flow**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n---\n\n## Payment and Financial Policies\n\n### Vehicle Purchase Payment Rules\n\n**Rule PAY-001: Two-Stage Vehicle Payment**\n\nVehicle purchases require two separate payments:\n\n1. **Reservation Signal (Seal de Reserva)**: Initial deposit to reserve the vehicle and initiate manufacturing\n2. **Final Payment**: Remaining balance paid before vehicle registration and delivery\n\n| Payment Stage | Timing | Purpose | Failure Consequence |\n|--------------|--------|---------|---------------------|\n| Reservation Signal | At sale registration | Reserve vehicle, trigger factory order | No vehicle manufacturing |\n| Final Payment | Before registration | Complete purchase | Vehicle becomes stock, customer loses reservation |\n\n**Rule PAY-002: Final Payment Failure Handling**\n\nIf the customer cannot complete final payment when the vehicle is ready:\n- Vehicle is marked as **\"sin asignar\"** (unassigned) in the system\n- Vehicle immediately becomes **stock for immediate sale** to other customers\n- Original customer **loses the reservation entirely**\n- Reservation signal is **not refunded** (standard business practice)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27, 80]()\n\n### Service Payment and Risk Assumption\n\n**Rule PAY-003: Immediate Service Delivery with Async Settlement**\n\nFor optional service payments, CaaS employs a **customer-favorable risk model**:\n\n- **Service is delivered immediately** upon payment initiation\n- **Bank settlement is asynchronous** and may take time to confirm\n- **CaaS assumes the settlement risk** rather than delaying service activation\n- If payment ultimately fails to settle, CaaS absorbs the financial loss\n\n**Rationale:** Optimize customer experience and competitive positioning by eliminating wait times for service activation.\n\n**Rule PAY-004: Subscription Billing (Mes Vencido)**\n\nSubscription services use a **post-paid billing model**:\n- Customer uses the service throughout the month\n- **Charge occurs at month end** for services actually consumed\n- Known as **\"mes vencido\"** (expired month) billing\n- If payment fails, subscription is cancelled (see [Service Cancellation and Refunds](#6.4))\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:81-82]()\n\n### Critical Rule: No Charge for Undelivered Services\n\n**Rule PAY-005: DO NOT CHARGE for OTA Failures**\n\nIf a service cannot be successfully activated via OTA:\n- The customer must **NEVER be charged** for the service\n- This rule applies even if payment has been initiated\n- Refund must be processed if charge has already occurred\n- Customer must be notified of the failure and no-charge status\n\nThis is the most critical customer protection rule in the system and must be enforced absolutely.\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:53]()\n\n---\n\n## Warranty and Maintenance Rules\n\n### Maintenance Responsibility and Tracking\n\n**Rule MAINT-001: Customer-Controlled Maintenance Schedule**\n\n- Customers **decide when to perform maintenance**the system cannot force or mandate it\n- Maintenance is performed at **official workshops** or **approved multi-brand workshops**\n- Maintenance records are tracked in the **VSS (Vehicle Service System)**\n- VSS maintains maintenance history and compliance percentage by functional block\n\n**Rule MAINT-002: Maintenance Status Query Model**\n\nThe vehicle **does NOT report maintenance status** via IoT telemetry. Instead:\n- CaaS must **query the VSS system** to determine maintenance status\n- VSS is the authoritative source for all maintenance records\n- Workshops update VSS when service is performed\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:61-64, 72-73]()\n\n### Warranty Loss and Service Restrictions\n\n**Rule MAINT-003: Warranty Loss Due to Missed Maintenance**\n\nIf required maintenance is not performed on schedule:\n- The customer **loses warranty coverage** for affected systems\n- The base vehicle remains operational (cannot be blocked from driving)\n\n**Rule MAINT-004: Maintenance-Gated Service Activation**\n\nFor safety-critical optional services that depend on specific maintenance:\n- The system **may block NEW service activation** if required maintenance is overdue\n- Already-paid and active services **cannot be deactivated** due to maintenance issues\n- The **plataforma base is never blocked** regardless of maintenance status\n- This rule applies only to services where missing maintenance creates a safety risk\n\n**Rule MAINT-005: Vehicle Cannot Be Immobilized**\n\nThe system **must never block a vehicle from driving** due to maintenance issues or payment problems:\n- Only law enforcement can immobilize vehicles\n- CaaS can only restrict access to **new optional services**\n- Base vehicle functionality must always remain available\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e MaintenanceCurrent: \"Vehicle Delivered\"\n    \n    state MaintenanceCurrent {\n        [*] --\u003e AllServicesAvailable\n        AllServicesAvailable --\u003e ServiceRequested: \"Customer Requests\u003cbr/\u003eOptional Service\"\n        ServiceRequested --\u003e AllServicesAvailable: \"Service Activated\"\n    }\n    \n    MaintenanceCurrent --\u003e MaintenanceOverdue: \"Maintenance Interval\u003cbr/\u003eExceeded\"\n    \n    state MaintenanceOverdue {\n        [*] --\u003e WarrantyLost: \"Warranty Invalidated\"\n        WarrantyLost --\u003e BaseRemains: \"Base Platform\u003cbr/\u003eStill Operational\"\n        BaseRemains --\u003e ActiveRemain: \"Already-Active Services\u003cbr/\u003eStill Functional\"\n        ActiveRemain --\u003e NewBlocked: \"NEW Safety-Critical\u003cbr/\u003eServices Blocked\"\n        \n        NewBlocked --\u003e ServiceDenied: \"Customer Attempts\u003cbr/\u003eNew Service\"\n        ServiceDenied --\u003e MaintenanceRequired: \"System Response:\u003cbr/\u003eComplete Maintenance First\"\n    }\n    \n    MaintenanceOverdue --\u003e MaintenanceCurrent: \"Customer Completes\u003cbr/\u003eMaintenance at Workshop\"\n```\n\n**Diagram: Maintenance Status State Machine**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-70]()\n\n---\n\n## Service Activation and OTA Policies\n\n### OTA Service Delivery Model\n\n**Rule OTA-001: All CaaS Services Are OTA-Activated**\n\n- All optional services sold by CaaS are activated **exclusively via OTA** (Over The Air)\n- **No workshop visit is ever required** to activate a CaaS service\n- All service functionality is **pre-installed in vehicle firmware**\n- CaaS only performs **activation or deactivation** of existing capabilities\n\n**Rule OTA-002: Pre-Installed Functionality Model**\n\nThe vehicle ships with all optional service capabilities already installed in firmware:\n- Services are **disabled by default**\n- Payment triggers an **activation command** via the IoT API\n- No software updates or downloads are required for service activation\n- Firmware updates are a **separate process** independent of CaaS service sales\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:46-47, 55-56]()\n\n### OTA Failure Handling Protocol\n\n**Rule OTA-003: Retry and Escalation for Failed Activations**\n\nWhen OTA activation fails, the system must follow this protocol:\n\n1. **Retry N times** with exponential backoff or configurable intervals\n2. **Query vehicle status proactively** to understand failure cause\n3. **Escalate to technical support** with diagnostic information\n4. **Notify customer** of the failure and resolution timeline\n5. **DO NOT CHARGE** the customer (see PAY-005)\n\n```mermaid\nflowchart TD\n    START[\"Service Payment\u003cbr/\u003eSuccessful\"] --\u003e SEND_OTA[\"Send OTA Activation\u003cbr/\u003eCommand via IoT API\"]\n    \n    SEND_OTA --\u003e WAIT[\"Wait for Vehicle\u003cbr/\u003eResponse\"]\n    \n    WAIT --\u003e CHECK_RESULT{\"Activation\u003cbr/\u003eSuccessful?\"}\n    \n    CHECK_RESULT --\u003e|\"Yes\"| NOTIFY_SUCCESS[\"Notify Customer\u003cbr/\u003eService Active\"]\n    CHECK_RESULT --\u003e|\"No\"| CHECK_RETRIES{\"Retries\u003cbr/\u003eRemaining?\"}\n    \n    CHECK_RETRIES --\u003e|\"Yes\"| RETRY_DELAY[\"Exponential Backoff\u003cbr/\u003eWait Period\"]\n    RETRY_DELAY --\u003e SEND_OTA\n    \n    CHECK_RETRIES --\u003e|\"No\"| QUERY_VEHICLE[\"Query Vehicle Status\u003cbr/\u003evia IoT API\"]\n    QUERY_VEHICLE --\u003e CREATE_TICKET[\"Create Technical\u003cbr/\u003eSupport Ticket\"]\n    CREATE_TICKET --\u003e NOTIFY_FAILURE[\"Notify Customer\u003cbr/\u003eActivation Failed\"]\n    NOTIFY_FAILURE --\u003e REFUND[\"Process Refund or\u003cbr/\u003eBlock Payment\u003cbr/\u003e(DO NOT CHARGE)\"]\n    \n    NOTIFY_SUCCESS --\u003e END[\"End\"]\n    REFUND --\u003e END\n    \n    style REFUND fill:#ffcccc\n    style NOTIFY_SUCCESS fill:#ccffcc\n```\n\n**Diagram: OTA Activation Failure Handling Flowchart**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n### Maintenance-Gated Service Eligibility\n\n**Rule OTA-004: Safety-Critical Services Require Current Maintenance**\n\nBefore activating certain optional services, the system must:\n\n1. **Query VSS** to determine maintenance status for relevant vehicle systems\n2. **Block activation** if required maintenance is overdue\n3. **Inform customer** that maintenance must be completed before service can be purchased\n4. **Allow normal purchase flow** once maintenance is current\n\nThis rule applies only to services with safety implications (e.g., performance enhancements, advanced driver assistance features).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:69-70]()\n\n---\n\n## Cancellation and Refund Policies (Desistimiento)\n\n### Legal Framework: Distance Selling Law\n\n**Rule REFUND-001: Right of Withdrawal (Desistimiento)**\n\nCaaS must comply with **distance selling regulations** that grant customers the right to cancel purchases and receive refunds. The specific rules depend on **service duration**:\n\n| Service Duration | Cancellation Window | Refund Eligibility |\n|-----------------|---------------------|-------------------|\n| **\u003e 14 days** | First 14 days from activation | Full refund if cancelled within window |\n| **\u003c 14 days** | Anytime during service period | Full refund available anytime |\n| **After window expires** | No legal right to refund | Service considered consumed |\n\n**Rule REFUND-002: Service Cancellation After Window**\n\nIf a customer requests cancellation after the desistimiento window:\n- **No refund is provided**\n- Service is considered **consumed**\n- This applies even in special circumstances like vehicle theft (unless within the 14-day window)\n\n**Rule REFUND-003: Configurable Catalog Restrictions**\n\nAs a configurable business policy:\n- If a customer cancels a service due to **dissatisfaction** (not theft or other circumstances)\n- That service **may be removed from the customer's catalog**\n- Customer cannot repurchase the same service\n- Prevents abuse of the refund system\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:85-89]()\n\n### Refund Processing Rules\n\n```mermaid\nflowchart TD\n    CANCEL_REQ[\"Customer Requests\u003cbr/\u003eService Cancellation\"] --\u003e CHECK_DURATION{\"Service\u003cbr/\u003eDuration?\"}\n    \n    CHECK_DURATION --\u003e|\"\u003c 14 days\"| REFUND_YES[\"Refund Granted\u003cbr/\u003e(Anytime)\"]\n    CHECK_DURATION --\u003e|\"\u003e 14 days\"| CHECK_WINDOW{\"Within 14 Days\u003cbr/\u003eof Activation?\"}\n    \n    CHECK_WINDOW --\u003e|\"Yes\"| REFUND_YES\n    CHECK_WINDOW --\u003e|\"No\"| REFUND_NO[\"No Refund\u003cbr/\u003eService Consumed\"]\n    \n    REFUND_YES --\u003e CHECK_REASON{\"Reason:\u003cbr/\u003eDissatisfaction?\"}\n    REFUND_NO --\u003e END[\"End Process\"]\n    \n    CHECK_REASON --\u003e|\"Yes\"| CATALOG_CHECK{\"Catalog Restriction\u003cbr/\u003ePolicy Enabled?\"}\n    CHECK_REASON --\u003e|\"No (Theft, Other)\"| PROCESS_REFUND[\"Process Refund\"]\n    \n    CATALOG_CHECK --\u003e|\"Yes\"| REMOVE_CATALOG[\"Remove Service from\u003cbr/\u003eCustomer's Catalog\"]\n    CATALOG_CHECK --\u003e|\"No\"| PROCESS_REFUND\n    \n    REMOVE_CATALOG --\u003e PROCESS_REFUND\n    PROCESS_REFUND --\u003e END\n```\n\n**Diagram: Refund Eligibility Decision Tree**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:85-96]()\n\n---\n\n## Delivery and Transport Rules\n\n### Home Delivery Protocol\n\n**Rule DELIVERY-001: Customer Availability Requirement**\n\nFor home delivery of vehicles:\n- Transport company must **contact customer** to confirm availability\n- If customer is **not present** at the scheduled time:\n  - Vehicle is **returned to dealership**\n  - Customer must **pick up at dealership**\n- Vehicle is **never left unattended** on the street or in unsecured locations\n\n**Rationale:** Security and liability concerns require direct handoff to the customer.\n\n**Rule DELIVERY-002: Dealership as Fallback Location**\n\nThe dealership serves as the default fallback for all delivery issues:\n- Customer absence during home delivery\n- Customer request for dealership pickup\n- Any other delivery complications\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n---\n\n## Vehicle Theft and Loss Scenarios\n\n### Theft Impact on Services\n\n**Rule THEFT-001: No Automatic Refunds for Delivered Services**\n\nIf a customer's vehicle is stolen:\n- There is **no direct relationship** between theft and service refunds\n- **Already delivered services** are subject to normal desistimiento rules:\n  - If within 14-day window  Refund available\n  - If past 14-day window  No refund (service was consumed)\n- Theft does not trigger special refund processing\n\n**Rule THEFT-002: Pending Services Can Be Cancelled**\n\nFor services that have been paid but not yet delivered (or subscriptions with future billing):\n- Customer **can cancel** these services\n- Customer **can cancel automatic renewal** of subscriptions\n- This prevents billing for services on a vehicle the customer no longer possesses\n\n**Rule THEFT-003: Theft Does Not Extend Refund Windows**\n\nVehicle theft does not extend or reset the 14-day desistimiento period for already-active services.\n\n```mermaid\nflowchart LR\n    THEFT[\"Vehicle Stolen\"] --\u003e CHECK_SERVICES{\"Service Status?\"}\n    \n    CHECK_SERVICES --\u003e|\"Already Delivered\u003cbr/\u003eand Active\"| CHECK_WINDOW{\"Within 14-Day\u003cbr/\u003eWindow?\"}\n    CHECK_SERVICES --\u003e|\"Pending or\u003cbr/\u003eFuture Subscription\"| ALLOW_CANCEL[\"Customer Can\u003cbr/\u003eCancel Service\"]\n    \n    CHECK_WINDOW --\u003e|\"Yes\"| ELIGIBLE_REFUND[\"Eligible for\u003cbr/\u003eRefund\"]\n    CHECK_WINDOW --\u003e|\"No\"| NO_REFUND[\"No Refund\u003cbr/\u003eService Consumed\"]\n    \n    ALLOW_CANCEL --\u003e CANCEL_FUTURE[\"Cancel Future\u003cbr/\u003eBilling/Delivery\"]\n    \n    ELIGIBLE_REFUND --\u003e END[\"End\"]\n    NO_REFUND --\u003e END\n    CANCEL_FUTURE --\u003e END\n```\n\n**Diagram: Vehicle Theft Service Impact**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:92-96]()\n\n---\n\n## Notification Requirements\n\n### Automatic Notification Policy\n\n**Rule NOTIFY-001: Manufacturing Status Notifications**\n\nThe system must provide **automatic notifications** about vehicle manufacturing status to customers:\n- Manufacturing started\n- Manufacturing milestones reached\n- Vehicle ready for delivery\n- Delivery scheduled\n\nThese notifications are part of the **value proposition** and differentiate CaaS from traditional vehicle sales.\n\n**Rule NOTIFY-002: Service Activation Notifications**\n\nCustomers must be notified about:\n- Successful service activation\n- Failed service activation (with explanation and next steps)\n- Refund processing status\n\n**Rule NOTIFY-003: Payment and Financial Notifications**\n\nCustomers must receive notifications for:\n- Payment confirmations\n- Payment failures\n- Subscription billing (monthly)\n- Refund processing\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n## Business Rules Summary Table\n\n| Rule ID | Category | Rule Summary | Critical? |\n|---------|----------|--------------|-----------|\n| UAR-001 | Authentication | No public registration or SSO | Yes |\n| PAY-001 | Payment | Two-stage vehicle payment (reservation + final) | Yes |\n| PAY-002 | Payment | Final payment failure  vehicle becomes stock | Yes |\n| PAY-003 | Payment | Immediate service delivery with async settlement | Yes |\n| PAY-004 | Payment | Subscriptions billed mes vencido (post-paid) | Yes |\n| PAY-005 | Payment | DO NOT CHARGE for failed OTA activations | **CRITICAL** |\n| MAINT-001 | Maintenance | Customer controls maintenance schedule | Yes |\n| MAINT-002 | Maintenance | Query VSS for maintenance status (not IoT) | Yes |\n| MAINT-003 | Warranty | Missed maintenance  warranty loss | Yes |\n| MAINT-004 | Maintenance | Block NEW service activation if maintenance overdue | Yes |\n| MAINT-005 | Safety | Never immobilize vehicle | **CRITICAL** |\n| OTA-001 | Service Delivery | All CaaS services are OTA-activated only | Yes |\n| OTA-002 | Service Delivery | All functionality pre-installed in firmware | Yes |\n| OTA-003 | Service Delivery | Retry  escalate  do not charge protocol | **CRITICAL** |\n| OTA-004 | Service Delivery | Safety-critical services require current maintenance | Yes |\n| REFUND-001 | Legal | Distance selling desistimiento rules apply | Yes |\n| REFUND-002 | Legal | No refund after cancellation window | Yes |\n| REFUND-003 | Business | Optional catalog restriction for dissatisfied customers | No |\n| DELIVERY-001 | Operations | Never leave vehicle unattended | Yes |\n| DELIVERY-002 | Operations | Dealership is fallback location | Yes |\n| THEFT-001 | Special Cases | No automatic refunds for theft | Yes |\n| THEFT-002 | Special Cases | Can cancel pending services after theft | Yes |\n| THEFT-003 | Special Cases | Theft doesn't extend refund windows | Yes |\n| NOTIFY-001 | Customer Service | Automatic manufacturing status updates | Yes |\n| NOTIFY-002 | Customer Service | Service activation status notifications | Yes |\n| NOTIFY-003 | Customer Service | Payment and billing notifications | Yes |\n\n---\n\n## Policy Enforcement Architecture\n\nThe following diagram maps business rules to system components responsible for enforcement:\n\n```mermaid\ngraph TB\n    subgraph \"Authentication Layer\"\n        AUTH[\"AuthenticationService\"]\n        USER_REPO[\"UserRepository\"]\n    end\n    \n    subgraph \"Business Logic Layer\"\n        ORDER_MGT[\"OrderManagement\"]\n        SERVICE_CAT[\"ServiceCatalog\"]\n        PAYMENT_PROC[\"PaymentProcessor\"]\n        OTA_ENGINE[\"OTAEngine\"]\n        REFUND_MGT[\"RefundManager\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        VSS_CLIENT[\"VSSClient\"]\n        IOT_GATEWAY[\"IoTGateway\"]\n        PAYMENT_GW[\"PaymentGatewayClient\"]\n    end\n    \n    subgraph \"Rule Enforcement Points\"\n        AUTH -.\"|UAR-001\"| USER_REPO\n        ORDER_MGT -.\"|PAY-001, PAY-002\"| PAYMENT_PROC\n        PAYMENT_PROC -.\"|PAY-003, PAY-004\"| PAYMENT_GW\n        \n        SERVICE_CAT -.\"|MAINT-004, OTA-004\"| VSS_CLIENT\n        OTA_ENGINE -.\"|OTA-001, OTA-002, OTA-003\"| IOT_GATEWAY\n        OTA_ENGINE -.\"|PAY-005\"| PAYMENT_PROC\n        \n        REFUND_MGT -.\"|REFUND-001, REFUND-002\"| PAYMENT_PROC\n        REFUND_MGT -.\"|REFUND-003\"| SERVICE_CAT\n    end\n    \n    AUTH --\u003e ORDER_MGT\n    AUTH --\u003e SERVICE_CAT\n    ORDER_MGT --\u003e OTA_ENGINE\n    SERVICE_CAT --\u003e OTA_ENGINE\n    OTA_ENGINE --\u003e REFUND_MGT\n```\n\n**Diagram: Business Rule Enforcement Mapping**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Compliance and Legal Considerations\n\n### Distance Selling Compliance\n\nThe desistimiento (right of withdrawal) rules are mandated by **EU Distance Selling Directive** and similar regulations in other jurisdictions. CaaS must maintain:\n- **Audit trail** of all cancellation requests and refund processing\n- **Clear communication** of cancellation rights to customers at point of sale\n- **Automated enforcement** to prevent manual override of legal protections\n\n### Data Protection and User Privacy\n\nAll user authentication and access control rules support:\n- **GDPR compliance** through explicit user provisioning\n- **Data minimization** by rejecting unknown users\n- **Access control** tied to legitimate business relationships\n\n### Consumer Protection\n\nRules PAY-005, MAINT-005, and OTA-003 represent **customer protection commitments**:\n- Never charge for undelivered services\n- Never immobilize vehicles for business reasons\n- Always provide transparent failure communication\n\nThese rules are **non-negotiable** and must be enforced even when doing so causes financial loss to CaaS.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:85-89]()"])</script><script>self.__next_f.push([1,"19:T779c,"])</script><script>self.__next_f.push([1,"# System Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document provides comprehensive technical architecture documentation for the Car as a Service (CaaS) platform. It defines the overall system structure, major subsystems, architectural patterns, and design decisions that govern how the platform operates.\n\nFor business context and model explanation, see [Business Model and Concept](#2). For detailed subsystem descriptions, see [High-Level Architecture](#3.1), [Core Technical Components](#3.2), and [Integration Architecture](#3.3). For specific integration patterns with external systems, see [External System Integrations](#5).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104](), [enunciado.md:1-23]()\n\n---\n\n## Architectural Overview\n\nThe CaaS platform employs a **hub-and-spoke integration architecture** with the central CaaS core orchestrating all interactions between customers, dealerships, manufacturing facilities, vehicles, and third-party services. The system is organized into distinct architectural layers with clear separation of concerns.\n\n### Architectural Principles\n\n| Principle | Description | Rationale |\n|-----------|-------------|-----------|\n| **Centralized Orchestration** | All business logic flows through the CaaS core platform | Single source of truth for business rules and state management |\n| **Async-First Integration** | External systems communicate primarily via asynchronous patterns | Enables system resilience and non-blocking operations |\n| **Customer-Favorable Failure Handling** | Default to customer protection in failure scenarios | Builds trust and ensures legal compliance |\n| **Service Delivery Before Settlement** | Activate services immediately upon payment initiation | Optimizes customer experience despite increased financial risk |\n| **No Vehicle Blocking** | Never disable base platform functionality | Legal and safety requirement |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:31-73]()\n\n---\n\n## System Decomposition\n\n### Major Subsystems\n\n```mermaid\ngraph TB\n    subgraph \"Customer Channels\"\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile Application\"]\n        EXPEDIENTE[\"Expediente de Compra\u003cbr/\u003e(Purchase Records)\"]\n    end\n    \n    subgraph \"Enterprise Channels\"\n        INTRANET[\"Corporate Intranet\"]\n        SALES[\"Sales Registration Module\"]\n    end\n    \n    subgraph \"CaaS Core Platform\"\n        ORDER[\"Order Management\"]\n        CATALOG[\"Service Catalog\"]\n        PAYMENT[\"Payment Processing\"]\n        NOTIFICATION[\"Notification Engine\"]\n        OTA[\"OTA Activation Engine\"]\n        CREDENTIAL[\"Credential Management\"]\n    end\n    \n    subgraph \"Integration Gateways\"\n        FACTORY_GW[\"Factory Gateway\"]\n        VSS_GW[\"VSS Gateway\"]\n        IOT_GW[\"IoT Gateway\"]\n        PAYMENT_GW[\"Payment Gateway\"]\n        ADMIN_GW[\"Admin Gateway\"]\n    end\n    \n    subgraph \"Data Stores\"\n        CUSTOMER_DB[(\"Customer Database\")]\n        ORDER_DB[(\"Order Database\")]\n        SERVICE_DB[(\"Service Database\")]\n        BILLING_DB[(\"Billing Database\")]\n        CONFIG_DB[(\"Configuration Repository\")]\n    end\n    \n    WEB --\u003e EXPEDIENTE\n    MOBILE --\u003e EXPEDIENTE\n    INTRANET --\u003e SALES\n    \n    EXPEDIENTE --\u003e ORDER\n    EXPEDIENTE --\u003e CATALOG\n    SALES --\u003e ORDER\n    \n    ORDER --\u003e PAYMENT\n    CATALOG --\u003e PAYMENT\n    PAYMENT --\u003e OTA\n    \n    ORDER --\u003e FACTORY_GW\n    ORDER --\u003e ADMIN_GW\n    CATALOG --\u003e VSS_GW\n    OTA --\u003e IOT_GW\n    \n    PAYMENT --\u003e PAYMENT_GW\n    \n    ORDER --\u003e NOTIFICATION\n    OTA --\u003e NOTIFICATION\n    SALES --\u003e CREDENTIAL\n    CREDENTIAL --\u003e NOTIFICATION\n    \n    ORDER --\u003e ORDER_DB\n    EXPEDIENTE --\u003e CUSTOMER_DB\n    CATALOG --\u003e SERVICE_DB\n    PAYMENT --\u003e BILLING_DB\n    OTA --\u003e SERVICE_DB\n    OTA --\u003e CONFIG_DB\n```\n\n**Subsystem Responsibilities:**\n\n**Customer Channels:**\n- `Web Platform`: Browser-based access to purchase records and service catalog\n- `Mobile Application`: Native mobile access with direct vehicle linking capability\n- `Expediente de Compra`: Unified customer data repository containing manuals, maintenance history, invoices\n\n**Enterprise Channels:**\n- `Corporate Intranet`: Dealership-facing system for sales operations\n- `Sales Registration Module`: Captures customer data and commercial plan details during dealership sales\n\n**CaaS Core Platform:**\n- `Order Management`: Handles vehicle reservations, orders, and manufacturing tracking\n- `Service Catalog`: Manages available optional services (opciones disponibles) with pricing and rules\n- `Payment Processing`: Orchestrates all payment types (reservation, final, service, subscription)\n- `Notification Engine`: Multi-channel notifications (email, push, SMS, vehicle display)\n- `OTA Activation Engine`: Manages service activation via IoT with retry logic\n- `Credential Management`: Generates and distributes customer access credentials\n\n**Integration Gateways:**\n- `Factory Gateway`: Bidirectional communication with manufacturing facilities\n- `VSS Gateway`: Queries Vehicle Service System for maintenance records\n- `IoT Gateway`: Commands vehicles and receives telemetry via API IoT\n- `Payment Gateway`: Processes card payments with async settlement\n- `Admin Gateway`: Registers vehicles with government administrative bodies\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:8-53]()\n\n---\n\n## Layered Architecture View\n\n```mermaid\ngraph TB\n    subgraph \"Presentation Layer\"\n        P1[\"Web UI\"]\n        P2[\"Mobile UI\"]\n        P3[\"Intranet UI\"]\n    end\n    \n    subgraph \"Application Services Layer\"\n        A1[\"Customer Management\"]\n        A2[\"Order Orchestration\"]\n        A3[\"Service Lifecycle Management\"]\n        A4[\"Payment Orchestration\"]\n        A5[\"Notification Dispatcher\"]\n    end\n    \n    subgraph \"Domain Logic Layer\"\n        D1[\"Sales Domain\u003cbr/\u003eReservations, Plans, Credentials\"]\n        D2[\"Catalog Domain\u003cbr/\u003eOpciones Disponibles, Pricing\"]\n        D3[\"Activation Domain\u003cbr/\u003eOTA, Retry, Status\"]\n        D4[\"Billing Domain\u003cbr/\u003ePayments, Refunds, Subscriptions\"]\n        D5[\"Maintenance Domain\u003cbr/\u003eVSS Integration, Service Gating\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        I1[\"Factory API Client\"]\n        I2[\"Factory Webhook Receiver\"]\n        I3[\"VSS Query Client\"]\n        I4[\"IoT API Client\"]\n        I5[\"Payment API Client\"]\n        I6[\"Admin API Client\"]\n    end\n    \n    subgraph \"Infrastructure Layer\"\n        INF1[\"Database Repositories\"]\n        INF2[\"Message Queue\"]\n        INF3[\"Logging \u0026 Monitoring\"]\n        INF4[\"Configuration Management\"]\n    end\n    \n    P1 --\u003e A1\n    P1 --\u003e A3\n    P2 --\u003e A1\n    P2 --\u003e A3\n    P3 --\u003e A2\n    \n    A1 --\u003e D1\n    A2 --\u003e D1\n    A2 --\u003e D2\n    A3 --\u003e D2\n    A3 --\u003e D3\n    A3 --\u003e D5\n    A4 --\u003e D4\n    A5 --\u003e D1\n    A5 --\u003e D3\n    \n    D1 --\u003e I1\n    D1 --\u003e I6\n    D2 --\u003e I3\n    D3 --\u003e I4\n    D4 --\u003e I5\n    \n    I2 --\u003e D1\n    \n    D1 --\u003e INF1\n    D2 --\u003e INF1\n    D3 --\u003e INF1\n    D3 --\u003e INF2\n    D4 --\u003e INF1\n    \n    I1 --\u003e INF3\n    I2 --\u003e INF3\n    I3 --\u003e INF3\n    I4 --\u003e INF3\n    I5 --\u003e INF3\n    I6 --\u003e INF3\n    \n    D3 --\u003e INF4\n```\n\n**Layer Responsibilities:**\n\n**Presentation Layer**: UI components for different user types (customers, dealership employees). No business logic.\n\n**Application Services Layer**: Coordinates multiple domain objects to fulfill use cases. Orchestrates workflows across domains.\n\n**Domain Logic Layer**: Core business rules and entities. Each domain is isolated and represents a cohesive business capability:\n- `Sales Domain`: Manages the purchase process from reservation through delivery\n- `Catalog Domain`: Defines available services, pricing models, and eligibility rules\n- `Activation Domain`: Handles OTA delivery, failure handling, and retry mechanisms\n- `Billing Domain`: Processes payments, manages subscriptions (mes vencido), handles refunds (desistimiento)\n- `Maintenance Domain`: Gates service access based on VSS maintenance status\n\n**Integration Layer**: Adapters for external systems. Isolates integration complexity from domain logic. Note the hybrid pattern with Factory: synchronous client for order placement (`Factory API Client`) and asynchronous webhook receiver (`Factory Webhook Receiver`) for status updates.\n\n**Infrastructure Layer**: Technical services used across all layers. Message queues support async processing of OTA activations and notifications.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:31-53](), [enunciado.md:8-23]()\n\n---\n\n## Data Architecture\n\n### Data Segregation by Domain\n\nThe system employs **database-per-domain** pattern to ensure clear data ownership and enable independent evolution:\n\n```mermaid\ngraph LR\n    subgraph \"Customer Data Domain\"\n        CUST_IDENTITY[\"Customer Identity\u003cbr/\u003eEmail, Phone, Address\"]\n        CUST_CREDS[\"Access Credentials\u003cbr/\u003eUsername, Password Hash\"]\n        CUST_PREFS[\"Preferences\u003cbr/\u003eNotification Settings\"]\n    end\n    \n    subgraph \"Order Data Domain\"\n        ORDER_HDR[\"Order Header\u003cbr/\u003eCustomer, Plan, Status\"]\n        ORDER_DETAILS[\"Order Details\u003cbr/\u003ePlatform Base, Options\"]\n        VEHICLE_REG[\"Vehicle Registration\u003cbr/\u003eVIN, Plate, Status\"]\n        MANUFACTURING[\"Manufacturing Status\u003cbr/\u003eFactory Updates\"]\n    end\n    \n    subgraph \"Service Data Domain\"\n        SERVICE_CATALOG[\"Service Definitions\u003cbr/\u003eOptions, Pricing, Rules\"]\n        SERVICE_ACTIVATION[\"Activation Records\u003cbr/\u003eService, Date, Status\"]\n        SUBSCRIPTION[\"Subscription Records\u003cbr/\u003eRecurring Services\"]\n    end\n    \n    subgraph \"Billing Data Domain\"\n        PAYMENT_TRANS[\"Payment Transactions\u003cbr/\u003eType, Amount, Status\"]\n        INVOICE[\"Invoices\u003cbr/\u003eCustomer, Items, Total\"]\n        REFUND[\"Refund Records\u003cbr/\u003eDesistimiento, Date\"]\n    end\n    \n    subgraph \"Configuration Data Domain\"\n        OTA_CONFIG[\"OTA Configurations\u003cbr/\u003eService to Vehicle Mapping\"]\n        RETRY_POLICY[\"Retry Policies\u003cbr/\u003eAttempts, Intervals\"]\n        MAINT_RULES[\"Maintenance Rules\u003cbr/\u003eService Dependencies\"]\n    end\n```\n\n**Data Flow Patterns:**\n\n| Flow | Pattern | Example |\n|------|---------|---------|\n| **Customer  Order** | Reference by ID | Customer ID stored in Order Header |\n| **Order  Service** | Event-driven | Order completion triggers service catalog availability |\n| **Payment  Activation** | Transactional | Payment success atomically queues OTA activation |\n| **Service  Configuration** | Lookup | Service activation reads OTA configuration for vehicle commands |\n\n**Sources:** [enunciado.md:1-23]()\n\n---\n\n## Integration Communication Patterns\n\n### Factory Integration (Hybrid Pattern)\n\n```mermaid\nsequenceDiagram\n    participant CAAS as \"CaaS Order Management\"\n    participant FACTORY_API as \"Factory API\"\n    participant FACTORY_SYS as \"Factory Systems\"\n    participant WEBHOOK as \"CaaS Webhook Receiver\"\n    participant NOTIF as \"Notification Engine\"\n    \n    Note over CAAS,FACTORY_API: Synchronous Order Placement\n    CAAS-\u003e\u003eFACTORY_API: POST /orders\u003cbr/\u003e{customer, platform, options}\n    FACTORY_API-\u003e\u003eFACTORY_SYS: Create Manufacturing Order\n    FACTORY_API--\u003e\u003eCAAS: 200 OK\u003cbr/\u003e{orderId, estimatedDate}\n    \n    Note over FACTORY_SYS,WEBHOOK: Asynchronous Status Updates\n    FACTORY_SYS-\u003e\u003eFACTORY_API: Manufacturing Started\n    FACTORY_API-\u003e\u003eWEBHOOK: POST /webhooks/factory\u003cbr/\u003e{orderId, status: \"IN_PROGRESS\"}\n    WEBHOOK-\u003e\u003eNOTIF: Send Customer Notification\n    \n    FACTORY_SYS-\u003e\u003eFACTORY_API: Manufacturing Complete\n    FACTORY_API-\u003e\u003eWEBHOOK: POST /webhooks/factory\u003cbr/\u003e{orderId, status: \"READY\"}\n    WEBHOOK-\u003e\u003eNOTIF: Send Customer Notification\n```\n\n**Rationale**: Synchronous order placement ensures immediate confirmation and error handling. Asynchronous status updates prevent blocking and enable long-running manufacturing processes without maintaining connections.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n### VSS Integration (Query Pattern)\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant CATALOG as \"Service Catalog\"\n    participant VSS_GW as \"VSS Gateway\"\n    participant VSS as \"VSS System\"\n    \n    CUSTOMER-\u003e\u003eCATALOG: Request Service Purchase\n    \n    Note over CATALOG,VSS: Maintenance Check for Dependent Services\n    CATALOG-\u003e\u003eVSS_GW: Query Maintenance Status\u003cbr/\u003e{vin, serviceRequirements}\n    VSS_GW-\u003e\u003eVSS: GET /vehicles/{vin}/maintenance\n    VSS--\u003e\u003eVSS_GW: {status, lastService, completionPercentage}\n    VSS_GW--\u003e\u003eCATALOG: Maintenance Status\n    \n    alt Maintenance Current\n        CATALOG--\u003e\u003eCUSTOMER: Service Available\n    else Maintenance Overdue\n        CATALOG--\u003e\u003eCUSTOMER: Service Blocked\u003cbr/\u003eComplete Maintenance First\n    end\n```\n\n**Key Architectural Constraint**: Vehicles do NOT report maintenance status directly. The VSS system is the authoritative source, maintained independently by workshops. CaaS queries VSS when needed for service gating decisions.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n### IoT Integration (Command Pattern with Retry)\n\n```mermaid\nsequenceDiagram\n    participant PAYMENT as \"Payment Processing\"\n    participant OTA as \"OTA Activation Engine\"\n    participant IOT_API as \"API IoT\u003cbr/\u003e(Existing, Documented)\"\n    participant IOT_NET as \"IoT Network\"\n    participant VEHICLE as \"Vehicle\"\n    participant NOTIF as \"Notification Engine\"\n    participant TECH as \"Technical Support\"\n    \n    PAYMENT-\u003e\u003eOTA: Payment Successful\u003cbr/\u003e{service, vehicle, customer}\n    \n    loop Retry Logic (N Attempts)\n        OTA-\u003e\u003eIOT_API: Send OTA Command\u003cbr/\u003e{vin, configurationPayload}\n        IOT_API-\u003e\u003eIOT_NET: Push Configuration\n        IOT_NET-\u003e\u003eVEHICLE: Apply Configuration\n        \n        alt Activation Successful\n            VEHICLE--\u003e\u003eIOT_NET: Status: Success\n            IOT_NET--\u003e\u003eIOT_API: Telemetry: Activated\n            IOT_API--\u003e\u003eOTA: Success Response\n            OTA-\u003e\u003eNOTIF: Notify Customer: Service Active\n        else Activation Failed\n            VEHICLE--\u003e\u003eIOT_NET: Status: Failed\n            IOT_NET--\u003e\u003eIOT_API: Telemetry: Error\n            IOT_API--\u003e\u003eOTA: Failure Response\n            \n            alt Retries Remaining\n                Note over OTA: Wait and Retry\n            else No Retries Remaining\n                OTA-\u003e\u003eIOT_API: Query Vehicle Status\u003cbr/\u003eProactively\n                IOT_API--\u003e\u003eOTA: Vehicle Status Details\n                OTA-\u003e\u003eTECH: Escalate\u003cbr/\u003e{service, vehicle, errorDetails}\n                OTA-\u003e\u003eNOTIF: Notify Customer:\u003cbr/\u003eTechnical Issue\n                Note over OTA: DO NOT CHARGE CUSTOMER\n            end\n        end\n    end\n```\n\n**Critical Architectural Constraint**: The API IoT is pre-existing, documented, and tested. It cannot be modified. All integration must conform to its existing interface.\n\n**Critical Business Rule**: If OTA activation fails after all retries, the customer is NOT charged for the service. This is a customer protection mechanism and legal requirement.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:31-56]()\n\n---\n\n### Payment Integration (Async with Risk Assumption)\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant SERVICE_CAT as \"Service Catalog\"\n    participant PAYMENT as \"Payment Processing\"\n    participant PGW as \"Payment Gateway\"\n    participant OTA as \"OTA Activation\"\n    participant BANK as \"Bank Settlement\u003cbr/\u003e(Async)\"\n    \n    CUSTOMER-\u003e\u003eSERVICE_CAT: Purchase Service\n    SERVICE_CAT-\u003e\u003ePAYMENT: Initiate Payment\u003cbr/\u003e{amount, customer, service}\n    PAYMENT-\u003e\u003ePGW: Process Payment\u003cbr/\u003e{cardDetails, amount}\n    PGW--\u003e\u003ePAYMENT: Payment Initiated\n    \n    Note over PAYMENT,OTA: Immediate Delivery Despite Async Settlement\n    PAYMENT-\u003e\u003eOTA: Activate Service\u003cbr/\u003e(Assumes Risk)\n    OTA-\u003e\u003eCUSTOMER: Service Activated\n    \n    Note over PGW,BANK: Asynchronous Settlement\n    PGW-\u003e\u003eBANK: Settlement Request\n    \n    alt Settlement Successful\n        BANK--\u003e\u003ePGW: Confirmation\n        PGW-\u003e\u003ePAYMENT: Webhook: Payment Confirmed\n    else Settlement Failed\n        BANK--\u003e\u003ePGW: Failure\n        PGW-\u003e\u003ePAYMENT: Webhook: Payment Failed\n        Note over PAYMENT: Handle Chargeback Risk\u003cbr/\u003eAlready Delivered Service\n    end\n```\n\n**Architectural Trade-off**: CaaS prioritizes customer experience by activating services immediately upon payment initiation, before bank settlement completes. This introduces financial risk (chargebacks, failed settlements) but significantly improves perceived service quality.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-82]()\n\n---\n\n## State Management Architecture\n\n### Vehicle and Service State Model\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e OrderCreated: Dealership Registration\n    \n    OrderCreated --\u003e FactoryOrdered: Reservation Payment\n    FactoryOrdered --\u003e Manufacturing: Factory Accepts\n    Manufacturing --\u003e VehicleReady: Manufacturing Complete\n    VehicleReady --\u003e PendingFinalPayment: Customer Notified\n    \n    PendingFinalPayment --\u003e Registered: Final Payment Success\n    PendingFinalPayment --\u003e StockForSale: Final Payment Failed\n    \n    StockForSale --\u003e [*]: Vehicle Reassigned\n    \n    Registered --\u003e InTransit: Admin Registration Complete\n    InTransit --\u003e Delivered: Customer Receives\n    InTransit --\u003e AtDealership: Delivery Failed\u003cbr/\u003eCustomer Unavailable\n    \n    AtDealership --\u003e Delivered: Customer Pickup\n    \n    Delivered --\u003e Operational: Mobile App Linked\n    \n    state Operational {\n        [*] --\u003e BaseActive: Base Platform Only\n        \n        BaseActive --\u003e ServiceRequested: Customer Requests Service\n        ServiceRequested --\u003e MaintenanceCheck: System Validation\n        \n        MaintenanceCheck --\u003e PaymentRequired: Maintenance OK\n        MaintenanceCheck --\u003e BaseActive: Maintenance Overdue\u003cbr/\u003eService Blocked\n        \n        PaymentRequired --\u003e OTAQueue: Payment Success\n        PaymentRequired --\u003e BaseActive: Payment Failed\n        \n        OTAQueue --\u003e ServiceActive: OTA Success\n        OTAQueue --\u003e TechSupport: OTA Failed\u003cbr/\u003eAfter Retries\n        \n        TechSupport --\u003e BaseActive: No Charge\n        \n        ServiceActive --\u003e BaseActive: Service Used\n        \n        ServiceActive --\u003e Refunded: Desistimiento\u003cbr/\u003eWithin 14 Days\n        Refunded --\u003e BaseActive\n    }\n```\n\n**State Transitions and Business Rules:**\n\n| Transition | Trigger | Business Rule |\n|------------|---------|---------------|\n| `OrderCreated  FactoryOrdered` | Reservation payment received | Automatic API call to factory |\n| `PendingFinalPayment  StockForSale` | Final payment fails | Vehicle marked \"sin asignar\", becomes immediately available for sale |\n| `InTransit  AtDealership` | Customer not available | Vehicle returned to dealership, never left unattended |\n| `MaintenanceCheck  BaseActive` | Maintenance overdue | Service blocked but base platform remains operational |\n| `OTAQueue  TechSupport` | All retry attempts exhausted | Customer NOT charged, technical escalation |\n| `ServiceActive  Refunded` | Customer cancels within 14 days | Desistimiento (legal right of withdrawal) honored |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:18-96](), [enunciado.md:1-23]()\n\n---\n\n## Deployment Architecture\n\n### Multi-Tenant Considerations\n\nThe system must support multiple countries with varying administrative requirements:\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Core Services\u003cbr/\u003e(Multi-Tenant)\"\n        CORE_APP[\"Application Services\u003cbr/\u003eCountry-Agnostic\"]\n        CORE_DB[\"Central Databases\u003cbr/\u003eCustomer, Order, Service\"]\n    end\n    \n    subgraph \"Country-Specific Adapters\"\n        ADMIN_ES[\"Admin Gateway ES\u003cbr/\u003eSpanish Bodies\"]\n        ADMIN_FR[\"Admin Gateway FR\u003cbr/\u003eFrench Bodies\"]\n        ADMIN_DE[\"Admin Gateway DE\u003cbr/\u003eGerman Bodies\"]\n    end\n    \n    subgraph \"Shared Integration Services\"\n        FACTORY_INT[\"Factory Integration\u003cbr/\u003eSingle Factory System\"]\n        VSS_INT[\"VSS Integration\u003cbr/\u003eRegional VSS Instances\"]\n        IOT_INT[\"IoT Gateway\u003cbr/\u003eGlobal Vehicle Fleet\"]\n        PAYMENT_INT[\"Payment Gateway\u003cbr/\u003eMulti-Currency Support\"]\n    end\n    \n    CORE_APP --\u003e ADMIN_ES\n    CORE_APP --\u003e ADMIN_FR\n    CORE_APP --\u003e ADMIN_DE\n    \n    CORE_APP --\u003e FACTORY_INT\n    CORE_APP --\u003e VSS_INT\n    CORE_APP --\u003e IOT_INT\n    CORE_APP --\u003e PAYMENT_INT\n    \n    CORE_APP --\u003e CORE_DB\n```\n\n**Design Considerations:**\n- **Core services** remain country-agnostic\n- **Administrative registration** uses country-specific adapters implementing common interface\n- **Payment processing** supports multiple currencies and payment methods per country\n- **VSS integration** may connect to regional instances but presents unified interface\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n## Notification Architecture\n\n### Multi-Channel Notification Delivery\n\n```mermaid\ngraph TB\n    subgraph \"Notification Triggers\"\n        T1[\"Order Status Change\u003cbr/\u003e(Factory Webhooks)\"]\n        T2[\"OTA Activation Result\u003cbr/\u003e(Success/Failure)\"]\n        T3[\"Payment Events\u003cbr/\u003e(Confirmation/Failure)\"]\n        T4[\"Credential Generation\u003cbr/\u003e(New Customer)\"]\n        T5[\"Maintenance Reminder\u003cbr/\u003e(Scheduled)\"]\n    end\n    \n    subgraph \"Notification Engine\"\n        ROUTER[\"Notification Router\u003cbr/\u003eEvent to Channel Mapping\"]\n        TEMPLATE[\"Template Renderer\u003cbr/\u003eLocalization Support\"]\n        QUEUE[\"Message Queue\u003cbr/\u003eAsync Processing\"]\n    end\n    \n    subgraph \"Delivery Channels\"\n        EMAIL[\"Email Service\u003cbr/\u003eSMTP/SendGrid\"]\n        PUSH[\"Push Notification\u003cbr/\u003eMobile App\"]\n        SMS[\"SMS Gateway\u003cbr/\u003eUrgent Messages\"]\n        VEHICLE[\"Vehicle Display\u003cbr/\u003eVia IoT API\"]\n    end\n    \n    T1 --\u003e ROUTER\n    T2 --\u003e ROUTER\n    T3 --\u003e ROUTER\n    T4 --\u003e ROUTER\n    T5 --\u003e ROUTER\n    \n    ROUTER --\u003e TEMPLATE\n    TEMPLATE --\u003e QUEUE\n    \n    QUEUE --\u003e EMAIL\n    QUEUE --\u003e PUSH\n    QUEUE --\u003e SMS\n    QUEUE --\u003e VEHICLE\n```\n\n**Notification Routing Rules:**\n\n| Event | Email | Push | SMS | Vehicle Display |\n|-------|-------|------|-----|-----------------|\n| **Order Status Update** |  |  | - | - |\n| **Vehicle Ready** |  |  |  | - |\n| **OTA Success** |  |  | - |  |\n| **OTA Failed** |  |  | - | - |\n| **Credentials Generated** |  | - | - | - |\n| **Payment Confirmation** |  |  | - | - |\n| **Maintenance Due** |  |  |  |  |\n\n**Sources:** [enunciado.md:11-20](), [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n## Security Architecture\n\n### Authentication and Authorization Model\n\n```mermaid\ngraph TB\n    subgraph \"User Types\"\n        CUST[\"Customer\u003cbr/\u003eVehicle Owner\"]\n        EMP[\"Employee\u003cbr/\u003eDealership Staff\"]\n        ADMIN[\"Administrator\u003cbr/\u003eSystem Operators\"]\n    end\n    \n    subgraph \"Authentication\"\n        AUTH[\"Authentication Service\"]\n        CRED_STORE[\"Credential Store\u003cbr/\u003ePassword Hashes\"]\n        SESSION[\"Session Management\u003cbr/\u003eToken Generation\"]\n    end\n    \n    subgraph \"Authorization\"\n        AUTHZ[\"Authorization Service\"]\n        ROLE_DB[\"Role Definitions\"]\n        POLICY[\"Access Control Policies\"]\n    end\n    \n    subgraph \"Protected Resources\"\n        EXPEDIENTE[\"Customer Expediente\"]\n        INTRANET[\"Sales Intranet\"]\n        ADMIN_PANEL[\"Admin Functions\"]\n    end\n    \n    CUST --\u003e AUTH\n    EMP --\u003e AUTH\n    ADMIN --\u003e AUTH\n    \n    AUTH --\u003e CRED_STORE\n    AUTH --\u003e SESSION\n    \n    SESSION --\u003e AUTHZ\n    AUTHZ --\u003e ROLE_DB\n    AUTHZ --\u003e POLICY\n    \n    AUTHZ --\u003e EXPEDIENTE\n    AUTHZ --\u003e INTRANET\n    AUTHZ --\u003e ADMIN_PANEL\n```\n\n**Access Control Rules:**\n\n| User Type | Access Scope | Key Restrictions |\n|-----------|--------------|------------------|\n| **Customer** | Own expediente, own vehicle services | Cannot view other customers' data |\n| **Employee (Dealership)** | Sales registration, order management | Cannot modify existing customer credentials |\n| **Administrator** | System configuration, all records | Cannot initiate OTA commands directly (automated only) |\n\n**Authentication Flow:**\n1. Customers receive credentials via email after dealership registration\n2. No self-registration or external SSO (Google, Microsoft, etc.)\n3. All users must be explicitly provisioned in the system\n4. Mobile app links to specific vehicle after delivery (one-to-one binding)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n---\n\n## Failure Handling and Resilience\n\n### Circuit Breaker Patterns\n\nThe system implements circuit breaker patterns for critical external dependencies:\n\n```mermaid\ngraph LR\n    subgraph \"OTA Activation Circuit Breaker\"\n        OTA_CB[\"Circuit Breaker\"]\n        OTA_RETRY[\"Retry Logic\u003cbr/\u003eExponential Backoff\"]\n        OTA_FALLBACK[\"Fallback:\u003cbr/\u003eTechnical Support\"]\n    end\n    \n    subgraph \"Factory API Circuit Breaker\"\n        FACTORY_CB[\"Circuit Breaker\"]\n        FACTORY_FALLBACK[\"Fallback:\u003cbr/\u003eQueue Order\"]\n    end\n    \n    subgraph \"VSS Query Circuit Breaker\"\n        VSS_CB[\"Circuit Breaker\"]\n        VSS_FALLBACK[\"Fallback:\u003cbr/\u003eAllow Service\u003cbr/\u003e(Assume Current)\"]\n    end\n    \n    subgraph \"Payment Circuit Breaker\"\n        PAY_CB[\"Circuit Breaker\"]\n        PAY_FALLBACK[\"Fallback:\u003cbr/\u003eReject Transaction\"]\n    end\n```\n\n**Failure Handling Strategies by Subsystem:**\n\n| Subsystem | Failure Mode | Strategy | Customer Impact |\n|-----------|--------------|----------|-----------------|\n| **OTA Activation** | IoT API unavailable | Retry with exponential backoff (N attempts)  Escalate to tech support | Service NOT activated, NOT charged |\n| **Factory API** | Factory system down | Queue order for later submission | Delayed order placement, customer notified |\n| **VSS Query** | VSS unavailable | Allow service purchase (assume maintenance current) | Service activated optimistically |\n| **Payment Gateway** | Payment system down | Reject transaction immediately | Customer must retry, no service delivered |\n| **Admin Registration** | Admin API fails | Retry synchronously (blocking), escalate after timeout | Delivery delayed, customer notified |\n\n**Critical Principle**: When in doubt, favor the customer. If OTA fails or payment confirmation is delayed, do NOT charge the customer for undelivered services.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:46-53]()\n\n---\n\n## Subscription and Billing Architecture\n\n### Mes Vencido (Post-Paid) Model\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant CATALOG as \"Service Catalog\"\n    participant SUBSCRIPTION as \"Subscription Manager\"\n    participant VEHICLE as \"Vehicle\u003cbr/\u003e(Usage Tracking)\"\n    participant BILLING as \"Billing Engine\"\n    participant PAYMENT as \"Payment Processing\"\n    \n    CUSTOMER-\u003e\u003eCATALOG: Subscribe to Recurring Service\n    CATALOG-\u003e\u003eSUBSCRIPTION: Create Subscription\u003cbr/\u003e{service, startDate, frequency}\n    SUBSCRIPTION-\u003e\u003eVEHICLE: Activate Service\n    \n    Note over VEHICLE,BILLING: Month of Usage\n    loop Daily\n        VEHICLE-\u003e\u003eSUBSCRIPTION: Usage Telemetry\n    end\n    \n    Note over SUBSCRIPTION,BILLING: End of Month\n    SUBSCRIPTION-\u003e\u003eBILLING: Generate Invoice\u003cbr/\u003e{customer, services, usage}\n    BILLING-\u003e\u003ePAYMENT: Charge Mes Vencido\u003cbr/\u003e(Post-Paid)\n    \n    alt Payment Success\n        PAYMENT--\u003e\u003eBILLING: Confirmation\n        BILLING-\u003e\u003eCUSTOMER: Invoice + Receipt\n        SUBSCRIPTION-\u003e\u003eVEHICLE: Continue Service\n    else Payment Failed\n        PAYMENT--\u003e\u003eBILLING: Failure\n        BILLING-\u003e\u003eSUBSCRIPTION: Cancel Subscription\n        SUBSCRIPTION-\u003e\u003eVEHICLE: Deactivate Service\n        BILLING-\u003e\u003eCUSTOMER: Service Cancelled\u003cbr/\u003ePayment Issue\n    end\n```\n\n**Billing Cycle Rules:**\n- **One-time services**: Charge immediately upon purchase\n- **Subscription services**: Charge at month end (mes vencido) for consumed services\n- **Failed subscription payment**: Automatic cancellation, no further charges\n- **Refunds**: Subject to desistimiento rules (14-day window for services \u003e 14 days duration)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-96]()\n\n---\n\n## Technology Stack Implications\n\nBased on the architectural patterns and requirements, the system likely employs:\n\n### Backend Services\n- **API Framework**: RESTful API design for synchronous operations (Factory order placement, VSS queries)\n- **Webhook Receivers**: Async endpoint handlers for Factory status updates and payment confirmations\n- **Message Queue**: Required for async OTA activation processing and notification distribution\n- **Scheduled Jobs**: Cron-based or triggered jobs for subscription billing (end-of-month), maintenance reminders\n\n### Data Storage\n- **Relational Database**: Transactional consistency for orders, payments, customer data\n- **Document Store** (possible): Configuration repository for OTA service definitions\n- **Cache Layer**: Performance optimization for service catalog queries, maintenance status lookups\n\n### Integration Infrastructure\n- **HTTP Client Libraries**: For calling Factory API, VSS API, IoT API, Payment Gateway, Admin API\n- **Retry Mechanisms**: Built-in or library-based retry logic with exponential backoff for OTA activations\n- **Circuit Breakers**: Fault tolerance for external dependencies\n\n### Security Components\n- **Password Hashing**: Secure credential storage (bcrypt, Argon2)\n- **Token Management**: Session or JWT tokens for stateless authentication\n- **TLS/HTTPS**: Encrypted communication for all external APIs and customer-facing platforms\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104](), [enunciado.md:1-23]()\n\n---\n\n## Summary\n\nThe CaaS system architecture is built on the following key principles:\n\n1. **Centralized Orchestration**: All business logic flows through the central CaaS platform\n2. **Async-First Integration**: External systems communicate primarily via asynchronous patterns with sync for critical transactions\n3. **Customer Protection**: Failure handling defaults to customer-favorable outcomes (no charge for failed OTA)\n4. **Legal Compliance**: Desistimiento (withdrawal rights) and maintenance warranty rules embedded in architecture\n5. **Risk-Tolerant Delivery**: Services activated before payment settlement completes\n6. **Multi-Tenant Design**: Country-specific adapters for administrative requirements\n7. **State-Driven Workflows**: Explicit state machines for vehicles, orders, services, and payments\n\nFor detailed component descriptions, see [Core Technical Components](#3.2). For integration patterns and external system details, see [Integration Architecture](#3.3) and [External System Integrations](#5).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104](), [enunciado.md:1-23]()"])</script><script>self.__next_f.push([1,"1a:T4c6a,"])</script><script>self.__next_f.push([1,"# High-Level Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document presents the overall system architecture of the CaaS (Car as a Service) platform, identifying major subsystems and their relationships. It provides a technical overview of how components are organized into layers and how they interact to deliver the core business functionality.\n\nFor detailed information about specific components, see:\n- Internal technical components: [Core Technical Components](#3.2)\n- External system integration patterns: [Integration Architecture](#3.3)\n- Business model context: [Business Model and Concept](#2)\n\n## Architectural Overview\n\nThe CaaS platform follows a **layered architecture** with clear separation of concerns, organized around a central hub that orchestrates interactions between customers, dealerships, factory systems, and vehicles. The system is designed to support the Car as a Service business model where customers purchase a base vehicle platform and dynamically activate optional features through OTA (Over The Air) delivery.\n\n```mermaid\ngraph TB\n    subgraph \"Presentation Layer\"\n        WEB[\"Web Platform\u003cbr/\u003e(Customer Portal)\"]\n        MOBILE[\"Mobile Application\u003cbr/\u003e(Customer + Vehicle Control)\"]\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Dealership Operations)\"]\n    end\n    \n    subgraph \"Business Logic Layer\"\n        EXPEDIENTE[\"Expediente de Compra\u003cbr/\u003e(Purchase Record Management)\"]\n        ORDER_MGMT[\"Order Management\u003cbr/\u003e(Reservations + Sales)\"]\n        SERVICE_CAT[\"Service Catalog\u003cbr/\u003e(Opciones Disponibles)\"]\n        PAYMENT[\"Payment Processing\u003cbr/\u003e(Multiple Payment Types)\"]\n        NOTIF[\"Notification Engine\u003cbr/\u003e(Multi-channel Delivery)\"]\n    end\n    \n    subgraph \"Vehicle Operations Layer\"\n        OTA_ENGINE[\"OTA Activation Engine\u003cbr/\u003e(Service Delivery + Retry Logic)\"]\n        CONFIG_MGMT[\"Configuration Management\u003cbr/\u003e(Service Definitions)\"]\n        STATUS_MON[\"Vehicle Status Monitor\u003cbr/\u003e(Telemetry + Health)\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        FACTORY_ADAPTER[\"Factory Integration Adapter\u003cbr/\u003e(Sync Orders + Async Status)\"]\n        VSS_ADAPTER[\"VSS Integration Adapter\u003cbr/\u003e(Maintenance Queries)\"]\n        IOT_ADAPTER[\"IoT Gateway Adapter\u003cbr/\u003e(Vehicle Communication)\"]\n        PAYMENT_ADAPTER[\"Payment Gateway Adapter\u003cbr/\u003e(Transaction Processing)\"]\n        ADMIN_ADAPTER[\"Administrative Adapter\u003cbr/\u003e(Vehicle Registration)\"]\n    end\n    \n    subgraph \"Data Layer\"\n        CUSTOMER_DB[(\"Customer Database\")]\n        ORDER_DB[(\"Order Database\")]\n        SERVICE_DB[(\"Service Database\")]\n        BILLING_DB[(\"Billing Database\")]\n        CONFIG_DB[(\"Configuration Repository\")]\n    end\n    \n    subgraph \"External Systems\"\n        FACTORY_API[\"Factory API\"]\n        VSS_API[\"VSS System\"]\n        IOT_NETWORK[\"IoT Network\"]\n        PAYMENT_GW[\"Payment Gateway\"]\n        ADMIN_API[\"Administrative Bodies\"]\n    end\n    \n    WEB --\u003e EXPEDIENTE\n    MOBILE --\u003e EXPEDIENTE\n    INTRANET --\u003e ORDER_MGMT\n    \n    EXPEDIENTE --\u003e ORDER_MGMT\n    EXPEDIENTE --\u003e SERVICE_CAT\n    ORDER_MGMT --\u003e PAYMENT\n    SERVICE_CAT --\u003e PAYMENT\n    \n    PAYMENT --\u003e OTA_ENGINE\n    OTA_ENGINE --\u003e CONFIG_MGMT\n    OTA_ENGINE --\u003e IOT_ADAPTER\n    OTA_ENGINE --\u003e NOTIF\n    \n    ORDER_MGMT --\u003e FACTORY_ADAPTER\n    SERVICE_CAT --\u003e VSS_ADAPTER\n    PAYMENT --\u003e PAYMENT_ADAPTER\n    ORDER_MGMT --\u003e ADMIN_ADAPTER\n    \n    IOT_ADAPTER --\u003e STATUS_MON\n    STATUS_MON --\u003e NOTIF\n    \n    FACTORY_ADAPTER \u003c--\u003e FACTORY_API\n    VSS_ADAPTER --\u003e VSS_API\n    IOT_ADAPTER \u003c--\u003e IOT_NETWORK\n    PAYMENT_ADAPTER \u003c--\u003e PAYMENT_GW\n    ADMIN_ADAPTER --\u003e ADMIN_API\n    \n    EXPEDIENTE --\u003e CUSTOMER_DB\n    ORDER_MGMT --\u003e ORDER_DB\n    SERVICE_CAT --\u003e SERVICE_DB\n    PAYMENT --\u003e BILLING_DB\n    CONFIG_MGMT --\u003e CONFIG_DB\n    OTA_ENGINE --\u003e SERVICE_DB\n```\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:33-56]()\n\n## System Layers\n\n### Presentation Layer\n\nThe presentation layer provides three distinct access channels, each serving different user types:\n\n| Channel | Users | Primary Functions |\n|---------|-------|-------------------|\n| **Web Platform** | Customers | Browse services, manage expediente, purchase optional features |\n| **Mobile Application** | Customers | Browse services, direct vehicle control, activation notifications |\n| **Corporate Intranet** | Dealership employees | Sales registration, customer data capture, order management |\n\nThe web and mobile platforms converge on the **Expediente de Compra** (purchase record) as the single source of truth for customer information, including manuals, maintenance history, and invoices.\n\n**Sources:** [enunciado.md:8-11](), [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n### Business Logic Layer\n\nThis layer implements core domain logic independent of presentation or integration concerns:\n\n- **Expediente de Compra Management**: Central customer record system containing purchase history, vehicle information, service activations, and all customer-facing documentation\n- **Order Management**: Handles vehicle reservations, sales registration, and order lifecycle from initial purchase through delivery\n- **Service Catalog**: Manages opciones disponibles (available options) with pricing rules, duration models, and maintenance dependencies\n- **Payment Processing**: Orchestrates multiple payment types (reservation signals, final payments, service payments) with asynchronous settlement handling\n- **Notification Engine**: Multi-channel notification delivery across email, mobile push, SMS, and vehicle display systems\n\n**Sources:** [enunciado.md:5-11](), [pasame las preguntas y sus respuestas a markdown.md:77-96]()\n\n### Vehicle Operations Layer\n\nSpecialized subsystem responsible for remote service delivery and vehicle monitoring:\n\n- **OTA Activation Engine**: Core component implementing Over The Air service activation with sophisticated retry logic and failure handling. Ensures no customer charge occurs if activation fails\n- **Configuration Management**: Repository of service definitions describing how each opcin disponible maps to vehicle configuration parameters\n- **Vehicle Status Monitor**: Processes telemetry and health data from connected vehicles via the IoT network\n\nThe OTA engine is architecturally significant as it implements the critical business rule: if service activation fails after all retries, the customer must not be charged.\n\n**Sources:** [enunciado.md:19](), [pasame las preguntas y sus respuestas a markdown.md:46-56]()\n\n### Integration Layer\n\nImplements adapter pattern to isolate external system dependencies:\n\n- **Factory Integration Adapter**: Hybrid sync/async pattern for order placement (synchronous) and manufacturing status updates (asynchronous webhooks)\n- **VSS Integration Adapter**: Query-only adapter to Vehicle Service System for maintenance status verification before allowing service purchases\n- **IoT Gateway Adapter**: Bidirectional communication channel with the existing API IoT infrastructure for OTA commands and telemetry\n- **Payment Gateway Adapter**: Handles card payment processing with async settlement, implementing CaaS risk assumption strategy\n- **Administrative Adapter**: Vehicle registration with government bodies (country-specific implementations)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n### Data Layer\n\nDatabase segregation by domain:\n\n- **Customer Database**: User profiles, authentication credentials, contact information\n- **Order Database**: Vehicle sales, inventory status (asignado/sin asignar), manufacturing tracking\n- **Service Database**: Service activation history, subscription status, cancellation records\n- **Billing Database**: Payment transactions, invoices, refund processing\n- **Configuration Repository**: Service definitions, pricing rules, vehicle capability mappings\n\n**Sources:** [enunciado.md:8-17]()\n\n## Key Subsystem Interactions\n\n### Vehicle Purchase Flow\n\n```mermaid\nsequenceDiagram\n    participant EMP as \"Corporate Intranet\"\n    participant ORDER as \"Order Management\"\n    participant PAY as \"Payment Processing\"\n    participant FACTORY as \"Factory Adapter\"\n    participant ADMIN as \"Admin Adapter\"\n    participant NOTIF as \"Notification Engine\"\n    participant DB as \"Order Database\"\n    \n    EMP-\u003e\u003eORDER: \"Register sale + customer data\"\n    ORDER-\u003e\u003eDB: \"Create customer record\"\n    ORDER-\u003e\u003eNOTIF: \"Send access credentials via email\"\n    \n    EMP-\u003e\u003ePAY: \"Process reservation signal\"\n    PAY-\u003e\u003eORDER: \"Payment confirmed\"\n    \n    ORDER-\u003e\u003eFACTORY: \"POST /orders (synchronous)\"\n    FACTORY--\u003e\u003eORDER: \"Order confirmation\"\n    ORDER-\u003e\u003eDB: \"Store order ID + status\"\n    \n    loop Manufacturing Progress\n        FACTORY--\u003e\u003eORDER: \"Webhook: status update\"\n        ORDER-\u003e\u003eDB: \"Update manufacturing status\"\n        ORDER-\u003e\u003eNOTIF: \"Notify customer of progress\"\n    end\n    \n    FACTORY--\u003e\u003eORDER: \"Webhook: vehicle ready\"\n    ORDER-\u003e\u003eNOTIF: \"Notify customer: ready for final payment\"\n    \n    EMP-\u003e\u003ePAY: \"Process final payment\"\n    PAY-\u003e\u003eORDER: \"Final payment confirmed\"\n    \n    ORDER-\u003e\u003eADMIN: \"Register vehicle with authorities\"\n    ADMIN--\u003e\u003eORDER: \"Registration complete\"\n    \n    ORDER-\u003e\u003eDB: \"Mark vehicle 'asignado'\"\n    ORDER-\u003e\u003eNOTIF: \"Notify customer: ready for delivery\"\n```\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:18-29](), [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n### Service Activation Flow\n\n```mermaid\nsequenceDiagram\n    participant CUST as \"Web/Mobile Platform\"\n    participant CAT as \"Service Catalog\"\n    participant VSS as \"VSS Adapter\"\n    participant PAY as \"Payment Processing\"\n    participant OTA as \"OTA Engine\"\n    participant IOT as \"IoT Adapter\"\n    participant NOTIF as \"Notification Engine\"\n    participant DB as \"Service Database\"\n    \n    CUST-\u003e\u003eCAT: \"Browse opciones disponibles\"\n    CAT-\u003e\u003eVSS: \"Query maintenance status\"\n    VSS--\u003e\u003eCAT: \"Return maintenance compliance\"\n    \n    alt Maintenance Required and Overdue\n        CAT--\u003e\u003eCUST: \"Service unavailable - complete maintenance\"\n    else Maintenance OK\n        CUST-\u003e\u003eCAT: \"Select service + duration\"\n        CAT-\u003e\u003ePAY: \"Initiate payment\"\n        PAY--\u003e\u003eCAT: \"Payment initiated (async settlement)\"\n        \n        PAY-\u003e\u003eOTA: \"Trigger OTA activation\"\n        OTA-\u003e\u003eDB: \"Create activation record\"\n        \n        loop Retry Logic (N attempts)\n            OTA-\u003e\u003eIOT: \"Send OTA configuration command\"\n            IOT--\u003e\u003eOTA: \"Activation status\"\n            \n            alt Activation Successful\n                OTA-\u003e\u003eDB: \"Mark service active\"\n                OTA-\u003e\u003eNOTIF: \"Notify customer: service active\"\n                NOTIF--\u003e\u003eCUST: \"Push notification + email\"\n            else Activation Failed\n                alt Retries Remaining\n                    Note over OTA: \"Wait and retry\"\n                else No Retries Remaining\n                    OTA-\u003e\u003eNOTIF: \"Send to technical support\"\n                    OTA-\u003e\u003ePAY: \"Cancel charge - DO NOT CHARGE CUSTOMER\"\n                    OTA-\u003e\u003eNOTIF: \"Notify customer: activation failed\"\n                end\n            end\n        end\n    end\n```\n\n**Sources:** [enunciado.md:18-20](), [pasame las preguntas y sus respuestas a markdown.md:46-56](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n## Integration Patterns\n\nThe CaaS platform employs distinct integration patterns for each external system:\n\n| External System | Pattern | Initiator | Data Flow | Notes |\n|-----------------|---------|-----------|-----------|-------|\n| **Factory API** | Hybrid Sync/Async | CaaS  Factory (sync)\u003cbr/\u003eFactory  CaaS (async) | Orders (sync), Status webhooks (async) | API IoT documented and tested |\n| **VSS System** | Query/Pull | CaaS  VSS | Maintenance status queries | Read-only, no vehicle self-reporting |\n| **IoT Network** | Bidirectional Real-Time | CaaS  Vehicles | Commands (push), Telemetry (pull) | Existing API IoT infrastructure |\n| **Payment Gateway** | Async Settlement | CaaS  Gateway | Payment requests, Settlement confirmations | CaaS assumes risk, delivers before settlement |\n| **Admin Bodies** | Synchronous | CaaS  Admin | Vehicle registration | Blocking operation, country-specific |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:33-44](), [pasame las preguntas y sus respuestas a markdown.md:60-73](), [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n## Architectural Constraints and Design Decisions\n\n### Pre-existing API IoT\n\nThe IoT network infrastructure and **API IoT** are pre-existing, documented, and tested systems. This is an architectural constraintCaaS must integrate with the API as-is without modifications:\n\n\u003e \"Existe una API IoT documentada y probada para configuracin remota. Est preparada para CaaS, aunque no en uso hasta que finalice el proyecto. Cualquier problema de integracin se carga al proyecto previo.\"\n\nThis constraint shapes the Vehicle Operations Layer, which must adapt to the existing API rather than designing a custom interface.\n\n### Firmware Pre-installation Model\n\nAll optional service functionality is **pre-installed in vehicle firmware**. The CaaS system performs only activation/deactivation, not software updates:\n\n\u003e \"Toda la funcionalidad ya est preinstalada en el firmware. CaaS solo realiza la activacin o desactivacin.\"\n\nThis architectural decision simplifies the OTA engine (configuration changes only) but requires comprehensive capability management in the Configuration Repository to track which features are available in each vehicle's firmware version.\n\n### Risk Assumption Strategy\n\nCaaS implements **immediate service delivery** despite asynchronous payment settlement. This business decision creates architectural requirements for:\n- Payment reconciliation subsystems\n- Failure detection and refund processing\n- Customer communication for settlement failures\n\nThe critical protection rule: **if OTA activation fails, the customer must not be charged**, regardless of payment gateway status.\n\n### Maintenance-Gated Service Access\n\nServices with maintenance dependencies require real-time VSS queries before purchase. This creates a dependency path: `Service Catalog  VSS Adapter  VSS API` for every service browse/purchase operation involving maintenance-linked opciones disponibles.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:33-56](), [pasame las preguntas y sus respuestas a markdown.md:60-73](), [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n## Data Flow Architecture\n\n### Customer-Facing Data Flow\n\n```mermaid\ngraph LR\n    subgraph \"Customer Access Points\"\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile App\"]\n    end\n    \n    subgraph \"Core Data Management\"\n        EXP[\"Expediente de Compra\u003cbr/\u003e(Central Record)\"]\n        HIST[\"Purchase History\"]\n        MAINT[\"Maintenance Records\"]\n        INVOICES[\"Invoices + Payments\"]\n        MANUALS[\"Vehicle Manuals\"]\n    end\n    \n    subgraph \"Data Sources\"\n        ORDER_SYS[\"Order Management\"]\n        SERVICE_SYS[\"Service Catalog\"]\n        VSS_SYS[\"VSS Integration\"]\n        BILLING_SYS[\"Billing System\"]\n    end\n    \n    WEB --\u003e EXP\n    MOBILE --\u003e EXP\n    \n    EXP --\u003e HIST\n    EXP --\u003e MAINT\n    EXP --\u003e INVOICES\n    EXP --\u003e MANUALS\n    \n    ORDER_SYS --\u003e HIST\n    SERVICE_SYS --\u003e HIST\n    VSS_SYS --\u003e MAINT\n    BILLING_SYS --\u003e INVOICES\n```\n\nThe **Expediente de Compra** serves as the aggregation point for all customer-facing data, providing a unified view regardless of access channel (web or mobile).\n\n**Sources:** [enunciado.md:11](), [pasame las preguntas y sus respuestas a markdown.md:11-16]()\n\n### Internal Operations Data Flow\n\n```mermaid\ngraph TD\n    subgraph \"Dealership Operations\"\n        SALES[\"Sales Registration\"]\n        CRED[\"Credential Generation\"]\n    end\n    \n    subgraph \"Manufacturing Tracking\"\n        ORDER_PLACE[\"Order Placement\"]\n        STATUS_TRACK[\"Status Tracking\"]\n        NOTIF_SEND[\"Customer Notifications\"]\n    end\n    \n    subgraph \"Financial Operations\"\n        RESERVA[\"Reservation Payment\"]\n        FINAL[\"Final Payment\"]\n        SERVICE_PAY[\"Service Payments\"]\n        BILLING[\"Mes Vencido Billing\"]\n    end\n    \n    subgraph \"Vehicle Inventory\"\n        ASSIGN[\"Vehicle Assignment\"]\n        STOCK[\"Stock Management\"]\n        REG[\"Registration Status\"]\n    end\n    \n    SALES --\u003e CRED\n    CRED --\u003e ORDER_PLACE\n    ORDER_PLACE --\u003e STATUS_TRACK\n    STATUS_TRACK --\u003e NOTIF_SEND\n    \n    SALES --\u003e RESERVA\n    STATUS_TRACK --\u003e FINAL\n    FINAL --\u003e REG\n    REG --\u003e ASSIGN\n    \n    FINAL -.Payment Failure.-\u003e STOCK\n    \n    SERVICE_PAY --\u003e BILLING\n```\n\nInternal operations maintain strict separation between dealership functions (sales, registration), manufacturing coordination (factory integration), and financial processing (payments, billing).\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:18-29](), [pasame las preguntas y sus respuestas a markdown.md:77-96]()\n\n## System Boundaries\n\n### What is Inside the CaaS System\n\nThe CaaS platform **owns and implements**:\n- Customer-facing platforms (web, mobile, expediente)\n- Corporate intranet for dealership operations\n- Order management and service catalog\n- OTA activation engine with retry logic\n- Payment processing orchestration (not settlement)\n- Notification delivery across all channels\n- Integration adapters for all external systems\n\n### What is Outside the CaaS System\n\n**External actors and systems** that CaaS integrates with but does not control:\n- **Customers**: External actors who use the system\n- **Dealership employees**: External actors who operate the intranet\n- **Factory systems**: Manufacturing execution, not part of CaaS\n- **Transport companies**: Subcontracted logistics\n- **VSS system**: Maintained by workshop network, CaaS queries only\n- **IoT Network**: Pre-existing infrastructure, CaaS sends commands via API\n- **Vehicles**: Infrastructure components that receive configurations\n- **Payment gateway**: Third-party financial service\n- **Administrative bodies**: Government registration systems\n\nThe architectural principle: **\"Un actor es siempre algo externo a nosotros (el sistema de informacin) a quien damos servicio\"** clarifies that actors are always external to the information system.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:10-16](), [enunciado.md:1-23]()\n\n## Scalability and Distribution Considerations\n\nWhile the current architecture is presented as a monolithic view, the layered design enables future distribution:\n\n- **Presentation Layer**: Can be scaled horizontally behind load balancers\n- **Business Logic Layer**: Stateless services suitable for horizontal scaling\n- **Vehicle Operations Layer**: OTA engine may require message queues for handling large fleets\n- **Integration Layer**: Adapters can be isolated as microservices if external system load varies significantly\n- **Data Layer**: Database segregation already supports independent scaling per domain\n\nThe asynchronous patterns (factory webhooks, payment settlement, OTA retries) provide natural boundaries for eventual consistency and distributed processing.\n\n**Sources:** [enunciado.md:7](), [pasame las preguntas y sus respuestas a markdown.md:33-56]()"])</script><script>self.__next_f.push([1,"1b:T607f,"])</script><script>self.__next_f.push([1,"# Core Technical Components\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the internal technical components that comprise the CaaS platform core. These components handle business logic, data management, and orchestration within the system boundaries. \n\nFor external system integrations and API communication patterns, see [Integration Architecture](#3.3). For the overall system structure, see [High-Level Architecture](#3.1).\n\n---\n\n## Component Overview\n\nThe CaaS platform consists of six core technical components that work together to deliver the Car as a Service functionality:\n\n```mermaid\ngraph TB\n    subgraph \"Customer Access Layer\"\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile Application\"]\n    end\n    \n    subgraph \"Employee Access Layer\"\n        INTRANET[\"Corporate Intranet\u003cbr/\u003eSales Registration\"]\n    end\n    \n    subgraph \"Core Technical Components\"\n        EXPEDIENTE[\"Expediente de Compra\u003cbr/\u003eCustomer Purchase Records\"]\n        CATALOG[\"Service Catalog Engine\u003cbr/\u003eOpciones Disponibles\"]\n        PAYMENT[\"Payment Processing Engine\u003cbr/\u003eMultiple Payment Types\"]\n        NOTIFICATION[\"Notification Engine\u003cbr/\u003eMulti-channel Delivery\"]\n        OTA[\"OTA Activation Engine\u003cbr/\u003eService Delivery \u0026 Retry\"]\n        ORDER[\"Order Management\u003cbr/\u003eSales \u0026 Inventory\"]\n    end\n    \n    subgraph \"Data Persistence\"\n        CUSTOMER_DB[(\"Customer Database\")]\n        ORDER_DB[(\"Order Database\")]\n        SERVICE_DB[(\"Service Database\")]\n        BILLING_DB[(\"Billing Database\")]\n    end\n    \n    WEB --\u003e EXPEDIENTE\n    MOBILE --\u003e EXPEDIENTE\n    INTRANET --\u003e ORDER\n    \n    EXPEDIENTE --\u003e CATALOG\n    EXPEDIENTE --\u003e ORDER\n    \n    ORDER --\u003e PAYMENT\n    CATALOG --\u003e PAYMENT\n    \n    PAYMENT --\u003e OTA\n    OTA --\u003e NOTIFICATION\n    \n    EXPEDIENTE --\u003e CUSTOMER_DB\n    ORDER --\u003e ORDER_DB\n    CATALOG --\u003e SERVICE_DB\n    PAYMENT --\u003e BILLING_DB\n    OTA --\u003e SERVICE_DB\n    \n    ORDER --\u003e NOTIFICATION\n    PAYMENT --\u003e NOTIFICATION\n```\n\n**Component Responsibilities Summary**\n\n| Component | Primary Responsibility | Key Data Managed |\n|-----------|----------------------|------------------|\n| Corporate Intranet | Sales registration and customer onboarding | Sale records, customer credentials |\n| Expediente de Compra | Customer purchase record aggregation | Manuals, maintenance history, invoices |\n| Service Catalog Engine | Opciones disponibles management | Service definitions, pricing rules, availability |\n| Payment Processing Engine | Payment orchestration | Reservation, final, and service payments |\n| Notification Engine | Multi-channel customer communication | Email, push, SMS notifications |\n| OTA Activation Engine | Remote service delivery | Activation commands, retry logic, failure tracking |\n\nSources: [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Corporate Intranet\n\n### Purpose\nThe corporate intranet is the dealership-facing system where sales staff register vehicle purchases and initiate customer onboarding. This component serves as the entry point for new customer relationships and vehicle orders.\n\n### Functionality\n\n**Sales Registration Process:**\n1. Capture customer identificative data\n2. Record plan comercial (plataforma base + included opciones)\n3. Generate customer access credentials\n4. Trigger automatic factory order placement via API\n5. Mark vehicle assignment status\n\n```mermaid\ngraph LR\n    STAFF[\"Dealership Staff\"] --\u003e INTRANET[\"Corporate Intranet\u003cbr/\u003eSales Module\"]\n    \n    INTRANET --\u003e CAPTURE[\"Capture Customer Data\u003cbr/\u003e+ Plan Comercial\"]\n    CAPTURE --\u003e VALIDATE[\"Validate Sale\"]\n    VALIDATE --\u003e GENERATE[\"Generate Credentials\"]\n    GENERATE --\u003e ORDER_API[\"Trigger Factory Order API\"]\n    GENERATE --\u003e ASSIGN[\"Assign Vehicle to Customer\"]\n    \n    ASSIGN --\u003e VEHICLE_DB[(\"Vehicle Database\u003cbr/\u003eAssignment Status\")]\n    GENERATE --\u003e CUSTOMER_DB[(\"Customer Database\u003cbr/\u003eCredentials \u0026 Profile\")]\n    ORDER_API --\u003e NOTIFICATION[\"Send Credentials Email\"]\n```\n\n**Data Captured:**\n- Customer identificative information\n- Contact email for credential delivery\n- Plataforma base model selected\n- Plan comercial details (included opciones disponibles)\n- Payment reservation signal\n\n**System Outputs:**\n- Customer account creation\n- Access credentials sent via email\n- Factory order initiation (synchronous API call)\n- Vehicle marked as \"assigned\" to customer\n\n**Business Rules Enforced:**\n- No auto-registration allowed - all users must be registered by dealership staff\n- Credentials sent to customer-provided email address only\n- Vehicle cannot be re-assigned once reserved\n\nSources: [enunciado.md:8-11](), [pasame las preguntas y sus respuestas a markdown.md:14-16]()\n\n---\n\n## Expediente de Compra System\n\n### Purpose\nThe Expediente de Compra is the central aggregation point for all customer purchase-related information. It serves as the single source of truth that customers access through web and mobile platforms.\n\n### Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Access Channels\"\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile Application\"]\n    end\n    \n    subgraph \"Expediente de Compra Core\"\n        AGGREGATOR[\"Data Aggregator\"]\n        MANUALS[\"Manuals Repository\"]\n        HISTORY[\"Maintenance History\"]\n        INVOICES[\"Invoice Archive\"]\n        ORDERS[\"Order Status\"]\n        SERVICES[\"Active Services\"]\n    end\n    \n    subgraph \"Data Sources\"\n        CUSTOMER_DB[(\"Customer Database\")]\n        ORDER_DB[(\"Order Database\")]\n        SERVICE_DB[(\"Service Database\")]\n        BILLING_DB[(\"Billing Database\")]\n        VSS_API[\"VSS System API\"]\n    end\n    \n    WEB --\u003e AGGREGATOR\n    MOBILE --\u003e AGGREGATOR\n    \n    AGGREGATOR --\u003e MANUALS\n    AGGREGATOR --\u003e HISTORY\n    AGGREGATOR --\u003e INVOICES\n    AGGREGATOR --\u003e ORDERS\n    AGGREGATOR --\u003e SERVICES\n    \n    MANUALS --\u003e CUSTOMER_DB\n    HISTORY --\u003e VSS_API\n    INVOICES --\u003e BILLING_DB\n    ORDERS --\u003e ORDER_DB\n    SERVICES --\u003e SERVICE_DB\n```\n\n### Information Provided\n\n**Manuals:**\n- Vehicle platform base manual\n- Optional service documentation\n- Usage guidelines for activated features\n\n**Maintenance History:**\n- Retrieved from VSS system via API query\n- Displays service records from official and approved workshops\n- Shows maintenance compliance percentage by functional blocks\n\n**Invoices:**\n- Reservation payment receipt\n- Final vehicle payment invoice\n- Service payment receipts (one-time and subscription)\n- Refund records (desistimiento cases)\n\n**Order Status:**\n- Manufacturing progress notifications\n- Delivery status tracking\n- Vehicle availability notifications\n\n**Active Services:**\n- Currently enabled opciones disponibles\n- Service expiration dates (for temporary services)\n- Subscription status and renewal dates\n- Planned/recurring service schedule\n\n### Authentication and Access Control\n\nThe Expediente de Compra implements strict access control:\n- Credentials generated by corporate intranet during sales registration\n- No external SSO integration (Google, Microsoft, etc.)\n- All users must be known and controlled by the system\n- Customers must have purchased a vehicle to access\n\nSources: [enunciado.md:11-12](), [pasame las preguntas y sus respuestas a markdown.md:14-16](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Service Catalog Engine\n\n### Purpose\nThe Service Catalog Engine manages the repository of opciones disponibles, their pricing models, eligibility rules, and availability constraints. This component determines what services customers can purchase at any given time.\n\n### Service Types and Pricing Models\n\n```mermaid\ngraph TD\n    CATALOG[\"Service Catalog Engine\"]\n    \n    CATALOG --\u003e TEMPORARY[\"Temporary Services\u003cbr/\u003eLimited Duration\"]\n    CATALOG --\u003e PERMANENT[\"Permanent Services\u003cbr/\u003eUntil End of Life\"]\n    CATALOG --\u003e PLANNED[\"Planned Services\u003cbr/\u003eFuture Activation\"]\n    CATALOG --\u003e RECURRING[\"Recurring Services\u003cbr/\u003eSubscription Model\"]\n    \n    TEMPORARY --\u003e PRICING_TEMP[\"Pago por Uso\u003cbr/\u003eOne-time Payment\"]\n    PERMANENT --\u003e PRICING_PERM[\"Pago por Uso\u003cbr/\u003eOne-time Payment\"]\n    PLANNED --\u003e PRICING_PLAN[\"Advance Payment\u003cbr/\u003eFuture Delivery\"]\n    RECURRING --\u003e PRICING_REC[\"Mes Vencido\u003cbr/\u003eMonthly Billing\"]\n    \n    CATALOG --\u003e RULES[\"Eligibility Rules\"]\n    RULES --\u003e MAINT_CHECK[\"Maintenance Status Check\"]\n    RULES --\u003e WARRANTY_CHECK[\"Warranty Status Check\"]\n    RULES --\u003e PLATFORM_CHECK[\"Platform Compatibility\"]\n```\n\n### Service Categories\n\nExamples of opciones disponibles managed by the catalog:\n\n| Service Category | Examples | Maintenance-Linked |\n|-----------------|----------|-------------------|\n| Performance | 50% power increase | Yes (engine maintenance) |\n| Driver Assistance | Collision avoidance, lane keeping | Yes (sensor calibration) |\n| Autonomous Driving | Highway autonomous mode | Yes (system diagnostics) |\n| Traction \u0026 Handling | Snow mode, off-road mode, sport mode | Yes (drivetrain maintenance) |\n| Climate Control | Advanced HVAC zones, heated seats | No |\n| Entertainment | Premium audio, streaming services | No |\n\n### Eligibility and Availability Logic\n\n**Maintenance-Linked Services:**\nThe catalog engine queries VSS system to determine if maintenance-dependent services can be offered:\n\n```mermaid\nflowchart TD\n    REQUEST[\"Customer Requests Service\"]\n    CHECK_MAINT{\"Service Requires\u003cbr/\u003eMaintenance?\"}\n    QUERY_VSS[\"Query VSS System\u003cbr/\u003eMaintenance Status\"]\n    CHECK_COMPLIANCE{\"Maintenance\u003cbr/\u003eCurrent?\"}\n    \n    REQUEST --\u003e CHECK_MAINT\n    CHECK_MAINT --\u003e|No| AVAILABLE[\"Service Available\u003cbr/\u003efor Purchase\"]\n    CHECK_MAINT --\u003e|Yes| QUERY_VSS\n    QUERY_VSS --\u003e CHECK_COMPLIANCE\n    CHECK_COMPLIANCE --\u003e|Yes| AVAILABLE\n    CHECK_COMPLIANCE --\u003e|No| BLOCKED[\"Service Blocked\u003cbr/\u003eComplete Maintenance First\"]\n    \n    BLOCKED --\u003e NOTIFY_CUSTOMER[\"Notify Customer\u003cbr/\u003eMaintenance Required\"]\n    AVAILABLE --\u003e SHOW_PRICE[\"Display Pricing\u003cbr/\u003e\u0026 Duration Options\"]\n```\n\n**Key Business Rules:**\n- If service requires maintenance and vehicle maintenance is overdue, service is unavailable for purchase\n- Already activated services are NOT deactivated if maintenance lapses (only new purchases blocked)\n- Plataforma base features are never affected by maintenance status\n- Warranty loss does not block base functionality, only new service activations\n\n**Platform Compatibility:**\n- Each plataforma base has specific compatible opciones disponibles\n- Service catalog filters options based on customer's vehicle platform\n- Pre-configured in service definitions repository\n\nSources: [enunciado.md:3-6](), [pasame las preguntas y sus respuestas a markdown.md:58-73](), [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Payment Processing Engine\n\n### Purpose\nThe Payment Processing Engine orchestrates all payment types and handles the complex lifecycle of vehicle purchases and service payments. This component manages integration with payment gateways while implementing CaaS risk management policies.\n\n### Payment Type Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Payment Types\"\n        RESERVATION[\"Reservation Payment\u003cbr/\u003eSeal\"]\n        FINAL[\"Final Payment\u003cbr/\u003eComplete Purchase\"]\n        SERVICE_ONETIME[\"Service Payment\u003cbr/\u003eOne-time\"]\n        SERVICE_SUB[\"Service Payment\u003cbr/\u003eSubscription\"]\n    end\n    \n    subgraph \"Payment Processing Engine\"\n        ORCHESTRATOR[\"Payment Orchestrator\"]\n        VALIDATOR[\"Payment Validator\"]\n        GATEWAY_INT[\"Gateway Integration\"]\n        RISK_MGR[\"Risk Manager\"]\n    end\n    \n    subgraph \"Payment Outcomes\"\n        SUCCESS[\"Payment Success\"]\n        ASYNC_SETTLE[\"Async Settlement\u003cbr/\u003eBank Processing\"]\n        IMMEDIATE_DELIVERY[\"Immediate Service Delivery\"]\n    end\n    \n    RESERVATION --\u003e ORCHESTRATOR\n    FINAL --\u003e ORCHESTRATOR\n    SERVICE_ONETIME --\u003e ORCHESTRATOR\n    SERVICE_SUB --\u003e ORCHESTRATOR\n    \n    ORCHESTRATOR --\u003e VALIDATOR\n    VALIDATOR --\u003e GATEWAY_INT\n    GATEWAY_INT --\u003e ASYNC_SETTLE\n    \n    VALIDATOR --\u003e RISK_MGR\n    RISK_MGR --\u003e IMMEDIATE_DELIVERY\n    IMMEDIATE_DELIVERY --\u003e SUCCESS\n```\n\n### Payment Workflows\n\n**Reservation Payment (Seal):**\n- Triggered at sales registration in corporate intranet\n- Required before factory order placement\n- Confirms customer commitment to purchase\n\n**Final Payment:**\n- Required before vehicle matriculation (registration)\n- Triggered when vehicle is available for delivery\n- Failure results in vehicle returning to stock (\"sin asignar\" status)\n\n**Service Payment (One-time):**\n- Pay-per-use model (pago por uso)\n- Payment processed before OTA activation attempt\n- Immediate service delivery despite async settlement (CaaS assumes risk)\n\n**Subscription Payment (Mes Vencido):**\n- Post-paid billing model\n- Customer charged at end of month for consumed services\n- Payment failure triggers subscription cancellation\n\n### Payment Failure Handling\n\n```mermaid\nflowchart TD\n    PAYMENT[\"Payment Initiated\"]\n    TYPE{\"Payment Type?\"}\n    \n    PAYMENT --\u003e TYPE\n    \n    TYPE --\u003e|Final Payment| FINAL_FAIL[\"Final Payment Fails\"]\n    FINAL_FAIL --\u003e RETURN_STOCK[\"Vehicle Returns to Stock\u003cbr/\u003esin asignar Status\"]\n    RETURN_STOCK --\u003e CUSTOMER_LOSES[\"Customer Loses Reservation\"]\n    \n    TYPE --\u003e|Service Payment| SERVICE_FAIL[\"Service Payment Fails\"]\n    SERVICE_FAIL --\u003e NO_ACTIVATION[\"No OTA Activation Attempted\"]\n    NO_ACTIVATION --\u003e NOTIFY_FAIL[\"Notify Customer\u003cbr/\u003ePayment Issue\"]\n    \n    TYPE --\u003e|Subscription| SUB_FAIL[\"Subscription Payment Fails\"]\n    SUB_FAIL --\u003e CANCEL_SUB[\"Cancel Subscription\u003cbr/\u003eAuto-renewal Stopped\"]\n    CANCEL_SUB --\u003e GRACE_PERIOD[\"Grace Period\u003cbr/\u003eService Remains Active\"]\n```\n\n### Risk Management Strategy\n\nThe Payment Processing Engine implements a customer-favorable risk approach:\n\n**Immediate Delivery Policy:**\n- Services activated before bank settlement confirmation\n- CaaS assumes risk of payment reversal/failure\n- Optimizes customer experience over financial risk\n\n**No Charge for Failed Delivery:**\n- If OTA activation fails, payment is NOT processed or is refunded\n- Customer never pays for undelivered services\n- Critical business rule: payment success depends on successful service delivery\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:75-96](), [enunciado.md:13-19]()\n\n---\n\n## Notification Engine\n\n### Purpose\nThe Notification Engine provides multi-channel communication to customers throughout their vehicle ownership and service usage lifecycle. This component ensures customers receive timely updates regardless of their preferred communication channel.\n\n### Multi-Channel Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Notification Triggers\"\n        CRED_GEN[\"Credential Generation\"]\n        ORDER_STATUS[\"Order Status Change\"]\n        VEHICLE_READY[\"Vehicle Ready\"]\n        SERVICE_ACTIVE[\"Service Activated\"]\n        OTA_FAIL[\"OTA Failure\"]\n        PAYMENT_CONF[\"Payment Confirmation\"]\n        MAINT_REMINDER[\"Maintenance Reminder\"]\n    end\n    \n    subgraph \"Notification Engine Core\"\n        ROUTER[\"Notification Router\"]\n        TEMPLATE[\"Template Engine\"]\n        DELIVERY[\"Delivery Manager\"]\n    end\n    \n    subgraph \"Delivery Channels\"\n        EMAIL[\"Email Service\"]\n        PUSH[\"Push Notifications\u003cbr/\u003eMobile App\"]\n        SMS[\"SMS Gateway\"]\n        VEHICLE[\"Vehicle Display\u003cbr/\u003eVia IoT\"]\n    end\n    \n    CRED_GEN --\u003e ROUTER\n    ORDER_STATUS --\u003e ROUTER\n    VEHICLE_READY --\u003e ROUTER\n    SERVICE_ACTIVE --\u003e ROUTER\n    OTA_FAIL --\u003e ROUTER\n    PAYMENT_CONF --\u003e ROUTER\n    MAINT_REMINDER --\u003e ROUTER\n    \n    ROUTER --\u003e TEMPLATE\n    TEMPLATE --\u003e DELIVERY\n    \n    DELIVERY --\u003e EMAIL\n    DELIVERY --\u003e PUSH\n    DELIVERY --\u003e SMS\n    DELIVERY --\u003e VEHICLE\n```\n\n### Notification Types and Channels\n\n| Notification Type | Email | Push | SMS | Vehicle Display |\n|------------------|-------|------|-----|----------------|\n| Access Credentials |  | - | - | - |\n| Manufacturing Status |  |  | - | - |\n| Vehicle Ready |  |  |  | - |\n| Service Activated |  |  | - |  |\n| OTA Activation Failure |  |  | - | - |\n| Payment Confirmation |  | - | - | - |\n| Maintenance Required |  |  | - |  |\n\n### Critical Notification Workflows\n\n**Credential Delivery:**\n- Sent immediately after sales registration in corporate intranet\n- Contains access credentials for web and mobile platforms\n- Email is the only channel (must be customer-provided address)\n\n**Manufacturing Status Updates:**\n- Automatic notifications throughout fabrication process\n- Key value differentiator for CaaS system\n- Updates sent at manufacturing milestones\n\n**OTA Activation Status:**\n- Success notification sent to mobile app and vehicle display\n- Failure notification triggers technical support workflow\n- Critical: customer notified if activation fails and no charge applied\n\n**Maintenance Alerts:**\n- Sent when maintenance schedule approaches\n- Warning if maintenance overdue and affects service availability\n- Does not block already-activated services\n\nSources: [enunciado.md:13-19](), [pasame las preguntas y sus respuestas a markdown.md:28-29](), [pasame las preguntas y sus respuestas a markdown.md:46-53]()\n\n---\n\n## OTA Activation Engine\n\n### Purpose\nThe OTA (Over The Air) Activation Engine is responsible for remote delivery of opciones disponibles to customer vehicles. This component implements sophisticated retry logic and failure handling to ensure reliable service delivery.\n\n### Activation Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Activation Triggers\"\n        PAYMENT_OK[\"Payment Successful\"]\n        PLANNED_TIME[\"Planned Service Time\"]\n        SUB_RENEWAL[\"Subscription Renewal\"]\n    end\n    \n    subgraph \"OTA Activation Engine\"\n        QUEUE[\"Activation Queue\"]\n        COMMAND_GEN[\"Command Generator\"]\n        IOT_INT[\"IoT Gateway Interface\"]\n        RETRY_MGR[\"Retry Manager\"]\n        STATUS_MON[\"Status Monitor\"]\n    end\n    \n    subgraph \"Configuration Repository\"\n        SERVICE_DEF[\"Service Definitions\"]\n        FIRMWARE_MAP[\"Firmware Mapping\"]\n        VEHICLE_CAP[\"Vehicle Capabilities\"]\n    end\n    \n    subgraph \"Outcomes\"\n        SUCCESS[\"Activation Successful\"]\n        FAILURE[\"All Retries Failed\"]\n        TECH_SUPPORT[\"Technical Support Ticket\"]\n        REFUND[\"Customer Refund\u003cbr/\u003eNo Charge\"]\n    end\n    \n    PAYMENT_OK --\u003e QUEUE\n    PLANNED_TIME --\u003e QUEUE\n    SUB_RENEWAL --\u003e QUEUE\n    \n    QUEUE --\u003e COMMAND_GEN\n    COMMAND_GEN --\u003e SERVICE_DEF\n    COMMAND_GEN --\u003e FIRMWARE_MAP\n    COMMAND_GEN --\u003e VEHICLE_CAP\n    \n    COMMAND_GEN --\u003e IOT_INT\n    IOT_INT --\u003e STATUS_MON\n    \n    STATUS_MON --\u003e SUCCESS\n    STATUS_MON --\u003e RETRY_MGR\n    RETRY_MGR --\u003e IOT_INT\n    RETRY_MGR --\u003e FAILURE\n    \n    FAILURE --\u003e TECH_SUPPORT\n    FAILURE --\u003e REFUND\n```\n\n### Firmware Pre-installation Model\n\n**Key Architectural Principle:**\nAll optional functionality is pre-installed in vehicle firmware. The OTA Activation Engine does NOT deliver software updates; it only activates or deactivates features that already exist in the vehicle.\n\n```mermaid\nflowchart LR\n    VEHICLE[\"Vehicle\u003cbr/\u003eAll Features Pre-installed\"]\n    OTA[\"OTA Activation Engine\"]\n    CONFIG[\"Configuration Command\u003cbr/\u003eEnable/Disable Feature\"]\n    \n    VEHICLE --\u003e|Current Config| OTA\n    OTA --\u003e|Activation Command| CONFIG\n    CONFIG --\u003e|Updated Config| VEHICLE\n    \n    NOTE[\"Note: No software upload\u003cbr/\u003eOnly configuration changes\"]\n```\n\n**Separation of Concerns:**\n- Software updates to vehicle firmware are independent processes\n- CaaS OTA only manages feature activation/deactivation\n- Reduces complexity and activation time\n- Improves reliability (no large file transfers)\n\n### Retry Logic and Failure Handling\n\n**Retry Strategy:**\n\n```mermaid\nflowchart TD\n    START[\"OTA Activation Initiated\"]\n    ATTEMPT1[\"Attempt 1\u003cbr/\u003eSend Command via IoT\"]\n    CHECK1{\"Success?\"}\n    \n    ATTEMPT2[\"Attempt 2\u003cbr/\u003eRetry After Delay\"]\n    CHECK2{\"Success?\"}\n    \n    ATTEMPTX[\"Attempt N\u003cbr/\u003eFinal Retry\"]\n    CHECKX{\"Success?\"}\n    \n    PROBE[\"Proactive Status Query\u003cbr/\u003eGet Vehicle State\"]\n    TICKET[\"Create Tech Support Ticket\"]\n    NOTIFY[\"Notify Customer\u003cbr/\u003eFailed Activation\"]\n    REFUND[\"Process Refund\u003cbr/\u003eDO NOT CHARGE\"]\n    \n    START --\u003e ATTEMPT1\n    ATTEMPT1 --\u003e CHECK1\n    CHECK1 --\u003e|Yes| SUCCESS[\"Service Activated\u003cbr/\u003eNotify Customer\"]\n    CHECK1 --\u003e|No| ATTEMPT2\n    \n    ATTEMPT2 --\u003e CHECK2\n    CHECK2 --\u003e|Yes| SUCCESS\n    CHECK2 --\u003e|No| ATTEMPTX\n    \n    ATTEMPTX --\u003e CHECKX\n    CHECKX --\u003e|Yes| SUCCESS\n    CHECKX --\u003e|No| PROBE\n    \n    PROBE --\u003e TICKET\n    TICKET --\u003e NOTIFY\n    NOTIFY --\u003e REFUND\n```\n\n**Critical Business Rule: No Charge for Failed Activation**\n\nIf OTA activation fails after all retry attempts:\n1. Proactively query vehicle state to gather diagnostic information\n2. Send diagnostic data to technical support service\n3. Notify customer of failure\n4. **DO NOT CHARGE** customer for the undelivered service\n5. Issue refund if payment already processed\n\nThis rule is fundamental to customer trust and legal compliance.\n\n### Status Monitoring\n\nThe OTA Activation Engine monitors activation status through multiple mechanisms:\n\n**Active Monitoring:**\n- Confirmation messages from vehicle via IoT network\n- Activation command acknowledgment\n- Feature status reports\n\n**Passive Monitoring:**\n- Telemetry data indicating feature usage\n- Vehicle health checks showing active configurations\n- Customer-reported activation status (via mobile app)\n\n**Proactive Querying:**\n- If activation confirmation not received within timeout\n- Before declaring activation failure\n- To gather diagnostics for technical support\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:31-56](), [enunciado.md:19-20]()\n\n---\n\n## Component Interaction Flow\n\nThe following diagram illustrates how these core components interact during a typical service purchase and activation:\n\n```mermaid\nsequenceDiagram\n    participant C as Customer\n    participant E as Expediente de Compra\n    participant CAT as Service Catalog\n    participant PAY as Payment Engine\n    participant OTA as OTA Activation Engine\n    participant NOT as Notification Engine\n    participant VSS as VSS System\n    \n    C-\u003e\u003eE: Browse Available Services\n    E-\u003e\u003eCAT: Request Service Catalog\n    CAT-\u003e\u003eVSS: Check Maintenance Status\n    VSS--\u003e\u003eCAT: Maintenance Current\n    CAT--\u003e\u003eE: Return Available Services\n    E--\u003e\u003eC: Display Services \u0026 Pricing\n    \n    C-\u003e\u003eE: Select Service \u0026 Duration\n    E-\u003e\u003ePAY: Initiate Payment\n    PAY-\u003e\u003ePAY: Process Payment\u003cbr/\u003eAssume Settlement Risk\n    PAY--\u003e\u003eE: Payment Accepted\n    \n    PAY-\u003e\u003eOTA: Queue Service Activation\n    OTA-\u003e\u003eOTA: Generate Configuration Command\n    OTA-\u003e\u003eOTA: Attempt 1: Send via IoT\n    \n    alt Activation Successful\n        OTA-\u003e\u003eNOT: Trigger Success Notification\n        NOT-\u003e\u003eC: Email + Push + Vehicle Display\n    else Activation Failed\n        OTA-\u003e\u003eOTA: Attempt 2: Retry\n        alt Retry Successful\n            OTA-\u003e\u003eNOT: Trigger Success Notification\n            NOT-\u003e\u003eC: Email + Push + Vehicle Display\n        else All Retries Failed\n            OTA-\u003e\u003eOTA: Query Vehicle Status\n            OTA-\u003e\u003eNOT: Trigger Failure Notification\n            NOT-\u003e\u003eC: Notify Customer\n            OTA-\u003e\u003ePAY: Request Refund\n            PAY-\u003e\u003eC: Process Refund - No Charge\n        end\n    end\n```\n\nSources: [enunciado.md:18-20](), [pasame las preguntas y sus respuestas a markdown.md:46-53]()\n\n---\n\n## Data Flow and Persistence\n\n### Database Segregation Strategy\n\nThe core technical components implement database segregation by domain:\n\n| Database | Owning Component | Data Stored |\n|----------|-----------------|-------------|\n| Customer Database | Expediente de Compra | Customer profiles, credentials, authentication |\n| Order Database | Corporate Intranet / Order Management | Sales records, vehicle assignments, manufacturing status |\n| Service Database | Service Catalog / OTA Engine | Service definitions, activations, history, expirations |\n| Billing Database | Payment Engine | Payment records, invoices, refunds, subscription billing |\n\n### Cross-Component Data Access Patterns\n\n**Read-Only Access:**\n- Expediente de Compra reads from all databases to aggregate customer view\n- Service Catalog reads customer and vehicle data to filter available services\n- Notification Engine reads across databases to populate notification templates\n\n**Write Access:**\n- Each component has exclusive write access to its primary database\n- Cross-component updates flow through component APIs, not direct database access\n- Ensures data consistency and component isolation\n\nSources: [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"1c:T6279,"])</script><script>self.__next_f.push([1,"# Integration Architecture\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the **integration patterns, API communication models, and architectural approaches** used by the CaaS platform to communicate with external systems. It focuses on the **technical design principles** and **integration strategies** rather than the specific details of each external system.\n\nFor detailed information about specific external systems and their APIs, see [External System Integrations](#5). For the overall system architecture and component relationships, see [High-Level Architecture](#3.1).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104](), [enunciado.md:1-23]()\n\n---\n\n## Integration Patterns Overview\n\nThe CaaS platform employs **five distinct integration patterns** based on the characteristics and requirements of each external system. The pattern selection is driven by control requirements, latency constraints, and data ownership models.\n\n### Integration Pattern Catalog\n\n```mermaid\ngraph TB\n    subgraph \"Pattern 1: Hybrid Request-Event\"\n        CAAS1[\"CaaS Platform\"]\n        FACTORY[\"Factory System\"]\n        \n        CAAS1 --\u003e|\"Synchronous POST\u003cbr/\u003eOrder Placement\"| FACTORY\n        FACTORY -.-\u003e|\"Async Webhooks\u003cbr/\u003eStatus Updates\"| CAAS1\n    end\n    \n    subgraph \"Pattern 2: Bidirectional Command-Status\"\n        CAAS2[\"CaaS Platform\"]\n        IOT_API[\"API IoT\u003cbr/\u003e(Existing System)\"]\n        IOT_NET[\"IoT Network\"]\n        \n        CAAS2 --\u003e|\"OTA Commands\u003cbr/\u003ePush Config\"| IOT_API\n        IOT_API --\u003e|\"Forward\"| IOT_NET\n        IOT_NET --\u003e|\"Status Reports\u003cbr/\u003eTelemetry\"| IOT_API\n        IOT_API --\u003e|\"Status Pull\"| CAAS2\n    end\n    \n    subgraph \"Pattern 3: Query-Only Pull\"\n        CAAS3[\"CaaS Platform\"]\n        VSS[\"VSS System\"]\n        \n        CAAS3 --\u003e|\"GET Maintenance\u003cbr/\u003eStatus Query\"| VSS\n        VSS --\u003e|\"Response\"| CAAS3\n    end\n    \n    subgraph \"Pattern 4: Fire-and-Assume\"\n        CAAS4[\"CaaS Platform\"]\n        PAYMENT_GW[\"Payment Gateway\"]\n        \n        CAAS4 --\u003e|\"Payment Request\"| PAYMENT_GW\n        CAAS4 --\u003e|\"Immediate Service\u003cbr/\u003eDelivery (Risk)\"| CAAS4\n        PAYMENT_GW -.-\u003e|\"Settlement\u003cbr/\u003eConfirmation (Later)\"| CAAS4\n    end\n    \n    subgraph \"Pattern 5: Synchronous Registration\"\n        CAAS5[\"CaaS Platform\"]\n        ADMIN[\"Admin Bodies\"]\n        \n        CAAS5 --\u003e|\"Register Vehicle\u003cbr/\u003eBlocking Call\"| ADMIN\n        ADMIN --\u003e|\"Registration\u003cbr/\u003eConfirmation\"| CAAS5\n    end\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [pasame las preguntas y sus respuestas a markdown.md:78-82]()\n\n### Pattern Selection Rationale\n\n| Pattern | External System | Rationale | Control | Risk |\n|---------|----------------|-----------|---------|------|\n| **Hybrid Request-Event** | Factory | CaaS initiates orders (control), Factory pushes status when ready (decoupling) | High | Low |\n| **Bidirectional Command-Status** | API IoT | Real-time vehicle control required, pre-existing API constraint | Medium | Medium |\n| **Query-Only Pull** | VSS | Workshop data ownership, maintenance checks on-demand only | Low | Low |\n| **Fire-and-Assume** | Payment Gateway | Customer experience over risk, async banking settlement | Medium | High |\n| **Synchronous Registration** | Admin Bodies | Legal requirement, blocking operation acceptable | Low | Low |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [pasame las preguntas y sus respuestas a markdown.md:78-82]()\n\n---\n\n## Synchronous vs Asynchronous Communication\n\n### Communication Model Matrix\n\nThe CaaS platform uses **both synchronous and asynchronous communication** depending on the business requirements and technical constraints of each integration point.\n\n```mermaid\nsequenceDiagram\n    participant CaaS as \"CaaS Platform\"\n    participant Factory as \"Factory API\"\n    participant PaymentGW as \"Payment Gateway\"\n    participant IoT as \"API IoT\"\n    participant VSS as \"VSS System\"\n    \n    Note over CaaS,VSS: Synchronous Operations\n    \n    CaaS-\u003e\u003e+Factory: \"POST /orders\u003cbr/\u003e{vehicleSpec}\"\n    Factory--\u003e\u003e-CaaS: \"201 Created\u003cbr/\u003e{orderId, estimatedDate}\"\n    \n    CaaS-\u003e\u003e+VSS: \"GET /maintenance/{vin}\"\n    VSS--\u003e\u003e-CaaS: \"200 OK\u003cbr/\u003e{status, percentage}\"\n    \n    CaaS-\u003e\u003e+IoT: \"POST /vehicles/{vin}/config\u003cbr/\u003e{serviceActivation}\"\n    IoT--\u003e\u003e-CaaS: \"202 Accepted\u003cbr/\u003e{commandId}\"\n    \n    Note over CaaS,VSS: Asynchronous Operations\n    \n    Factory--)CaaS: \"Webhook: Status Update\u003cbr/\u003e{orderId, status: 'MANUFACTURING'}\"\n    \n    CaaS-\u003e\u003ePaymentGW: \"POST /payments\u003cbr/\u003e{amount, cardToken}\"\n    Note over CaaS: Deliver service immediately\u003cbr/\u003eAssume settlement risk\n    PaymentGW--)CaaS: \"Settlement Confirmation\u003cbr/\u003e(minutes to hours later)\"\n    \n    CaaS-\u003e\u003e+IoT: \"GET /vehicles/{vin}/status\"\n    IoT--\u003e\u003e-CaaS: \"200 OK\u003cbr/\u003e{telemetry, lastContact}\"\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [pasame las preguntas y sus respuestas a markdown.md:78-82]()\n\n### Synchronous Integration Characteristics\n\n**Factory Order Placement:**\n- **Pattern:** Request-Response\n- **Timeout:** 30 seconds\n- **Retry:** No automatic retry (business decision required)\n- **Rationale:** CaaS needs immediate confirmation that order was accepted to inform customer\n\n**VSS Maintenance Queries:**\n- **Pattern:** Request-Response\n- **Timeout:** 5 seconds\n- **Cache:** 1 hour TTL\n- **Rationale:** Maintenance status required before allowing service purchases\n\n**API IoT Commands:**\n- **Pattern:** Command acknowledgment (not completion)\n- **Timeout:** 10 seconds\n- **Response:** Acknowledges command received, not that vehicle processed it\n- **Rationale:** IoT network may take time to deliver to vehicle\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n### Asynchronous Integration Characteristics\n\n**Factory Status Notifications:**\n- **Pattern:** Webhook (push from Factory)\n- **Delivery:** Best-effort with retries\n- **Idempotency:** Required (duplicate status updates possible)\n- **Rationale:** Manufacturing timelines are unpredictable; Factory pushes when state changes\n\n**Payment Settlement:**\n- **Pattern:** Fire-and-assume with eventual confirmation\n- **Business Rule:** Deliver service immediately, charge if activation succeeds\n- **Risk:** CaaS assumes settlement failure risk\n- **Rationale:** Customer experience optimization over financial risk\n\n**Vehicle Status Reports:**\n- **Pattern:** Periodic telemetry (vehicle pushes to IoT network)\n- **Frequency:** Vehicle-dependent\n- **Access:** CaaS polls API IoT for latest status\n- **Rationale:** Real-time vehicle connection not guaranteed\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [pasame las preguntas y sus respuestas a markdown.md:78-82]()\n\n---\n\n## External System Integration Points\n\n### Integration Topology\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform\"\n        CORE[\"Core Business Logic\"]\n        INT_LAYER[\"Integration Layer\"]\n        \n        FACTORY_ADAPTER[\"FactoryOrderAdapter\"]\n        VSS_ADAPTER[\"VSSMaintenanceAdapter\"]\n        IOT_ADAPTER[\"IoTGatewayAdapter\"]\n        PAYMENT_ADAPTER[\"PaymentGatewayAdapter\"]\n        ADMIN_ADAPTER[\"AdminRegistrationAdapter\"]\n        \n        CORE --\u003e INT_LAYER\n        INT_LAYER --\u003e FACTORY_ADAPTER\n        INT_LAYER --\u003e VSS_ADAPTER\n        INT_LAYER --\u003e IOT_ADAPTER\n        INT_LAYER --\u003e PAYMENT_ADAPTER\n        INT_LAYER --\u003e ADMIN_ADAPTER\n    end\n    \n    subgraph \"External Systems\"\n        FACTORY_SYS[\"Factory API\u003cbr/\u003eOrder Management\"]\n        VSS_SYS[\"VSS API\u003cbr/\u003eMaintenance Records\"]\n        IOT_SYS[\"API IoT\u003cbr/\u003eVehicle Communication\u003cbr/\u003e(Pre-existing)\"]\n        PAYMENT_SYS[\"Payment Gateway\u003cbr/\u003eCard Processing\"]\n        ADMIN_SYS[\"Admin API\u003cbr/\u003eVehicle Registration\"]\n    end\n    \n    FACTORY_ADAPTER --\u003e|\"POST /api/v1/orders\u003cbr/\u003eGET /api/v1/orders/{id}\"| FACTORY_SYS\n    FACTORY_SYS -.-\u003e|\"POST /webhooks/factory/status\"| FACTORY_ADAPTER\n    \n    VSS_ADAPTER --\u003e|\"GET /api/v2/vehicles/{vin}/maintenance\"| VSS_SYS\n    \n    IOT_ADAPTER --\u003e|\"POST /api/iot/vehicles/{vin}/configure\u003cbr/\u003eGET /api/iot/vehicles/{vin}/status\"| IOT_SYS\n    \n    PAYMENT_ADAPTER --\u003e|\"POST /api/payments/authorize\u003cbr/\u003ePOST /api/payments/capture\"| PAYMENT_SYS\n    PAYMENT_SYS -.-\u003e|\"POST /webhooks/payment/settlement\"| PAYMENT_ADAPTER\n    \n    ADMIN_ADAPTER --\u003e|\"POST /api/registration/vehicles\"| ADMIN_SYS\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:33-56](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n### Adapter Layer Implementation\n\nEach external system has a **dedicated adapter** that isolates integration complexity and provides a stable interface to the core business logic.\n\n**Adapter Responsibilities:**\n1. **Protocol Translation:** Convert internal domain objects to external API formats\n2. **Error Handling:** Translate external errors to internal exception hierarchy\n3. **Retry Logic:** Implement retry strategies appropriate to each system\n4. **Circuit Breaking:** Protect CaaS from cascading failures\n5. **Monitoring:** Emit metrics and logs for integration health\n6. **Caching:** Cache responses where appropriate (e.g., VSS maintenance status)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n---\n\n## API Design Principles\n\n### Existing vs New APIs\n\nThe CaaS platform interacts with both **pre-existing APIs** (constraints) and **newly developed APIs** (requirements).\n\n```mermaid\ngraph LR\n    subgraph \"Pre-existing APIs (Constraints)\"\n        IOT_EXISTING[\"API IoT\u003cbr/\u003eDocumented, Tested\u003cbr/\u003eCannot Modify\"]\n        VSS_EXISTING[\"VSS API\u003cbr/\u003eWorkshop System\u003cbr/\u003eRead-Only Access\"]\n        PAYMENT_EXISTING[\"Payment Gateway\u003cbr/\u003eThird-party Provider\"]\n    end\n    \n    subgraph \"APIs to Develop (Requirements)\"\n        FACTORY_NEW[\"Factory API\u003cbr/\u003eOrder Management\u003cbr/\u003eStatus Webhooks\"]\n        ADMIN_NEW[\"Admin API\u003cbr/\u003eVehicle Registration\u003cbr/\u003eCountry-specific\"]\n        WEBHOOK_NEW[\"Webhook Endpoints\u003cbr/\u003eCaaS Receives\u003cbr/\u003eFactory/Payment Events\"]\n    end\n    \n    subgraph \"CaaS Integration Strategy\"\n        ADAPT_EXISTING[\"Adapter Pattern\u003cbr/\u003eWork within constraints\"]\n        DESIGN_NEW[\"Design for CaaS needs\u003cbr/\u003eControl specification\"]\n    end\n    \n    IOT_EXISTING --\u003e ADAPT_EXISTING\n    VSS_EXISTING --\u003e ADAPT_EXISTING\n    PAYMENT_EXISTING --\u003e ADAPT_EXISTING\n    \n    FACTORY_NEW --\u003e DESIGN_NEW\n    ADMIN_NEW --\u003e DESIGN_NEW\n    WEBHOOK_NEW --\u003e DESIGN_NEW\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104](), [pasame las preguntas y sus respuestas a markdown.md:33-38]()\n\n### API Documentation Standards\n\n**For Pre-existing APIs (Restrictions):**\n- Reference external documentation URL\n- Document known limitations and constraints\n- Specify integration patterns used (cannot change API)\n- Example: \"API IoT uses existing `/api/iot/vehicles/{vin}/configure` endpoint with JSON payload. Documentation: [internal link]. Constraint: Cannot modify response format.\"\n\n**For APIs to Develop (Requirements):**\n- Specify complete request/response schemas\n- Document authentication/authorization requirements\n- Define error codes and retry strategies\n- Include sequence diagrams for complex flows\n- Example: \"Factory API requires POST `/api/v1/orders` with `vehicleSpec` object. Returns `orderId` and `estimatedCompletionDate`. See [Factory Integration](#5.1) for details.\"\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n---\n\n## Error Handling and Resilience\n\n### Retry Strategies by Integration\n\nDifferent external systems require different **retry strategies** based on their reliability characteristics and business criticality.\n\n```mermaid\ngraph TD\n    subgraph \"OTA Activation Retry Logic\"\n        OTA_REQ[\"OTA Activation Request\"]\n        ATTEMPT[\"Send to API IoT\"]\n        CHECK[\"Check Status\"]\n        \n        OTA_REQ --\u003e ATTEMPT\n        ATTEMPT --\u003e CHECK\n        CHECK --\u003e|\"Success\"| SUCCESS[\"Service Active\u003cbr/\u003eNotify Customer\"]\n        CHECK --\u003e|\"Failed + Retries Left\"| WAIT[\"Wait 30s\"]\n        WAIT --\u003e ATTEMPT\n        CHECK --\u003e|\"Failed + No Retries\"| TECH[\"Tech Support\u003cbr/\u003eDO NOT CHARGE\"]\n    end\n    \n    subgraph \"Factory Order Retry\"\n        FACTORY_REQ[\"Factory Order\"]\n        FACTORY_SEND[\"POST to Factory API\"]\n        \n        FACTORY_REQ --\u003e FACTORY_SEND\n        FACTORY_SEND --\u003e|\"Timeout/Error\"| FACTORY_FAIL[\"Alert Operations\u003cbr/\u003eManual Intervention\"]\n        FACTORY_SEND --\u003e|\"Success\"| FACTORY_OK[\"Order Placed\"]\n    end\n    \n    subgraph \"VSS Query Retry\"\n        VSS_REQ[\"Maintenance Check\"]\n        VSS_QUERY[\"GET from VSS\"]\n        \n        VSS_REQ --\u003e VSS_QUERY\n        VSS_QUERY --\u003e|\"Timeout\"| VSS_RETRY[\"Retry 3x\u003cbr/\u003eExponential Backoff\"]\n        VSS_RETRY --\u003e|\"All Failed\"| VSS_CACHE[\"Use Cached Value\u003cbr/\u003eIf Recent\"]\n        VSS_RETRY --\u003e|\"Success\"| VSS_OK[\"Return Status\"]\n        VSS_QUERY --\u003e|\"Success\"| VSS_OK\n    end\n    \n    subgraph \"Payment Retry\"\n        PAY_REQ[\"Payment Request\"]\n        PAY_SEND[\"POST to Gateway\"]\n        \n        PAY_REQ --\u003e PAY_SEND\n        PAY_SEND --\u003e|\"Network Error\"| PAY_RETRY[\"Retry Once\u003cbr/\u003eSame Idempotency Key\"]\n        PAY_RETRY --\u003e PAY_SEND\n        PAY_SEND --\u003e|\"Declined\"| PAY_FAIL[\"Notify Customer\u003cbr/\u003eNo Retry\"]\n        PAY_SEND --\u003e|\"Success\"| PAY_OK[\"Deliver Service\"]\n    end\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n### Retry Policy Matrix\n\n| Integration | Initial Timeout | Max Retries | Backoff Strategy | Failure Action |\n|-------------|----------------|-------------|------------------|----------------|\n| **OTA Activation** | 60s | Configurable (default: 5) | Fixed 30s intervals | Escalate to tech support, **DO NOT CHARGE** customer |\n| **Factory Order** | 30s | 0 (manual retry) | N/A | Alert operations team, require human decision |\n| **VSS Query** | 5s | 3 | Exponential (5s, 10s, 20s) | Use cached value if \u003c1hr old, else block service purchase |\n| **Payment** | 30s | 1 | Immediate | Return error to customer (card declined, network error) |\n| **Admin Registration** | 60s | 2 | Fixed 10s intervals | Block vehicle delivery, alert operations |\n| **Webhook Receipt** | N/A (incoming) | N/A | N/A | Log failed webhooks, poll API as fallback |\n\n**Critical Business Rule:** For OTA activation failures, the system **MUST NOT charge** the customer for services that could not be activated. This is enforced at the payment processing layer.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n### Circuit Breaker Pattern\n\nThe integration layer implements **circuit breaker pattern** for each external system to prevent cascading failures.\n\n**Circuit States:**\n- **Closed:** Normal operation, requests flow through\n- **Open:** Too many failures, reject requests immediately for 60s\n- **Half-Open:** Allow one test request to check if service recovered\n\n**Thresholds:**\n- **Factory API:** 5 failures in 60s  Open circuit\n- **VSS API:** 10 failures in 60s  Open circuit (fall back to cache)\n- **API IoT:** 5 failures in 60s  Open circuit (queue requests)\n- **Payment Gateway:** No circuit breaker (each transaction critical)\n\n**Sources:** Based on standard integration resilience patterns\n\n---\n\n## Integration Security Model\n\n### Authentication and Authorization\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform Security\"\n        CAAS_CORE[\"CaaS Core\"]\n        CERT_STORE[\"Certificate Store\"]\n        API_KEY_STORE[\"API Key Vault\"]\n        TOKEN_CACHE[\"Token Cache\"]\n        \n        CAAS_CORE --\u003e CERT_STORE\n        CAAS_CORE --\u003e API_KEY_STORE\n        CAAS_CORE --\u003e TOKEN_CACHE\n    end\n    \n    subgraph \"Factory Integration\"\n        CAAS_CORE --\u003e|\"mTLS Certificate\u003cbr/\u003e+ API Key\"| FACTORY_API[\"Factory API\"]\n    end\n    \n    subgraph \"VSS Integration\"\n        CAAS_CORE --\u003e|\"OAuth 2.0 Token\u003cbr/\u003eClient Credentials\"| VSS_API[\"VSS API\"]\n        TOKEN_CACHE --\u003e|\"Cache tokens\u003cbr/\u003eRefresh before expiry\"| VSS_API\n    end\n    \n    subgraph \"API IoT Integration\"\n        CAAS_CORE --\u003e|\"Pre-shared Key\u003cbr/\u003eHMAC Signature\"| IOT_API[\"API IoT\"]\n    end\n    \n    subgraph \"Payment Integration\"\n        CAAS_CORE --\u003e|\"PCI-DSS Compliant\u003cbr/\u003eTokenized Cards\"| PAY_API[\"Payment Gateway\"]\n    end\n    \n    subgraph \"Webhook Security\"\n        FACTORY_API --\u003e|\"HMAC Signature\u003cbr/\u003eVerify Origin\"| WEBHOOK_ENDPOINT[\"Webhook Endpoint\"]\n        PAY_API --\u003e|\"Signature Validation\"| WEBHOOK_ENDPOINT\n        WEBHOOK_ENDPOINT --\u003e CAAS_CORE\n    end\n```\n\n**Sources:** Standard API security practices for automotive and payment systems\n\n### Security Requirements by Integration\n\n| External System | Authentication Method | Authorization Model | Data Classification |\n|----------------|----------------------|---------------------|---------------------|\n| **Factory API** | Mutual TLS + API Key | Service account with order management scope | Internal - Confidential |\n| **VSS API** | OAuth 2.0 Client Credentials | Read-only access to maintenance records | Internal - Restricted |\n| **API IoT** | Pre-shared key + HMAC | Vehicle command permissions | Internal - Highly Confidential |\n| **Payment Gateway** | API Key + PCI DSS compliance | PCI DSS Level 1 merchant | Customer - PCI Protected |\n| **Admin API** | Government-issued certificates | Per-country registration authority | Public - Regulated |\n\n**Sources:** Based on automotive industry and payment security standards\n\n### Webhook Security\n\n**Incoming webhooks** from Factory and Payment Gateway must be validated to prevent spoofing:\n\n1. **Signature Validation:** HMAC-SHA256 signature in header\n2. **Timestamp Check:** Reject messages \u003e5 minutes old\n3. **Idempotency:** Store message IDs to detect duplicates\n4. **IP Allowlisting:** Restrict to known external system IPs\n5. **Rate Limiting:** Max 100 webhooks/minute per source\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44]()\n\n---\n\n## Data Flow Patterns\n\n### Request-Initiated Flows\n\nThese flows are **initiated by CaaS** in response to customer or operational actions.\n\n```mermaid\nsequenceDiagram\n    participant Customer as \"Customer\"\n    participant WebApp as \"Web Platform\"\n    participant CaaS as \"CaaS Core\"\n    participant VSS as \"VSS Adapter\"\n    participant Payment as \"Payment Adapter\"\n    participant IoT as \"IoT Adapter\"\n    \n    Customer-\u003e\u003eWebApp: \"Purchase Service\u003cbr/\u003e(Enhanced Power)\"\n    WebApp-\u003e\u003eCaaS: \"ServicePurchaseRequest\"\n    \n    Note over CaaS,VSS: Validation Phase\n    \n    CaaS-\u003e\u003e+VSS: \"GetMaintenanceStatus(VIN)\"\n    VSS-\u003e\u003e-CaaS: \"Status: CURRENT\u003cbr/\u003ePercentage: 95%\"\n    \n    alt Maintenance OK\n        Note over CaaS,Payment: Payment Phase\n        \n        CaaS-\u003e\u003e+Payment: \"AuthorizePayment(amount, cardToken)\"\n        Payment--\u003e\u003e-CaaS: \"PaymentAuthorized\u003cbr/\u003e(async settlement)\"\n        \n        Note over CaaS: Assume risk\u003cbr/\u003eDeliver immediately\n        \n        Note over CaaS,IoT: Activation Phase\n        \n        CaaS-\u003e\u003e+IoT: \"ConfigureVehicle(VIN, serviceConfig)\"\n        IoT--\u003e\u003e-CaaS: \"CommandAccepted\u003cbr/\u003e(commandId)\"\n        \n        loop Retry up to N times\n            CaaS-\u003e\u003e+IoT: \"GetActivationStatus(commandId)\"\n            IoT--\u003e\u003e-CaaS: \"Status: IN_PROGRESS\"\n        end\n        \n        CaaS-\u003e\u003e+IoT: \"GetActivationStatus(commandId)\"\n        IoT--\u003e\u003e-CaaS: \"Status: COMPLETED\"\n        \n        CaaS-\u003e\u003eWebApp: \"ServiceActivated\"\n        WebApp-\u003e\u003eCustomer: \"Notification: Service Active\"\n        \n    else Maintenance Overdue\n        CaaS-\u003e\u003eWebApp: \"ServiceBlocked\u003cbr/\u003eMaintenanceRequired\"\n        WebApp-\u003e\u003eCustomer: \"Cannot activate\u003cbr/\u003eComplete maintenance\"\n    end\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73](), [enunciado.md:18-20]()\n\n### Event-Driven Flows\n\nThese flows are **initiated by external systems** pushing state changes to CaaS.\n\n```mermaid\nsequenceDiagram\n    participant Factory as \"Factory System\"\n    participant Webhook as \"Webhook Endpoint\"\n    participant CaaS as \"CaaS Core\"\n    participant NotifEngine as \"Notification Engine\"\n    participant Customer as \"Customer\"\n    \n    Note over Factory: Manufacturing progresses\u003cbr/\u003eState change occurs\n    \n    Factory--)Webhook: \"POST /webhooks/factory/status\u003cbr/\u003e{orderId, status: 'READY'}\"\n    \n    Webhook-\u003e\u003eWebhook: \"Validate HMAC\u003cbr/\u003eCheck timestamp\"\n    \n    Webhook-\u003e\u003eCaaS: \"FactoryStatusEvent\"\n    \n    CaaS-\u003e\u003eCaaS: \"Update Order Status\u003cbr/\u003eStore in database\"\n    \n    alt Status: READY\n        CaaS-\u003e\u003eNotifEngine: \"SendNotification\u003cbr/\u003e(VEHICLE_READY)\"\n        NotifEngine-\u003e\u003eCustomer: \"Email: Vehicle ready\"\n        NotifEngine-\u003e\u003eCustomer: \"Push: Complete payment\"\n        \n    else Status: MANUFACTURING\n        CaaS-\u003e\u003eNotifEngine: \"SendNotification\u003cbr/\u003e(STATUS_UPDATE)\"\n        NotifEngine-\u003e\u003eCustomer: \"Email: Production update\"\n        \n    else Status: DELAYED\n        CaaS-\u003e\u003eNotifEngine: \"SendNotification\u003cbr/\u003e(DELAY_ALERT)\"\n        NotifEngine-\u003e\u003eCustomer: \"Email: Delay notification\"\n    end\n    \n    Webhook--\u003e\u003eFactory: \"200 OK\u003cbr/\u003e(acknowledge)\"\n    \n    Note over Webhook,Factory: Factory will retry if\u003cbr/\u003eno 200 response\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29](), [enunciado.md:13-14]()\n\n---\n\n## Integration Monitoring and Observability\n\n### Key Metrics\n\nEach integration adapter emits **standardized metrics** for monitoring health:\n\n| Metric | Description | Alert Threshold |\n|--------|-------------|----------------|\n| `integration.request.count` | Total requests sent | N/A (baseline) |\n| `integration.request.duration` | Request latency (p50, p95, p99) | p95 \u003e 2x baseline |\n| `integration.request.errors` | Failed requests (4xx, 5xx, timeout) | Error rate \u003e 5% |\n| `integration.retry.count` | Number of retry attempts | Spike \u003e 50% increase |\n| `integration.circuit.state` | Circuit breaker state (0=closed, 1=open) | Any open circuit |\n| `integration.queue.depth` | Queued requests (for IoT commands) | Depth \u003e 1000 |\n\n### Distributed Tracing\n\nAll integration calls include **trace context propagation** to enable end-to-end request tracing:\n\n1. Generate `trace-id` when customer initiates action\n2. Propagate `trace-id` in headers: `X-Trace-Id`, `X-Span-Id`\n3. Log trace context with all integration calls\n4. Enable correlation across CaaS  Factory  IoT  Vehicle\n\n**Sources:** Based on observability best practices\n\n---\n\n## Integration Testing Strategy\n\n### Testing Approach by Integration Type\n\n```mermaid\ngraph TB\n    subgraph \"Pre-existing APIs\"\n        IOT_TEST[\"API IoT Testing\"]\n        VSS_TEST[\"VSS Testing\"]\n        PAY_TEST[\"Payment Gateway Testing\"]\n        \n        IOT_TEST --\u003e IOT_SANDBOX[\"Use test/sandbox environment\u003cbr/\u003eCannot modify API\"]\n        VSS_TEST --\u003e VSS_READ[\"Read-only queries\u003cbr/\u003eUse test VINs\"]\n        PAY_TEST --\u003e PAY_TESTCARDS[\"Test card numbers\u003cbr/\u003eSandbox mode\"]\n    end\n    \n    subgraph \"APIs to Develop\"\n        FACTORY_TEST[\"Factory API Testing\"]\n        ADMIN_TEST[\"Admin API Testing\"]\n        WEBHOOK_TEST[\"Webhook Testing\"]\n        \n        FACTORY_TEST --\u003e FACTORY_MOCK[\"Mock server\u003cbr/\u003eContract testing\"]\n        ADMIN_TEST --\u003e ADMIN_STUB[\"Stub per country\u003cbr/\u003eRegression suite\"]\n        WEBHOOK_TEST --\u003e WEBHOOK_SIM[\"Simulate events\u003cbr/\u003eTest error cases\"]\n    end\n    \n    subgraph \"Integration Test Types\"\n        UNIT[\"Unit Tests\u003cbr/\u003eAdapter logic\"]\n        CONTRACT[\"Contract Tests\u003cbr/\u003eAPI schemas\"]\n        E2E[\"E2E Tests\u003cbr/\u003eFull flows\"]\n        CHAOS[\"Chaos Tests\u003cbr/\u003eFailure scenarios\"]\n    end\n    \n    IOT_SANDBOX --\u003e E2E\n    FACTORY_MOCK --\u003e CONTRACT\n    WEBHOOK_SIM --\u003e CHAOS\n```\n\n**Test Coverage Requirements:**\n- **Unit Tests:** 80%+ coverage of adapter logic\n- **Contract Tests:** All API request/response schemas validated\n- **E2E Tests:** Critical paths (order  manufacture  delivery, service purchase  OTA activation)\n- **Chaos Tests:** Network failures, timeouts, circuit breaker triggers\n\n**Sources:** Based on integration testing best practices\n\n---\n\n## Summary\n\nThe CaaS integration architecture employs **five distinct patterns** tailored to each external system:\n\n1. **Hybrid Request-Event** (Factory): Synchronous control, asynchronous updates\n2. **Bidirectional Command-Status** (API IoT): Real-time vehicle communication with constraints\n3. **Query-Only Pull** (VSS): On-demand maintenance checks\n4. **Fire-and-Assume** (Payment): Immediate delivery with risk assumption\n5. **Synchronous Registration** (Admin): Blocking legal compliance\n\nKey architectural principles:\n- **Adapter pattern** isolates integration complexity\n- **Retry strategies** tailored to each system's characteristics\n- **Circuit breakers** prevent cascading failures\n- **Customer-first error handling** (do not charge for failed activations)\n- **Webhook validation** ensures secure event reception\n- **Distributed tracing** enables end-to-end observability\n\nFor details on specific integrations, see [External System Integrations](#5).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104](), [enunciado.md:1-23]()"])</script><script>self.__next_f.push([1,"1d:T708d,"])</script><script>self.__next_f.push([1,"# Customer Journey\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the complete customer experience in the Car as a Service (CaaS) system, from initial vehicle purchase through ongoing service usage. It provides an end-to-end view of customer interactions with the platform, covering all major touchpoints, decision points, and system responses throughout the customer lifecycle.\n\nThis page focuses on the **customer perspective** and **experience flow**. For detailed technical information about specific phases, see:\n- [Vehicle Purchase and Delivery Process](#4.1) - technical details of manufacturing, payment, and delivery\n- [Service Acquisition and Management](#4.2) - detailed service purchasing and activation flows  \n- [Customer-Facing Platforms](#4.3) - web and mobile platform features\n\nFor business model context, see [Business Model and Concept](#2). For technical architecture, see [System Architecture](#3).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Customer Journey Phases\n\nThe CaaS customer journey consists of five primary phases, each with distinct interactions and system touchpoints:\n\n| Phase | Duration | Primary Channel | Key Milestone |\n|-------|----------|----------------|---------------|\n| **Sales and Registration** | 1 day | In-person (Dealership) + Intranet | Customer data captured, credentials issued |\n| **Manufacturing and Tracking** | Weeks to months | Email + Web/Mobile notifications | Customer stays informed of vehicle status |\n| **Payment and Registration** | 1-3 days | Web/Mobile platform + Administrative systems | Vehicle legally registered to customer |\n| **Delivery and Activation** | 1 day | Physical delivery + Mobile app | Vehicle operational, app linked |\n| **Operational Use** | Vehicle lifetime | Web + Mobile platforms | Ongoing service acquisition and management |\n\n**Sources:** [enunciado.md:8-23](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n---\n\n## Complete Customer Journey Flow\n\nThe following diagram illustrates the end-to-end customer journey with all major decision points and system interactions:\n\n```mermaid\nflowchart TD\n    Start([Customer Visits Dealership])\n    \n    Start --\u003e Sales[\"Sales Consultation\u003cbr/\u003eEmployee demonstrates platform base\u003cbr/\u003eand opciones disponibles\"]\n    \n    Sales --\u003e Configure[\"Select Configuration\u003cbr/\u003eBase model + optional\u003cbr/\u003eplan comercial\"]\n    \n    Configure --\u003e Register[\"Dealership Registration\u003cbr/\u003eEmployee enters data in\u003cbr/\u003ecorporate intranet\"]\n    \n    Register --\u003e Credentials[\"Credential Generation\u003cbr/\u003eSystem sends email with\u003cbr/\u003eweb/mobile access credentials\"]\n    \n    Credentials --\u003e Reserve{\"Customer Pays\u003cbr/\u003eReservation Signal?\"}\n    \n    Reserve --\u003e|\"No\"| Abandon([Sale Abandoned])\n    \n    Reserve --\u003e|\"Yes\"| FactoryOrder[\"Automatic Factory Order\u003cbr/\u003eAPI call to factory\u003cbr/\u003emanufacturing system\"]\n    \n    FactoryOrder --\u003e Manufacturing[\"Manufacturing Phase\u003cbr/\u003eCustomer receives\u003cbr/\u003estatus notifications\"]\n    \n    Manufacturing --\u003e Ready[\"Vehicle Ready\u003cbr/\u003eNotification sent\u003cbr/\u003eto customer\"]\n    \n    Ready --\u003e FinalPayment{\"Customer Pays\u003cbr/\u003eFinal Amount?\"}\n    \n    FinalPayment --\u003e|\"No\"| LoseReservation[\"Vehicle Becomes Stock\u003cbr/\u003eMarked 'sin asignar'\u003cbr/\u003eCustomer loses reservation\"]\n    \n    LoseReservation --\u003e Abandon\n    \n    FinalPayment --\u003e|\"Yes\"| AdminReg[\"Administrative Registration\u003cbr/\u003eVehicle registered with\u003cbr/\u003egovernment bodies\"]\n    \n    AdminReg --\u003e Transport[\"Transport to Address\u003cbr/\u003eSubcontractor delivers\u003cbr/\u003eto customer home\"]\n    \n    Transport --\u003e DeliveryAttempt{\"Customer Present\u003cbr/\u003eat Delivery?\"}\n    \n    DeliveryAttempt --\u003e|\"No\"| ReturnDealer[\"Return to Dealership\u003cbr/\u003eCustomer must pick up\u003cbr/\u003evehicle in person\"]\n    \n    ReturnDealer --\u003e Pickup[\"Customer Pickup\u003cbr/\u003eAt dealership\"]\n    \n    DeliveryAttempt --\u003e|\"Yes\"| LinkApp[\"Link Mobile App\u003cbr/\u003eApp connects to vehicle\u003cbr/\u003evia direct link\"]\n    \n    Pickup --\u003e LinkApp\n    \n    LinkApp --\u003e Operational[\"Vehicle Operational\u003cbr/\u003ePlatform base active\u003cbr/\u003eOptional services from plan\u003cbr/\u003ecomercial active\"]\n    \n    Operational --\u003e UseVehicle[\"Customer Uses Vehicle\u003cbr/\u003eAccess to expediente de compra\u003cbr/\u003eManuals, history, invoices\"]\n    \n    UseVehicle --\u003e ServiceDecision{\"Want Additional\u003cbr/\u003eService?\"}\n    \n    ServiceDecision --\u003e|\"No\"| ContinueUse[\"Continue Using Vehicle\"]\n    \n    ServiceDecision --\u003e|\"Yes\"| AccessPlatform[\"Access Web/Mobile Platform\u003cbr/\u003eBrowse opciones disponibles\u003cbr/\u003ein service catalog\"]\n    \n    AccessPlatform --\u003e CheckMaint[\"System Checks Maintenance\u003cbr/\u003eQuery VSS system for\u003cbr/\u003eestado oficial\"]\n    \n    CheckMaint --\u003e MaintOK{\"Maintenance\u003cbr/\u003eStatus OK?\"}\n    \n    MaintOK --\u003e|\"No - Overdue\"| ServiceBlocked[\"Service Blocked\u003cbr/\u003eCustomer must complete\u003cbr/\u003emaintenance first\"]\n    \n    ServiceBlocked --\u003e UseVehicle\n    \n    MaintOK --\u003e|\"Yes - Current\"| SelectService[\"Select Service\u003cbr/\u003eChoose duration:\u003cbr/\u003eTemporary, Permanent,\u003cbr/\u003eor Subscription\"]\n    \n    SelectService --\u003e PayService[\"Pay for Service\u003cbr/\u003ePayment via gateway\u003cbr/\u003eRisk assumed by CaaS\"]\n    \n    PayService --\u003e OTAActivation[\"OTA Activation Process\u003cbr/\u003eConfiguration sent via\u003cbr/\u003eAPI IoT\"]\n    \n    OTAActivation --\u003e OTAResult{\"Activation\u003cbr/\u003eSuccessful?\"}\n    \n    OTAResult --\u003e|\"Yes\"| NotifySuccess[\"Notification Sent\u003cbr/\u003eMobile app + vehicle display\u003cbr/\u003eEmail confirmation\"]\n    \n    OTAResult --\u003e|\"No\"| RetryLogic{\"Retries\u003cbr/\u003eRemaining?\"}\n    \n    RetryLogic --\u003e|\"Yes\"| OTAActivation\n    \n    RetryLogic --\u003e|\"No\"| TechSupport[\"Escalate to Tech Support\u003cbr/\u003eDO NOT CHARGE customer\u003cbr/\u003eManual investigation\"]\n    \n    NotifySuccess --\u003e ServiceActive[\"Service Active\u003cbr/\u003eFeature available in vehicle\u003cbr/\u003eLogged in expediente\"]\n    \n    ServiceActive --\u003e UseVehicle\n    TechSupport --\u003e UseVehicle\n    \n    ContinueUse --\u003e CancelDecision{\"Cancel\u003cbr/\u003eService?\"}\n    \n    CancelDecision --\u003e|\"No\"| ContinueUse\n    \n    CancelDecision --\u003e|\"Yes\"| CheckCancelRights[\"Check Desistimiento Rights\u003cbr/\u003eService duration and\u003cbr/\u003etime since purchase\"]\n    \n    CheckCancelRights --\u003e RefundEligible{\"Refund\u003cbr/\u003eEligible?\"}\n    \n    RefundEligible --\u003e|\"Yes - Within Window\"| ProcessRefund[\"Process Refund\u003cbr/\u003eService deactivated\u003cbr/\u003ePayment returned\"]\n    \n    RefundEligible --\u003e|\"No - Past Window\"| NoRefund[\"Service Remains\u003cbr/\u003eNo refund available\u003cbr/\u003eCustomer informed\"]\n    \n    ProcessRefund --\u003e UseVehicle\n    NoRefund --\u003e UseVehicle\n    \n    UseVehicle --\u003e MaintenanceDue{\"Maintenance\u003cbr/\u003eDue?\"}\n    \n    MaintenanceDue --\u003e|\"Yes\"| Workshop[\"Visit Workshop\u003cbr/\u003eOfficial or approved\u003cbr/\u003etaller multimarca\"]\n    \n    MaintenanceDue --\u003e|\"No\"| UseVehicle\n    \n    Workshop --\u003e VSSRecord[\"Maintenance Recorded\u003cbr/\u003eLogged in VSS system\u003cbr/\u003eEstado oficial updated\"]\n    \n    VSSRecord --\u003e UseVehicle\n    \n    UseVehicle --\u003e EndLife([End of Vehicle Life])\n```\n\n**Sources:** [enunciado.md:8-23](), [pasame las preguntas y suas respuestas a markdown.md:18-97]()\n\n---\n\n## Customer Touchpoints by Phase\n\n### Phase 1: Sales and Registration\n\n**Customer Experience:**\n- Physical interaction with dealership employee\n- System is transparent to customer at this stage\n- Customer selects base platform and optional plan comercial\n- Receives email with access credentials to web and mobile platforms\n\n**System Actions:**\n- Employee captures customer data in corporate intranet\n- Customer profile created with authentication credentials\n- Credentials sent via email notification system\n- Customer expediente de compra initialized\n\n**Customer State:** Registered but no vehicle yet\n\n| Touchpoint | Channel | System Component | Customer Action |\n|------------|---------|------------------|-----------------|\n| Sales consultation | In-person | Dealership staff | Select configuration |\n| Data entry | Intranet | Corporate registration system | Provide personal data |\n| Credential delivery | Email | Notification engine | Receive and store credentials |\n| Platform access | Web/Mobile | Authentication system | First login to expediente |\n\n**Sources:** [enunciado.md:8-12](), [pasame las preguntas y respuestas a markdown.md:10-16]()\n\n---\n\n### Phase 2: Manufacturing and Tracking\n\n**Customer Experience:**\n- Pays reservation deposit (seal)\n- Receives automatic notifications throughout manufacturing\n- Can access expediente to view current status\n- Passive phase - customer waits but stays informed\n\n**System Actions:**\n- Automatic factory order via synchronous API on reservation payment\n- Factory sends asynchronous status updates via webhooks\n- Notification engine distributes updates to customer (email, mobile push)\n- Manufacturing state tracked and displayed in expediente\n\n**Customer State:** Reserved vehicle, waiting for completion\n\n```mermaid\nsequenceDiagram\n    participant C as Customer\n    participant W as Web/Mobile Platform\n    participant N as Notification Engine\n    participant CaaS as CaaS Core\n    participant F as Factory API\n    participant Factory as Manufacturing Facility\n\n    C-\u003e\u003eW: Pay reservation signal\n    W-\u003e\u003eCaaS: Process payment\n    CaaS-\u003e\u003eF: POST /orders (synchronous)\n    F-\u003e\u003eFactory: Create manufacturing order\n    F--\u003e\u003eCaaS: Order confirmed with ID\n    CaaS-\u003e\u003eN: Trigger confirmation notification\n    N-\u003e\u003eC: Email: Order placed\n    \n    Note over Factory: Manufacturing in progress\n    \n    Factory-\u003e\u003eF: Update status: In production\n    F-\u003e\u003eCaaS: Webhook: Status update\n    CaaS-\u003e\u003eN: Trigger status notification\n    N-\u003e\u003eC: Email/Push: Vehicle in production\n    \n    Factory-\u003e\u003eF: Update status: Quality control\n    F-\u003e\u003eCaaS: Webhook: Status update\n    CaaS-\u003e\u003eN: Trigger status notification\n    N-\u003e\u003eC: Email/Push: Quality control phase\n    \n    Factory-\u003e\u003eF: Update status: Ready for shipment\n    F-\u003e\u003eCaaS: Webhook: Status update\n    CaaS-\u003e\u003eN: Trigger status notification\n    N-\u003e\u003eC: Email/Push: Vehicle ready\n    \n    C-\u003e\u003eW: Check expediente\n    W-\u003e\u003eCaaS: Get order status\n    CaaS--\u003e\u003eW: Display manufacturing timeline\n    W--\u003e\u003eC: Show detailed status\n```\n\n**Sources:** [enunciado.md:13-14](), [pasame las preguntas y respuestas a markdown.md:18-29](), [pasame las preguntas y respuestas a markdown.md:40-44]()\n\n---\n\n### Phase 3: Payment and Registration\n\n**Customer Experience:**\n- Receives notification that vehicle is ready\n- Must complete final payment before delivery\n- If payment fails, loses reservation (critical decision point)\n- Passive waiting during administrative registration\n\n**System Actions:**\n- Final payment processed through payment gateway\n- Payment failure triggers vehicle state change to \"sin asignar\" (unassigned)\n- Successful payment triggers administrative registration process\n- Integration with government bodies for vehicle matriculation\n\n**Customer State:** Transition from reserved to owner (legal transfer)\n\n**Critical Business Rules:**\n- Payment failure = immediate loss of reservation\n- Vehicle becomes available stock at dealership\n- No second chances for final payment\n- Administrative registration only proceeds after confirmed payment\n\n| Scenario | Customer Action | System Response | Outcome |\n|----------|----------------|-----------------|---------|\n| Payment successful | Complete final payment | Register vehicle with administrative bodies | Proceed to delivery |\n| Payment failed | Payment rejected by bank | Vehicle marked \"sin asignar\" | Customer loses reservation, vehicle becomes stock |\n| Payment pending | Waiting for settlement | CaaS assumes risk, proceeds with registration | Normal flow continues |\n\n**Sources:** [enunciado.md:14-16](), [pasame las preguntas y respuestas a markdown.md:26-27](), [pasame las preguntas y respuestas a markdown.md:77-82]()\n\n---\n\n### Phase 4: Delivery and Activation\n\n**Customer Experience:**\n- Vehicle transported to customer address\n- Must be present to receive delivery\n- If absent, must pick up from dealership\n- Mobile app directly linked to specific vehicle\n- Vehicle becomes operational upon successful delivery\n\n**System Actions:**\n- Transport company subcontracted for delivery\n- Delivery status tracked in system\n- Mobile app performs direct link to vehicle (not through CaaS core)\n- Platform base automatically activated\n- Optional services from plan comercial activated\n- Expediente updated with vehicle details and manuals\n\n**Customer State:** Owner with operational vehicle\n\n```mermaid\nflowchart LR\n    Factory[\"Manufacturing\u003cbr/\u003eComplete\"] --\u003e Transport[\"Transport\u003cbr/\u003eCompany\"]\n    \n    Transport --\u003e HomeDelivery{\"Delivery to\u003cbr/\u003eHome Address\"}\n    \n    HomeDelivery --\u003e|\"Customer Present\"| SuccessDelivery[\"Successful\u003cbr/\u003eDelivery\"]\n    \n    HomeDelivery --\u003e|\"Customer Absent\"| ContactCustomer[\"Transport Company\u003cbr/\u003eCalls Customer\"]\n    \n    ContactCustomer --\u003e CustomerResponse{\"Customer\u003cbr/\u003eAvailable?\"}\n    \n    CustomerResponse --\u003e|\"No\"| ReturnDealer[\"Return Vehicle\u003cbr/\u003eto Dealership\"]\n    \n    ReturnDealer --\u003e CustomerPickup[\"Customer Picks Up\u003cbr/\u003eat Dealership\"]\n    \n    CustomerResponse --\u003e|\"Yes - Reschedule\"| HomeDelivery\n    \n    SuccessDelivery --\u003e LinkApp[\"Link Mobile App\u003cbr/\u003eDirect connection\u003cbr/\u003eto vehicle\"]\n    \n    CustomerPickup --\u003e LinkApp\n    \n    LinkApp --\u003e ActivateBase[\"Platform Base\u003cbr/\u003eActive\"]\n    \n    ActivateBase --\u003e ActivatePlan[\"Plan Comercial\u003cbr/\u003eServices Active\"]\n    \n    ActivatePlan --\u003e Operational[\"Vehicle\u003cbr/\u003eOperational\"]\n```\n\n**Delivery Fallback Logic:**\n- Vehicle NEVER left unattended (security risk)\n- Customer contacted immediately if not present\n- Return to dealership as safe fallback\n- Customer must pick up in person (no re-delivery attempts)\n\n**Sources:** [enunciado.md:17](), [pasame las preguntas y respuestas a markdown.md:24-25]()\n\n---\n\n### Phase 5: Operational Use and Service Lifecycle\n\n**Customer Experience:**\n- Ongoing vehicle usage with active platform base\n- Can access expediente anytime (web or mobile)\n- Browse and purchase additional opciones disponibles\n- Receive services via OTA (no workshop visit needed)\n- Manage subscriptions and cancellations\n- Track maintenance requirements\n\n**System Actions:**\n- Continuous availability of web and mobile platforms\n- Service catalog browsing and purchasing\n- Maintenance status validation via VSS integration\n- OTA service activation via API IoT\n- Retry logic for failed activations\n- Billing and refund processing\n- Subscription management (mes vencido model)\n\n**Customer State:** Active user with evolving service portfolio\n\n#### Service Acquisition Subflow\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e BrowsingCatalog: Access platform\n    \n    BrowsingCatalog --\u003e ServiceSelected: Choose opcin disponible\n    \n    ServiceSelected --\u003e MaintenanceCheck: System validates\n    \n    state MaintenanceCheck {\n        [*] --\u003e QueryVSS\n        QueryVSS --\u003e CheckStatus\n        CheckStatus --\u003e MaintenanceOK: Estado oficial current\n        CheckStatus --\u003e MaintenanceOverdue: Maintenance required\n    }\n    \n    MaintenanceCheck --\u003e ServiceAvailable: Maintenance OK\n    MaintenanceCheck --\u003e ServiceBlocked: Maintenance overdue\n    \n    ServiceBlocked --\u003e BrowsingCatalog: Customer informed,\u003cbr/\u003emust visit workshop\n    \n    ServiceAvailable --\u003e DurationSelection: Customer chooses\n    \n    state DurationSelection {\n        [*] --\u003e Temporary\n        [*] --\u003e Permanent\n        [*] --\u003e Subscription\n    }\n    \n    DurationSelection --\u003e Payment: Customer pays\n    \n    Payment --\u003e OTAQueue: Payment accepted\u003cbr/\u003e(CaaS assumes risk)\n    \n    state OTAQueue {\n        [*] --\u003e Attempt1\n        Attempt1 --\u003e Success: Activated\n        Attempt1 --\u003e Attempt2: Failed\n        Attempt2 --\u003e Success: Activated\n        Attempt2 --\u003e AttemptN: Failed\n        AttemptN --\u003e Success: Activated\n        AttemptN --\u003e TechnicalSupport: All retries failed\n    }\n    \n    OTAQueue --\u003e ServiceActive: Activation successful\n    OTAQueue --\u003e EscalatedToSupport: Activation failed\n    \n    EscalatedToSupport --\u003e CustomerNotified: DO NOT CHARGE\u003cbr/\u003eService not delivered\n    \n    ServiceActive --\u003e InUse: Service operational\n    \n    CustomerNotified --\u003e BrowsingCatalog: May try again later\n    \n    state InUse {\n        [*] --\u003e Using\n        Using --\u003e CancellationRequested: Customer wants refund\n        \n        CancellationRequested --\u003e CheckDesistimiento\n        \n        state CheckDesistimiento {\n            [*] --\u003e EvaluateDuration\n            EvaluateDuration --\u003e LongService: Service \u003e 14 days\n            EvaluateDuration --\u003e ShortService: Service \u003c 14 days\n            \n            LongService --\u003e CheckTimeWindow\n            state CheckTimeWindow {\n                [*] --\u003e Within14Days: \u003c 14 days since purchase\n                [*] --\u003e After14Days: \u003e= 14 days since purchase\n            }\n            \n            Within14Days --\u003e RefundGranted\n            After14Days --\u003e RefundDenied\n            ShortService --\u003e RefundGranted: Can cancel anytime\n        }\n        \n        CheckDesistimiento --\u003e RefundProcessed: Refund granted\n        CheckDesistimiento --\u003e RefundRejected: Refund denied\n        \n        RefundProcessed --\u003e Using: Service deactivated,\u003cbr/\u003epayment returned\n        RefundRejected --\u003e Using: Service remains active\n    }\n    \n    InUse --\u003e [*]: Service expires or\u003cbr/\u003ecustomer cancels\n```\n\n**Key Customer Protections:**\n- **No charge for failed OTA activations** - customer only pays for delivered services\n- **Maintenance-gated access** - prevents unsafe service usage\n- **Desistimiento (withdrawal) rights** - legal compliance with distance selling laws\n- **Transparent notifications** - customer informed at every step\n\n**Sources:** [enunciado.md:18-23](), [pasame las preguntas y respuestas a markdown.md:46-96]()\n\n---\n\n## Customer Information Access: Expediente de Compra\n\nThroughout the entire journey, customers have continuous access to their **expediente de compra** (purchase file) via web and mobile platforms. This serves as the single source of truth for customer-facing information.\n\n**Expediente Contents:**\n\n| Information Category | Details Available | Update Frequency |\n|---------------------|-------------------|------------------|\n| Vehicle Information | Model, platform base, VIN, registration | Static after delivery |\n| Manufacturing Status | Current phase, estimated completion | Real-time during manufacturing |\n| Service Catalog | Available opciones, pricing, restrictions | Dynamic based on vehicle and maintenance |\n| Active Services | Currently enabled services, expiration dates | Real-time |\n| Service History | Past activations, deactivations, refunds | Historical log |\n| Maintenance Records | Service dates, workshop, maintenance plan status | Updated by workshops via VSS |\n| Payment History | Invoices, receipts, pending charges | Real-time |\n| Vehicle Manuals | User guides, technical documentation | Static |\n| Subscription Management | Active subscriptions, renewal dates, cancellation | Real-time |\n\n**Access Channels:**\n- **Web platform**: Full-featured interface for all expediente functions\n- **Mobile application**: Optimized interface with additional vehicle control features\n- **Mobile app has direct link to vehicle**: Some operational controls bypass CaaS core\n\n**Sources:** [enunciado.md:11-12](), [pasame las preguntas y respuestas a markdown.md:10-16]()\n\n---\n\n## Alternative Journey Paths\n\n### Journey Variant: Subscription Services\n\nFor customers using subscription-based services (plan comercial or additional recurring services):\n\n```mermaid\nflowchart TD\n    Subscribe[\"Customer Subscribes\u003cbr/\u003eto Recurring Service\"]\n    \n    Subscribe --\u003e MonthStart[\"Month Begins\u003cbr/\u003eService active\"]\n    \n    MonthStart --\u003e CustomerUses[\"Customer Uses Service\u003cbr/\u003eThroughout month\"]\n    \n    CustomerUses --\u003e MonthEnd[\"Month Ends\"]\n    \n    MonthEnd --\u003e MesVencido[\"Billing: Mes Vencido\u003cbr/\u003eCharge for previous month\"]\n    \n    MesVencido --\u003e PaymentAttempt{\"Payment\u003cbr/\u003eSuccessful?\"}\n    \n    PaymentAttempt --\u003e|\"Yes\"| NextMonth[\"Next Month Begins\u003cbr/\u003eService continues\"]\n    \n    PaymentAttempt --\u003e|\"No\"| PaymentRetry[\"Retry Payment\u003cbr/\u003eCustomer notified\"]\n    \n    PaymentRetry --\u003e RetrySuccess{\"Retry\u003cbr/\u003eSuccessful?\"}\n    \n    RetrySuccess --\u003e|\"Yes\"| NextMonth\n    \n    RetrySuccess --\u003e|\"No\"| CancelSubscription[\"Cancel Subscription\u003cbr/\u003eService deactivated\"]\n    \n    NextMonth --\u003e CustomerDecision{\"Customer\u003cbr/\u003eContinues?\"}\n    \n    CustomerDecision --\u003e|\"Yes\"| MonthStart\n    \n    CustomerDecision --\u003e|\"No\"| CustomerCancels[\"Customer Cancels\u003cbr/\u003eSubscription\"]\n    \n    CustomerCancels --\u003e FinalBilling[\"Final Billing\u003cbr/\u003eFor completed month\"]\n    \n    CancelSubscription --\u003e End([Subscription Ended])\n    FinalBilling --\u003e End\n```\n\n**Subscription-Specific Rules:**\n- **Mes vencido (post-paid)**: Charge AFTER service consumed, not before\n- **Payment failure**: Multiple retries before cancellation\n- **Customer cancellation**: Effective at end of current billing period\n- **No pro-rata refunds**: Customer pays for full month if service used\n\n**Sources:** [pasame las preguntas y respuestas a markdown.md:82-96]()\n\n---\n\n### Journey Variant: Maintenance-Required Services\n\nSome services require current maintenance status. Customer journey includes additional validation:\n\n```mermaid\nsequenceDiagram\n    participant C as Customer\n    participant W as Web/Mobile\n    participant CaaS as CaaS Core\n    participant VSS as VSS System\n    participant Workshop as Workshop\n\n    C-\u003e\u003eW: Request premium service\n    W-\u003e\u003eCaaS: Validate service eligibility\n    CaaS-\u003e\u003eVSS: Query maintenance status\n    VSS--\u003e\u003eCaaS: Estado oficial: Overdue\n    CaaS--\u003e\u003eW: Service blocked: Maintenance required\n    W--\u003e\u003eC: Display: Must complete maintenance\n    \n    Note over C,Workshop: Customer visits workshop\n    \n    C-\u003e\u003eWorkshop: Complete maintenance\n    Workshop-\u003e\u003eVSS: Record service completion\n    VSS-\u003e\u003eVSS: Update estado oficial\n    \n    C-\u003e\u003eW: Request premium service again\n    W-\u003e\u003eCaaS: Validate service eligibility\n    CaaS-\u003e\u003eVSS: Query maintenance status\n    VSS--\u003e\u003eCaaS: Estado oficial: Current\n    CaaS--\u003e\u003eW: Service available\n    W--\u003e\u003eC: Allow purchase\n    \n    C-\u003e\u003eW: Complete purchase\n    Note over CaaS: OTA activation proceeds\n```\n\n**Maintenance-Gating Rules:**\n- **Selective blocking**: Only maintenance-dependent services blocked, not all services\n- **Safety rationale**: Prevents unsafe usage (e.g., high-performance modes without proper maintenance)\n- **No retroactive deactivation**: Services already active remain active even if maintenance lapses\n- **Warranty impact**: Missing maintenance voids warranty but doesn't block vehicle operation\n\n**Sources:** [pasame las preguntas y respuestas a markdown.md:58-73]()\n\n---\n\n### Journey Variant: Vehicle Theft\n\nSpecial scenario when vehicle is stolen:\n\n**Customer Actions Available:**\n- Cancel pending scheduled services (not yet delivered)\n- Cancel active subscriptions (prevent future charges)\n- Cannot refund services already delivered (unless within desistimiento period)\n\n**System Behavior:**\n- No automatic refunds triggered by theft\n- Desistimiento rules still apply normally\n- Future scheduled activations can be cancelled without penalty\n- Subscription billing stops upon customer cancellation\n\n**Business Logic:**\n- Theft is insurance matter, not CaaS service matter\n- Services already delivered and consumed are not refundable due to theft alone\n- Customer retains normal cancellation rights for future services\n\n**Sources:** [pasame las preguntas y respuestas a markdown.md:91-96]()\n\n---\n\n## Customer Journey Success Metrics\n\nThe customer journey is designed to optimize for:\n\n| Metric | Target | Measurement Point |\n|--------|--------|------------------|\n| **Credential delivery time** | \u003c 5 minutes after registration | Phase 1: Sales |\n| **Manufacturing visibility** | 100% of status updates delivered | Phase 2: Manufacturing |\n| **Delivery success rate** | \u003e 90% on first attempt | Phase 4: Delivery |\n| **OTA activation success** | \u003e 99% within retry window | Phase 5: Service activation |\n| **Payment settlement transparency** | Real-time status in expediente | All payment touchpoints |\n| **Customer notification delivery** | Multi-channel redundancy (email + push + SMS) | All phases |\n\n**Customer-Favorable Policies:**\n- Assume payment risk for better experience (no waiting for settlement)\n- Never charge for undelivered services (OTA failures)\n- Liberal refund policy (desistimiento compliance)\n- Proactive notifications (keep customer informed)\n\n**Sources:** [pasame las preguntas y respuestas a markdown.md:28-29](), [pasame las preguntas y respuestas a markdown.md:48-53](), [pasame las preguntas y respuestas a markdown.md:77-82]()\n\n---\n\n## Related Customer-Facing Systems\n\nThe customer journey relies on integration with multiple systems:\n\n```mermaid\ngraph TB\n    subgraph \"Customer Touchpoints\"\n        WebPlatform[\"Web Platform\u003cbr/\u003eBrowser-based access\"]\n        MobileApp[\"Mobile Application\u003cbr/\u003eiOS/Android\"]\n        Email[\"Email Notifications\"]\n        Vehicle[\"Vehicle Display\u003cbr/\u003eIn-car information\"]\n    end\n    \n    subgraph \"CaaS Core Services\"\n        Expediente[\"Expediente System\u003cbr/\u003ePurchase file management\"]\n        ServiceCatalog[\"Service Catalog\u003cbr/\u003eOpciones disponibles\"]\n        OrderMgmt[\"Order Management\u003cbr/\u003eSales and fulfillment\"]\n        PaymentProc[\"Payment Processing\u003cbr/\u003eGateway integration\"]\n        NotificationEngine[\"Notification Engine\u003cbr/\u003eMulti-channel delivery\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        FactoryAPI[\"Factory API\u003cbr/\u003eOrder and status\"]\n        VSSAPI[\"VSS API\u003cbr/\u003eMaintenance queries\"]\n        IoTAPI[\"API IoT\u003cbr/\u003eOTA commands\"]\n        PaymentGW[\"Payment Gateway\u003cbr/\u003eCard processing\"]\n        AdminAPI[\"Admin API\u003cbr/\u003eVehicle registration\"]\n    end\n    \n    subgraph \"External Systems\"\n        Factory[\"Manufacturing\u003cbr/\u003eFacility\"]\n        Workshops[\"Workshop\u003cbr/\u003eNetwork\"]\n        IoTNetwork[\"IoT Network\u003cbr/\u003eVehicle connectivity\"]\n        Banks[\"Payment\u003cbr/\u003eSettlement\"]\n        GovtBodies[\"Administrative\u003cbr/\u003eBodies\"]\n    end\n    \n    WebPlatform --\u003e Expediente\n    MobileApp --\u003e Expediente\n    MobileApp -.Direct Link.-\u003e IoTNetwork\n    \n    Expediente --\u003e ServiceCatalog\n    Expediente --\u003e OrderMgmt\n    ServiceCatalog --\u003e PaymentProc\n    OrderMgmt --\u003e PaymentProc\n    \n    PaymentProc --\u003e NotificationEngine\n    OrderMgmt --\u003e NotificationEngine\n    ServiceCatalog --\u003e NotificationEngine\n    \n    NotificationEngine --\u003e Email\n    NotificationEngine --\u003e MobileApp\n    NotificationEngine --\u003e Vehicle\n    \n    OrderMgmt --\u003e FactoryAPI\n    ServiceCatalog --\u003e VSSAPI\n    PaymentProc --\u003e IoTAPI\n    PaymentProc --\u003e PaymentGW\n    OrderMgmt --\u003e AdminAPI\n    \n    FactoryAPI --\u003e Factory\n    VSSAPI --\u003e Workshops\n    IoTAPI --\u003e IoTNetwork\n    PaymentGW --\u003e Banks\n    AdminAPI --\u003e GovtBodies\n    \n    Factory -.Async Status.-\u003e FactoryAPI\n    Workshops --\u003e VSSAPI\n    IoTNetwork --\u003e Vehicle\n```\n\n**Key Integration Points for Customer Journey:**\n- **Factory API**: Enables automatic ordering and status tracking\n- **VSS API**: Validates maintenance status before service purchases  \n- **API IoT**: Delivers services via OTA to vehicle\n- **Payment Gateway**: Processes all financial transactions\n- **Admin API**: Registers vehicle to customer legally\n\nFor detailed information on each integration, see [External System Integrations](#5).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y respuestas a markdown.md:31-56]()\n\n---\n\n## Summary\n\nThe CaaS customer journey is designed as a **continuous, evolving relationship** rather than a one-time purchase. Key characteristics:\n\n1. **Dealership-initiated**: Customer enters system through employee registration, not self-service\n2. **Transparent manufacturing**: Real-time visibility into vehicle production status\n3. **Strict payment enforcement**: Final payment failure = immediate loss of reservation\n4. **Flexible delivery**: Home delivery with dealership fallback for safety\n5. **Self-service operations**: Post-delivery, customer manages all service changes independently\n6. **Maintenance-aware**: System enforces safety rules by gating certain services on maintenance status\n7. **Customer-favorable failures**: OTA failures result in no charge, not delayed delivery\n8. **Legal compliance**: Desistimiento (withdrawal) rights built into service cancellation flows\n9. **Continuous access**: Expediente de compra provides persistent visibility into all customer data\n\nThe journey emphasizes **customer trust** through transparent processes, favorable failure handling, and legal compliance, while maintaining operational efficiency through automation and integration with external systems.\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"1e:T6812,"])</script><script>self.__next_f.push([1,"# Vehicle Purchase and Delivery Process\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details the end-to-end process of purchasing a vehicle through the CaaS platform, from initial sale registration at the dealership through final delivery to the customer. It covers the coordination between dealerships, the CaaS platform, the manufacturing facility, transport providers, and administrative registration bodies.\n\nFor operational details about sales workflow management, see [Sales and Order Management](#8.1). For manufacturing and delivery operational procedures, see [Manufacturing and Delivery Workflow](#8.2). For payment processing details, see [Payment Types and Flows](#7.1). For factory API integration specifics, see [Factory Integration](#5.1). For failure handling, see [Payment Failure Scenarios](#9.2) and [Delivery and Transport Issues](#9.3).\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n## Process Overview\n\nThe vehicle purchase and delivery process consists of nine major stages that span from initial sale to final delivery. The process is initiated by dealership employees using the corporate intranet and involves automatic coordination between multiple systems and external actors.\n\n### High-Level Process Flow\n\n```mermaid\nflowchart TD\n    Start[\"Customer visits dealership\"]\n    SalesReg[\"1. Sales Registration\u003cbr/\u003e(Corporate Intranet)\"]\n    CredGen[\"2. Customer Credential Generation\u003cbr/\u003e(Automatic email)\"]\n    ResPay[\"3. Reservation Payment\u003cbr/\u003e(Seal/down payment)\"]\n    FactOrder[\"4. Factory Order Placement\u003cbr/\u003e(Automatic via API)\"]\n    MfgTrack[\"5. Manufacturing Status Tracking\u003cbr/\u003e(Asynchronous notifications)\"]\n    VehicleReady[\"6. Vehicle Available Notification\"]\n    FinalPay[\"7. Final Payment\u003cbr/\u003e(Complete purchase amount)\"]\n    AdminReg[\"8. Administrative Registration\u003cbr/\u003e(Vehicle matriculation)\"]\n    Delivery[\"9. Transport and Delivery\u003cbr/\u003e(Home delivery + app linking)\"]\n    Complete[\"Vehicle operational with\u003cbr/\u003ePlataforma Base active\"]\n    \n    Start --\u003e SalesReg\n    SalesReg --\u003e CredGen\n    CredGen --\u003e ResPay\n    ResPay --\u003e FactOrder\n    FactOrder --\u003e MfgTrack\n    MfgTrack --\u003e VehicleReady\n    VehicleReady --\u003e FinalPay\n    FinalPay --\u003e AdminReg\n    AdminReg --\u003e Delivery\n    Delivery --\u003e Complete\n```\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n### Process Stages Summary\n\n| Stage | Actor | System Component | Critical Output |\n|-------|-------|------------------|-----------------|\n| 1. Sales Registration | Dealership employee | Corporate Intranet | Customer record + Commercial plan |\n| 2. Credential Generation | CaaS System | Notification Engine | Email with access credentials |\n| 3. Reservation Payment | Customer | Payment Gateway | Payment confirmation + Reservation |\n| 4. Factory Order | CaaS System | Factory API Integration | Factory order number |\n| 5. Manufacturing Tracking | Factory | Factory API (async) | Status notifications |\n| 6. Vehicle Available | CaaS System | Notification Engine | Customer notification |\n| 7. Final Payment | Customer | Payment Gateway | Full payment confirmation |\n| 8. Administrative Registration | Dealership/CaaS | Admin Registration API | Vehicle matriculation |\n| 9. Transport \u0026 Delivery | Transport Company | Logistics coordination | Physical vehicle delivery |\n\n**Sources:** [enunciado.md:8-17]()\n\n## Sales Registration at Dealership\n\nThe purchase process begins when a dealership employee (commercial) closes a sale and registers it in the corporate intranet system. This is the authoritative entry point for all customer and vehicle purchase data into the CaaS platform.\n\n### Data Captured During Sales Registration\n\nThe sales registration process captures the following information:\n\n| Data Category | Fields Captured | Purpose |\n|---------------|----------------|---------|\n| Customer Identification | Name, email, address, contact details | Customer account creation and communication |\n| Commercial Plan | Selected plataforma base (vehicle model) | Defines base vehicle configuration |\n| Optional Services | Included opciones disponibles | Services active throughout vehicle lifetime |\n| Payment Terms | Down payment amount, financing details | Financial tracking and invoicing |\n| Delivery Address | Customer home address | Transport coordination |\n\n**Critical Business Rule:** All customers must be registered by dealership employees. There is no self-service registration. This ensures all users are \"known and controlled\" within the system.\n\n**Sources:** [enunciado.md:8-10](), [pasame las preguntas y sus respuestas a markdown.md:16]()\n\n### Systems and Components Involved\n\n```mermaid\ngraph LR\n    Employee[\"Dealership Employee\u003cbr/\u003e(Authorized user)\"]\n    Intranet[\"Corporate Intranet\u003cbr/\u003e(Sales registration interface)\"]\n    CustomerDB[(\"Customer Database\u003cbr/\u003e(Customer records)\")]\n    OrderDB[(\"Order Database\u003cbr/\u003e(Purchase records)\")]\n    PlanDB[(\"Service Database\u003cbr/\u003e(Commercial plans)\")]\n    NotifEngine[\"Notification Engine\"]\n    \n    Employee --\u003e|\"Enters customer data +\u003cbr/\u003ecommercial plan\"| Intranet\n    Intranet --\u003e|\"Create customer record\"| CustomerDB\n    Intranet --\u003e|\"Create purchase order\"| OrderDB\n    Intranet --\u003e|\"Link plan services\"| PlanDB\n    Intranet --\u003e|\"Trigger credential generation\"| NotifEngine\n```\n\n**Sources:** [enunciado.md:8-10]()\n\n## Customer Credential Generation\n\nUpon successful sales registration, the CaaS system automatically generates access credentials for the customer and sends them via email. This enables customer access to both the web platform and mobile application.\n\n### Credential Generation Flow\n\n```mermaid\nsequenceDiagram\n    participant Intranet as Corporate Intranet\n    participant UserMgmt as User Management Service\n    participant AuthDB as Authentication Database\n    participant NotifEngine as Notification Engine\n    participant Email as Email Service\n    participant Customer as Customer Email\n    \n    Intranet-\u003e\u003eUserMgmt: Create customer account\n    UserMgmt-\u003e\u003eAuthDB: Generate credentials\n    AuthDB--\u003e\u003eUserMgmt: Return credentials\n    UserMgmt-\u003e\u003eNotifEngine: Send welcome notification\n    NotifEngine-\u003e\u003eEmail: Format email with credentials\n    Email-\u003e\u003eCustomer: Deliver access credentials\n    \n    Note over Customer: Customer can now access\u003cbr/\u003eweb platform and mobile app\n```\n\n**Sources:** [enunciado.md:10-12]()\n\n### Customer Access Capabilities\n\nOnce credentials are received, customers can access:\n\n1. **Web Platform** - Full-featured browser-based access to expediente de compra\n2. **Mobile Application** - On-the-go access with direct vehicle linking capabilities\n\nThe **expediente de compra** (purchase dossier) provides access to:\n- Vehicle manuals and documentation\n- Maintenance history (historial de mantenimiento)\n- Invoice records (facturas)\n- Manufacturing status during production\n- Service activation history (after delivery)\n\nFor details on customer-facing platform features, see [Customer-Facing Platforms](#4.3).\n\n**Sources:** [enunciado.md:10-12]()\n\n## Reservation Payment and Factory Order\n\nOnce the customer receives credentials and reviews their purchase details, they must pay a reservation signal (seal) to confirm the order. This triggers automatic factory order placement.\n\n### Payment and Order Sequence\n\n```mermaid\nsequenceDiagram\n    participant Customer as Customer\u003cbr/\u003e(Web/Mobile)\n    participant PaymentProc as Payment Processing\n    participant PaymentGW as Payment Gateway\n    participant OrderMgmt as Order Management\n    participant FactoryAPI as Factory API\u003cbr/\u003e(Synchronous)\n    participant Factory as Factory System\n    \n    Customer-\u003e\u003ePaymentProc: Submit reservation payment (seal)\n    PaymentProc-\u003e\u003ePaymentGW: Process card/bank payment\n    PaymentGW--\u003e\u003ePaymentProc: Payment confirmation\n    PaymentProc-\u003e\u003eOrderMgmt: Mark order as reserved\n    \n    Note over OrderMgmt: Automatic trigger on payment success\n    \n    OrderMgmt-\u003e\u003eFactoryAPI: POST /orders\u003cbr/\u003e(Customer data + vehicle spec)\n    FactoryAPI-\u003e\u003eFactory: Create manufacturing order\n    Factory--\u003e\u003eFactoryAPI: Order number + estimated timeline\n    FactoryAPI--\u003e\u003eOrderMgmt: Order confirmation\n    OrderMgmt-\u003e\u003eCustomer: Order placed notification\n```\n\n**Sources:** [enunciado.md:13-14](), [pasame las preguntas y sus respuestas a markdown.md:41-44]()\n\n### Factory API Integration Pattern\n\nThe factory order placement uses a **synchronous API call**:\n\n- **Direction:** CaaS  Factory\n- **Protocol:** REST API (synchronous request-response)\n- **Endpoint:** Factory Order API\n- **Initiative:** CaaS initiates the order placement\n- **Response:** Factory provides order confirmation with order number\n\nThis is distinct from manufacturing status updates, which use an asynchronous pattern. For complete factory integration details, see [Factory Integration](#5.1).\n\n**Critical Business Rule:** Factory order placement is **automatic** upon reservation payment confirmation. No manual intervention is required.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44]()\n\n## Manufacturing Status Tracking\n\nAfter the factory order is placed, the customer receives ongoing notifications about the manufacturing status throughout the production process. This provides transparency and is a \"differentiating value\" of the CaaS platform.\n\n### Status Notification Architecture\n\n```mermaid\ngraph LR\n    Factory[\"Factory System\u003cbr/\u003e(Manufacturing execution)\"]\n    FactoryWebhook[\"Factory Webhook Handler\u003cbr/\u003e(Asynchronous notifications)\"]\n    OrderDB[(\"Order Database\u003cbr/\u003e(Status tracking)\")]\n    NotifEngine[\"Notification Engine\"]\n    Email[\"Email Service\"]\n    Push[\"Push Notification Service\"]\n    Customer[\"Customer\u003cbr/\u003e(Web/Mobile/Email)\"]\n    \n    Factory --\u003e|\"Webhook: Status updates\u003cbr/\u003e(async)\"| FactoryWebhook\n    FactoryWebhook --\u003e|\"Update order status\"| OrderDB\n    FactoryWebhook --\u003e|\"Trigger notification\"| NotifEngine\n    NotifEngine --\u003e Email\n    NotifEngine --\u003e Push\n    Email --\u003e Customer\n    Push --\u003e Customer\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29, 41-44](), [enunciado.md:13-14]()\n\n### Manufacturing Status Notifications\n\nThe system provides automatic notifications for key manufacturing milestones:\n\n| Manufacturing Stage | Notification Content | Delivery Channels |\n|-------------------|---------------------|------------------|\n| Order Confirmed | Factory has received order, production scheduled | Email + Push |\n| Production Started | Vehicle manufacturing has begun | Email + Push |\n| Quality Control | Vehicle undergoing final quality checks | Email + Push |\n| Ready for Shipment | Vehicle completed and ready to ship | Email + Push |\n| Shipped to Dealership | Vehicle en route to local dealership | Email + Push |\n| Available at Location | Vehicle arrived and ready for final payment | Email + Push + SMS |\n\n**Integration Pattern:** The factory uses **asynchronous webhooks** to push status updates to CaaS, eliminating the need for CaaS to poll for status changes.\n\n**Critical Business Rule:** The factory determines the delivery date based on their production planning. CaaS does not control or override these dates.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:22-23, 28-29](), [enunciado.md:13-14]()\n\n## Final Payment and Vehicle Registration\n\nWhen the vehicle is manufactured and available at the dealership location, the customer must complete the final payment for the vehicle. Only after full payment is confirmed does the administrative registration (matriculation) process begin.\n\n### Final Payment Flow\n\n```mermaid\nsequenceDiagram\n    participant Customer as Customer\n    participant CaaS as CaaS Platform\n    participant PaymentGW as Payment Gateway\n    participant OrderMgmt as Order Management\n    participant AdminAPI as Admin Registration API\n    participant GovtBodies as Government Bodies\u003cbr/\u003e(Per country)\n    \n    CaaS-\u003e\u003eCustomer: Vehicle available notification\n    Customer-\u003e\u003eCaaS: Initiate final payment\n    CaaS-\u003e\u003ePaymentGW: Process remaining amount\n    PaymentGW--\u003e\u003eCaaS: Payment confirmed\n    CaaS-\u003e\u003eOrderMgmt: Mark as fully paid\n    \n    Note over OrderMgmt,AdminAPI: Registration process begins\n    \n    OrderMgmt-\u003e\u003eAdminAPI: Register vehicle\u003cbr/\u003e(Customer + vehicle data)\n    AdminAPI-\u003e\u003eGovtBodies: Submit registration\u003cbr/\u003e(Country-specific)\n    GovtBodies--\u003e\u003eAdminAPI: Registration confirmation + plates\n    AdminAPI--\u003e\u003eOrderMgmt: Vehicle matriculated\n    OrderMgmt-\u003e\u003eCustomer: Registration complete notification\n```\n\n**Sources:** [enunciado.md:14-16](), [pasame las preguntas y sus respuestas a markdown.md:80]()\n\n### Payment Failure Scenario\n\nIf the customer cannot complete the final payment, the following actions occur:\n\n```mermaid\nflowchart TD\n    PaymentAttempt[\"Customer attempts final payment\"]\n    PaymentFail{\"Payment\u003cbr/\u003esuccessful?\"}\n    VehicleUnassign[\"Mark vehicle 'sin asignar'\u003cbr/\u003e(unassigned)\"]\n    VehicleStock[\"Move vehicle to dealership stock\"]\n    CustomerLoses[\"Customer loses reservation\"]\n    ImmediateSale[\"Vehicle available for immediate sale\"]\n    \n    PaymentAttempt --\u003e PaymentFail\n    PaymentFail --\u003e|\"No\"| VehicleUnassign\n    VehicleUnassign --\u003e VehicleStock\n    VehicleStock --\u003e CustomerLoses\n    VehicleStock --\u003e ImmediateSale\n    \n    PaymentFail --\u003e|\"Yes\"| Registration[\"Proceed with registration\"]\n```\n\n**Critical Business Rules:**\n1. **Vehicle becomes dealership stock** - The vehicle remains at the dealership and is marked as available inventory\n2. **Customer loses reservation** - The customer forfeits their reservation and down payment\n3. **Vehicle marked \"sin asignar\"** - In the system, the vehicle exists but is not assigned to any customer\n4. **Immediate availability** - The vehicle can be sold immediately to another customer\n\nThis is a hard business boundary: **no full payment = no vehicle**.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Administrative Registration Process\n\nThe administrative registration process varies by country, as each country has different governmental bodies and requirements. The CaaS system integrates with country-specific administrative APIs to handle vehicle matriculation.\n\n| Process Step | Responsibility | System Component |\n|--------------|---------------|------------------|\n| Payment verification | CaaS Platform | Order Management |\n| Registration submission | CaaS Platform / Dealership | Admin Registration API |\n| Document processing | Government bodies | External (per country) |\n| Plate assignment | Government bodies | External (per country) |\n| Registration confirmation | CaaS Platform | Admin Registration Integration |\n\nFor complete details on administrative integration, see [Administrative Registration Integration](#5.5).\n\n**Sources:** [enunciado.md:15-16]()\n\n## Vehicle Delivery\n\nOnce the vehicle is registered and matriculated, it is transported to the customer's home address for delivery. The delivery process includes physical vehicle handoff and mobile application linking to enable vehicle operation.\n\n### Transport and Delivery Flow\n\n```mermaid\nflowchart TD\n    RegComplete[\"Vehicle registered and matriculated\"]\n    ScheduleTransport[\"Schedule transport to\u003cbr/\u003ecustomer address\"]\n    TransportCompany[\"Subcontracted transport company\u003cbr/\u003epicks up vehicle\"]\n    DeliverAttempt[\"Attempt delivery at\u003cbr/\u003ecustomer address\"]\n    CustomerPresent{\"Customer\u003cbr/\u003epresent?\"}\n    DeliverSuccess[\"Successful delivery\"]\n    LinkApp[\"Link mobile app to vehicle\"]\n    VehicleActive[\"Vehicle operational\u003cbr/\u003ePlataforma base active\"]\n    \n    CallCustomer[\"Transport company calls customer\"]\n    CustomerAvailable{\"Customer\u003cbr/\u003eavailable?\"}\n    ReturnDealer[\"Return vehicle to dealership\"]\n    CustomerPickup[\"Customer goes to dealership\u003cbr/\u003eto pick up vehicle\"]\n    \n    RegComplete --\u003e ScheduleTransport\n    ScheduleTransport --\u003e TransportCompany\n    TransportCompany --\u003e DeliverAttempt\n    DeliverAttempt --\u003e CustomerPresent\n    \n    CustomerPresent --\u003e|\"Yes\"| DeliverSuccess\n    DeliverSuccess --\u003e LinkApp\n    LinkApp --\u003e VehicleActive\n    \n    CustomerPresent --\u003e|\"No\"| CallCustomer\n    CallCustomer --\u003e CustomerAvailable\n    CustomerAvailable --\u003e|\"No\"| ReturnDealer\n    ReturnDealer --\u003e CustomerPickup\n    CustomerPickup --\u003e LinkApp\n    \n    CustomerAvailable --\u003e|\"Yes - reschedule\"| DeliverAttempt\n```\n\n**Sources:** [enunciado.md:16-17](), [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n### Transport Coordination\n\nThe physical transport of the vehicle involves a subcontracted transport company:\n\n| Actor | Responsibility | System Interaction |\n|-------|---------------|-------------------|\n| Factory | Prepares vehicle for shipment | Notifies CaaS of shipment |\n| Transport Company | Picks up from factory, delivers to dealership | Records pickup/delivery timestamps |\n| Dealership | Receives vehicle at location | Confirms vehicle receipt in CaaS |\n| Transport Company (final) | Delivers to customer home | GPS tracking, delivery confirmation |\n| CaaS Platform | Coordinates and tracks entire process | Logistics coordination system |\n\n**Critical Logistics Points:**\n- **Pickup timestamp:** When vehicle leaves factory/dealership\n- **Delivery timestamp:** When vehicle arrives at destination\n- **GPS tracking:** Real-time location during transport (if available)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-21]()\n\n### Delivery Failure Handling\n\nIf the customer is not present during the home delivery attempt:\n\n**Step 1: Contact Customer**\n- Transport company (gra/tow truck) calls the customer\n- Attempts to reschedule delivery for same day or next available time\n\n**Step 2: Return to Dealership (if customer unavailable)**\n- Vehicle is **never left on the street** due to security risks\n- Vehicle is returned to the dealership\n- Customer is notified that vehicle is waiting for pickup at dealership\n\n**Step 3: Customer Dealership Pickup**\n- Customer goes to dealership to collect vehicle\n- Mobile app linking occurs at dealership instead of home\n\nThis fallback ensures vehicle security while still completing the delivery process.\n\nFor complete delivery failure procedures, see [Delivery and Transport Issues](#9.3).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n### Mobile Application Linking\n\nThe final step of delivery is linking the customer's mobile application directly to the physical vehicle. This establishes the bidirectional communication channel between customer and vehicle.\n\n```mermaid\nsequenceDiagram\n    participant Customer as Customer\u003cbr/\u003e(Mobile App)\n    participant CaaS as CaaS Platform\n    participant IoTGateway as IoT Gateway\u003cbr/\u003e(API IoT)\n    participant Vehicle as Vehicle\u003cbr/\u003e(IoT-connected)\n    \n    Note over Customer,Vehicle: During physical delivery\n    \n    Customer-\u003e\u003eCaaS: Scan vehicle QR code / Enter VIN\n    CaaS-\u003e\u003eIoTGateway: Link customer ID to vehicle ID\n    IoTGateway-\u003e\u003eVehicle: Push customer authorization\n    Vehicle--\u003e\u003eIoTGateway: Confirm authorization\n    IoTGateway--\u003e\u003eCaaS: Linking successful\n    CaaS-\u003e\u003eCustomer: Vehicle linked successfully\n    \n    Note over Customer,Vehicle: Post-delivery\n    \n    Customer-\u003e\u003eVehicle: Direct commands\u003cbr/\u003e(via app)\n    Vehicle--\u003e\u003eCustomer: Status updates\u003cbr/\u003e(via app)\n    \n    Note over Customer,Vehicle: Plataforma base now operational\n```\n\n**Sources:** [enunciado.md:16-17]()\n\n### Post-Delivery Vehicle State\n\nOnce delivery and app linking are complete:\n\n| Component | State | Capabilities |\n|-----------|-------|--------------|\n| Vehicle | Operational | Plataforma base features active |\n| Mobile App | Linked | Direct vehicle control, status monitoring |\n| Customer Account | Active | Can purchase additional opciones disponibles |\n| Expediente de Compra | Accessible | Full purchase history and documentation |\n| IoT Connection | Established | Bidirectional communication active |\n\nThe customer can now use the vehicle with its base platform features and begin purchasing additional optional services as needed. For service acquisition process, see [Service Acquisition and Management](#4.2).\n\n**Sources:** [enunciado.md:16-17]()\n\n## Failure Scenarios\n\nSeveral failure scenarios can occur during the purchase and delivery process. The system includes specific handling procedures for each scenario to protect both customer and business interests.\n\n### Payment Failure During Final Payment\n\nAs detailed in [Final Payment and Vehicle Registration](#final-payment-and-vehicle-registration), if the customer cannot complete the final payment:\n\n- Vehicle is marked **\"sin asignar\"** (unassigned) in the system\n- Vehicle becomes dealership stock for immediate sale\n- Customer **loses reservation** and down payment\n- No further customer obligations or rights to the vehicle\n\nThis is a permanent state change with no recovery path for the customer.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Delivery Failure - Customer Absent\n\nAs detailed in [Delivery Failure Handling](#delivery-failure-handling), if the customer is not present during home delivery:\n\n1. Transport company attempts phone contact\n2. If contact successful: Reschedule delivery\n3. If contact unsuccessful: Return vehicle to dealership\n4. Customer must pick up at dealership\n5. Mobile app linking occurs at dealership\n\n**Critical Security Rule:** Vehicle is **never left unattended** on the street, even temporarily.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n### Manufacturing Delays\n\nIf the factory experiences delays in manufacturing:\n\n- Factory pushes updated status via asynchronous webhooks\n- CaaS automatically notifies customer of revised timeline\n- Customer retains reservation throughout delay\n- No penalty or cancellation option for reasonable delays\n\nThe factory controls the manufacturing timeline and CaaS adapts to factory schedules.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:22-23]()\n\n### Integration Failure Scenarios\n\n| Failure Type | System Impact | Recovery Action |\n|-------------|---------------|-----------------|\n| Factory API timeout during order | Order not placed | Retry with exponential backoff, manual escalation if persistent |\n| Admin registration API failure | Vehicle registered but CaaS not updated | Query registration status periodically, manual reconciliation |\n| Payment gateway timeout | Payment status unknown | Query payment status, do not deliver until confirmed |\n| IoT linking failure at delivery | Vehicle delivered but app not linked | Link can be completed later via app, does not block delivery |\n\nFor complete failure handling procedures across all system areas, see [Failure Handling and Edge Cases](#9).\n\n**Sources:** Multiple sources across [pasame las preguntas y sus respuestas a markdown.md]()\n\n## Process State Diagram\n\nThe following state diagram shows the complete lifecycle of a vehicle purchase order from initial registration through operational delivery:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e SalesRegistered: Dealership registers sale\n    \n    SalesRegistered --\u003e CredentialsSent: Auto-generate credentials\n    CredentialsSent --\u003e AwaitingReservation: Customer receives access\n    \n    AwaitingReservation --\u003e Reserved: Customer pays seal\n    Reserved --\u003e FactoryOrdered: Auto-order via Factory API\n    \n    state FactoryOrdered {\n        [*] --\u003e InProduction\n        InProduction --\u003e QualityControl: Manufacturing complete\n        QualityControl --\u003e ReadyToShip: QC passed\n        ReadyToShip --\u003e Shipped: Dispatched to dealership\n        Shipped --\u003e [*]\n    }\n    \n    FactoryOrdered --\u003e VehicleAvailable: Arrived at dealership\n    \n    VehicleAvailable --\u003e AwaitingFinalPayment: Customer notified\n    AwaitingFinalPayment --\u003e FullyPaid: Customer completes payment\n    AwaitingFinalPayment --\u003e SinAsignar: Payment failed\n    \n    SinAsignar --\u003e DealershipStock: Vehicle unassigned\n    DealershipStock --\u003e [*]: Available for sale\n    \n    FullyPaid --\u003e Registering: Submit to admin bodies\n    Registering --\u003e Registered: Matriculation complete\n    \n    Registered --\u003e InTransit: Schedule home delivery\n    InTransit --\u003e DeliveryAttempted: Arrive at customer address\n    \n    DeliveryAttempted --\u003e Delivered: Customer present\n    DeliveryAttempted --\u003e ReturnedToDealer: Customer absent\n    \n    ReturnedToDealer --\u003e AwaitingPickup: Vehicle at dealership\n    AwaitingPickup --\u003e Delivered: Customer picks up\n    \n    Delivered --\u003e AppLinked: Link mobile app to vehicle\n    AppLinked --\u003e Operational: Plataforma base active\n    \n    Operational --\u003e [*]: Customer using vehicle\n    \n    note right of FactoryOrdered\n        Asynchronous status updates\n        via Factory webhooks\n    end note\n    \n    note right of SinAsignar\n        Customer loses reservation\n        Vehicle becomes stock\n    end note\n    \n    note right of AppLinked\n        Bidirectional IoT connection\n        established via API IoT\n    end note\n```\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n## Summary\n\nThe vehicle purchase and delivery process is a complex, multi-stage workflow that requires coordination between multiple systems, external services, and human actors. Key characteristics of this process include:\n\n**Automation:** Credential generation, factory ordering, and status notifications are fully automated with no manual intervention required.\n\n**Synchronous and Asynchronous Patterns:** Factory order placement is synchronous (request-response), while manufacturing status updates are asynchronous (webhooks).\n\n**Customer Protection:** Payment failures result in clear outcomes (vehicle returned to stock) with no ambiguity. Delivery failures have fallback procedures (dealership pickup).\n\n**Integration Complexity:** The process touches Factory API, Payment Gateway, Admin Registration API, IoT Gateway, and Notification Engine, requiring robust failure handling.\n\n**State Management:** Vehicle orders progress through well-defined states with specific entry and exit criteria for each stage.\n\nThe successful completion of this process results in an operational vehicle with the plataforma base active, ready for the customer to begin using and purchasing optional services as needed.\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"1f:T4c7e,"])</script><script>self.__next_f.push([1,"# Service Acquisition and Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the customer journey for acquiring and managing optional vehicle services (opciones disponibles) after vehicle delivery. It covers the complete workflow from service discovery through purchase, activation, and ongoing management including cancellations and refunds.\n\nFor the initial vehicle purchase and delivery process, see [Vehicle Purchase and Delivery Process](#4.1). For technical details of customer-facing web and mobile platforms, see [Customer-Facing Platforms](#4.3). For technical implementation details of OTA activation, see [OTA Service Activation](#6.2). For payment gateway integration specifics, see [Payment Gateway Integration](#5.4).\n\n**Sources:** [enunciado.md:18-22](), [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Service Acquisition Workflow Overview\n\nThe service acquisition process begins when a customer accesses their expediente de compra through either the web platform or mobile application. Customers can browse the catalog of opciones disponibles specific to their vehicle's plataforma base, select services with desired durations, complete payment, and receive automatic OTA activation.\n\n### Customer Service Acquisition Flow\n\n```mermaid\nflowchart TD\n    START[\"Customer Accesses\u003cbr/\u003eExpediente de Compra\"] --\u003e ACCESS_PLATFORM{\"Access Channel\"}\n    \n    ACCESS_PLATFORM --\u003e|\"Web Browser\"| WEB[\"Web Platform\"]\n    ACCESS_PLATFORM --\u003e|\"Mobile App\"| MOBILE[\"Mobile Application\"]\n    \n    WEB --\u003e EXPEDIENTE[\"View Expediente\u003cbr/\u003ePurchase Record\"]\n    MOBILE --\u003e EXPEDIENTE\n    \n    EXPEDIENTE --\u003e BROWSE[\"Browse Service Catalog\u003cbr/\u003eOpciones Disponibles\"]\n    \n    BROWSE --\u003e FILTER[\"Filter by Category\u003cbr/\u003ePerformance, ADAS, Entertainment, etc.\"]\n    \n    FILTER --\u003e SELECT[\"Select Service\"]\n    \n    SELECT --\u003e CHECK_MAINT{\"Maintenance-Linked\u003cbr/\u003eService?\"}\n    \n    CHECK_MAINT --\u003e|\"Yes\"| QUERY_VSS[\"Query VSS System\u003cbr/\u003eMaintenance Status\"]\n    CHECK_MAINT --\u003e|\"No\"| CONFIGURE\n    \n    QUERY_VSS --\u003e MAINT_OK{\"Maintenance\u003cbr/\u003eCurrent?\"}\n    \n    MAINT_OK --\u003e|\"No\"| BLOCK[\"Service Blocked\u003cbr/\u003eDisplay Maintenance Required\"]\n    MAINT_OK --\u003e|\"Yes\"| CONFIGURE\n    \n    BLOCK --\u003e BROWSE\n    \n    CONFIGURE[\"Configure Service\u003cbr/\u003eSelect Duration/Type\"] --\u003e DURATION{\"Service Type\"}\n    \n    DURATION --\u003e|\"Temporary\"| TEMP[\"Specify Time Period\u003cbr/\u003eDays/Months\"]\n    DURATION --\u003e|\"Permanent\"| PERM[\"Until End of Vehicle Life\"]\n    DURATION --\u003e|\"Subscription\"| SUB[\"Recurring Monthly\u003cbr/\u003eMes Vencido Billing\"]\n    \n    TEMP --\u003e PRICE[\"Calculate Price\u003cbr/\u003eBased on Duration\"]\n    PERM --\u003e PRICE\n    SUB --\u003e PRICE\n    \n    PRICE --\u003e CONFIRM[\"Review Purchase\u003cbr/\u003eService Summary + Price\"]\n    \n    CONFIRM --\u003e PAYMENT[\"Process Payment\u003cbr/\u003ePayment Gateway\"]\n    \n    PAYMENT --\u003e PAY_SUCCESS{\"Payment\u003cbr/\u003eSuccessful?\"}\n    \n    PAY_SUCCESS --\u003e|\"No\"| PAY_FAILED[\"Display Payment Error\"]\n    PAY_SUCCESS --\u003e|\"Yes\"| QUEUE_OTA[\"Queue OTA Activation\u003cbr/\u003eSend to Activation Engine\"]\n    \n    PAY_FAILED --\u003e CONFIRM\n    \n    QUEUE_OTA --\u003e NOTIFY[\"Notify Customer\u003cbr/\u003eActivation in Progress\"]\n    \n    NOTIFY --\u003e WAIT[\"Wait for OTA\u003cbr/\u003eCompletion\"]\n    \n    WAIT --\u003e OTA_RESULT{\"OTA Result\"}\n    \n    OTA_RESULT --\u003e|\"Success\"| ACTIVE[\"Service Active\u003cbr/\u003eUpdate Expediente\"]\n    OTA_RESULT --\u003e|\"Failure After Retries\"| TECH[\"Technical Support\u003cbr/\u003eNo Charge to Customer\"]\n    \n    ACTIVE --\u003e END[\"Return to Expediente\"]\n    TECH --\u003e END\n    \n    END --\u003e BROWSE\n```\n\n**Sources:** [enunciado.md:18-20](), [pasame las preguntas y sus respuestas a markdown.md:46-53](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Service Catalog and Discovery\n\n### Accessing Available Services\n\nCustomers access the service catalog through their expediente de compra, which is accessible via both web and mobile channels. The catalog displays only the opciones disponibles that are compatible with the customer's specific vehicle plataforma base.\n\nThe service catalog is organized by functional categories:\n\n| Category | Examples |\n|----------|----------|\n| **Performance** | 50% power increase, enhanced acceleration modes |\n| **Driver Assistance (ADAS)** | Autonomous driving on highways, advanced parking assist |\n| **Traction \u0026 Handling** | Specialized modes for different terrain and weather conditions |\n| **Climate Control** | Enhanced HVAC options, seat heating/cooling |\n| **Entertainment** | Premium audio, in-vehicle streaming services |\n\n### Service Catalog Architecture\n\n```mermaid\ngraph TB\n    subgraph \"Customer Access Layer\"\n        WEB_CLIENT[\"Web Platform Client\"]\n        MOBILE_CLIENT[\"Mobile App Client\"]\n    end\n    \n    subgraph \"Expediente System\"\n        EXPEDIENTE_SVC[\"Expediente Service\"]\n        CUSTOMER_CTX[\"Customer Context\u003cbr/\u003eVehicle ID + Plan Comercial\"]\n    end\n    \n    subgraph \"Service Catalog Core\"\n        CATALOG_API[\"Service Catalog API\"]\n        FILTER_ENGINE[\"Compatibility Filter\u003cbr/\u003eby Plataforma Base\"]\n        PRICING_ENGINE[\"Pricing Calculator\"]\n    end\n    \n    subgraph \"Data Sources\"\n        SERVICE_DB[\"Service Definitions DB\u003cbr/\u003eOpciones Disponibles\"]\n        CUSTOMER_DB[\"Customer Database\u003cbr/\u003ePurchase History\"]\n        VEHICLE_DB[\"Vehicle Configuration DB\u003cbr/\u003ePlataforma Base\"]\n    end\n    \n    subgraph \"External Integration\"\n        VSS_CLIENT[\"VSS Integration Client\"]\n        VSS_SYSTEM[\"VSS System\u003cbr/\u003eMaintenance Records\"]\n    end\n    \n    WEB_CLIENT --\u003e EXPEDIENTE_SVC\n    MOBILE_CLIENT --\u003e EXPEDIENTE_SVC\n    \n    EXPEDIENTE_SVC --\u003e CUSTOMER_CTX\n    CUSTOMER_CTX --\u003e CATALOG_API\n    \n    CATALOG_API --\u003e FILTER_ENGINE\n    CATALOG_API --\u003e PRICING_ENGINE\n    \n    FILTER_ENGINE --\u003e SERVICE_DB\n    FILTER_ENGINE --\u003e VEHICLE_DB\n    \n    PRICING_ENGINE --\u003e SERVICE_DB\n    PRICING_ENGINE --\u003e CUSTOMER_DB\n    \n    CATALOG_API --\u003e VSS_CLIENT\n    VSS_CLIENT --\u003e VSS_SYSTEM\n    \n    FILTER_ENGINE -..\"Filters out\u003cbr/\u003eincompatible services\"..-\u003e CATALOG_API\n    VSS_CLIENT -..\"Checks maintenance\u003cbr/\u003efor gated services\"..-\u003e CATALOG_API\n```\n\n**Sources:** [enunciado.md:3-5](), [enunciado.md:18-19](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Maintenance-Linked Service Access\n\nCertain services have dependencies on the vehicle's official maintenance status. Before allowing purchase of these services, the system queries the VSS (Vehicle Service System) to verify current maintenance compliance.\n\n### Maintenance Validation Logic\n\n```mermaid\nflowchart TD\n    SERVICE_REQUEST[\"Customer Selects Service\"] --\u003e IS_GATED{\"Service Requires\u003cbr/\u003eMaintenance Check?\"}\n    \n    IS_GATED --\u003e|\"No\"| ALLOW[\"Allow Purchase\"]\n    IS_GATED --\u003e|\"Yes\"| QUERY[\"Query VSS API\u003cbr/\u003eGet Maintenance Status\"]\n    \n    QUERY --\u003e VSS_RESPONSE[\"VSS Returns\u003cbr/\u003eCompliance by Block\"]\n    \n    VSS_RESPONSE --\u003e CHECK_BLOCK{\"Required Block\u003cbr/\u003eCurrent?\"}\n    \n    CHECK_BLOCK --\u003e|\"Yes - Compliant\"| ALLOW\n    CHECK_BLOCK --\u003e|\"No - Overdue\"| BLOCK_PURCHASE[\"Block Service Purchase\"]\n    \n    BLOCK_PURCHASE --\u003e DISPLAY[\"Display Message:\u003cbr/\u003eMaintenance Required for Safety\"]\n    \n    DISPLAY --\u003e LINK_MAINT[\"Provide Link to\u003cbr/\u003eMaintenance Schedule\"]\n    \n    ALLOW --\u003e CONTINUE[\"Continue to\u003cbr/\u003eService Configuration\"]\n```\n\n**Key Business Rules:**\n\n1. **Never block the plataforma base** - Only new service purchases can be blocked, never existing functionality\n2. **Never immobilize the vehicle** - Lack of maintenance results in warranty loss, not vehicle lockout\n3. **Safety-based blocking** - Only services with safety dependencies (e.g., autonomous driving, enhanced performance) check maintenance\n4. **Block-specific validation** - VSS tracks maintenance by functional blocks; only relevant blocks are checked per service\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Service Configuration and Pricing\n\n### Service Duration Models\n\nThe system supports three distinct service duration models:\n\n| Model | Description | Payment | Use Case |\n|-------|-------------|---------|----------|\n| **Temporary (Temporal)** | Service active for a specified time period | One-time upfront payment | Weekend trip, seasonal needs |\n| **Permanent (Permanente)** | Service active until end of vehicle life | One-time upfront payment | Features customer wants always available |\n| **Subscription (Planificada/Recurrente)** | Recurring monthly service | Monthly billing (mes vencido) | Ongoing entertainment, regular performance boost |\n\n### Pricing Calculation\n\n```mermaid\nflowchart LR\n    INPUT[\"Service + Duration\"] --\u003e PRICING_ENGINE[\"Pricing Engine\"]\n    \n    PRICING_ENGINE --\u003e BASE_RATE[\"Get Base Rate\u003cbr/\u003efrom Service Catalog\"]\n    PRICING_ENGINE --\u003e DURATION_MULT[\"Apply Duration\u003cbr/\u003eMultiplier\"]\n    PRICING_ENGINE --\u003e CUSTOMER_DISC[\"Check Plan Comercial\u003cbr/\u003efor Discounts\"]\n    \n    BASE_RATE --\u003e CALC[\"Calculate Final Price\"]\n    DURATION_MULT --\u003e CALC\n    CUSTOMER_DISC --\u003e CALC\n    \n    CALC --\u003e DISPLAY_PRICE[\"Display to Customer\"]\n    \n    subgraph \"Pricing Rules\"\n        RULE1[\"Temporary: Price per unit time\"]\n        RULE2[\"Permanent: Fixed one-time fee\"]\n        RULE3[\"Subscription: Monthly rate\"]\n        RULE4[\"Plan Comercial may include\u003cbr/\u003ebundled services at no cost\"]\n    end\n```\n\n**Sources:** [enunciado.md:5-6](), [enunciado.md:21](), [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n---\n\n## Payment Processing for Services\n\n### Service Payment Flow\n\nPayment for services occurs before OTA activation. The system integrates with the payment gateway to process card payments, with CaaS assuming settlement risk by delivering services immediately upon payment initiation.\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant Expediente as \"Expediente UI\"\n    participant PaymentProc as \"Payment Processor\"\n    participant Gateway as \"Payment Gateway\"\n    participant OTA as \"OTA Queue\"\n    participant Notification as \"Notification Engine\"\n    \n    Customer-\u003e\u003eExpediente: \"Confirm Purchase\"\n    Expediente-\u003e\u003ePaymentProc: \"initiate_service_payment(service_id, amount)\"\n    \n    PaymentProc-\u003e\u003eGateway: \"POST /payment\"\n    Gateway--\u003e\u003ePaymentProc: \"Payment Initiated\"\n    \n    Note over PaymentProc: CaaS Assumes Risk\u003cbr/\u003eProceeds Immediately\n    \n    PaymentProc-\u003e\u003eOTA: \"queue_activation(customer_id, service_id)\"\n    PaymentProc-\u003e\u003eNotification: \"notify(customer, 'activation_pending')\"\n    \n    PaymentProc--\u003e\u003eExpediente: \"Payment Accepted\"\n    Expediente--\u003e\u003eCustomer: \"Display: Activating Service...\"\n    \n    Note over Gateway: Async Settlement\u003cbr/\u003e(may take time)\n    \n    Gateway--\u003e\u003ePaymentProc: \"Settlement Confirmed\"\n    PaymentProc-\u003e\u003eNotification: \"notify_settlement(customer_id)\"\n    \n    OTA-\u003e\u003eCustomer: \"OTA Activation Begins\"\n```\n\n**Critical Rules:**\n\n1. **Immediate Service Delivery** - Service activation begins immediately after payment initiation, before settlement confirmation\n2. **No Charge on Failure** - If OTA activation fails after all retries, customer is NOT charged (refund or void transaction)\n3. **Async Settlement Risk** - CaaS accepts the risk of payment reversal/chargeback for improved customer experience\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82](), [pasame las preguntas y sus respuestas a markdown.md:46-53]()\n\n---\n\n## Post-Purchase Service Management\n\n### Viewing Active Services\n\nAfter successful activation, services appear in the customer's expediente with the following information:\n\n- Service name and description\n- Activation date and time\n- Expiration date (for temporary services)\n- Current status (active, pending, failed, cancelled)\n- Cancellation eligibility (based on desistimiento rules)\n- Payment history\n\n### Service Management Dashboard\n\n```mermaid\ngraph TB\n    subgraph \"Expediente View\"\n        DASHBOARD[\"Service Management Dashboard\"]\n        ACTIVE_LIST[\"Active Services List\"]\n        PENDING_LIST[\"Pending Activations\"]\n        HISTORY[\"Service History\"]\n    end\n    \n    subgraph \"Service Actions\"\n        VIEW_DETAILS[\"View Details\"]\n        CANCEL_SERVICE[\"Cancel Service\"]\n        RENEW_SUB[\"Manage Subscription\"]\n        DOWNLOAD_INVOICE[\"Download Invoice\"]\n    end\n    \n    subgraph \"Service Status Display\"\n        STATUS_ACTIVE[\"Active\u003cbr/\u003eOTA Delivered\"]\n        STATUS_PENDING[\"Pending\u003cbr/\u003eOTA in Progress\"]\n        STATUS_FAILED[\"Failed\u003cbr/\u003eTech Support Required\"]\n        STATUS_CANCELLED[\"Cancelled\u003cbr/\u003eRefund Processed\"]\n        STATUS_EXPIRED[\"Expired\u003cbr/\u003eTemporary Service Ended\"]\n    end\n    \n    DASHBOARD --\u003e ACTIVE_LIST\n    DASHBOARD --\u003e PENDING_LIST\n    DASHBOARD --\u003e HISTORY\n    \n    ACTIVE_LIST --\u003e VIEW_DETAILS\n    ACTIVE_LIST --\u003e CANCEL_SERVICE\n    \n    PENDING_LIST --\u003e VIEW_DETAILS\n    \n    ACTIVE_LIST --\u003e STATUS_ACTIVE\n    ACTIVE_LIST --\u003e STATUS_EXPIRED\n    PENDING_LIST --\u003e STATUS_PENDING\n    PENDING_LIST --\u003e STATUS_FAILED\n    HISTORY --\u003e STATUS_CANCELLED\n    \n    RENEW_SUB --\u003e CANCEL_SERVICE\n    DOWNLOAD_INVOICE --\u003e HISTORY\n```\n\n**Sources:** [enunciado.md:11]()\n\n---\n\n## Service Cancellation and Refunds\n\n### Desistimiento (Right of Withdrawal) Rules\n\nSpanish and EU law requires distance selling to provide withdrawal rights. The system implements the following cancellation policies:\n\n| Service Duration | Cancellation Window | Refund Policy |\n|------------------|---------------------|---------------|\n| **\u003e 14 days** | First 14 days only | Full refund if cancelled within 14 days |\n| ** 14 days** | Anytime before expiration | Full refund at any time |\n| **After window** | No refund | Service considered consumed |\n| **Subscriptions** | Anytime | Cancel before next billing cycle |\n\n### Cancellation Workflow\n\n```mermaid\nflowchart TD\n    REQUEST[\"Customer Requests Cancellation\"] --\u003e CHECK_TYPE{\"Service Type\"}\n    \n    CHECK_TYPE --\u003e|\"One-Time Service\"| CHECK_DURATION{\"Service Duration\"}\n    CHECK_TYPE --\u003e|\"Subscription\"| CANCEL_SUB[\"Cancel Recurring Billing\"]\n    \n    CHECK_DURATION --\u003e|\"\u003e 14 days\"| CHECK_TIME{\"Days Since\u003cbr/\u003eActivation?\"}\n    CHECK_DURATION --\u003e|\" 14 days\"| CHECK_CONSUMED{\"Service\u003cbr/\u003eConsumed?\"}\n    \n    CHECK_TIME --\u003e|\" 14 days\"| GRANT_REFUND[\"Grant Full Refund\"]\n    CHECK_TIME --\u003e|\"\u003e 14 days\"| DENY_REFUND[\"Deny Refund\u003cbr/\u003eService Consumed\"]\n    \n    CHECK_CONSUMED --\u003e|\"No\"| GRANT_REFUND\n    CHECK_CONSUMED --\u003e|\"Yes\"| DENY_REFUND\n    \n    GRANT_REFUND --\u003e PROCESS_REFUND[\"Process Refund\u003cbr/\u003evia Payment Gateway\"]\n    GRANT_REFUND --\u003e DEACTIVATE[\"Queue OTA Deactivation\"]\n    \n    CANCEL_SUB --\u003e STOP_BILLING[\"Stop Future Charges\"]\n    CANCEL_SUB --\u003e NO_REFUND_CURRENT[\"Current Month: No Refund\u003cbr/\u003eMes Vencido - Already Consumed\"]\n    \n    PROCESS_REFUND --\u003e UPDATE_EXPEDIENTE[\"Update Expediente Status\"]\n    DEACTIVATE --\u003e UPDATE_EXPEDIENTE\n    DENY_REFUND --\u003e UPDATE_EXPEDIENTE\n    STOP_BILLING --\u003e UPDATE_EXPEDIENTE\n    NO_REFUND_CURRENT --\u003e UPDATE_EXPEDIENTE\n    \n    UPDATE_EXPEDIENTE --\u003e NOTIFY[\"Notify Customer\u003cbr/\u003eCancellation Confirmation\"]\n    \n    NOTIFY --\u003e OPTIONAL_BLACKLIST{\"Blacklist Service?\"}\n    \n    OPTIONAL_BLACKLIST --\u003e|\"Policy Enabled\"| REMOVE_FROM_CATALOG[\"Remove from Customer's\u003cbr/\u003eAvailable Catalog\"]\n    OPTIONAL_BLACKLIST --\u003e|\"Policy Disabled\"| END[\"End Process\"]\n    \n    REMOVE_FROM_CATALOG --\u003e END\n```\n\n**Implementation Notes:**\n\n1. **Configurable Blacklisting** - System can optionally remove cancelled services from future catalog for that customer (reduce returns)\n2. **Partial Consumption** - No pro-rated refunds; refund is all-or-nothing based on time windows\n3. **Subscription Mes Vencido** - Current month never refunded because it's post-paid (service already consumed)\n4. **OTA Deactivation** - If service is refunded, it must be deactivated via OTA\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Special Scenarios\n\n### Vehicle Theft\n\nWhen a vehicle is stolen, service management rules are:\n\n1. **Delivered Services** - No automatic refund; normal desistimiento rules apply\n2. **Pending Services** - Customer can cancel and receive refund\n3. **Active Subscriptions** - Customer can cancel to stop future billing\n4. **Within 14-Day Window** - Can still request desistimiento refund if eligible\n\nThe system does NOT automatically process refunds on theft notification.\n\n### Warranty Loss Due to Maintenance\n\nIf a customer loses warranty by not following the maintenance plan:\n\n1. **Existing Services** - Remain active; customer paid for them\n2. **New Service Purchases** - Maintenance-linked services become unavailable\n3. **No Forced Deactivation** - Already active services are never revoked due to maintenance lapse\n4. **Restoration** - Once maintenance is current, gated services become available again\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:91-96](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Service Activation Notifications\n\nCustomers receive notifications through multiple channels throughout the service acquisition and activation process:\n\n| Event | Channels | Content |\n|-------|----------|---------|\n| **Payment Confirmed** | Email, Mobile Push | Payment receipt, activation queued |\n| **OTA Activation Started** | Mobile Push, Vehicle Display | Activation in progress |\n| **OTA Success** | Email, Mobile Push, Vehicle Display | Service now active |\n| **OTA Failure (Retrying)** | Mobile Push | Temporary activation issue, retrying |\n| **OTA Failed (Final)** | Email, Mobile Push | Technical support contacted, no charge |\n| **Service Expiring** | Email, Mobile Push | Reminder before temporary service expires |\n| **Service Expired** | Email, Mobile Push | Service has ended |\n| **Cancellation Confirmed** | Email | Cancellation processed, refund details |\n| **Subscription Billing** | Email | Monthly invoice for mes vencido billing |\n\n**Sources:** [enunciado.md:19-20](), [pasame las preguntas y sus respuestas a markdown.md:46-53]()\n\n---\n\n## Integration Points\n\nThe service acquisition and management system integrates with multiple external and internal systems:\n\n```mermaid\ngraph LR\n    subgraph \"Service Management Core\"\n        ACQ[\"Service Acquisition Module\"]\n        MGT[\"Service Management Module\"]\n    end\n    \n    subgraph \"Internal Systems\"\n        EXPEDIENTE[\"Expediente System\"]\n        PAYMENT[\"Payment Processor\"]\n        OTA_QUEUE[\"OTA Activation Queue\"]\n        NOTIF[\"Notification Engine\"]\n        CATALOG[\"Service Catalog\"]\n    end\n    \n    subgraph \"External Systems\"\n        VSS[\"VSS System\u003cbr/\u003eMaintenance Records\"]\n        PAY_GW[\"Payment Gateway\"]\n        IOT[\"API IoT\u003cbr/\u003eVehicle Communication\"]\n    end\n    \n    ACQ --\u003e EXPEDIENTE\n    ACQ --\u003e CATALOG\n    ACQ --\u003e VSS\n    ACQ --\u003e PAYMENT\n    \n    PAYMENT --\u003e PAY_GW\n    PAYMENT --\u003e OTA_QUEUE\n    \n    OTA_QUEUE --\u003e IOT\n    \n    MGT --\u003e EXPEDIENTE\n    MGT --\u003e NOTIF\n    MGT --\u003e PAYMENT\n    \n    NOTIF --\u003e |\"Email/Push/SMS\"| CUSTOMER[\"Customer\"]\n```\n\n**Key Integration Patterns:**\n\n- **VSS Integration** - Pull-based query for maintenance status (not push)\n- **Payment Gateway** - Async settlement with immediate service delivery\n- **OTA Queue** - Decoupled activation with retry logic (detailed in [OTA Service Activation](#6.2))\n- **Notification Engine** - Multi-channel redundant delivery\n\n**Sources:** [enunciado.md:18-20](), [pasame las preguntas y sus respuestas a markdown.md:60-73](), [pasame las preguntas and sus respuestas a markdown.md:77-82]()"])</script><script>self.__next_f.push([1,"20:T52ea,"])</script><script>self.__next_f.push([1,"# Customer-Facing Platforms\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the customer-facing digital platforms that enable customers to interact with the CaaS system. It covers the web platform, mobile application, and the expediente de compra (purchase record) system that forms the core of the customer experience.\n\nFor information about the business processes customers perform through these platforms (purchasing vehicles, acquiring services), see [Vehicle Purchase and Delivery Process](#4.1) and [Service Acquisition and Management](#4.2). For technical details on backend integrations, see [Integration Architecture](#3.3).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Platform Overview\n\nThe CaaS system provides two primary customer-facing platforms:\n\n| Platform | Access Method | Primary Use Cases |\n|----------|---------------|-------------------|\n| **Web Platform** | Browser-based via corporate website | Initial registration review, document access, service browsing from desktop |\n| **Mobile Application** | Native smartphone app | Service activation, vehicle status monitoring, direct vehicle control |\n\nBoth platforms provide access to the **expediente de compra** (purchase record), which serves as the single source of truth for all customer-related data, documents, and transaction history.\n\n```mermaid\ngraph TB\n    subgraph \"Customer Access Channels\"\n        CUSTOMER[\"Customer\"]\n        WEB[\"Web Platform\u003cbr/\u003e(Browser)\"]\n        MOBILE[\"Mobile Application\u003cbr/\u003e(Native App)\"]\n    end\n    \n    subgraph \"Core Customer Data\"\n        EXPEDIENTE[\"Expediente de Compra\u003cbr/\u003ePurchase Record\u003cbr/\u003e- Manuals\u003cbr/\u003e- Maintenance History\u003cbr/\u003e- Invoices\u003cbr/\u003e- Service Catalog Access\"]\n    end\n    \n    subgraph \"Backend Services\"\n        CAAS_CORE[\"CaaS Core Services\"]\n        SERVICE_CAT[\"Service Catalog\"]\n        PAYMENT[\"Payment Processing\"]\n        NOTIF[\"Notification Engine\"]\n    end\n    \n    subgraph \"Vehicle Infrastructure\"\n        VEHICLE[\"Customer's Vehicle\"]\n        IOT[\"IoT Network\"]\n    end\n    \n    CUSTOMER --\u003e|\"Accesses via browser\"| WEB\n    CUSTOMER --\u003e|\"Installs and uses\"| MOBILE\n    \n    WEB --\u003e EXPEDIENTE\n    MOBILE --\u003e EXPEDIENTE\n    \n    EXPEDIENTE --\u003e CAAS_CORE\n    CAAS_CORE --\u003e SERVICE_CAT\n    CAAS_CORE --\u003e PAYMENT\n    \n    MOBILE -.-\u003e|\"Direct connection for\u003cbr/\u003eoperational control\"| VEHICLE\n    \n    CAAS_CORE --\u003e IOT\n    IOT --\u003e VEHICLE\n    \n    NOTIF --\u003e|\"Email\"| CUSTOMER\n    NOTIF --\u003e|\"Push notifications\"| MOBILE\n    NOTIF --\u003e|\"Vehicle display\"| VEHICLE\n```\n\n**Diagram: Customer-Facing Platform Architecture**\n\n**Key Architectural Characteristics:**\n\n- **Unified Data Model**: Both platforms access the same expediente de compra\n- **Dual Mobile Paths**: Mobile app communicates with CaaS backend for services AND directly with vehicle for operational control\n- **Multi-Channel Notifications**: Customers receive updates via email, mobile push, and vehicle display\n\n**Sources:** [enunciado.md:10-12](), [enunciado.md:17-20]()\n\n---\n\n## Expediente de Compra (Purchase Record)\n\nThe expediente de compra is the central data structure containing all customer-related information. It is accessible through both the web platform and mobile application.\n\n### Contents\n\nThe expediente de compra includes:\n\n| Component | Description | Update Frequency |\n|-----------|-------------|------------------|\n| **Vehicle Manuals** | Digital copies of vehicle documentation | Static (updated on vehicle delivery) |\n| **Maintenance History** | Complete service record from VSS system | Updated after each workshop visit |\n| **Invoice Archive** | All purchase and service invoices | Updated on each transaction |\n| **Service History** | Record of activated optional services | Real-time (updated on activation/cancellation) |\n| **Manufacturing Status** | Current state during vehicle production | Real-time during manufacturing phase |\n| **Plan Comercial** | Contracted commercial plan details | Static (defined at purchase) |\n\n### Data Flow\n\n```mermaid\ngraph LR\n    subgraph \"Data Sources\"\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Sales Registration)\"]\n        FACTORY_API[\"Factory API\u003cbr/\u003e(Manufacturing Status)\"]\n        VSS[\"VSS System\u003cbr/\u003e(Maintenance Records)\"]\n        PAYMENT_SYS[\"Payment System\u003cbr/\u003e(Invoices)\"]\n        OTA[\"OTA Engine\u003cbr/\u003e(Service Activations)\"]\n    end\n    \n    subgraph \"Expediente de Compra\"\n        CUSTOMER_PROFILE[\"Customer Profile\u003cbr/\u003e\u0026 Credentials\"]\n        VEHICLE_DATA[\"Vehicle Data\u003cbr/\u003e\u0026 Manuals\"]\n        COMMERCIAL_PLAN[\"Plan Comercial\u003cbr/\u003e(Base + Options)\"]\n        TRANSACTION_HIST[\"Transaction History\u003cbr/\u003e\u0026 Invoices\"]\n        SERVICE_HIST[\"Service History\u003cbr/\u003e\u0026 Activations\"]\n        MAINT_HIST[\"Maintenance History\u003cbr/\u003e\u0026 Status\"]\n    end\n    \n    subgraph \"Customer Platforms\"\n        WEB_INTERFACE[\"Web Platform\"]\n        MOBILE_INTERFACE[\"Mobile App\"]\n    end\n    \n    INTRANET --\u003e|\"Initial registration\"| CUSTOMER_PROFILE\n    INTRANET --\u003e|\"Commercial plan\"| COMMERCIAL_PLAN\n    \n    FACTORY_API --\u003e|\"Status updates\"| VEHICLE_DATA\n    VSS --\u003e|\"Query for history\"| MAINT_HIST\n    PAYMENT_SYS --\u003e TRANSACTION_HIST\n    OTA --\u003e SERVICE_HIST\n    \n    CUSTOMER_PROFILE --\u003e WEB_INTERFACE\n    VEHICLE_DATA --\u003e WEB_INTERFACE\n    COMMERCIAL_PLAN --\u003e WEB_INTERFACE\n    TRANSACTION_HIST --\u003e WEB_INTERFACE\n    SERVICE_HIST --\u003e WEB_INTERFACE\n    MAINT_HIST --\u003e WEB_INTERFACE\n    \n    CUSTOMER_PROFILE --\u003e MOBILE_INTERFACE\n    VEHICLE_DATA --\u003e MOBILE_INTERFACE\n    COMMERCIAL_PLAN --\u003e MOBILE_INTERFACE\n    TRANSACTION_HIST --\u003e MOBILE_INTERFACE\n    SERVICE_HIST --\u003e MOBILE_INTERFACE\n    MAINT_HIST --\u003e MOBILE_INTERFACE\n```\n\n**Diagram: Expediente de Compra Data Flow**\n\n**Sources:** [enunciado.md:11-12](), [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n## Web Platform\n\nThe web platform provides browser-based access to the CaaS system. Customers access it via the corporate website using credentials provided by email after vehicle purchase registration.\n\n### Features and Capabilities\n\n```mermaid\ngraph TB\n    subgraph \"Web Platform Features\"\n        LOGIN[\"Login Page\u003cbr/\u003e(Email-based credentials)\"]\n        DASHBOARD[\"Customer Dashboard\"]\n        \n        subgraph \"Expediente Access\"\n            DOCS[\"Document Library\u003cbr/\u003e(Manuals)\"]\n            INVOICES[\"Invoice History\"]\n            MAINT_VIEW[\"Maintenance Records\u003cbr/\u003e(from VSS)\"]\n            STATUS[\"Manufacturing Status\u003cbr/\u003e(during production)\"]\n        end\n        \n        subgraph \"Service Management\"\n            CATALOG[\"Service Catalog\u003cbr/\u003e(Opciones Disponibles)\"]\n            SERVICE_DETAIL[\"Service Detail View\u003cbr/\u003e(Pricing \u0026 Duration)\"]\n            PURCHASE_FLOW[\"Service Purchase Flow\"]\n            PAYMENT_WEB[\"Payment Interface\"]\n        end\n        \n        subgraph \"Account Management\"\n            PROFILE[\"Profile Settings\"]\n            PAYMENT_METHODS[\"Payment Methods\"]\n            NOTIF_PREFS[\"Notification Preferences\"]\n        end\n    end\n    \n    LOGIN --\u003e DASHBOARD\n    DASHBOARD --\u003e DOCS\n    DASHBOARD --\u003e INVOICES\n    DASHBOARD --\u003e MAINT_VIEW\n    DASHBOARD --\u003e STATUS\n    \n    DASHBOARD --\u003e CATALOG\n    CATALOG --\u003e SERVICE_DETAIL\n    SERVICE_DETAIL --\u003e PURCHASE_FLOW\n    PURCHASE_FLOW --\u003e PAYMENT_WEB\n    \n    DASHBOARD --\u003e PROFILE\n    DASHBOARD --\u003e PAYMENT_METHODS\n    DASHBOARD --\u003e NOTIF_PREFS\n```\n\n**Diagram: Web Platform Feature Map**\n\n### User Access Flow\n\n1. **Credential Delivery**: After sales registration at dealership, customer receives email with access credentials [enunciado.md:11]()\n2. **Authentication**: Customer logs in using email address and provided password\n3. **Dashboard Access**: Upon login, customer sees personalized dashboard with expediente data\n4. **Service Browsing**: Customer can browse opciones disponibles (optional services)\n5. **Transaction Execution**: Purchase flow includes service selection, payment, and confirmation\n\n### Technical Characteristics\n\n- **No Self-Registration**: System does not allow public registration. All users must be pre-registered through dealership sales process [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n- **No External SSO**: No integration with Google, Microsoft, or other external identity providers [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n- **Controlled User Base**: All customers are known entities who have purchased vehicles\n\n**Sources:** [enunciado.md:10-12](), [enunciado.md:18-19](), [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n---\n\n## Mobile Application\n\nThe mobile application provides smartphone-based access to CaaS services with enhanced capabilities for vehicle interaction and real-time notifications.\n\n### Dual Communication Paths\n\nThe mobile application has two distinct communication paths:\n\n```mermaid\ngraph TB\n    subgraph \"Mobile Application\"\n        APP[\"Mobile App\"]\n        \n        subgraph \"App Features\"\n            EXPEDIENTE_VIEW[\"Expediente View\"]\n            SERVICE_ACTIVATION[\"Service Activation\"]\n            VEHICLE_STATUS[\"Vehicle Status Monitor\"]\n            DIRECT_CONTROL[\"Direct Vehicle Control\"]\n        end\n    end\n    \n    subgraph \"Communication Paths\"\n        PATH_1[\"Path 1: Backend Services\u003cbr/\u003e(via CaaS API)\"]\n        PATH_2[\"Path 2: Direct Vehicle\u003cbr/\u003e(via Bluetooth/WiFi)\"]\n    end\n    \n    subgraph \"Backend\"\n        CAAS_API[\"CaaS Core API\"]\n        OTA_ENGINE[\"OTA Engine\"]\n        IOT_GATEWAY[\"IoT Gateway\"]\n    end\n    \n    subgraph \"Vehicle\"\n        VEHICLE_SYSTEM[\"Vehicle Systems\"]\n        VEHICLE_DISPLAY[\"Vehicle Display\"]\n    end\n    \n    EXPEDIENTE_VIEW --\u003e PATH_1\n    SERVICE_ACTIVATION --\u003e PATH_1\n    PATH_1 --\u003e CAAS_API\n    CAAS_API --\u003e OTA_ENGINE\n    OTA_ENGINE --\u003e IOT_GATEWAY\n    \n    DIRECT_CONTROL --\u003e PATH_2\n    VEHICLE_STATUS --\u003e PATH_2\n    PATH_2 -.-\u003e|\"Direct link\"| VEHICLE_SYSTEM\n    \n    IOT_GATEWAY --\u003e VEHICLE_SYSTEM\n    VEHICLE_SYSTEM --\u003e VEHICLE_DISPLAY\n```\n\n**Diagram: Mobile App Communication Architecture**\n\n**Path 1 - Backend Services:**\n- Expediente de compra access\n- Service catalog browsing\n- Payment processing\n- Service activation requests\n- Notification reception\n\n**Path 2 - Direct Vehicle Connection:**\n- Real-time vehicle status monitoring\n- Operational control (lock/unlock, climate control, etc.)\n- Local configuration without internet dependency\n\n**Sources:** [enunciado.md:17](), High-Level Architecture Diagram 1\n\n### Vehicle Linking Process\n\nThe mobile application is linked to the customer's vehicle upon delivery:\n\n1. **Vehicle Delivery**: Vehicle is transported to customer address [enunciado.md:17]()\n2. **App Binding**: Mobile application is directly linked to the acquired vehicle [enunciado.md:17]()\n3. **Operational Enablement**: Vehicle functionality is enabled through the app [enunciado.md:17]()\n\n### Service Activation Display\n\nWhen customers purchase optional services, the mobile app provides real-time activation status:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ServicePurchased: \"Customer pays for service\"\n    ServicePurchased --\u003e OTAInProgress: \"OTA activation initiated\"\n    OTAInProgress --\u003e ActivationSuccess: \"OTA successful\"\n    OTAInProgress --\u003e ActivationRetry: \"OTA fails - retry\"\n    ActivationRetry --\u003e OTAInProgress: \"Retry attempt\"\n    ActivationRetry --\u003e ActivationFailed: \"All retries exhausted\"\n    \n    ActivationSuccess --\u003e [*]: \"App shows: Service Active\u003cbr/\u003eVehicle display confirms\"\n    ActivationFailed --\u003e [*]: \"App shows: Activation Failed\u003cbr/\u003eCustomer NOT charged\"\n    \n    note right of ActivationSuccess\n        Customer receives notification:\n        - Mobile app notification\n        - Vehicle display message\n    end note\n    \n    note right of ActivationFailed\n        Customer receives notification:\n        - Mobile app alert\n        - Technical support contact\n        - Refund processed automatically\n    end note\n```\n\n**Diagram: Service Activation Status Flow in Mobile App**\n\nThe mobile application displays activation status received from both:\n- **CaaS backend**: Overall service status and OTA progress\n- **Vehicle information system**: Confirmation of feature activation on vehicle [enunciado.md:19-20]()\n\n**Sources:** [enunciado.md:19-20](), [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Platform Access and Security\n\n### User Provisioning\n\n```mermaid\nsequenceDiagram\n    participant Dealership as \"Dealership Staff\u003cbr/\u003e(Corporate Intranet)\"\n    participant CaaS as \"CaaS System\"\n    participant EmailSvc as \"Email Service\"\n    participant Customer as \"Customer\"\n    participant WebApp as \"Web Platform\"\n    participant MobileApp as \"Mobile App\"\n    \n    Dealership-\u003e\u003eCaaS: \"Register sale\u003cbr/\u003e(customer data + plan comercial)\"\n    CaaS-\u003e\u003eCaaS: \"Generate credentials\u003cbr/\u003e(email + password)\"\n    CaaS-\u003e\u003eEmailSvc: \"Send credentials\"\n    EmailSvc-\u003e\u003eCustomer: \"Email with access credentials\"\n    \n    Customer-\u003e\u003eWebApp: \"Login with credentials\"\n    WebApp-\u003e\u003eCaaS: \"Authenticate\"\n    CaaS--\u003e\u003eWebApp: \"Access granted\"\n    \n    Customer-\u003e\u003eMobileApp: \"Login with same credentials\"\n    MobileApp-\u003e\u003eCaaS: \"Authenticate\"\n    CaaS--\u003e\u003eMobileApp: \"Access granted\"\n```\n\n**Diagram: User Provisioning and Authentication Flow**\n\n### Security Characteristics\n\n| Security Feature | Implementation |\n|------------------|----------------|\n| **User Origin** | All users created through dealership sales registration |\n| **Authentication** | Email + password (no external SSO) |\n| **Authorization** | Role-based: customers see only their own expediente |\n| **Self-Registration** | **Disabled** - no public registration allowed |\n| **External Identity Providers** | **Not supported** - no Google/Microsoft SSO |\n| **User Verification** | Users are known entities who have purchased vehicles |\n\n### Rationale for Closed System\n\nThe CaaS platform is intentionally **not a public system**. All users must be:\n- Known to the organization (customers, employees)\n- Created through controlled processes (sales registration)\n- Associated with specific vehicles or roles\n\nThis design ensures:\n- Customer data privacy\n- Vehicle security\n- Controlled access to premium services\n- Clear audit trails for transactions\n\n**Sources:** [enunciado.md:8-11](), [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n---\n\n## Technical Architecture\n\n### Platform Integration with Backend Services\n\n```mermaid\ngraph TB\n    subgraph \"Customer Platforms\"\n        WEB_CLIENT[\"Web Platform\u003cbr/\u003e(Browser Client)\"]\n        MOBILE_CLIENT[\"Mobile App\u003cbr/\u003e(Native Client)\"]\n    end\n    \n    subgraph \"API Layer\"\n        API_GATEWAY[\"API Gateway\"]\n        AUTH_SERVICE[\"Authentication Service\"]\n    end\n    \n    subgraph \"Business Services\"\n        EXPEDIENTE_SVC[\"Expediente Service\"]\n        ORDER_SVC[\"Order Management Service\"]\n        SERVICE_CATALOG_SVC[\"Service Catalog Service\"]\n        PAYMENT_SVC[\"Payment Processing Service\"]\n        NOTIFICATION_SVC[\"Notification Service\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        FACTORY_INT[\"Factory Integration\"]\n        VSS_INT[\"VSS Integration\"]\n        IOT_INT[\"IoT Gateway\"]\n        PAYMENT_GW[\"Payment Gateway\"]\n    end\n    \n    subgraph \"Data Stores\"\n        CUSTOMER_DB[(\"Customer Database\")]\n        ORDER_DB[(\"Order Database\")]\n        SERVICE_DB[(\"Service Database\")]\n    end\n    \n    WEB_CLIENT --\u003e|\"HTTPS/REST\"| API_GATEWAY\n    MOBILE_CLIENT --\u003e|\"HTTPS/REST\"| API_GATEWAY\n    \n    API_GATEWAY --\u003e AUTH_SERVICE\n    AUTH_SERVICE --\u003e CUSTOMER_DB\n    \n    API_GATEWAY --\u003e EXPEDIENTE_SVC\n    API_GATEWAY --\u003e ORDER_SVC\n    API_GATEWAY --\u003e SERVICE_CATALOG_SVC\n    API_GATEWAY --\u003e PAYMENT_SVC\n    \n    EXPEDIENTE_SVC --\u003e CUSTOMER_DB\n    ORDER_SVC --\u003e ORDER_DB\n    SERVICE_CATALOG_SVC --\u003e SERVICE_DB\n    PAYMENT_SVC --\u003e PAYMENT_GW\n    \n    ORDER_SVC --\u003e FACTORY_INT\n    EXPEDIENTE_SVC --\u003e VSS_INT\n    SERVICE_CATALOG_SVC --\u003e IOT_INT\n    \n    NOTIFICATION_SVC --\u003e WEB_CLIENT\n    NOTIFICATION_SVC --\u003e MOBILE_CLIENT\n    \n    FACTORY_INT -.-\u003e|\"Async status\"| NOTIFICATION_SVC\n    IOT_INT -.-\u003e|\"OTA status\"| NOTIFICATION_SVC\n    PAYMENT_GW -.-\u003e|\"Payment confirmation\"| NOTIFICATION_SVC\n```\n\n**Diagram: Technical Integration Architecture**\n\n### API Communication Patterns\n\nThe customer-facing platforms interact with backend services using the following patterns:\n\n| Operation | Platform | Pattern | Example |\n|-----------|----------|---------|---------|\n| **View Expediente** | Web/Mobile | Synchronous GET | Retrieve customer data, documents, history |\n| **Browse Services** | Web/Mobile | Synchronous GET | Query service catalog with filters |\n| **Purchase Service** | Web/Mobile | Synchronous POST | Submit payment and service request |\n| **Receive Notifications** | Mobile | Push (Async) | Manufacturing status updates |\n| **Query Maintenance** | Web/Mobile | Synchronous GET | Check VSS maintenance status |\n| **Monitor OTA Status** | Mobile | Polling/WebSocket | Real-time activation progress |\n\n**Sources:** High-Level Architecture Diagrams 2 and 4\n\n---\n\n## Notification System\n\nThe CaaS platform employs a multi-channel notification strategy to ensure customers stay informed throughout their journey.\n\n### Notification Channels\n\n```mermaid\ngraph TB\n    subgraph \"Notification Triggers\"\n        FACTORY_STATUS[\"Factory Status Update\"]\n        VEHICLE_READY[\"Vehicle Ready\"]\n        PAYMENT_CONFIRM[\"Payment Confirmed\"]\n        OTA_SUCCESS[\"OTA Activation Success\"]\n        OTA_FAILURE[\"OTA Activation Failure\"]\n        MAINT_DUE[\"Maintenance Due\"]\n    end\n    \n    subgraph \"Notification Engine\"\n        NOTIF_ENGINE[\"Notification Engine\u003cbr/\u003e(Event Processor)\"]\n        ROUTING[\"Channel Router\"]\n    end\n    \n    subgraph \"Delivery Channels\"\n        EMAIL[\"Email Service\"]\n        PUSH[\"Mobile Push Notifications\"]\n        VEHICLE_MSG[\"Vehicle Display Messages\"]\n        SMS[\"SMS Gateway\"]\n    end\n    \n    subgraph \"Customer Touchpoints\"\n        CUSTOMER_EMAIL[\"Customer Email\"]\n        CUSTOMER_MOBILE[\"Customer Mobile App\"]\n        CUSTOMER_VEHICLE[\"Vehicle Information System\"]\n    end\n    \n    FACTORY_STATUS --\u003e NOTIF_ENGINE\n    VEHICLE_READY --\u003e NOTIF_ENGINE\n    PAYMENT_CONFIRM --\u003e NOTIF_ENGINE\n    OTA_SUCCESS --\u003e NOTIF_ENGINE\n    OTA_FAILURE --\u003e NOTIF_ENGINE\n    MAINT_DUE --\u003e NOTIF_ENGINE\n    \n    NOTIF_ENGINE --\u003e ROUTING\n    \n    ROUTING --\u003e EMAIL\n    ROUTING --\u003e PUSH\n    ROUTING --\u003e VEHICLE_MSG\n    ROUTING --\u003e SMS\n    \n    EMAIL --\u003e CUSTOMER_EMAIL\n    PUSH --\u003e CUSTOMER_MOBILE\n    VEHICLE_MSG --\u003e CUSTOMER_VEHICLE\n    SMS --\u003e CUSTOMER_EMAIL\n```\n\n**Diagram: Multi-Channel Notification System**\n\n### Notification Types and Delivery\n\n| Notification Type | Email | Mobile Push | Vehicle Display | SMS |\n|-------------------|-------|-------------|-----------------|-----|\n| **Credentials Sent** |  | - | - | - |\n| **Manufacturing Status** |  |  | - | Optional |\n| **Vehicle Ready** |  |  | - |  |\n| **Payment Confirmation** |  |  | - | - |\n| **Service Activated** |  |  |  | - |\n| **OTA Failure** |  |  | - |  |\n| **Maintenance Due** |  |  |  | Optional |\n\n### Critical Notification Rules\n\n**Manufacturing Status Notifications:**\n- Automatic notifications during vehicle production are part of the value proposition [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n- Status updates sent at key manufacturing milestones\n- Enables customer to plan for vehicle receipt\n\n**OTA Activation Notifications:**\n- **Success Case**: Confirmation sent via app notification and vehicle display [enunciado.md:19-20]()\n- **Failure Case**: Customer notified immediately with technical support escalation [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n- **Critical Rule**: If OTA fails after all retries, customer is notified AND NOT CHARGED [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n**Sources:** [enunciado.md:11](), [enunciado.md:13](), [enunciado.md:19-20](), [pasame las preguntas y sus respuestas a markdown.md:28-29](), [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Platform Responsibilities Summary\n\n### Web Platform Responsibilities\n\n- Initial customer onboarding and credential reception\n- Desktop-friendly expediente browsing\n- Document access (manuals, invoices)\n- Service catalog exploration with detailed information\n- Service purchase and payment processing\n- Account and payment method management\n\n### Mobile Application Responsibilities\n\n- On-the-go expediente access\n- Real-time service activation monitoring\n- Direct vehicle status monitoring and control\n- Push notification reception\n- Vehicle linking and operational enablement\n- Immediate updates on OTA activation status\n\n### Shared Responsibilities\n\nBoth platforms provide:\n- Access to the complete expediente de compra\n- Service catalog browsing and purchasing\n- Payment processing capabilities\n- Transaction history viewing\n- Maintenance record access (queried from VSS)\n- Manufacturing status tracking (during production phase)\n\n**Sources:** [enunciado.md:10-23](), High-Level Architecture Diagrams"])</script><script>self.__next_f.push([1,"21:Tb60b,"])</script><script>self.__next_f.push([1,"# External System Integrations\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document provides comprehensive technical documentation for all external system integrations within the Car as a Service (CaaS) platform. It details the communication patterns, protocols, constraints, and integration requirements for each external system that CaaS depends on to deliver its business functionality.\n\nCaaS operates as a central orchestration platform that integrates with multiple external systems to enable the complete vehicle sales and service lifecycle. This page documents the technical aspects of these integrations, including synchronous and asynchronous communication patterns, error handling strategies, and architectural constraints imposed by existing systems.\n\n**Related Documentation:**\n- For internal CaaS components and subsystems, see [Core Technical Components](#3.2)\n- For overall integration patterns and architecture, see [Integration Architecture](#3.3)\n- For specific business process flows that utilize these integrations, see [Customer Journey](#4)\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Integration Architecture Overview\n\nThe CaaS platform integrates with five primary external systems, each serving a distinct business function. The integration architecture follows a hub-and-spoke pattern with CaaS Core serving as the central integration hub.\n\n### External Systems Integration Map\n\n```mermaid\ngraph TB\n    subgraph \"CaaS_Platform\"\n        CORE[\"CaaS Core Platform\"]\n        INTEGRATION_LAYER[\"Integration Layer\"]\n        CORE --\u003e INTEGRATION_LAYER\n    end\n    \n    subgraph \"External_Systems\"\n        FACTORY[\"Factory System\u003cbr/\u003e(Fbrica)\"]\n        VSS[\"VSS System\u003cbr/\u003e(Vehicle Service System)\"]\n        IOT_NETWORK[\"IoT Network\u003cbr/\u003eAPI IoT\"]\n        PAYMENT[\"Payment Gateway\u003cbr/\u003eCard Processing\"]\n        ADMIN[\"Administrative Bodies\u003cbr/\u003eGovernment Registration\"]\n    end\n    \n    subgraph \"Communication_Patterns\"\n        SYNC[\"Synchronous\u003cbr/\u003eRequest-Response\"]\n        ASYNC[\"Asynchronous\u003cbr/\u003eEvent-Driven\"]\n        BIDIRECT[\"Bidirectional\u003cbr/\u003eCommand \u0026 Status\"]\n    end\n    \n    INTEGRATION_LAYER --\u003e|\"Order Placement\"| FACTORY\n    FACTORY -.-\u003e|\"Status Webhooks\"| INTEGRATION_LAYER\n    \n    INTEGRATION_LAYER --\u003e|\"Maintenance Query\"| VSS\n    \n    INTEGRATION_LAYER --\u003e|\"OTA Commands\"| IOT_NETWORK\n    IOT_NETWORK -.-\u003e|\"Vehicle Status\"| INTEGRATION_LAYER\n    \n    INTEGRATION_LAYER --\u003e|\"Process Payment\"| PAYMENT\n    PAYMENT -.-\u003e|\"Settlement Notification\"| INTEGRATION_LAYER\n    \n    INTEGRATION_LAYER --\u003e|\"Register Vehicle\"| ADMIN\n    \n    FACTORY -.-\u003e SYNC\n    FACTORY -.-\u003e ASYNC\n    VSS -.-\u003e SYNC\n    IOT_NETWORK -.-\u003e BIDIRECT\n    PAYMENT -.-\u003e ASYNC\n    ADMIN -.-\u003e SYNC\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:31-56](), [enunciado.md:13-19]()\n\n---\n\n### Integration Characteristics Summary\n\n| External System | Communication Pattern | Initiator | Existing or New | Critical Constraint |\n|----------------|----------------------|-----------|-----------------|---------------------|\n| **Factory API** | Hybrid: Sync orders, Async status | CaaS (orders), Factory (status) | New - to be developed | Must support both sync and async patterns |\n| **VSS System** | Synchronous query | CaaS | Existing - external | Read-only access, no writes |\n| **API IoT** | Bidirectional | CaaS (commands), Vehicles (status) | Existing - documented, tested | Cannot be modified, must use as-is |\n| **Payment Gateway** | Asynchronous | CaaS | Third-party service | Settlement delay requires risk assumption |\n| **Administrative Bodies** | Synchronous | CaaS | Varies by country | Country-specific implementations |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-56](), [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n---\n\n## Factory Integration\n\n### Purpose\n\nThe Factory Integration enables CaaS to place vehicle orders with the manufacturing facility and receive real-time status updates throughout the production lifecycle. The factory and CaaS are part of the same company, but the factory operates as an independent system with its own APIs.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:33-44](), [enunciado.md:13-14]()\n\n---\n\n### Communication Pattern: Hybrid Synchronous/Asynchronous\n\nThe Factory API implements a hybrid integration pattern that combines both synchronous and asynchronous communication:\n\n1. **Synchronous (CaaS  Factory):** Order placement with immediate confirmation\n2. **Asynchronous (Factory  CaaS):** Manufacturing status notifications via webhooks\n\n```mermaid\nsequenceDiagram\n    participant CONC as \"Concesionario\u003cbr/\u003e(Dealership)\"\n    participant CAAS as \"CaaS Platform\"\n    participant FACTORY_API as \"Factory Order API\"\n    participant FACTORY_SYS as \"Factory Systems\"\n    participant CUSTOMER as \"Customer\"\n\n    Note over CONC,CUSTOMER: Synchronous Order Phase\n    CONC-\u003e\u003eCAAS: \"Register sale + Plan Comercial\"\n    CUSTOMER-\u003e\u003eCAAS: \"Pay reservation signal\"\n    activate CAAS\n    CAAS-\u003e\u003eFACTORY_API: \"POST /orders\u003cbr/\u003e{model, options, customer}\"\n    activate FACTORY_API\n    FACTORY_API-\u003e\u003eFACTORY_SYS: \"Create production order\"\n    FACTORY_SYS--\u003e\u003eFACTORY_API: \"Order confirmed, ID\"\n    FACTORY_API--\u003e\u003eCAAS: \"200 OK\u003cbr/\u003e{orderId, estimatedDate}\"\n    deactivate FACTORY_API\n    CAAS--\u003e\u003eCUSTOMER: \"Order confirmation notification\"\n    deactivate CAAS\n\n    Note over FACTORY_SYS,CUSTOMER: Asynchronous Status Updates\n    loop Manufacturing Progress\n        FACTORY_SYS-\u003e\u003eFACTORY_API: \"Status change detected\"\n        activate FACTORY_API\n        FACTORY_API-\u003e\u003eCAAS: \"POST /webhooks/order-status\u003cbr/\u003e{orderId, status, timestamp}\"\n        activate CAAS\n        CAAS-\u003e\u003eCUSTOMER: \"Notify manufacturing status\"\n        CAAS--\u003e\u003eFACTORY_API: \"200 OK (acknowledged)\"\n        deactivate CAAS\n        deactivate FACTORY_API\n    end\n\n    FACTORY_SYS-\u003e\u003eFACTORY_API: \"Vehicle ready for shipment\"\n    FACTORY_API-\u003e\u003eCAAS: \"POST /webhooks/order-status\u003cbr/\u003e{orderId, status: READY}\"\n    CAAS-\u003e\u003eCUSTOMER: \"Vehicle available notification\"\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44](), [enunciado.md:13-14]()\n\n---\n\n### Factory API Specifications\n\n#### Outbound API: Order Placement (CaaS  Factory)\n\n**Endpoint Pattern:** `POST /orders`\n\n**Request Characteristics:**\n- **Synchronous:** Blocking call, waits for confirmation\n- **Initiated by:** CaaS Platform after reservation payment\n- **Automatic trigger:** Occurs automatically upon reservation signal payment\n\n**Response Data:**\n- Order confirmation ID\n- Estimated delivery date\n- Initial manufacturing status\n\n**Error Handling:**\n- If factory API unavailable: Queue order for retry\n- If order rejected: Notify customer and refund reservation\n- Timeout handling: 30-second timeout with exponential backoff retry\n\n**Sources:** [enunciado.md:13-14](), [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n#### Inbound API: Status Notifications (Factory  CaaS)\n\n**Endpoint Pattern:** `POST /webhooks/order-status` (CaaS must implement)\n\n**Notification Characteristics:**\n- **Asynchronous:** Event-driven, factory-initiated\n- **Delivery guarantee:** At-least-once delivery (must handle idempotency)\n- **Notification triggers:**\n  - Production started\n  - Component assembly milestones\n  - Quality control checkpoints\n  - Vehicle ready for shipment\n  - Shipment initiated\n  - Vehicle arrived at dealership\n\n**Payload Structure:**\n- Order ID\n- Status code and description\n- Timestamp\n- Optional: Estimated completion date updates\n- Optional: Shipment tracking information\n\n**Sources:** [enunciado.md:13-14](), [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n### Manufacturing Status Flow\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ORDER_PLACED: \"Reservation paid,\u003cbr/\u003eAPI call successful\"\n    \n    ORDER_PLACED --\u003e PRODUCTION_SCHEDULED: \"Factory accepts order\"\n    PRODUCTION_SCHEDULED --\u003e PRODUCTION_IN_PROGRESS: \"Manufacturing begins\"\n    \n    PRODUCTION_IN_PROGRESS --\u003e QUALITY_CONTROL: \"Assembly complete\"\n    QUALITY_CONTROL --\u003e READY_FOR_SHIPMENT: \"QC passed\"\n    QUALITY_CONTROL --\u003e PRODUCTION_IN_PROGRESS: \"QC failed, rework\"\n    \n    READY_FOR_SHIPMENT --\u003e IN_TRANSIT: \"Shipped to dealership\"\n    IN_TRANSIT --\u003e ARRIVED_AT_DEALERSHIP: \"Delivered\"\n    \n    ARRIVED_AT_DEALERSHIP --\u003e AWAITING_FINAL_PAYMENT: \"Notify customer\"\n    AWAITING_FINAL_PAYMENT --\u003e REGISTRATION: \"Final payment received\"\n    AWAITING_FINAL_PAYMENT --\u003e RETURNED_TO_STOCK: \"Payment failed\"\n    \n    REGISTRATION --\u003e [*]: \"Vehicle registered,\u003cbr/\u003eready for delivery\"\n    RETURNED_TO_STOCK --\u003e [*]: \"Vehicle unassigned\"\n    \n    note right of ORDER_PLACED: \"Async notification:\u003cbr/\u003eOrder confirmed\"\n    note right of PRODUCTION_IN_PROGRESS: \"Async notifications:\u003cbr/\u003eProgress updates\"\n    note right of READY_FOR_SHIPMENT: \"Async notification:\u003cbr/\u003eReady for pickup\"\n    note right of ARRIVED_AT_DEALERSHIP: \"Async notification:\u003cbr/\u003eVehicle available\"\n```\n\n**Sources:** [enunciado.md:13-17](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n---\n\n### Transport Coordination\n\n**Transport Provider:** Subcontracted external company\n\n**Key Integration Points:**\n1. **Factory embarkation:** Factory records shipment timestamp\n2. **Dealership receipt:** Concesionario confirms vehicle arrival\n3. **Home delivery:** Transport company coordinates with customer\n\n**Important Business Rule:** If customer is unavailable for home delivery, the transport company returns the vehicle to the dealership. The customer must then collect the vehicle in person.\n\n| Event | Notification Recipient | Notification Content |\n|-------|----------------------|---------------------|\n| Vehicle shipped from factory | Customer | Expected arrival date at dealership |\n| Vehicle arrived at dealership | Customer | Vehicle available, request final payment |\n| Final payment received | Transport company | Schedule home delivery |\n| Delivery attempted, customer absent | Customer | Vehicle returned to dealership, pickup required |\n| Delivery successful | Customer | Mobile app linking instructions |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-25](), [enunciado.md:17]()\n\n---\n\n## VSS (Vehicle Service System) Integration\n\n### Purpose\n\nThe VSS (Vehicle Service System) is an external, independent system maintained by the network of official and approved workshops. It stores comprehensive maintenance history for all vehicles, including service dates, types of maintenance performed, and compliance status with official maintenance plans.\n\nCaaS integrates with VSS to query maintenance status when customers attempt to purchase certain optional services that are maintenance-dependent.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n### System Ownership and Boundaries\n\n```mermaid\ngraph LR\n    subgraph \"CaaS_Responsibility\"\n        CAAS[\"CaaS Platform\"]\n        SERVICE_CATALOG[\"Service Catalog\"]\n        PURCHASE_FLOW[\"Purchase Flow\"]\n    end\n    \n    subgraph \"Workshop_Network\"\n        OFFICIAL[\"Talleres Oficiales\u003cbr/\u003e(Official Workshops)\"]\n        APPROVED[\"Talleres Homologados\u003cbr/\u003e(Approved Workshops)\"]\n    end\n    \n    subgraph \"VSS_External_System\"\n        VSS_DB[(\"VSS Database\u003cbr/\u003eMaintenance History\")]\n        VSS_API[\"VSS Query API\"]\n    end\n    \n    subgraph \"Vehicle_Owner\"\n        CUSTOMER[\"Customer\"]\n        VEHICLE[\"Vehicle\"]\n    end\n    \n    CUSTOMER --\u003e|\"Decides when\u003cbr/\u003eto service\"| VEHICLE\n    VEHICLE --\u003e|\"Physical service\"| OFFICIAL\n    VEHICLE --\u003e|\"Physical service\"| APPROVED\n    \n    OFFICIAL --\u003e|\"Record service\"| VSS_DB\n    APPROVED --\u003e|\"Record service\"| VSS_DB\n    \n    VSS_DB --\u003e VSS_API\n    \n    PURCHASE_FLOW --\u003e|\"Query maintenance\u003cbr/\u003estatus\"| VSS_API\n    VSS_API --\u003e|\"Compliance %\u003cbr/\u003eby block\"| PURCHASE_FLOW\n    \n    PURCHASE_FLOW --\u003e SERVICE_CATALOG\n    SERVICE_CATALOG --\u003e|\"Block/Allow\u003cbr/\u003eservice purchase\"| CUSTOMER\n    \n    note[\"Customer controls timing\u003cbr/\u003eCaaS cannot force maintenance\"]\n```\n\n**Critical Constraint:** CaaS has **read-only access** to VSS. CaaS cannot write maintenance records or modify data. All maintenance records originate from workshops.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-65]()\n\n---\n\n### Communication Pattern: Synchronous Query\n\nVSS integration uses a pull-based, synchronous query pattern:\n\n1. Customer attempts to purchase a maintenance-dependent service\n2. CaaS queries VSS API for current maintenance status\n3. VSS returns compliance percentage by functional blocks\n4. CaaS applies business rules to allow/deny purchase\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant WEB as \"Web/Mobile Platform\"\n    participant CAAS as \"CaaS Service Logic\"\n    participant VSS_API as \"VSS API\"\n    participant VSS_DB as \"VSS Database\"\n\n    CUSTOMER-\u003e\u003eWEB: \"Browse service catalog\"\n    WEB-\u003e\u003eCAAS: \"Display opciones disponibles\"\n    CUSTOMER-\u003e\u003eWEB: \"Select service\u003cbr/\u003e(e.g., 50% power increase)\"\n    \n    WEB-\u003e\u003eCAAS: \"Initiate purchase flow\"\n    activate CAAS\n    \n    Note over CAAS: \"Check if service\u003cbr/\u003eis maintenance-dependent\"\n    \n    CAAS-\u003e\u003eVSS_API: \"GET /vehicles/{vin}/maintenance-status\"\n    activate VSS_API\n    VSS_API-\u003e\u003eVSS_DB: \"Query maintenance records\"\n    VSS_DB--\u003e\u003eVSS_API: \"Compliance data by block\"\n    VSS_API--\u003e\u003eCAAS: \"200 OK\u003cbr/\u003e{blocks: [{name, compliance%}]}\"\n    deactivate VSS_API\n    \n    alt \"Maintenance OK\"\n        CAAS--\u003e\u003eWEB: \"Proceed to payment\"\n        WEB-\u003e\u003eCUSTOMER: \"Select duration and pay\"\n    else \"Maintenance Overdue\"\n        CAAS--\u003e\u003eWEB: \"Service blocked\"\n        WEB-\u003e\u003eCUSTOMER: \"Must complete maintenance first\"\n    end\n    deactivate CAAS\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73](), [enunciado.md:22-23]()\n\n---\n\n### Maintenance Compliance Structure\n\nVSS organizes maintenance by **functional blocks** corresponding to vehicle systems:\n\n| Functional Block | Examples | Typical Services Dependent On This Block |\n|-----------------|----------|----------------------------------------|\n| Powertrain | Engine, transmission service | Power increase, performance modes |\n| Suspension \u0026 Steering | Alignment, shock absorbers | Off-road modes, sport handling |\n| Brakes | Brake pad replacement, fluid | Performance braking modes |\n| Electronics | Software updates, diagnostics | ADAS features, autonomous driving |\n| Climate Control | A/C service, refrigerant | Advanced climatization |\n| Drivetrain | Differential, 4WD components | All-wheel drive modes |\n\n**Compliance Calculation:**\n- Each block has a compliance percentage (0-100%)\n- Based on whether scheduled maintenance was completed on time\n- CaaS defines threshold (e.g., \u003e80% compliance required) per service\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:62-64]()\n\n---\n\n### Maintenance-Linked Service Rules\n\n**Business Rules Enforced by CaaS:**\n\n1. **Service Gating:** Some services require maintenance compliance to be purchased\n2. **Warranty Protection:** Insufficient maintenance voids warranty, but CaaS blocks risky service activations\n3. **Safety Priority:** Maintenance requirements ensure vehicle safety before enabling performance features\n4. **No Retroactive Blocking:** Services already paid for and activated cannot be disabled due to missed maintenance\n\n**Important Constraint:** CaaS **cannot force the customer** to complete maintenance. The customer decides when to service the vehicle. CaaS can only:\n- Deny purchase of new maintenance-dependent services\n- Display warnings about warranty status\n- Preserve existing active services\n\n**What CaaS Cannot Do:**\n- Disable the plataforma base\n- Remotely disable the vehicle\n- Deactivate already-purchased services\n- Force the vehicle to a workshop\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-71]()\n\n---\n\n### VSS API Query Pattern\n\n```mermaid\ngraph TD\n    START[\"Customer attempts\u003cbr/\u003eservice purchase\"]\n    \n    START --\u003e CHECK{\"Is service\u003cbr/\u003emaintenance-\u003cbr/\u003edependent?\"}\n    \n    CHECK --\u003e|\"No\"| PROCEED[\"Proceed to payment\"]\n    CHECK --\u003e|\"Yes\"| QUERY[\"Query VSS API\u003cbr/\u003eGET /maintenance-status\"]\n    \n    QUERY --\u003e PARSE[\"Parse compliance %\u003cbr/\u003eby functional block\"]\n    \n    PARSE --\u003e EVALUATE{\"Compliance meets\u003cbr/\u003ethreshold for\u003cbr/\u003ethis service?\"}\n    \n    EVALUATE --\u003e|\"Yes\"| PROCEED\n    EVALUATE --\u003e|\"No\"| BLOCK[\"Block purchase\"]\n    \n    BLOCK --\u003e NOTIFY[\"Display message:\u003cbr/\u003e'Complete maintenance\u003cbr/\u003eto unlock this service'\"]\n    \n    PROCEED --\u003e PAYMENT[\"Process payment\"]\n    PAYMENT --\u003e OTA[\"OTA activation\"]\n    \n    NOTIFY --\u003e END[\"End\"]\n    OTA --\u003e END\n```\n\n**Sources:** [enunciado.md:22-23](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Vehicle Communication (IoT and OTA)\n\n### Purpose\n\nThe vehicle communication system enables CaaS to remotely configure and activate optional services on customer vehicles via Over-The-Air (OTA) updates. This integration is fundamental to the Car as a Service business model, allowing instant service delivery without requiring physical workshop visits.\n\n**Sources:** [enunciado.md:7-8](), [pasame las preguntas y sus respuestas a markdown.md:31-56]()\n\n---\n\n### API IoT: Existing System Constraint\n\n**Critical Constraint:** The **API IoT** is a pre-existing, documented, and tested system that CaaS **must use as-is**. This is a hard architectural constraint.\n\n**API IoT Characteristics:**\n- **Pre-existing:** Already deployed and operational\n- **Documented:** Complete technical documentation available\n- **Tested:** Proven in production environment\n- **Restriction:** Cannot be modified for this project\n- **Integration issues:** Charged to the previous project (not CaaS responsibility)\n- **Prepared for CaaS:** Designed with CaaS use cases in mind but not yet in active use\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:33-38]()\n\n---\n\n### Vehicle Communication Architecture\n\n```mermaid\ngraph TB\n    subgraph \"CaaS_Platform\"\n        PAYMENT[\"Payment Processing\"]\n        OTA_ENGINE[\"OTA Activation Engine\u003cbr/\u003eRetry Logic\"]\n        CONFIG_REPO[\"Service Configuration\u003cbr/\u003eRepository\"]\n        NOTIF[\"Notification Service\"]\n    end\n    \n    subgraph \"API_IoT_Layer\"\n        API_IOT[\"API IoT\u003cbr/\u003e(Existing, Documented)\"]\n        IOT_GATEWAY[\"IoT Gateway\"]\n    end\n    \n    subgraph \"Network_Infrastructure\"\n        IOT_NETWORK[\"IoT Network\u003cbr/\u003eProprietary Protocol\"]\n    end\n    \n    subgraph \"Vehicle_Fleet\"\n        VEHICLE_1[\"Vehicle 1\u003cbr/\u003ePre-installed Firmware\"]\n        VEHICLE_2[\"Vehicle 2\u003cbr/\u003ePre-installed Firmware\"]\n        VEHICLE_N[\"Vehicle N\u003cbr/\u003ePre-installed Firmware\"]\n    end\n    \n    subgraph \"Mobile_Channel\"\n        MOBILE_APP[\"Mobile Application\"]\n    end\n    \n    PAYMENT --\u003e|\"Payment successful\"| OTA_ENGINE\n    OTA_ENGINE --\u003e|\"Retrieve config\u003cbr/\u003eparameters\"| CONFIG_REPO\n    \n    OTA_ENGINE --\u003e|\"POST /ota/activate\u003cbr/\u003e{vin, serviceId, params}\"| API_IOT\n    API_IOT --\u003e IOT_GATEWAY\n    IOT_GATEWAY --\u003e IOT_NETWORK\n    \n    IOT_NETWORK --\u003e|\"Push configuration\"| VEHICLE_1\n    IOT_NETWORK --\u003e|\"Push configuration\"| VEHICLE_2\n    IOT_NETWORK --\u003e|\"Push configuration\"| VEHICLE_N\n    \n    VEHICLE_1 --\u003e|\"Status report\"| IOT_NETWORK\n    VEHICLE_2 --\u003e|\"Status report\"| IOT_NETWORK\n    VEHICLE_N --\u003e|\"Status report\"| IOT_NETWORK\n    \n    IOT_NETWORK --\u003e IOT_GATEWAY\n    IOT_GATEWAY --\u003e API_IOT\n    API_IOT --\u003e|\"Status callback\"| OTA_ENGINE\n    \n    OTA_ENGINE --\u003e NOTIF\n    NOTIF --\u003e|\"Service activated\"| MOBILE_APP\n    \n    MOBILE_APP -.-\u003e|\"Direct link\u003cbr/\u003eOperational control\"| VEHICLE_1\n```\n\n**Sources:** [enunciado.md:7-8](), [pasame las preguntas y sus respuestas a markdown.md:33-38]()\n\n---\n\n### Pre-installed Firmware Model\n\n**Architecture:** All optional services are **pre-installed** in vehicle firmware at manufacturing time. CaaS only activates or deactivates existing functionality.\n\n```mermaid\ngraph LR\n    subgraph \"Vehicle_Manufacturing\"\n        FACTORY[\"Factory\"]\n        FIRMWARE[\"Complete Firmware\u003cbr/\u003eAll Features Included\"]\n    end\n    \n    subgraph \"Default_State\"\n        BASE[\"Plataforma Base\u003cbr/\u003eACTIVE\"]\n        OPTIONAL[\"Optional Services\u003cbr/\u003eINACTIVE\"]\n    end\n    \n    subgraph \"CaaS_Operation\"\n        PURCHASE[\"Customer Purchases\u003cbr/\u003eService\"]\n        OTA[\"OTA Command\"]\n        ACTIVATION[\"Activate Feature Flag\"]\n    end\n    \n    subgraph \"Vehicle_Runtime\"\n        ENABLED[\"Service NOW ACTIVE\u003cbr/\u003eFeature unlocked\"]\n    end\n    \n    FACTORY --\u003e FIRMWARE\n    FIRMWARE --\u003e BASE\n    FIRMWARE --\u003e OPTIONAL\n    \n    PURCHASE --\u003e OTA\n    OTA --\u003e ACTIVATION\n    OPTIONAL --\u003e ACTIVATION\n    ACTIVATION --\u003e ENABLED\n    \n    note1[\"No software download\u003cbr/\u003eNo firmware update\u003cbr/\u003eOnly configuration change\"]\n    ACTIVATION -.-\u003e note1\n```\n\n**Key Implications:**\n- **No software downloads:** Service activation is instantaneous configuration change\n- **No firmware updates:** All code already exists in vehicle\n- **Feature flags:** Services are controlled by configuration parameters/flags\n- **Reversible:** Services can be deactivated by reversing the configuration\n- **Independent updates:** Vehicle software updates (firmware) are separate from CaaS service sales\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:55-56]()\n\n---\n\n### OTA Activation Flow\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant PLATFORM as \"Web/Mobile\"\n    participant PAYMENT as \"Payment Service\"\n    participant OTA as \"OTA Engine\"\n    participant CONFIG as \"Config Repo\"\n    participant API_IOT as \"API IoT\"\n    participant VEHICLE as \"Vehicle\"\n    participant NOTIF as \"Notification Service\"\n\n    CUSTOMER-\u003e\u003ePLATFORM: \"Purchase service + duration\"\n    PLATFORM-\u003e\u003ePAYMENT: \"Process payment\"\n    activate PAYMENT\n    PAYMENT-\u003e\u003ePAYMENT: \"Initiate payment\"\n    PAYMENT--\u003e\u003ePLATFORM: \"Payment initiated (async)\"\n    deactivate PAYMENT\n    \n    Note over PAYMENT,OTA: \"CaaS assumes risk,\u003cbr/\u003edelivers immediately\"\n    \n    activate OTA\n    PLATFORM-\u003e\u003eOTA: \"Trigger activation\"\n    OTA-\u003e\u003eCONFIG: \"GET /services/{serviceId}/config\"\n    CONFIG--\u003e\u003eOTA: \"Configuration parameters\"\n    \n    OTA-\u003e\u003eAPI_IOT: \"POST /ota/activate\u003cbr/\u003e{vin, serviceId, config, duration}\"\n    activate API_IOT\n    API_IOT-\u003e\u003eVEHICLE: \"Push configuration via IoT\"\n    activate VEHICLE\n    VEHICLE-\u003e\u003eVEHICLE: \"Apply configuration\"\n    \n    alt \"Activation Successful\"\n        VEHICLE--\u003e\u003eAPI_IOT: \"Status: ACTIVATED\"\n        API_IOT--\u003e\u003eOTA: \"Callback: Success\"\n        deactivate VEHICLE\n        deactivate API_IOT\n        OTA-\u003e\u003eNOTIF: \"Send success notification\"\n        NOTIF-\u003e\u003eCUSTOMER: \"Email + Push:\u003cbr/\u003eService active\"\n        NOTIF-\u003e\u003eVEHICLE: \"Display in vehicle UI\"\n    else \"Activation Failed\"\n        VEHICLE--\u003e\u003eAPI_IOT: \"Status: FAILED\"\n        API_IOT--\u003e\u003eOTA: \"Callback: Failure\"\n        deactivate VEHICLE\n        deactivate API_IOT\n        OTA-\u003e\u003eOTA: \"Retry logic (see section below)\"\n    end\n    deactivate OTA\n```\n\n**Sources:** [enunciado.md:18-19](), [pasame las preguntas y sus respuestas a markdown.md:46-56]()\n\n---\n\n### OTA Retry Logic and Failure Handling\n\n**Critical Business Rule:** If OTA activation fails after all retries, the customer **must not be charged** for the undelivered service.\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e PAYMENT_SUCCESSFUL: \"Payment initiated\"\n    \n    PAYMENT_SUCCESSFUL --\u003e OTA_QUEUE: \"Queue activation request\"\n    OTA_QUEUE --\u003e OTA_ATTEMPT_1: \"First attempt\"\n    \n    OTA_ATTEMPT_1 --\u003e ACTIVATED: \"Success\"\n    OTA_ATTEMPT_1 --\u003e WAIT_RETRY_1: \"Failure\"\n    \n    WAIT_RETRY_1 --\u003e OTA_ATTEMPT_2: \"Retry delay\u003cbr/\u003e(exponential backoff)\"\n    OTA_ATTEMPT_2 --\u003e ACTIVATED: \"Success\"\n    OTA_ATTEMPT_2 --\u003e WAIT_RETRY_2: \"Failure\"\n    \n    WAIT_RETRY_2 --\u003e OTA_ATTEMPT_3: \"Retry delay\"\n    OTA_ATTEMPT_3 --\u003e ACTIVATED: \"Success\"\n    OTA_ATTEMPT_3 --\u003e WAIT_RETRY_3: \"Failure\"\n    \n    WAIT_RETRY_3 --\u003e OTA_ATTEMPT_N: \"Final retry\"\n    OTA_ATTEMPT_N --\u003e ACTIVATED: \"Success\"\n    OTA_ATTEMPT_N --\u003e ALL_RETRIES_FAILED: \"Final failure\"\n    \n    ALL_RETRIES_FAILED --\u003e GET_VEHICLE_STATUS: \"Query vehicle state\u003cbr/\u003eproactively\"\n    GET_VEHICLE_STATUS --\u003e SEND_TO_TECH_SUPPORT: \"Create support ticket\"\n    \n    SEND_TO_TECH_SUPPORT --\u003e REFUND_CUSTOMER: \"Process refund\"\n    SEND_TO_TECH_SUPPORT --\u003e NOTIFY_CUSTOMER: \"Email + push notification\"\n    \n    REFUND_CUSTOMER --\u003e [*]: \"DO NOT CHARGE\"\n    NOTIFY_CUSTOMER --\u003e [*]: \"Customer informed\"\n    \n    ACTIVATED --\u003e NOTIFY_SUCCESS: \"Send notifications\"\n    NOTIFY_SUCCESS --\u003e [*]: \"Process complete\"\n    \n    note right of REFUND_CUSTOMER: \"Critical: Customer never\u003cbr/\u003epays for undelivered service\"\n```\n\n**Retry Strategy Parameters:**\n- **Number of retries:** Configurable (e.g., 3-5 attempts)\n- **Backoff strategy:** Exponential (e.g., 1min, 5min, 15min, 30min)\n- **Timeout per attempt:** 60 seconds\n- **Vehicle status query:** After final failure, proactively query vehicle state\n- **Technical support escalation:** Create automatic support ticket with vehicle diagnostics\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n### API IoT Interface Specification\n\n#### Activation Command\n\n**Endpoint:** `POST /ota/activate`\n\n**Request Parameters:**\n```\n{\n  \"vin\": \"Vehicle Identification Number\",\n  \"serviceId\": \"Unique service identifier\",\n  \"configuration\": {\n    \"featureFlags\": [\"flag1\", \"flag2\"],\n    \"parameters\": {\n      \"param1\": \"value1\",\n      \"param2\": \"value2\"\n    }\n  },\n  \"duration\": {\n    \"type\": \"TEMPORARY | PERMANENT | SUBSCRIPTION\",\n    \"expiryDate\": \"ISO-8601 timestamp (if temporary)\",\n    \"autoRenewal\": \"boolean (if subscription)\"\n  }\n}\n```\n\n**Response:**\n```\n{\n  \"requestId\": \"Unique activation request ID\",\n  \"status\": \"QUEUED | IN_PROGRESS | COMPLETED | FAILED\",\n  \"timestamp\": \"ISO-8601\"\n}\n```\n\n**Callback Notification (Async):**\n```\nPOST /caas/webhooks/ota-status\n{\n  \"requestId\": \"Original request ID\",\n  \"vin\": \"Vehicle ID\",\n  \"status\": \"ACTIVATED | FAILED\",\n  \"errorCode\": \"Error code if failed\",\n  \"timestamp\": \"Completion timestamp\"\n}\n```\n\n**Sources:** [enunciado.md:18-19](), [pasame las preguntas y sus respuestas a markdown.md:46-56]()\n\n---\n\n#### Vehicle Status Query\n\n**Endpoint:** `GET /vehicles/{vin}/status`\n\n**Purpose:** Proactive status query when OTA activation fails\n\n**Response:**\n```\n{\n  \"vin\": \"Vehicle ID\",\n  \"connectivity\": \"ONLINE | OFFLINE | LIMITED\",\n  \"lastSeen\": \"ISO-8601 timestamp\",\n  \"activeServices\": [\n    {\n      \"serviceId\": \"Service identifier\",\n      \"activationDate\": \"ISO-8601\",\n      \"status\": \"ACTIVE | PENDING | ERROR\"\n    }\n  ],\n  \"diagnostics\": {\n    \"errorCodes\": [\"code1\", \"code2\"],\n    \"firmwareVersion\": \"Version string\",\n    \"networkSignalStrength\": \"0-100\"\n  }\n}\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n### IoT Network Characteristics\n\n**Connectivity Model:**\n- **Unidirectional initially:** Vehicles report position\n- **Bidirectional for CaaS:** API IoT enables command and status\n- **Always-on connectivity:** Vehicles maintain persistent connection to IoT network\n- **Proprietary protocol:** Uses manufacturer's proprietary IoT protocol\n\n**Network Infrastructure:**\n- Owned and operated by manufacturer (same company as CaaS)\n- Global coverage required for international vehicle operations\n- Redundancy and failover for high availability\n- Security: Encrypted communication, authenticated commands\n\n**Sources:** [enunciado.md:7](), [pasame las preguntas y sus respuestas a markdown.md:33-38]()\n\n---\n\n### Mobile Application Direct Vehicle Link\n\n**Dual Communication Paths:**\n\n1. **Through CaaS Platform:** Service purchases, account management, expediente access\n2. **Direct to Vehicle:** Operational control (lock/unlock, climate pre-conditioning, location tracking)\n\n```mermaid\ngraph LR\n    MOBILE[\"Mobile Application\"]\n    \n    MOBILE --\u003e|\"Purchase services\u003cbr/\u003eView history\"| CAAS[\"CaaS Platform\"]\n    MOBILE -.-\u003e|\"Direct link\u003cbr/\u003eOperational commands\"| VEHICLE[\"Vehicle\"]\n    \n    CAAS --\u003e|\"Service activation\"| API_IOT[\"API IoT\"]\n    API_IOT --\u003e VEHICLE\n    \n    note[\"Mobile has two paths:\u003cbr/\u003e1. Through CaaS for services\u003cbr/\u003e2. Direct to vehicle for control\"]\n```\n\n**Direct Link Functions:**\n- Vehicle lock/unlock\n- Climate control pre-conditioning\n- Real-time location tracking\n- Battery status (if electric)\n- Remote horn/lights activation\n- Security alerts\n\nThese functions are **not routed through CaaS** as they require low-latency, real-time interaction.\n\n**Sources:** [enunciado.md:17]()\n\n---\n\n## Payment Gateway Integration\n\n### Purpose\n\nThe Payment Gateway integration enables CaaS to process all financial transactions including vehicle purchase payments (reservation and final) and service payments (one-time and subscription). The integration follows an asynchronous settlement pattern where CaaS assumes financial risk to optimize customer experience.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:75-83]()\n\n---\n\n### Payment Types\n\n| Payment Type | Timing | Amount | Purpose | Settlement Pattern |\n|-------------|--------|--------|---------|-------------------|\n| **Reservation Signal** | At vehicle purchase | Partial (seal) | Reserve production slot | Synchronous confirmation |\n| **Final Payment** | Vehicle ready | Remaining balance | Complete purchase, enable registration | Synchronous, blocking |\n| **Service Payment (One-time)** | At service purchase | Full service price | Activate temporary/permanent service | Async, deliver immediately |\n| **Subscription Billing** | Month end | Usage-based | Charge for consumed month | Async, post-paid (mes vencido) |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82](), [enunciado.md:13-19]()\n\n---\n\n### Asynchronous Settlement and Risk Assumption\n\n**Business Decision:** CaaS delivers services **immediately** upon payment initiation, before bank settlement confirmation, to optimize customer experience.\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant CAAS as \"CaaS Platform\"\n    participant PAYMENT_GW as \"Payment Gateway\"\n    participant BANK as \"Bank\"\n    participant OTA as \"OTA Engine\"\n\n    CUSTOMER-\u003e\u003eCAAS: \"Purchase service\"\n    CAAS-\u003e\u003ePAYMENT_GW: \"Initiate payment\"\n    activate PAYMENT_GW\n    PAYMENT_GW-\u003e\u003eBANK: \"Authorize transaction\"\n    BANK--\u003e\u003ePAYMENT_GW: \"Authorization OK\"\n    PAYMENT_GW--\u003e\u003eCAAS: \"Payment initiated\"\n    deactivate PAYMENT_GW\n    \n    Note over CAAS,OTA: \"CaaS assumes risk,\u003cbr/\u003edelivers immediately\"\n    \n    CAAS-\u003e\u003eOTA: \"Activate service NOW\"\n    OTA-\u003e\u003eCUSTOMER: \"Service delivered\"\n    \n    Note over PAYMENT_GW,BANK: \"Settlement delay\u003cbr/\u003e(hours to days)\"\n    \n    PAYMENT_GW-\u003e\u003eBANK: \"Settlement request\"\n    activate BANK\n    BANK-\u003e\u003eBANK: \"Process settlement\"\n    \n    alt \"Settlement Successful\"\n        BANK--\u003e\u003ePAYMENT_GW: \"Funds transferred\"\n        deactivate BANK\n        PAYMENT_GW-\u003e\u003eCAAS: \"Webhook: Settlement confirmed\"\n        CAAS-\u003e\u003eCAAS: \"Mark payment complete\"\n    else \"Settlement Failed\"\n        BANK--\u003e\u003ePAYMENT_GW: \"Settlement failed\"\n        deactivate BANK\n        PAYMENT_GW-\u003e\u003eCAAS: \"Webhook: Settlement failed\"\n        CAAS-\u003e\u003eCAAS: \"Handle failed settlement\"\n        Note over CAAS: \"Service already delivered\u003cbr/\u003eCollection process required\"\n    end\n```\n\n**Risk Implications:**\n- **Chargebacks:** Customer may dispute transaction after service delivered\n- **Insufficient funds:** Payment authorization may succeed but settlement fails\n- **Card expiry:** Subscription renewals may fail if card expired\n- **Collection required:** Need processes for recovering failed settlements\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n### Final Payment: Synchronous and Blocking\n\n**Exception to Async Pattern:** The final vehicle payment is synchronous and blocks vehicle registration.\n\n```mermaid\ngraph TD\n    VEHICLE_READY[\"Vehicle arrives\u003cbr/\u003eat dealership\"]\n    NOTIFY[\"Notify customer:\u003cbr/\u003eVehicle available\"]\n    FINAL_PAY[\"Customer initiates\u003cbr/\u003efinal payment\"]\n    \n    VEHICLE_READY --\u003e NOTIFY\n    NOTIFY --\u003e FINAL_PAY\n    \n    FINAL_PAY --\u003e PAYMENT_GW[\"Payment Gateway\"]\n    PAYMENT_GW --\u003e SUCCESS{\"Payment\u003cbr/\u003esuccessful?\"}\n    \n    SUCCESS --\u003e|\"Yes\"| REGISTER[\"Register vehicle\u003cbr/\u003ewith admin bodies\"]\n    SUCCESS --\u003e|\"No\"| UNASSIGN[\"Mark vehicle\u003cbr/\u003e'Sin Asignar'\"]\n    \n    REGISTER --\u003e SCHEDULE_DELIVERY[\"Schedule home delivery\"]\n    UNASSIGN --\u003e STOCK[\"Vehicle becomes stock\"]\n    \n    STOCK --\u003e IMMEDIATE_SALE[\"Available for\u003cbr/\u003eimmediate sale\"]\n    \n    note1[\"Critical: Customer LOSES\u003cbr/\u003ereservation if payment fails\"]\n    UNASSIGN -.-\u003e note1\n```\n\n**Business Rule:** If final payment fails, the customer **loses the vehicle reservation entirely**. The vehicle is immediately marked as unassigned and becomes available stock for sale.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n---\n\n### Subscription Billing: Mes Vencido (Post-Paid)\n\n**Billing Model:** Subscriptions are charged at **month end** for services consumed during that month (post-paid).\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e SUBSCRIPTION_ACTIVE: \"Customer subscribes\"\n    \n    SUBSCRIPTION_ACTIVE --\u003e MONTH_1: \"Month 1 begins\"\n    MONTH_1 --\u003e CUSTOMER_USES: \"Customer uses service\"\n    CUSTOMER_USES --\u003e MONTH_1_END: \"Month 1 ends\"\n    \n    MONTH_1_END --\u003e BILLING_PROCESS: \"Generate invoice\"\n    BILLING_PROCESS --\u003e CHARGE_ATTEMPT: \"Charge payment method\"\n    \n    CHARGE_ATTEMPT --\u003e PAYMENT_SUCCESS: \"Payment OK\"\n    CHARGE_ATTEMPT --\u003e PAYMENT_FAILED: \"Payment failed\"\n    \n    PAYMENT_SUCCESS --\u003e SUBSCRIPTION_ACTIVE: \"Continue to month 2\"\n    \n    PAYMENT_FAILED --\u003e RETRY_BILLING: \"Retry (3 attempts)\"\n    RETRY_BILLING --\u003e PAYMENT_SUCCESS: \"Retry successful\"\n    RETRY_BILLING --\u003e SUBSCRIPTION_CANCELLED: \"All retries failed\"\n    \n    SUBSCRIPTION_ACTIVE --\u003e CUSTOMER_CANCELS: \"Customer cancels\"\n    CUSTOMER_CANCELS --\u003e FINAL_BILLING: \"Charge for partial month\"\n    FINAL_BILLING --\u003e [*]: \"Subscription ended\"\n    \n    SUBSCRIPTION_CANCELLED --\u003e COLLECTION_PROCESS: \"Outstanding balance\"\n    COLLECTION_PROCESS --\u003e [*]: \"Account settled\"\n```\n\n**Billing Cycle:**\n1. **Activation:** Subscription starts immediately upon purchase\n2. **Usage period:** Customer uses service throughout the month\n3. **Month end:** System generates invoice for consumed services\n4. **Charging:** Attempt to charge stored payment method\n5. **Retry logic:** Up to 3 attempts with exponential backoff\n6. **Cancellation:** If payment fails after retries, cancel subscription\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n---\n\n### Payment Gateway API Patterns\n\n#### Payment Initiation\n\n**Endpoint:** `POST /payments/initiate`\n\n**Request:**\n```\n{\n  \"paymentType\": \"RESERVATION | FINAL | SERVICE | SUBSCRIPTION\",\n  \"amount\": {\n    \"value\": \"Decimal amount\",\n    \"currency\": \"EUR | USD | GBP\"\n  },\n  \"paymentMethod\": {\n    \"type\": \"CARD | BANK_TRANSFER\",\n    \"token\": \"Stored payment method token\"\n  },\n  \"metadata\": {\n    \"customerId\": \"Customer identifier\",\n    \"orderId\": \"Associated order/service ID\",\n    \"description\": \"Human-readable description\"\n  }\n}\n```\n\n**Response:**\n```\n{\n  \"paymentId\": \"Unique payment ID\",\n  \"status\": \"INITIATED | AUTHORIZED | PROCESSING\",\n  \"timestamp\": \"ISO-8601\"\n}\n```\n\n---\n\n#### Settlement Notification (Webhook)\n\n**Endpoint:** `POST /caas/webhooks/payment-settlement` (CaaS implements)\n\n**Payload:**\n```\n{\n  \"paymentId\": \"Original payment ID\",\n  \"status\": \"SETTLED | FAILED\",\n  \"settlementAmount\": \"Actual settled amount\",\n  \"settlementDate\": \"ISO-8601 timestamp\",\n  \"failureReason\": \"Reason if failed\",\n  \"metadata\": {\n    \"bankTransactionId\": \"Bank reference\",\n    \"fees\": \"Processing fees deducted\"\n  }\n}\n```\n\n**CaaS Response:** `200 OK` (acknowledged)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n### Refund Processing\n\n**Refund Scenarios:**\n1. **Desistimiento (Right of Withdrawal):** Customer cancels within legal window\n2. **OTA Activation Failure:** Service could not be delivered\n3. **Final Payment Failure Reversal:** Edge case for reservation signal refund\n\n```mermaid\ngraph TD\n    REFUND_REQUEST[\"Refund requested\"]\n    \n    REFUND_REQUEST --\u003e CHECK_TYPE{\"Refund\u003cbr/\u003ereason?\"}\n    \n    CHECK_TYPE --\u003e|\"Desistimiento\"| CHECK_WINDOW{\"Within\u003cbr/\u003e14 days?\"}\n    CHECK_TYPE --\u003e|\"OTA failure\"| AUTOMATIC_REFUND[\"Automatic full refund\"]\n    CHECK_TYPE --\u003e|\"Payment reversal\"| ADMIN_REVIEW[\"Admin review required\"]\n    \n    CHECK_WINDOW --\u003e|\"Yes\"| FULL_REFUND[\"Full refund\"]\n    CHECK_WINDOW --\u003e|\"No\"| NO_REFUND[\"No refund\u003cbr/\u003eService consumed\"]\n    \n    AUTOMATIC_REFUND --\u003e PAYMENT_GW[\"Payment Gateway\u003cbr/\u003eProcess refund\"]\n    FULL_REFUND --\u003e PAYMENT_GW\n    \n    PAYMENT_GW --\u003e NOTIFY[\"Notify customer\"]\n    NO_REFUND --\u003e NOTIFY\n    ADMIN_REVIEW --\u003e MANUAL_PROCESS[\"Manual processing\"]\n```\n\n**Refund API:** `POST /payments/{paymentId}/refund`\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Administrative Registration Integration\n\n### Purpose\n\nThe Administrative Registration Integration enables CaaS to register vehicles with government administrative bodies in each country where CaaS operates. This is a legally required step before vehicle delivery and occurs after the final payment is completed.\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n### Country-Specific Implementations\n\n**Key Characteristic:** Registration requirements vary significantly by country, requiring country-specific integration implementations.\n\n| Country | Administrative Body | Integration Method | Required Documents | Processing Time |\n|---------|-------------------|-------------------|-------------------|-----------------|\n| **Spain** | Direccin General de Trfico (DGT) | API synchronous | Purchase contract, technical specs | 2-5 business days |\n| **France** | Agence Nationale des Titres Scuriss (ANTS) | API synchronous | Certificat de conformit, proof of purchase | 3-7 business days |\n| **Germany** | Kraftfahrt-Bundesamt (KBA) | Semi-automated | Fahrzeugbrief, insurance proof | 1-3 business days |\n| **UK** | Driver and Vehicle Licensing Agency (DVLA) | API asynchronous | V5C application, insurance | 5-10 business days |\n| **Other EU** | Various national authorities | Mixed (API or manual) | Country-specific | Varies |\n\n**Note:** The table above is illustrative. Actual country implementations require detailed analysis of each jurisdiction's requirements.\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n### Registration Workflow\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant CAAS as \"CaaS Platform\"\n    participant PAYMENT as \"Payment Service\"\n    participant REGISTRATION as \"Registration Module\"\n    participant ADMIN_API as \"Admin Body API\"\n    participant GOVT as \"Government System\"\n\n    Note over CUSTOMER,GOVT: Vehicle arrives at dealership\n    \n    CUSTOMER-\u003e\u003eCAAS: \"Complete final payment\"\n    CAAS-\u003e\u003ePAYMENT: \"Process payment\"\n    activate PAYMENT\n    PAYMENT--\u003e\u003eCAAS: \"Payment successful\"\n    deactivate PAYMENT\n    \n    CAAS-\u003e\u003eREGISTRATION: \"Initiate registration\"\n    activate REGISTRATION\n    \n    REGISTRATION-\u003e\u003eREGISTRATION: \"Prepare documents\u003cbr/\u003eper country\"\n    REGISTRATION-\u003e\u003eREGISTRATION: \"Validate customer data\"\n    \n    REGISTRATION-\u003e\u003eADMIN_API: \"Submit registration\u003cbr/\u003e{vin, owner, address}\"\n    activate ADMIN_API\n    ADMIN_API-\u003e\u003eGOVT: \"Process registration\"\n    activate GOVT\n    \n    alt \"Registration Successful\"\n        GOVT--\u003e\u003eADMIN_API: \"Registration confirmed\u003cbr/\u003eLicense plate assigned\"\n        deactivate GOVT\n        ADMIN_API--\u003e\u003eREGISTRATION: \"200 OK\u003cbr/\u003e{plateNumber, registrationDate}\"\n        deactivate ADMIN_API\n        REGISTRATION-\u003e\u003eCAAS: \"Registration complete\"\n        deactivate REGISTRATION\n        CAAS-\u003e\u003eCUSTOMER: \"Vehicle registered\u003cbr/\u003eReady for delivery\"\n    else \"Registration Failed\"\n        GOVT--\u003e\u003eADMIN_API: \"Registration rejected\u003cbr/\u003eReason\"\n        deactivate GOVT\n        ADMIN_API--\u003e\u003eREGISTRATION: \"400/500 Error\"\n        deactivate ADMIN_API\n        REGISTRATION-\u003e\u003eCAAS: \"Registration failed\"\n        deactivate REGISTRATION\n        CAAS-\u003e\u003eCUSTOMER: \"Issue with registration\u003cbr/\u003eDealership will contact\"\n    end\n```\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n### Registration Data Requirements\n\n**Common Data Elements Across Countries:**\n\n```\n{\n  \"vehicle\": {\n    \"vin\": \"17-character VIN\",\n    \"make\": \"Manufacturer name\",\n    \"model\": \"Model designation\",\n    \"year\": \"Manufacturing year\",\n    \"engineType\": \"PETROL | DIESEL | ELECTRIC | HYBRID\",\n    \"emissions\": \"CO2 g/km\",\n    \"power\": \"kW and HP\",\n    \"weight\": \"kg\",\n    \"color\": \"Exterior color\"\n  },\n  \"owner\": {\n    \"type\": \"INDIVIDUAL | COMPANY\",\n    \"name\": \"Full legal name\",\n    \"taxId\": \"Tax identification number\",\n    \"address\": {\n      \"street\": \"Street address\",\n      \"city\": \"City\",\n      \"postalCode\": \"Postal/ZIP code\",\n      \"country\": \"Country code\"\n    },\n    \"dateOfBirth\": \"If individual\",\n    \"driverLicense\": \"License number (if required)\"\n  },\n  \"purchase\": {\n    \"date\": \"Purchase date\",\n    \"price\": \"Purchase price\",\n    \"dealership\": \"Dealership identifier\",\n    \"invoice\": \"Invoice reference\"\n  },\n  \"insurance\": {\n    \"provider\": \"Insurance company\",\n    \"policyNumber\": \"Policy reference\",\n    \"validFrom\": \"Coverage start date\"\n  }\n}\n```\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n### Registration Status Tracking\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e PENDING_PAYMENT: \"Vehicle ready\"\n    \n    PENDING_PAYMENT --\u003e PAYMENT_RECEIVED: \"Final payment complete\"\n    PAYMENT_RECEIVED --\u003e REGISTRATION_INITIATED: \"Submit to admin body\"\n    \n    REGISTRATION_INITIATED --\u003e UNDER_REVIEW: \"Government processing\"\n    \n    UNDER_REVIEW --\u003e APPROVED: \"Registration approved\"\n    UNDER_REVIEW --\u003e ADDITIONAL_INFO_REQUIRED: \"More info needed\"\n    UNDER_REVIEW --\u003e REJECTED: \"Registration denied\"\n    \n    ADDITIONAL_INFO_REQUIRED --\u003e UNDER_REVIEW: \"Info provided\"\n    \n    APPROVED --\u003e PLATE_ASSIGNED: \"License plate issued\"\n    PLATE_ASSIGNED --\u003e READY_FOR_DELIVERY: \"Update vehicle records\"\n    \n    READY_FOR_DELIVERY --\u003e [*]: \"Schedule transport\"\n    \n    REJECTED --\u003e RESOLVE_ISSUE: \"Contact customer\"\n    RESOLVE_ISSUE --\u003e REGISTRATION_INITIATED: \"Retry with corrections\"\n    RESOLVE_ISSUE --\u003e REFUND_PROCESS: \"Cannot resolve\"\n    \n    REFUND_PROCESS --\u003e [*]: \"Cancel sale\"\n```\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n### Error Handling and Fallback\n\n**Common Registration Issues:**\n\n1. **Missing Documents:** Customer hasn't provided required documentation\n2. **Invalid Data:** Data validation failure (e.g., incorrect tax ID format)\n3. **System Unavailability:** Government API temporarily down\n4. **Policy Changes:** New regulations require additional information\n\n**Fallback Strategy:**\n- **Automated retry:** For transient system errors, retry up to 3 times\n- **Manual intervention:** For validation errors, escalate to dealership staff\n- **Alternative process:** If API unavailable, prepare documents for manual submission\n- **Customer notification:** Keep customer informed of status and requirements\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n## Integration Summary and Cross-System Dependencies\n\n### Integration Dependency Matrix\n\n| CaaS Function | Factory | VSS | API IoT | Payment Gateway | Admin Bodies |\n|--------------|---------|-----|---------|----------------|--------------|\n| **Order Vehicle** | Required (sync) | - | - | Required (reservation) | - |\n| **Track Manufacturing** | Required (async) | - | - | - | - |\n| **Complete Purchase** | - | - | - | Required (final pay) | Required |\n| **Purchase Service** | - | Optional (if maint-dependent) | - | Required | - |\n| **Activate Service** | - | - | Required | - | - |\n| **Subscription Billing** | - | - | - | Required (mes vencido) | - |\n| **Maintenance Check** | - | Required | - | - | - |\n| **Delivery Tracking** | Partial (shipment) | - | - | - | - |\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n### Integration Failure Impact Analysis\n\n```mermaid\ngraph TD\n    subgraph \"Critical_Path_Failures\"\n        FACTORY_DOWN[\"Factory API Down\"]\n        API_IOT_DOWN[\"API IoT Down\"]\n        PAYMENT_DOWN[\"Payment Gateway Down\"]\n        ADMIN_DOWN[\"Admin API Down\"]\n    end\n    \n    subgraph \"Non_Critical_Failures\"\n        VSS_DOWN[\"VSS API Down\"]\n    end\n    \n    FACTORY_DOWN --\u003e|\"Cannot place orders\"| BLOCK_SALES[\"Block new vehicle sales\"]\n    API_IOT_DOWN --\u003e|\"Cannot activate\"| QUEUE_OTA[\"Queue OTA requests\u003cbr/\u003eRetry later\"]\n    PAYMENT_DOWN --\u003e|\"Cannot charge\"| DEFER_PAYMENT[\"Defer payment\u003cbr/\u003eManual fallback\"]\n    ADMIN_DOWN --\u003e|\"Cannot register\"| MANUAL_REG[\"Manual registration\u003cbr/\u003eprocess\"]\n    \n    VSS_DOWN --\u003e|\"Cannot check maint\"| ALLOW_SERVICE[\"Allow service purchase\u003cbr/\u003eSkip maintenance check\"]\n    \n    BLOCK_SALES --\u003e NOTIFY_DEALERS[\"Notify dealerships\u003cbr/\u003eSuspend sales\"]\n    QUEUE_OTA --\u003e NOTIFY_CUSTOMER[\"Notify customer:\u003cbr/\u003eDelayed activation\"]\n    DEFER_PAYMENT --\u003e NOTIFY_CUSTOMER\n    MANUAL_REG --\u003e NOTIFY_DEALER_STAFF[\"Alert dealership staff\"]\n    ALLOW_SERVICE --\u003e LOG_RISK[\"Log risk decision\"]\n    \n    style FACTORY_DOWN fill:#ffcccc\n    style API_IOT_DOWN fill:#ffcccc\n    style PAYMENT_DOWN fill:#ffcccc\n    style ADMIN_DOWN fill:#ffcccc\n    style VSS_DOWN fill:#ffffcc\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n### System Availability Requirements\n\n| External System | Required Uptime | Acceptable Downtime | Fallback Strategy |\n|----------------|----------------|-------------------|------------------|\n| **Factory API** | 99.5% | Max 4 hours/month | Queue orders, manual phone orders |\n| **API IoT** | 99.9% | Max 43 minutes/month | Queue OTA, retry automatically |\n| **Payment Gateway** | 99.95% | Max 22 minutes/month | Manual payment processing |\n| **VSS API** | 95% | Flexible | Allow purchases without check, log exception |\n| **Admin Bodies** | Varies by country | Dependent on govt systems | Manual submission process |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\nThis completes the External System Integrations documentation. Each integration has been detailed with its communication patterns, constraints, error handling, and business impact, providing a comprehensive technical reference for developers and architects working with the CaaS platform."])</script><script>self.__next_f.push([1,"22:T7157,"])</script><script>self.__next_f.push([1,"# Factory Integration\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the integration between the CaaS platform and the Factory (manufacturing facility) systems. The Factory Integration enables order placement, manufacturing tracking, and delivery coordination for vehicles purchased through the CaaS platform.\n\nThis integration implements a **hybrid communication pattern**: synchronous order placement initiated by CaaS, and asynchronous status notifications sent by the Factory. This page covers the technical architecture, API contracts, data flows, and error handling specific to factory communication.\n\nFor information about vehicle delivery after manufacturing, see [Manufacturing and Delivery Workflow](#8.2). For administrative registration of manufactured vehicles, see [Administrative Registration Integration](#5.5). For the overall sales process that triggers factory orders, see [Sales and Order Management](#8.1).\n\n**Sources:** [enunciado.md:13](), [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n## Integration Architecture\n\nThe Factory Integration uses a **hybrid synchronous-asynchronous pattern** that separates concerns between order control and manufacturing progress tracking:\n\n- **Order Placement (CaaS  Factory):** Synchronous, request-response API. CaaS initiates order creation with immediate confirmation.\n- **Status Notifications (Factory  CaaS):** Asynchronous, event-driven webhooks. Factory pushes manufacturing status updates as they occur.\n\nThis architectural pattern provides CaaS with transactional control over order placement while allowing the Factory to manage its manufacturing timeline independently. The asynchronous status updates enable non-blocking progress tracking without requiring CaaS to poll the Factory systems.\n\n```mermaid\ngraph LR\n    subgraph \"CaaS Platform\"\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Dealership Interface)\"]\n        ORDER_MGT[\"Order Management\u003cbr/\u003eSubsystem\"]\n        NOTIF_ENGINE[\"Notification Engine\"]\n        CUSTOMER_DB[(\"Customer Database\")]\n    end\n    \n    subgraph \"Factory Integration Layer\"\n        FACTORY_CLIENT[\"Factory API Client\u003cbr/\u003e(Synchronous)\"]\n        WEBHOOK_HANDLER[\"Webhook Handler\u003cbr/\u003e(Asynchronous)\"]\n    end\n    \n    subgraph \"Factory Systems\"\n        FACTORY_API[\"Factory Order API\u003cbr/\u003e/orders endpoint\"]\n        MFG_SYSTEM[\"Manufacturing\u003cbr/\u003eExecution System\"]\n        WEBHOOK_SENDER[\"Status Event Publisher\"]\n    end\n    \n    INTRANET --\u003e|\"1. Register Sale\"| ORDER_MGT\n    ORDER_MGT --\u003e|\"2. Create Order\"| FACTORY_CLIENT\n    FACTORY_CLIENT --\u003e|\"POST /orders\u003cbr/\u003e(sync)\"| FACTORY_API\n    FACTORY_API --\u003e|\"Order Confirmation\"| FACTORY_CLIENT\n    FACTORY_CLIENT --\u003e|\"3. Order ID\"| ORDER_MGT\n    ORDER_MGT --\u003e|\"4. Store Order\"| CUSTOMER_DB\n    \n    FACTORY_API --\u003e|\"Queue Order\"| MFG_SYSTEM\n    MFG_SYSTEM --\u003e|\"Status Changes\"| WEBHOOK_SENDER\n    WEBHOOK_SENDER --\u003e|\"POST /webhooks/factory/status\u003cbr/\u003e(async)\"| WEBHOOK_HANDLER\n    WEBHOOK_HANDLER --\u003e|\"5. Update Status\"| ORDER_MGT\n    ORDER_MGT --\u003e|\"6. Trigger Notification\"| NOTIF_ENGINE\n```\n\n**Diagram: Factory Integration Architecture and Data Flow**\n\n**Key Architectural Characteristics:**\n\n| Aspect | Order Placement | Status Notifications |\n|--------|----------------|---------------------|\n| **Initiator** | CaaS Platform | Factory Systems |\n| **Pattern** | Synchronous (Request-Response) | Asynchronous (Event-Driven) |\n| **Transport** | HTTP REST API | Webhooks (HTTP POST) |\n| **Timing** | Immediate (blocking) | Variable (as events occur) |\n| **Error Handling** | Retry with backoff | Webhook retry + reconciliation |\n| **Data Direction** | CaaS  Factory | Factory  CaaS |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44](), [enunciado.md:13]()\n\n---\n\n## Order Placement (Synchronous)\n\n### Order Creation Workflow\n\nWhen a dealership employee registers a vehicle sale and the customer pays the reservation deposit, CaaS automatically initiates an order with the Factory through a synchronous API call. This occurs without manual intervention to ensure immediate manufacturing queue placement.\n\n```mermaid\nsequenceDiagram\n    participant D as Dealership Employee\u003cbr/\u003e(Corporate Intranet)\n    participant OM as Order Management\u003cbr/\u003eSubsystem\n    participant FC as Factory API Client\n    participant FA as Factory Order API\n    participant MES as Manufacturing\u003cbr/\u003eExecution System\n    \n    D-\u003e\u003eOM: Register Sale\u003cbr/\u003e(Customer + Vehicle Config)\n    OM-\u003e\u003eOM: Validate Customer Data\n    OM-\u003e\u003eOM: Validate Plan Comercial\n    \n    Note over D,OM: Customer Pays Reservation Signal\n    \n    D-\u003e\u003eOM: Confirm Reservation Payment\n    OM-\u003e\u003eFC: Create Factory Order Request\n    \n    FC-\u003e\u003eFA: POST /orders\u003cbr/\u003e{customer, vehicle_spec, plan_comercial}\n    \n    alt Order Accepted\n        FA-\u003e\u003eFA: Validate Order\n        FA-\u003e\u003eFA: Generate Order ID\n        FA-\u003e\u003eMES: Queue Manufacturing Job\n        FA--\u003e\u003eFC: 201 Created\u003cbr/\u003e{order_id, estimated_date}\n        FC--\u003e\u003eOM: Order Confirmation\n        OM-\u003e\u003eOM: Store Order ID + Status=\"ORDERED\"\n        OM--\u003e\u003eD: Order Placed Successfully\n    else Order Rejected\n        FA--\u003e\u003eFC: 400/500 Error\u003cbr/\u003e{error_code, message}\n        FC--\u003e\u003eOM: Order Failed\n        OM-\u003e\u003eOM: Mark Order as Failed\n        OM--\u003e\u003eD: Order Failed - Manual Intervention Required\n    end\n```\n\n**Diagram: Order Placement Sequence (Synchronous)**\n\n### Order Request Payload\n\nThe order request sent from CaaS to the Factory includes:\n\n| Field | Description | Source |\n|-------|-------------|--------|\n| `customer_id` | CaaS customer identifier | Customer registration in Corporate Intranet |\n| `vehicle_specification` | Base platform + initial opciones disponibles | Plan comercial selected during sale |\n| `dealership_id` | Originating dealership | Logged-in employee's dealership |\n| `delivery_address` | Customer's delivery address | Customer profile |\n| `plan_comercial_details` | Commercial plan specifics (warranty, maintenance) | Sales package configuration |\n\nThe Factory API returns:\n\n| Field | Description |\n|-------|-------------|\n| `order_id` | Unique factory order identifier |\n| `estimated_delivery_date` | Factory's manufacturing timeline estimate |\n| `manufacturing_location` | Factory facility assigned to this order |\n| `order_status` | Initial status (typically `ORDERED` or `QUEUED`) |\n\n**Important Business Rule:** The Factory determines the delivery date based on its own production scheduling. CaaS cannot specify or negotiate delivery dates; it must accept the Factory's timeline.\n\n**Sources:** [enunciado.md:13](), [pasame las preguntas y sus respuestas a markdown.md:22-23]()\n\n### Error Handling and Retries\n\nSince order placement is a critical operation, the Factory API Client implements retry logic with exponential backoff for transient failures:\n\n| Error Type | HTTP Status | Retry Strategy | Fallback |\n|------------|-------------|----------------|----------|\n| Network timeout | N/A | Retry 3 times, exponential backoff | Manual order placement by technical support |\n| Server error | 500, 502, 503 | Retry 5 times, exponential backoff | Queue for manual review |\n| Validation error | 400 | No retry - log and alert | Fix data and resubmit manually |\n| Authorization error | 401, 403 | No retry - critical alert | Escalate to integration team |\n\nOrders that fail all automatic retries are flagged in the Order Management Subsystem for manual intervention. The dealership employee receives notification of the failure, and the customer's reservation remains valid pending resolution.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n## Manufacturing Status Notifications (Asynchronous)\n\n### Status Update Events\n\nOnce the Factory accepts an order, it begins manufacturing and sends status update notifications to CaaS as the vehicle progresses through various manufacturing stages. These notifications are sent asynchronously via webhooks to a dedicated endpoint in the CaaS platform.\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ORDERED: Order Placed\u003cbr/\u003evia Sync API\n    \n    ORDERED --\u003e IN_PRODUCTION: Manufacturing Started\u003cbr/\u003e(Webhook)\n    \n    IN_PRODUCTION --\u003e ASSEMBLY_COMPLETE: Assembly Finished\u003cbr/\u003e(Webhook)\n    \n    ASSEMBLY_COMPLETE --\u003e QUALITY_CHECK: Quality Control\u003cbr/\u003e(Webhook)\n    \n    QUALITY_CHECK --\u003e READY_FOR_SHIPMENT: QC Passed\u003cbr/\u003e(Webhook)\n    QUALITY_CHECK --\u003e IN_PRODUCTION: QC Failed\u003cbr/\u003e(Webhook - Rework)\n    \n    READY_FOR_SHIPMENT --\u003e SHIPPED: Dispatched to Transport\u003cbr/\u003e(Webhook)\n    \n    SHIPPED --\u003e ARRIVED_AT_DEALERSHIP: Arrived at Dealership\u003cbr/\u003e(Webhook)\n    \n    ARRIVED_AT_DEALERSHIP --\u003e READY_FOR_DELIVERY: Ready for Customer\u003cbr/\u003e(Internal CaaS Status)\n    \n    READY_FOR_DELIVERY --\u003e [*]: Delivered to Customer\n    \n    note right of ORDERED: CaaS initiates\n    note right of IN_PRODUCTION: Factory updates\n    note right of READY_FOR_DELIVERY: Requires customer\u003cbr/\u003efinal payment\n```\n\n**Diagram: Manufacturing Status State Machine**\n\n### Webhook Notification Format\n\nThe Factory sends webhook notifications to CaaS using HTTP POST to the endpoint `/webhooks/factory/status`. Each notification includes:\n\n| Field | Description | Example Values |\n|-------|-------------|----------------|\n| `order_id` | Factory order identifier | `\"FAC-2024-001234\"` |\n| `status` | Current manufacturing status | `\"IN_PRODUCTION\"`, `\"SHIPPED\"`, etc. |\n| `timestamp` | Event occurrence time (ISO 8601) | `\"2024-01-15T10:30:00Z\"` |\n| `estimated_completion_date` | Updated delivery estimate (optional) | `\"2024-02-01\"` |\n| `notes` | Human-readable status details | `\"Vehicle passed quality control\"` |\n| `location` | Current physical location (optional) | `\"Factory Barcelona\"`, `\"In Transit\"` |\n\n### Webhook Handler Implementation\n\nThe CaaS Webhook Handler receives Factory status notifications and processes them:\n\n```mermaid\nflowchart TD\n    START[\"Factory Sends\u003cbr/\u003ePOST /webhooks/factory/status\"]\n    \n    RECEIVE[\"Webhook Handler\u003cbr/\u003eReceives Request\"]\n    \n    VALIDATE{\"Validate\u003cbr/\u003eRequest?\"}\n    \n    VERIFY{\"Order ID\u003cbr/\u003eExists?\"}\n    \n    UPDATE[\"Update Order Status\u003cbr/\u003ein Database\"]\n    \n    NOTIFY_CHECK{\"Status Requires\u003cbr/\u003eCustomer Notification?\"}\n    \n    SEND_NOTIF[\"Trigger Notification Engine\u003cbr/\u003e(Email + App)\"]\n    \n    PAYMENT_CHECK{\"Status =\u003cbr/\u003eARRIVED_AT_DEALERSHIP?\"}\n    \n    PAYMENT_TRIGGER[\"Trigger Payment\u003cbr/\u003eReminder to Customer\"]\n    \n    RESPOND_OK[\"Return 200 OK\u003cbr/\u003eto Factory\"]\n    \n    RESPOND_ERROR[\"Return 400/500\u003cbr/\u003eLog Error\"]\n    \n    RETRY_QUEUE[\"Add to Retry Queue\"]\n    \n    START --\u003e RECEIVE\n    RECEIVE --\u003e VALIDATE\n    \n    VALIDATE --\u003e|Invalid Signature| RESPOND_ERROR\n    VALIDATE --\u003e|Valid| VERIFY\n    \n    VERIFY --\u003e|Not Found| RESPOND_ERROR\n    VERIFY --\u003e|Found| UPDATE\n    \n    UPDATE --\u003e NOTIFY_CHECK\n    \n    NOTIFY_CHECK --\u003e|Yes - Major Status| SEND_NOTIF\n    NOTIFY_CHECK --\u003e|No - Minor Status| PAYMENT_CHECK\n    \n    SEND_NOTIF --\u003e PAYMENT_CHECK\n    \n    PAYMENT_CHECK --\u003e|Yes| PAYMENT_TRIGGER\n    PAYMENT_CHECK --\u003e|No| RESPOND_OK\n    \n    PAYMENT_TRIGGER --\u003e RESPOND_OK\n    \n    RESPOND_ERROR --\u003e RETRY_QUEUE\n```\n\n**Diagram: Webhook Processing Flow**\n\n**Key Processing Rules:**\n\n1. **Authentication:** Webhook requests must include a signature in the `X-Factory-Signature` header using HMAC-SHA256 with a shared secret.\n\n2. **Idempotency:** The handler checks for duplicate notifications based on `order_id` and `timestamp`. Duplicate notifications are acknowledged with 200 OK but do not update the database.\n\n3. **Customer Notifications:** Major status changes trigger automatic customer notifications:\n   - `IN_PRODUCTION`  \"Your vehicle manufacturing has started\"\n   - `READY_FOR_SHIPMENT`  \"Your vehicle is ready and will ship soon\"\n   - `ARRIVED_AT_DEALERSHIP`  \"Your vehicle has arrived - please complete payment\"\n\n4. **Payment Triggering:** When status reaches `ARRIVED_AT_DEALERSHIP`, the system triggers a payment reminder to the customer. The vehicle cannot be registered until final payment is completed.\n\n**Sources:** [enunciado.md:13-16](), [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n### Webhook Reliability and Reconciliation\n\nTo ensure reliability of asynchronous status updates:\n\n| Mechanism | Description | Purpose |\n|-----------|-------------|---------|\n| **Webhook Retries (Factory)** | Factory retries failed webhooks with exponential backoff (5 attempts over 24 hours) | Handle temporary CaaS downtime |\n| **Retry Queue (CaaS)** | Failed webhook processing is queued for retry within CaaS | Handle transient database/logic errors |\n| **Status Polling (Fallback)** | CaaS polls Factory API for status if no webhook received for \u003e48 hours | Detect missed webhooks |\n| **Manual Reconciliation** | Automated daily job compares CaaS order statuses with Factory state | Catch and fix discrepancies |\n\nIf webhook delivery fails after all retries, the Factory system alerts its operations team to investigate. CaaS similarly alerts its integration monitoring team if status updates are missing for orders in active manufacturing.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n## Integration Points with CaaS Subsystems\n\nThe Factory Integration component interacts with multiple CaaS subsystems to complete the vehicle ordering and delivery workflow:\n\n```mermaid\ngraph TB\n    subgraph \"Factory Integration\"\n        FACTORY_CLIENT[\"Factory API Client\"]\n        WEBHOOK_HANDLER[\"Webhook Handler\"]\n    end\n    \n    subgraph \"CaaS Core Subsystems\"\n        ORDER_MGT[\"Order Management\"]\n        NOTIF_ENGINE[\"Notification Engine\"]\n        PAYMENT_PROC[\"Payment Processing\"]\n        ADMIN_INT[\"Administrative Registration\"]\n        TRANSPORT[\"Transport Coordination\"]\n    end\n    \n    subgraph \"Customer Interfaces\"\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Dealerships)\"]\n        WEB[\"Web Platform\u003cbr/\u003e(Customers)\"]\n        MOBILE[\"Mobile App\u003cbr/\u003e(Customers)\"]\n    end\n    \n    subgraph \"Data Layer\"\n        ORDER_DB[(\"Order Database\")]\n        CUSTOMER_DB[(\"Customer Database\")]\n    end\n    \n    INTRANET --\u003e|\"Initiate Sale\"| ORDER_MGT\n    ORDER_MGT --\u003e|\"Place Order\"| FACTORY_CLIENT\n    \n    WEBHOOK_HANDLER --\u003e|\"Update Status\"| ORDER_MGT\n    \n    ORDER_MGT --\u003e|\"Store Order Data\"| ORDER_DB\n    ORDER_MGT --\u003e|\"Read Customer Info\"| CUSTOMER_DB\n    \n    WEBHOOK_HANDLER --\u003e|\"Trigger Notifications\"| NOTIF_ENGINE\n    NOTIF_ENGINE --\u003e|\"Send Updates\"| WEB\n    NOTIF_ENGINE --\u003e|\"Send Updates\"| MOBILE\n    \n    ORDER_MGT --\u003e|\"Status: ARRIVED_AT_DEALERSHIP\"| PAYMENT_PROC\n    PAYMENT_PROC --\u003e|\"Payment Completed\"| ADMIN_INT\n    \n    ADMIN_INT --\u003e|\"Registration Complete\"| TRANSPORT\n    TRANSPORT --\u003e|\"Delivery Scheduled\"| NOTIF_ENGINE\n    \n    ORDER_MGT \u003c--\u003e|\"Read/Write Order State\"| ORDER_DB\n```\n\n**Diagram: Factory Integration Dependencies**\n\n### Subsystem Interactions\n\n| Subsystem | Interaction Type | Description |\n|-----------|-----------------|-------------|\n| **Order Management** | Bidirectional | Factory Integration reads order data and writes status updates |\n| **Notification Engine** | Outbound | Triggers customer notifications for manufacturing milestones |\n| **Payment Processing** | Sequential | Hands off to payment system when vehicle arrives at dealership |\n| **Administrative Registration** | Sequential | Triggers registration after final payment is completed |\n| **Transport Coordination** | Sequential | Initiates customer delivery after registration |\n| **Corporate Intranet** | Inbound | Receives order creation requests from dealership employees |\n| **Customer Databases** | Read | Retrieves customer and vehicle data for order placement |\n\n**Critical Workflow Dependencies:**\n\n1. **Order Placement:** Requires validated customer data from Customer Database and plan comercial details from Order Management.\n\n2. **Status Updates:** Webhook Handler must update Order Management before triggering Notification Engine to maintain data consistency.\n\n3. **Payment Triggering:** Status `ARRIVED_AT_DEALERSHIP` must be reached before Payment Processing can request final payment from customer.\n\n4. **Registration Blocking:** Administrative Registration cannot proceed until Payment Processing confirms completed payment.\n\n**Sources:** [enunciado.md:13-17](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n---\n\n## API Contract Reference\n\n### Factory Order API Specification\n\nThe Factory provides a REST API for order management. CaaS implements a client for this **existing, documented, and tested API**.\n\n**Important Constraint:** The Factory Order API is a pre-existing system that CaaS must integrate with. CaaS cannot modify the API specification; it can only consume it. Any integration issues or requirements must be addressed within the CaaS implementation.\n\n#### Order Placement Endpoint\n\n```\nPOST /api/v1/orders\nContent-Type: application/json\nAuthorization: Bearer {api_token}\n\nRequest Body:\n{\n  \"customer_id\": \"CAAS-CUST-123456\",\n  \"vehicle_specification\": {\n    \"platform_base\": \"SUV_ELECTRIC_2024\",\n    \"initial_options\": [\"POWER_BOOST_50\", \"ADAS_LEVEL_2\"],\n    \"color\": \"MIDNIGHT_BLUE\",\n    \"interior\": \"PREMIUM_LEATHER\"\n  },\n  \"dealership_id\": \"DEALER-ES-001\",\n  \"delivery_address\": {\n    \"street\": \"Calle Principal 123\",\n    \"city\": \"Madrid\",\n    \"postal_code\": \"28001\",\n    \"country\": \"ES\"\n  },\n  \"plan_comercial\": {\n    \"maintenance_included\": true,\n    \"warranty_years\": 5,\n    \"opciones_permanentes\": [\"POWER_BOOST_50\"]\n  }\n}\n\nResponse (201 Created):\n{\n  \"order_id\": \"FAC-2024-001234\",\n  \"status\": \"ORDERED\",\n  \"estimated_delivery_date\": \"2024-02-15\",\n  \"manufacturing_location\": \"Barcelona Factory\",\n  \"created_at\": \"2024-01-10T14:30:00Z\"\n}\n\nResponse (400 Bad Request):\n{\n  \"error_code\": \"INVALID_SPECIFICATION\",\n  \"message\": \"Unknown option code: INVALID_OPTION\",\n  \"field\": \"vehicle_specification.initial_options[1]\"\n}\n```\n\n#### Status Query Endpoint (Polling Fallback)\n\n```\nGET /api/v1/orders/{order_id}/status\nAuthorization: Bearer {api_token}\n\nResponse (200 OK):\n{\n  \"order_id\": \"FAC-2024-001234\",\n  \"status\": \"IN_PRODUCTION\",\n  \"status_history\": [\n    {\n      \"status\": \"ORDERED\",\n      \"timestamp\": \"2024-01-10T14:30:00Z\"\n    },\n    {\n      \"status\": \"IN_PRODUCTION\",\n      \"timestamp\": \"2024-01-12T08:00:00Z\"\n    }\n  ],\n  \"estimated_delivery_date\": \"2024-02-15\",\n  \"current_location\": \"Barcelona Factory - Assembly Line 3\"\n}\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44, 100-104]()\n\n### CaaS Webhook Endpoint Specification\n\nCaaS exposes a webhook endpoint for Factory status notifications. This endpoint is **developed by CaaS** as part of the project.\n\n```\nPOST /api/v1/webhooks/factory/status\nContent-Type: application/json\nX-Factory-Signature: {HMAC-SHA256 signature}\n\nRequest Body:\n{\n  \"order_id\": \"FAC-2024-001234\",\n  \"status\": \"SHIPPED\",\n  \"timestamp\": \"2024-02-01T10:00:00Z\",\n  \"estimated_completion_date\": \"2024-02-03\",\n  \"notes\": \"Dispatched via transport contractor ABC-TRANS-001\",\n  \"location\": \"In Transit - Madrid Route\"\n}\n\nResponse (200 OK):\n{\n  \"received\": true,\n  \"order_id\": \"FAC-2024-001234\",\n  \"processed_at\": \"2024-02-01T10:00:15Z\"\n}\n\nResponse (400 Bad Request):\n{\n  \"error\": \"Invalid signature\",\n  \"received\": false\n}\n\nResponse (404 Not Found):\n{\n  \"error\": \"Order not found\",\n  \"order_id\": \"FAC-2024-001234\",\n  \"received\": false\n}\n```\n\n**Authentication:** The `X-Factory-Signature` header contains an HMAC-SHA256 signature of the request body using a shared secret known to both Factory and CaaS. CaaS validates this signature before processing the webhook.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n## Business Rules and Constraints\n\nThe Factory Integration implements several critical business rules:\n\n### Factory Autonomy\n\n| Rule | Rationale | Implementation |\n|------|-----------|----------------|\n| Factory determines delivery dates | Manufacturing capacity and scheduling are factory-controlled | CaaS accepts `estimated_delivery_date` from Factory without negotiation |\n| Factory determines manufacturing location | Geographic optimization and resource availability | CaaS stores but does not influence `manufacturing_location` |\n| Factory sets production priorities | Internal factory operations management | CaaS cannot expedite or deprioritize orders |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:22-23]()\n\n### Order State Constraints\n\n1. **Order Immutability:** Once an order is placed with the Factory, vehicle specifications cannot be changed. Any customer changes to opciones disponibles after order placement only affect the service catalog, not the physical vehicle being manufactured.\n\n2. **Final Payment Requirement:** The vehicle cannot proceed to administrative registration until the customer completes final payment. This occurs when status reaches `ARRIVED_AT_DEALERSHIP`.\n\n3. **Payment Failure Consequences:** If the customer fails to complete final payment, the vehicle is marked as \"sin asignar\" (unassigned) in the CaaS Order Management system and becomes stock for immediate sale. The customer loses their reservation entirely.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27](), [enunciado.md:14-16]()\n\n### Status Notification Requirements\n\nThe system must provide automatic notifications to customers for manufacturing milestones. This is a core value proposition of the CaaS platform, differentiating it from traditional vehicle purchasing where customers have no visibility into manufacturing progress.\n\n**Notification Triggers:**\n\n- Order placement confirmed\n- Manufacturing started\n- Manufacturing milestones reached\n- Quality control completed\n- Vehicle shipped\n- Vehicle arrived at dealership (with payment reminder)\n- Registration completed\n- Delivery scheduled\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29](), [enunciado.md:13]()\n\n---\n\n## Error Handling and Edge Cases\n\n### Factory System Unavailability\n\nIf the Factory Order API is unavailable when CaaS attempts to place an order:\n\n1. **Immediate Retry:** 3 attempts with exponential backoff (1s, 2s, 4s)\n2. **Persistent Failure:** Queue order for manual placement by technical support team\n3. **Customer Communication:** Notify customer of delay via email with expected resolution timeline\n4. **Reservation Status:** Keep customer's reservation active; do not cancel or penalize\n\nThe Order Management Subsystem maintains order status `PENDING_FACTORY_SUBMISSION` until Factory confirms the order.\n\n### Missed Webhook Notifications\n\nIf CaaS does not receive expected webhook notifications:\n\n1. **Detection:** Automated monitoring alerts if no status update received for \u003e48 hours on orders in `ORDERED` or `IN_PRODUCTION` status\n2. **Fallback Polling:** CaaS polls Factory status API every 4 hours for affected orders\n3. **Reconciliation:** Daily automated job compares all active order statuses between CaaS and Factory\n4. **Manual Intervention:** Integration team investigates discrepancies and manually updates order status if needed\n\n### Duplicate Webhook Notifications\n\nThe webhook handler implements idempotency checking:\n\n- **Duplicate Detection:** Check database for existing status update with same `order_id`, `status`, and `timestamp`\n- **Response:** Return 200 OK without updating database\n- **Logging:** Log duplicate detection for monitoring (high duplicate rate indicates Factory retry issues)\n\n### Invalid or Malformed Webhook Data\n\nIf webhook payload fails validation:\n\n1. **Response:** Return 400 Bad Request with error details\n2. **Logging:** Log full request body and validation errors for investigation\n3. **Alerting:** Critical alert to integration team (Factory may have changed webhook format)\n4. **Retry Expectation:** Factory should retry; if persistent, manual coordination required\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n## Monitoring and Observability\n\nThe Factory Integration component provides monitoring metrics and logging for operational visibility:\n\n### Key Metrics\n\n| Metric | Description | Alert Threshold |\n|--------|-------------|-----------------|\n| `factory_order_success_rate` | Percentage of successful order placements | \u003c 95% |\n| `factory_order_latency_p95` | 95th percentile order placement response time | \u003e 5 seconds |\n| `webhook_processing_success_rate` | Percentage of successfully processed webhooks | \u003c 99% |\n| `webhook_processing_latency_p95` | 95th percentile webhook processing time | \u003e 2 seconds |\n| `missed_webhook_count` | Orders missing expected status updates (24h window) | \u003e 0 |\n| `order_status_discrepancy_count` | Orders with status mismatch between CaaS and Factory | \u003e 5 |\n\n### Logging Standards\n\nAll Factory Integration operations log structured events including:\n\n- `correlation_id`: Unique identifier linking related operations\n- `order_id`: Factory order identifier\n- `customer_id`: CaaS customer identifier\n- `operation`: `order_placement`, `webhook_received`, `status_poll`, etc.\n- `status`: `success`, `failure`, `retry`\n- `error_details`: Error codes and messages for failures\n- `latency_ms`: Operation duration\n\n### Integration Health Dashboard\n\nOperations teams monitor Factory Integration health through dashboards displaying:\n\n- Real-time order placement success rate (last 1 hour, 24 hours, 7 days)\n- Webhook delivery success rate and latency distribution\n- Active orders by manufacturing status\n- Orders with outdated status (no update in \u003e24 hours)\n- Failed order placements requiring manual intervention\n- Recent error patterns and trends\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n## Relationship to Other CaaS Subsystems\n\nThe Factory Integration sits at the beginning of the vehicle lifecycle within CaaS, initiating a workflow that spans multiple subsystems:\n\n```mermaid\nflowchart LR\n    FACTORY_INT[\"Factory Integration\u003cbr/\u003e(Order + Status)\"]\n    \n    ORDER_MGT[\"Order Management\u003cbr/\u003e(State Tracking)\"]\n    \n    PAYMENT[\"Payment Processing\u003cbr/\u003e(Final Payment)\"]\n    \n    ADMIN_REG[\"Administrative Registration\u003cbr/\u003e(Matriculation)\"]\n    \n    TRANSPORT[\"Transport Coordination\u003cbr/\u003e(Delivery)\"]\n    \n    VEHICLE_LINK[\"Vehicle Linking\u003cbr/\u003e(IoT Connection)\"]\n    \n    SERVICE_CAT[\"Service Catalog\u003cbr/\u003e(Optional Services)\"]\n    \n    FACTORY_INT --\u003e|\"Order Placed\"| ORDER_MGT\n    FACTORY_INT --\u003e|\"ARRIVED_AT_DEALERSHIP\"| PAYMENT\n    PAYMENT --\u003e|\"Payment Complete\"| ADMIN_REG\n    ADMIN_REG --\u003e|\"Registration Complete\"| TRANSPORT\n    TRANSPORT --\u003e|\"Delivery Complete\"| VEHICLE_LINK\n    VEHICLE_LINK --\u003e|\"Vehicle Operational\"| SERVICE_CAT\n```\n\n**Diagram: Factory Integration in Vehicle Lifecycle**\n\n**Workflow Handoffs:**\n\n1. **Factory Integration  Order Management:** Order placement and status tracking\n2. **Factory Integration  Payment Processing:** Vehicle arrival triggers final payment request\n3. **Payment Processing  Administrative Registration:** Payment completion enables registration\n4. **Administrative Registration  Transport Coordination:** Registration enables delivery scheduling\n5. **Transport Coordination  Vehicle Linking (IoT):** Delivery enables mobile app pairing\n6. **Vehicle Linking  Service Catalog:** Operational vehicle enables optional service purchases\n\nThe Factory Integration is responsible for the **first two stages** of this lifecycle: initiating manufacturing and tracking progress until the vehicle arrives at the dealership. Subsequent stages are handled by other subsystems documented in their respective wiki pages.\n\n**Sources:** [enunciado.md:8-19]()\n\n---\n\n## Summary\n\nThe Factory Integration component enables CaaS to orchestrate vehicle manufacturing through a hybrid synchronous-asynchronous communication pattern. Key characteristics:\n\n- **Order Placement:** Synchronous API initiated by CaaS when customer pays reservation\n- **Status Tracking:** Asynchronous webhooks from Factory to CaaS throughout manufacturing\n- **Factory Autonomy:** Factory determines delivery dates and manufacturing priorities\n- **Reliability:** Retry logic, fallback polling, and reconciliation ensure data consistency\n- **Customer Visibility:** Status updates automatically trigger customer notifications\n- **Workflow Integration:** Seamlessly hands off to Payment, Registration, and Delivery subsystems\n\nThe integration treats the Factory Order API as a pre-existing, unchangeable constraint that CaaS must adapt to, implementing robust error handling and monitoring to ensure reliable order placement and status tracking.\n\nFor the subsequent stages of vehicle delivery and customer activation, see [Manufacturing and Delivery Workflow](#8.2) and [Vehicle Communication (IoT and OTA)](#5.3).\n\n**Sources:** [enunciado.md:8-19](), [pasame las preguntas y sus respuestas a markdown.md:18-44]()"])</script><script>self.__next_f.push([1,"23:T51bf,"])</script><script>self.__next_f.push([1,"# VSS (Vehicle Service System) Integration\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details the technical integration between the CaaS platform and the **VSS (Vehicle Service System)**, an external system maintained by authorized workshops. VSS stores comprehensive vehicle maintenance records including service history, compliance status, and warranty information. CaaS queries VSS to enforce maintenance-dependent service availability rules and ensure customer safety.\n\nThis page focuses on the **technical integration architecture and API communication patterns**. For business rules about how maintenance status affects service purchases, see [Maintenance-Linked Service Access](#6.3). For operational maintenance management workflows, see [Maintenance Management](#8.3).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## VSS System Overview\n\n### System Ownership and Scope\n\nVSS is an **external system** not owned or operated by CaaS. Key characteristics:\n\n| Aspect | Details |\n|--------|---------|\n| **Owner** | Network of official workshops and approved multi-brand workshops |\n| **Data Authority** | Workshops are authoritative source for all maintenance records |\n| **CaaS Relationship** | Read-only query access; CaaS cannot write to VSS |\n| **Data Residence** | Maintained independently; not replicated to CaaS databases |\n| **Integration Pattern** | Pull-based queries initiated by CaaS |\n\nVSS maintains the complete service history for all vehicles serviced by authorized workshops, including:\n\n- Scheduled maintenance completion records\n- Repair history by functional block (engine, brakes, suspension, etc.)\n- Compliance percentage per functional block\n- Warranty status and conditions\n- Service dates and mileage readings\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-65]()\n\n---\n\n## Integration Architecture\n\n### Communication Pattern\n\nThe VSS integration follows a **synchronous query pattern** where CaaS initiates requests to VSS when maintenance status information is required.\n\n#### VSS Integration Pattern Diagram\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform\"\n        ServiceCatalog[\"Service Catalog\u003cbr/\u003eService Browse \u0026 Purchase\"]\n        MaintenanceGate[\"Maintenance Gate Service\u003cbr/\u003eValidation Logic\"]\n        VSSClient[\"VSS API Client\u003cbr/\u003eIntegration Adapter\"]\n    end\n    \n    subgraph \"VSS External System\"\n        VSSEndpoint[\"VSS API Endpoint\u003cbr/\u003eMaintenance Query API\"]\n        VSSDatabase[(\"VSS Database\u003cbr/\u003eMaintenance Records\")]\n    end\n    \n    subgraph \"Workshop Network\"\n        OfficialWorkshop[\"Official Workshops\u003cbr/\u003eFactory Authorized\"]\n        ApprovedWorkshop[\"Approved Workshops\u003cbr/\u003eMulti-brand Certified\"]\n    end\n    \n    ServiceCatalog --\u003e|\"Check Maintenance\u003cbr/\u003eBefore Service Purchase\"| MaintenanceGate\n    MaintenanceGate --\u003e|\"Query Maintenance Status\u003cbr/\u003eSynchronous HTTP\"| VSSClient\n    VSSClient --\u003e|\"GET /vehicles/{vin}/maintenance\"| VSSEndpoint\n    VSSEndpoint --\u003e|\"Returns Compliance Data\"| VSSClient\n    VSSEndpoint --\u003e VSSDatabase\n    \n    OfficialWorkshop --\u003e|\"Record Service\u003cbr/\u003eEvents\"| VSSDatabase\n    ApprovedWorkshop --\u003e|\"Record Service\u003cbr/\u003eEvents\"| VSSDatabase\n    \n    VSSClient -.-\u003e|\"Response:\u003cbr/\u003eCompliance Status\"| MaintenanceGate\n    MaintenanceGate -.-\u003e|\"Allow/Deny\u003cbr/\u003ePurchase\"| ServiceCatalog\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73](), High-Level Diagram 4\n\n### Key Architectural Constraints\n\n1. **Vehicles Do NOT Self-Report Maintenance**\n   - Vehicles do not communicate their maintenance status via the IoT network\n   - All maintenance data must be queried from VSS\n   - This is an explicit architectural constraint stated in [pasame las preguntas y sus respuestas a markdown.md:72-73]()\n\n2. **Query-Only Access**\n   - CaaS has read-only access to VSS\n   - No write operations are permitted\n   - Workshops own all data entry\n\n3. **No Data Replication**\n   - Maintenance records are not cached or replicated in CaaS databases\n   - Every service purchase requires a fresh VSS query for current compliance status\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:72-73]()\n\n---\n\n## Query Trigger Points\n\n### When CaaS Queries VSS\n\nCaaS queries VSS at specific points in the customer journey where maintenance compliance must be verified:\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebPlatform as \"Web/Mobile Platform\"\n    participant ServiceCatalog as \"Service Catalog\"\n    participant MaintenanceGate as \"Maintenance Gate\"\n    participant VSSClient as \"VSS API Client\"\n    participant VSS as \"VSS System\"\n    \n    Customer-\u003e\u003eWebPlatform: \"Browse optional services\"\n    WebPlatform-\u003e\u003eServiceCatalog: \"Get available services\"\n    ServiceCatalog-\u003e\u003eCustomer: \"Display service catalog\"\n    \n    Customer-\u003e\u003eWebPlatform: \"Select service requiring maintenance\"\n    WebPlatform-\u003e\u003eServiceCatalog: \"Request service purchase\"\n    \n    ServiceCatalog-\u003e\u003eMaintenanceGate: \"Check maintenance for service X\"\n    MaintenanceGate-\u003e\u003eVSSClient: \"Query maintenance status for VIN\"\n    VSSClient-\u003e\u003eVSS: \"GET /vehicles/{vin}/maintenance-status\"\n    VSS--\u003e\u003eVSSClient: \"Compliance data by functional block\"\n    VSSClient--\u003e\u003eMaintenanceGate: \"Parsed compliance status\"\n    \n    alt \"Maintenance Current for Required Block\"\n        MaintenanceGate--\u003e\u003eServiceCatalog: \"ALLOW: Maintenance OK\"\n        ServiceCatalog-\u003e\u003eCustomer: \"Proceed to payment\"\n    else \"Maintenance Overdue\"\n        MaintenanceGate--\u003e\u003eServiceCatalog: \"DENY: Maintenance required\"\n        ServiceCatalog-\u003e\u003eCustomer: \"Service unavailable - maintenance needed\"\n    end\n```\n\n### Query Timing Rules\n\n| Trigger Event | Query Timing | Rationale |\n|---------------|--------------|-----------|\n| **Service Browse** | No query | Display all services; don't pre-filter |\n| **Service Selection** | Query before payment | Prevent purchase of unsafe services |\n| **Payment Completion** | No additional query | Use result from selection step |\n| **Already-Owned Service** | No query | Never block paid services |\n\nThe critical rule: **Query only when customer attempts to purchase a new service that requires maintenance compliance**. Do not query for:\n- Base platform features (always available)\n- Services already purchased and activated\n- Services that don't have maintenance dependencies\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-71]()\n\n---\n\n## VSS API Request/Response Model\n\n### Request Structure\n\nWhile the exact VSS API specification exists in external documentation, the expected request pattern follows:\n\n**Endpoint Pattern:**\n```\nGET /api/v1/vehicles/{vin}/maintenance-status\n```\n\n**Query Parameters:**\n- `vin` (required): Vehicle Identification Number\n- `functional-blocks` (optional): Comma-separated list to filter specific blocks\n- `include-history` (optional): Boolean to include detailed history\n\n**Headers:**\n- `Authorization: Bearer {token}` - Authentication credential for CaaS\n- `X-Request-ID: {uuid}` - Correlation ID for tracing\n\n### Response Data Model\n\nVSS returns maintenance compliance information structured by vehicle functional blocks:\n\n```json\n{\n  \"vin\": \"WVWZZZ1KZBW123456\",\n  \"last_service_date\": \"2024-01-15\",\n  \"last_service_mileage_km\": 45230,\n  \"current_mileage_km\": 48750,\n  \"warranty_active\": true,\n  \"functional_blocks\": [\n    {\n      \"block_id\": \"ENGINE\",\n      \"block_name\": \"Motor y Sistema de Propulsin\",\n      \"maintenance_current\": true,\n      \"compliance_percentage\": 100,\n      \"next_service_due_km\": 60000,\n      \"next_service_due_date\": \"2024-08-15\",\n      \"overdue\": false\n    },\n    {\n      \"block_id\": \"BRAKES\",\n      \"block_name\": \"Sistema de Frenos\",\n      \"maintenance_current\": false,\n      \"compliance_percentage\": 75,\n      \"next_service_due_km\": 47000,\n      \"next_service_due_date\": \"2023-12-01\",\n      \"overdue\": true,\n      \"overdue_km\": 1750,\n      \"overdue_days\": 45\n    },\n    {\n      \"block_id\": \"SUSPENSION\",\n      \"block_name\": \"Suspensin y Direccin\",\n      \"maintenance_current\": true,\n      \"compliance_percentage\": 100,\n      \"next_service_due_km\": 55000,\n      \"next_service_due_date\": \"2024-06-01\",\n      \"overdue\": false\n    }\n  ]\n}\n```\n\n**Key Response Fields:**\n\n| Field | Type | Purpose |\n|-------|------|---------|\n| `warranty_active` | boolean | Overall warranty status for vehicle |\n| `functional_blocks[].maintenance_current` | boolean | Whether this block's maintenance is up-to-date |\n| `functional_blocks[].compliance_percentage` | integer | Historical compliance score (0-100) |\n| `functional_blocks[].overdue` | boolean | Whether maintenance is past due |\n| `functional_blocks[].overdue_km` | integer | How many km past service interval |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-65]()\n\n---\n\n## Service-to-Maintenance Mapping\n\n### Functional Block Dependencies\n\nEach optional service in the CaaS catalog must declare which VSS functional blocks it depends on for safe operation:\n\n#### Service Dependency Configuration Example\n\n```mermaid\ngraph LR\n    subgraph \"Service Catalog Configuration\"\n        ABS[\"Avanzado de Frenado\u003cbr/\u003e(Advanced Braking)\"]\n        Suspension[\"Suspensin Adaptativa\u003cbr/\u003e(Adaptive Suspension)\"]\n        Engine[\"Optimizacin Motor\u003cbr/\u003e(Engine Optimization)\"]\n        Entertainment[\"Sistema Entretenimiento\u003cbr/\u003e(Entertainment)\"]\n    end\n    \n    subgraph \"VSS Functional Blocks\"\n        BRAKES[\"BRAKES Block\"]\n        SUSP[\"SUSPENSION Block\"]\n        ENG[\"ENGINE Block\"]\n        NONE[\"No Dependency\"]\n    end\n    \n    ABS --\u003e|\"Requires\"| BRAKES\n    Suspension --\u003e|\"Requires\"| SUSP\n    Engine --\u003e|\"Requires\"| ENG\n    Entertainment --\u003e|\"Requires\"| NONE\n```\n\n### Maintenance Gate Decision Logic\n\n```mermaid\nflowchart TD\n    Start[\"Service Purchase Request\"] --\u003e GetService[\"Load Service Definition\"]\n    GetService --\u003e CheckDeps{\"Service Has\u003cbr/\u003eMaintenance\u003cbr/\u003eDependencies?\"}\n    \n    CheckDeps --\u003e|\"No\"| AllowPurchase[\"ALLOW: No restrictions\"]\n    CheckDeps --\u003e|\"Yes\"| QueryVSS[\"Query VSS for VIN\"]\n    \n    QueryVSS --\u003e VSSResponse{\"VSS Query\u003cbr/\u003eSuccessful?\"}\n    VSSResponse --\u003e|\"No - Error\"| ErrorHandling[\"Error Handling Logic\"]\n    VSSResponse --\u003e|\"Yes\"| CheckBlocks[\"Check Required Blocks\"]\n    \n    CheckBlocks --\u003e BlocksCurrent{\"All Required\u003cbr/\u003eBlocks Current?\"}\n    BlocksCurrent --\u003e|\"Yes\"| AllowPurchase\n    BlocksCurrent --\u003e|\"No\"| DenyPurchase[\"DENY: Maintenance required\"]\n    \n    ErrorHandling --\u003e ConfigCheck{\"Fail-Safe\u003cbr/\u003eConfiguration?\"}\n    ConfigCheck --\u003e|\"Allow on Error\"| AllowPurchase\n    ConfigCheck --\u003e|\"Deny on Error\"| DenyPurchase\n    \n    AllowPurchase --\u003e End[\"Proceed to Payment\"]\n    DenyPurchase --\u003e End2[\"Display Maintenance Message\"]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-71]()\n\n---\n\n## Critical Business Rules\n\n### Rule 1: Never Block Already-Purchased Services\n\n**Enforcement:** The maintenance gate check occurs **before payment processing**, not after service activation.\n\n```mermaid\nflowchart LR\n    ServiceOwned{\"Service Already\u003cbr/\u003eOwned/Active?\"}\n    ServiceOwned --\u003e|\"Yes\"| SkipCheck[\"SKIP maintenance check\"]\n    ServiceOwned --\u003e|\"No - New Purchase\"| RunCheck[\"RUN maintenance check\"]\n    \n    SkipCheck --\u003e AlwaysAllow[\"Always Allow Usage\"]\n    RunCheck --\u003e GateLogic[\"Maintenance Gate Logic\"]\n```\n\n**Rationale:** Customer has already paid for the service. Even if they've neglected maintenance since purchase, the service remains active. Only NEW purchases are gated.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-71]()\n\n### Rule 2: Never Block Vehicle Circulation\n\nVSS integration checks **cannot prevent the vehicle from operating**. Key constraints:\n\n| Action | Allowed | Rationale |\n|--------|---------|-----------|\n| Block new service purchase |  Yes | Safety and warranty protection |\n| Deactivate already-paid service |  No | Customer has paid; service delivered |\n| Prevent vehicle startup |  No | Only police can restrict vehicle operation |\n| Display maintenance warnings |  Yes | Informational only |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-68]()\n\n### Rule 3: Warranty Loss on Non-Compliance\n\nIf VSS returns `warranty_active: false` due to maintenance non-compliance:\n\n- Customer is **informed** but not blocked from operating vehicle\n- New service purchases for maintenance-dependent services are **denied**\n- Customer must complete overdue maintenance to restore warranty\n- Base platform features remain **fully operational**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:68-70]()\n\n---\n\n## Error Handling and Resilience\n\n### VSS Unavailability Scenarios\n\n```mermaid\nflowchart TD\n    QueryVSS[\"Query VSS API\"] --\u003e Timeout{\"Response\u003cbr/\u003eReceived?\"}\n    \n    Timeout --\u003e|\"Timeout\"| FailSafe[\"Apply Fail-Safe Policy\"]\n    Timeout --\u003e|\"HTTP 500\"| FailSafe\n    Timeout --\u003e|\"HTTP 503\"| FailSafe\n    Timeout --\u003e|\"Success\"| ParseResponse[\"Parse Response\"]\n    \n    FailSafe --\u003e PolicyCheck{\"Configured\u003cbr/\u003ePolicy?\"}\n    PolicyCheck --\u003e|\"ALLOW_ON_ERROR\"| LogAndAllow[\"Log Error \u0026 ALLOW Purchase\"]\n    PolicyCheck --\u003e|\"DENY_ON_ERROR\"| LogAndDeny[\"Log Error \u0026 DENY Purchase\"]\n    PolicyCheck --\u003e|\"DEFAULT\"| LogAndDeny\n    \n    ParseResponse --\u003e ValidData{\"Valid\u003cbr/\u003eResponse?\"}\n    ValidData --\u003e|\"Yes\"| ApplyRules[\"Apply Maintenance Rules\"]\n    ValidData --\u003e|\"No - Malformed\"| FailSafe\n    \n    LogAndAllow --\u003e NotifyOps[\"Alert Operations Team\"]\n    LogAndDeny --\u003e NotifyOps\n    NotifyOps --\u003e ReturnDecision[\"Return Decision to Caller\"]\n```\n\n### Fail-Safe Policy Configuration\n\nCaaS must implement configurable fail-safe behavior for VSS unavailability:\n\n**Option 1: ALLOW_ON_ERROR (Customer-Favorable)**\n- Allows service purchase when VSS is unreachable\n- Assumes customer is compliant by default\n- Higher safety risk but better customer experience\n- Recommended for non-critical services\n\n**Option 2: DENY_ON_ERROR (Safety-First)**\n- Denies service purchase when VSS is unreachable\n- Assumes non-compliance by default\n- Lower safety risk but worse customer experience\n- Recommended for safety-critical services (braking, steering)\n\nThis policy should be configurable **per service** based on its safety criticality.\n\n**Sources:** General error handling best practices\n\n---\n\n## Integration Implementation Components\n\n### Code Structure for VSS Integration\n\nThe VSS integration should be implemented with clear separation of concerns:\n\n#### Component Architecture Diagram\n\n```mermaid\ngraph TB\n    subgraph \"Service Layer\"\n        ServicePurchase[\"ServicePurchaseService\u003cbr/\u003eOrchestrates purchase flow\"]\n        MaintenanceGate[\"MaintenanceGateService\u003cbr/\u003eEnforces maintenance rules\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        VSSClient[\"VSSApiClient\u003cbr/\u003eHTTP client for VSS\"]\n        VSSMapper[\"VSSResponseMapper\u003cbr/\u003eMaps VSS to domain model\"]\n    end\n    \n    subgraph \"Domain Layer\"\n        MaintenanceStatus[\"MaintenanceStatus\u003cbr/\u003eDomain entity\"]\n        FunctionalBlock[\"FunctionalBlock\u003cbr/\u003eValue object\"]\n        ServiceDefinition[\"ServiceDefinition\u003cbr/\u003eEntity with dependencies\"]\n    end\n    \n    subgraph \"Configuration Layer\"\n        ServiceConfig[\"service-catalog.yml\u003cbr/\u003eMaintenance dependencies\"]\n        VSSConfig[\"vss-integration.yml\u003cbr/\u003eEndpoint, timeout, policy\"]\n    end\n    \n    ServicePurchase --\u003e MaintenanceGate\n    MaintenanceGate --\u003e VSSClient\n    MaintenanceGate --\u003e ServiceDefinition\n    VSSClient --\u003e VSSMapper\n    VSSMapper --\u003e MaintenanceStatus\n    MaintenanceStatus --\u003e FunctionalBlock\n    ServiceDefinition --\u003e ServiceConfig\n    VSSClient --\u003e VSSConfig\n```\n\n### Expected File Structure\n\nWhile no actual code exists in the repository, the implementation should follow this structure:\n\n```\nsrc/\n services/\n    maintenance/\n       MaintenanceGateService       # Business logic for gating\n       MaintenanceRuleEngine        # Evaluates maintenance rules\n    catalog/\n        ServicePurchaseService       # Orchestrates purchase flow\n integration/\n    vss/\n       VSSApiClient                 # HTTP client\n       VSSResponseMapper            # Response transformation\n       VSSErrorHandler              # Error handling logic\n    factories/\n        IntegrationClientFactory     # Creates configured clients\n domain/\n    entities/\n       MaintenanceStatus            # Domain model\n       ServiceDefinition            # Service entity\n    valueobjects/\n        FunctionalBlock              # Functional block VO\n config/\n     service-catalog.yml              # Service definitions\n     vss-integration.yml              # VSS endpoint config\n```\n\n**Sources:** Standard layered architecture patterns\n\n---\n\n## Customer Communication\n\n### Maintenance Denial Messages\n\nWhen VSS indicates maintenance is overdue and a service is denied, CaaS must provide clear, actionable messaging:\n\n**Minimum Required Information:**\n- Which functional block(s) require maintenance\n- Approximate overdue amount (km or days)\n- Links to find authorized workshops\n- Warranty implications if maintenance continues to be neglected\n\n**Example Message Template:**\n```\nService Unavailable - Maintenance Required\n\nThe \"Advanced Braking System\" service requires current maintenance \non the following systems:\n\n Brake System: 1,750 km overdue\n  Next service was due: 01-Dec-2023\n\nTo purchase this service, please complete the required maintenance \nat an authorized workshop. \n\nFind workshops: [Link to workshop locator]\n\nNote: Continued delay may affect your vehicle warranty.\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-71]()\n\n---\n\n## Testing and Validation\n\n### Integration Test Scenarios\n\n| Test Case | VSS Response | Expected CaaS Behavior |\n|-----------|--------------|------------------------|\n| **All maintenance current** | `maintenance_current: true` for all blocks | Allow service purchase |\n| **Single block overdue** | `maintenance_current: false` for BRAKES | Deny brake-dependent services only |\n| **Warranty expired** | `warranty_active: false` | Deny all maintenance-dependent services |\n| **VSS timeout** | No response within 5s | Apply fail-safe policy |\n| **VSS 500 error** | Internal server error | Apply fail-safe policy |\n| **Malformed response** | Invalid JSON | Apply fail-safe policy |\n| **Service has no dependencies** | Any VSS state | Always allow (skip VSS query) |\n\n### Mock VSS for Development\n\nDevelopment and testing should use a mock VSS service that can simulate:\n- Various maintenance states (current, overdue, expired warranty)\n- Network failures and timeouts\n- Malformed responses\n- High latency scenarios\n\n**Sources:** Standard integration testing practices\n\n---\n\n## Monitoring and Observability\n\n### Key Metrics to Track\n\n| Metric | Purpose | Alert Threshold |\n|--------|---------|----------------|\n| **VSS Query Success Rate** | Overall integration health | \u003c 95% success |\n| **VSS Response Time (p95)** | Performance monitoring | \u003e 2 seconds |\n| **Maintenance Denials** | Business metric | N/A (informational) |\n| **Fail-Safe Activations** | Error handling frequency | \u003e 10/hour |\n| **VIN Not Found Errors** | Data synchronization issues | \u003e 1% of queries |\n\n### Logging Requirements\n\nEvery VSS query should log:\n- Request timestamp and correlation ID\n- VIN queried\n- Response status (success/failure)\n- Response time\n- Maintenance gate decision (allow/deny)\n- Fail-safe policy applied (if applicable)\n\n**Sources:** Operational best practices\n\n---\n\n## Summary\n\nThe VSS integration is a **critical safety mechanism** that gates service purchases based on maintenance compliance. Key takeaways:\n\n1. **Query Pattern**: Synchronous, pull-based queries initiated by CaaS when customer attempts to purchase maintenance-dependent services\n2. **No Self-Reporting**: Vehicles do NOT report maintenance status; all data comes from VSS\n3. **Selective Gating**: Only NEW service purchases are checked; already-owned services always remain active\n4. **Fail-Safe Design**: Configurable behavior when VSS is unavailable, balancing safety and customer experience\n5. **Workshop Ownership**: VSS is external and authoritative; CaaS has read-only access\n\nThe integration enforces safety rules while respecting customer rights: never block paid services, never prevent vehicle operation, and always provide clear communication about maintenance requirements.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73](), High-Level System Diagrams"])</script><script>self.__next_f.push([1,"24:T6e1a,"])</script><script>self.__next_f.push([1,"# Vehicle Communication (IoT and OTA)\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the vehicle communication infrastructure for the CaaS platform, focusing on the IoT network and OTA (Over-The-Air) service activation system. It covers:\n\n- The **API IoT** interface for remote vehicle configuration\n- IoT network infrastructure and connectivity architecture\n- OTA activation process for remote service delivery\n- Pre-installed functionality model and firmware activation\n- Vehicle status reporting and telemetry\n- Retry logic and failure handling mechanisms\n\nFor information about how maintenance status is tracked via workshops, see [VSS (Vehicle Service System) Integration](#5.2). For details on the OTA activation workflow and service lifecycle, see [OTA Service Activation](#6.2). For failure handling policies, see [OTA Activation Failures](#9.1).\n\n## Overview\n\nThe CaaS system relies on a pre-existing, tested IoT infrastructure to enable remote configuration and monitoring of the entire vehicle fleet. All vehicles sold through CaaS are equipped with connectivity hardware and pre-installed firmware containing all optional features. The system does not install new software via OTA; it only **activates or deactivates** pre-existing functionality through configuration changes.\n\n**Key Architectural Principles:**\n- **Pre-installed Functionality Model**: All optional services (opciones disponibles) are already present in vehicle firmware at manufacture time\n- **Configuration-Based Activation**: OTA operations send configuration commands, not software updates\n- **Existing API Constraint**: The API IoT is a pre-existing, documented interface that CaaS must use as-is\n- **Bidirectional Communication**: Vehicles both receive configuration commands and report operational status\n- **No Workshop Requirement**: Service activation never requires physical workshop visits\n\nSources: [enunciado.md:7-8](), [pasame las preguntas y sus respuestas a markdown.md:34-38](), [pasame las preguntas y sus respuestas a markdown.md:55-56]()\n\n## API IoT Interface\n\n### Characteristics\n\nThe **API IoT** is a pre-existing, fully documented, and tested interface developed prior to the CaaS project. This API was designed to support remote vehicle configuration but was not operational until CaaS deployment.\n\n**Integration Constraints:**\n- **Cannot be modified**: The API is a fixed external interface\n- **Fully documented**: Complete technical specifications exist\n- **Already tested**: Integration testing was performed in a previous project\n- **Pre-CaaS origin**: Developed before the CaaS business model\n- **Problem attribution**: Any integration issues are attributed to the prior project, not CaaS\n\n**Primary Capabilities:**\n- Remote configuration delivery to vehicles\n- Vehicle status querying and telemetry retrieval\n- Command acknowledgment and execution status reporting\n\nThe API serves as the **single integration point** between CaaS business logic and the physical vehicle fleet. All service activation, deactivation, and status monitoring flows through this interface.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:34-38](), [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n### API Classification\n\nAccording to system documentation standards, the API IoT is classified as a **Restriction** rather than a **Requirement**:\n\n| API Type | Description | Documentation Approach |\n|----------|-------------|------------------------|\n| **Restriction** | Pre-existing API that must be used as-is | Brief summary of functionality + reference to existing technical documentation |\n| **Requirement** | New API to be developed as part of CaaS | Full requirements specification as part of project deliverables |\n\nThe API IoT falls into the first category. CaaS must integrate with it but cannot define or modify its interface.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n## IoT Network Architecture\n\n### Infrastructure Layers\n\nThe vehicle communication infrastructure is organized in distinct layers, separating concerns between business logic, integration, network transport, and physical devices.\n\n**IoT Network Architecture Diagram**\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform Layer\"\n        OTA_ENGINE[\"OTA Activation Engine\u003cbr/\u003e(Service Delivery Logic)\"]\n        STATUS_MONITOR[\"Vehicle Status Monitor\u003cbr/\u003e(Telemetry Processing)\"]\n        CONFIG_REPO[\"Configuration Repository\u003cbr/\u003e(Service Definitions)\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        IOT_GATEWAY[\"IoT Gateway\u003cbr/\u003e(API IoT Client)\"]\n        RETRY_HANDLER[\"Retry Handler\u003cbr/\u003e(Failure Logic)\"]\n    end\n    \n    subgraph \"API IoT Interface\"\n        API_IOT[\"API IoT\u003cbr/\u003e(Pre-existing Interface)\"]\n    end\n    \n    subgraph \"Network Transport Layer\"\n        IOT_NETWORK[\"IoT Network\u003cbr/\u003e(Cellular/Satellite)\"]\n    end\n    \n    subgraph \"Vehicle Fleet\"\n        VEHICLE_1[\"Connected Vehicle 1\u003cbr/\u003e(Pre-installed Firmware)\"]\n        VEHICLE_2[\"Connected Vehicle 2\u003cbr/\u003e(Pre-installed Firmware)\"]\n        VEHICLE_N[\"Connected Vehicle N\u003cbr/\u003e(Pre-installed Firmware)\"]\n    end\n    \n    OTA_ENGINE --\u003e CONFIG_REPO\n    OTA_ENGINE --\u003e IOT_GATEWAY\n    STATUS_MONITOR --\u003e IOT_GATEWAY\n    \n    IOT_GATEWAY --\u003e RETRY_HANDLER\n    RETRY_HANDLER --\u003e API_IOT\n    IOT_GATEWAY --\u003e API_IOT\n    \n    API_IOT --\u003e IOT_NETWORK\n    IOT_NETWORK --\u003e VEHICLE_1\n    IOT_NETWORK --\u003e VEHICLE_2\n    IOT_NETWORK --\u003e VEHICLE_N\n    \n    VEHICLE_1 -.-\u003e|\"Status Reports\"| IOT_NETWORK\n    VEHICLE_2 -.-\u003e|\"Status Reports\"| IOT_NETWORK\n    VEHICLE_N -.-\u003e|\"Status Reports\"| IOT_NETWORK\n    \n    IOT_NETWORK -.-\u003e|\"Telemetry\"| API_IOT\n    API_IOT -.-\u003e|\"Status Data\"| IOT_GATEWAY\n    IOT_GATEWAY -.-\u003e|\"Vehicle State\"| STATUS_MONITOR\n```\n\n**Layer Responsibilities:**\n\n| Layer | Components | Responsibility |\n|-------|-----------|----------------|\n| **CaaS Platform** | OTA Engine, Status Monitor, Config Repository | Business logic for service activation and vehicle monitoring |\n| **Integration** | IoT Gateway, Retry Handler | Adapter for API IoT with failure handling |\n| **API Interface** | API IoT | Documented external interface (immutable) |\n| **Network Transport** | IoT Network | Physical connectivity infrastructure (cellular, satellite) |\n| **Vehicle Fleet** | Connected Vehicles | Firmware execution and status reporting |\n\nSources: [enunciado.md:7-8](), [pasame las preguntas y sus respuestas a markdown.md:34-38]()\n\n### Connectivity Characteristics\n\n**Unidirectional vs Bidirectional:**\n- **Initial State**: Vehicles initially had unidirectional communication for position reporting only\n- **CaaS Enhancement**: API IoT enables bidirectional communication for configuration and status\n- **Network Protocol**: Cellular and/or satellite connectivity (specific protocols abstracted by API IoT)\n\n**Vehicle Identification:**\n- Each vehicle is uniquely identifiable in the IoT network\n- Vehicle-to-customer association is managed by CaaS core systems\n- Mobile application can establish direct connection to assigned vehicle (separate from CaaS API path)\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:34-38]()\n\n## OTA Service Activation Process\n\n### Activation Workflow\n\nWhen a customer purchases an optional service (opcin disponible), the activation process executes entirely through remote OTA configuration. No workshop visit is required.\n\n**Complete OTA Activation Flow**\n\n```mermaid\nflowchart TD\n    START[\"Customer Pays for Service\u003cbr/\u003e(Payment Confirmed)\"]\n    \n    START --\u003e LOOKUP[\"Lookup Service Configuration\u003cbr/\u003efrom Configuration Repository\"]\n    LOOKUP --\u003e BUILD[\"Build OTA Command\u003cbr/\u003efor Target Vehicle\"]\n    \n    BUILD --\u003e SEND1[\"Attempt 1:\u003cbr/\u003eSend Configuration via API IoT\"]\n    \n    SEND1 --\u003e CHECK1{Check\u003cbr/\u003eActivation Status}\n    CHECK1 --\u003e|\"Success\"| NOTIFY_SUCCESS[\"Notify Customer:\u003cbr/\u003eService Active\"]\n    CHECK1 --\u003e|\"Failure\"| WAIT1[\"Wait for Retry Interval\"]\n    \n    WAIT1 --\u003e SEND2[\"Attempt 2:\u003cbr/\u003eRetry OTA Command\"]\n    SEND2 --\u003e CHECK2{Check\u003cbr/\u003eActivation Status}\n    CHECK2 --\u003e|\"Success\"| NOTIFY_SUCCESS\n    CHECK2 --\u003e|\"Failure\"| WAIT2[\"Wait for Retry Interval\"]\n    \n    WAIT2 --\u003e SEND3[\"Attempt N:\u003cbr/\u003eFinal Retry\"]\n    SEND3 --\u003e CHECK3{Check\u003cbr/\u003eActivation Status}\n    CHECK3 --\u003e|\"Success\"| NOTIFY_SUCCESS\n    CHECK3 --\u003e|\"Failure\"| QUERY_STATUS[\"Proactively Query\u003cbr/\u003eVehicle Status via API IoT\"]\n    \n    QUERY_STATUS --\u003e ESCALATE[\"Send to Technical Support\u003cbr/\u003ewith Vehicle Status Data\"]\n    ESCALATE --\u003e NO_CHARGE[\"DO NOT CHARGE Customer\u003cbr/\u003eService Not Delivered\"]\n    ESCALATE --\u003e NOTIFY_FAILURE[\"Notify Customer:\u003cbr/\u003eActivation Failed\"]\n    \n    NOTIFY_SUCCESS --\u003e UPDATE_DB[\"Update Service Database:\u003cbr/\u003eService Active\"]\n    NO_CHARGE --\u003e UPDATE_DB_FAIL[\"Update Service Database:\u003cbr/\u003eActivation Failed (No Charge)\"]\n    \n    UPDATE_DB --\u003e END[\"End\"]\n    UPDATE_DB_FAIL --\u003e END\n    NOTIFY_FAILURE --\u003e END\n```\n\n**Critical Business Rules:**\n1. **Multiple Retry Attempts**: System retries OTA activation a configurable number of times\n2. **Proactive Status Query**: After final failure, system actively queries vehicle state (not passive waiting)\n3. **Technical Support Escalation**: Failed activations are routed to support with full diagnostic data\n4. **Customer Protection**: **Never charge** for services that fail to activate (critical requirement)\n5. **Customer Communication**: System notifies customer of both success and failure outcomes\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53](), [enunciado.md:19-20]()\n\n### Activation Components\n\n**OTA Activation Engine Responsibilities:**\n- Retrieve service configuration definitions from repository\n- Translate service definitions into API IoT command format\n- Execute retry logic with exponential backoff or fixed intervals\n- Track activation state for each service instance\n- Coordinate with notification engine for customer updates\n- Integrate with payment system for charge/no-charge decisions\n\n**Configuration Repository:**\n- Stores service-to-firmware mapping (which firmware features map to which CaaS services)\n- Maintains activation parameters (command structure, timeout values)\n- Defines retry policies per service type\n- May contain different configurations for different vehicle models/platforms\n\n**Notification Channels:**\n- **Mobile Application**: Real-time push notification of activation status\n- **Vehicle Display**: Confirmation message shown in vehicle's information system\n- **Email**: Confirmation or failure notification sent to customer\n\nSources: [enunciado.md:19-20](), [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n## Pre-installed Functionality Model\n\n### Firmware Architecture\n\nAll vehicles manufactured for CaaS sale contain **complete firmware** with all optional features already installed. OTA operations do not transfer new software to vehicles; they only modify **configuration flags** to enable or disable existing functionality.\n\n**Firmware Composition:**\n- **Plataforma Base**: Core features enabled by default (always active)\n- **Opciones Disponibles**: Optional features present but disabled by default\n- **Configuration State**: Binary flags or parameters controlling feature activation\n\n**Activation vs Software Update:**\n\n| Operation | Description | CaaS Involvement | Workshop Required |\n|-----------|-------------|------------------|-------------------|\n| **OTA Activation** | Enable pre-installed optional feature | CaaS sends configuration command | No |\n| **OTA Deactivation** | Disable previously enabled feature | CaaS sends configuration command | No |\n| **Firmware Update** | Install new software version | Independent process, not CaaS responsibility | Varies |\n\n**Key Distinction**: CaaS **never installs software** on vehicles. Software updates (patching, new firmware versions) are handled by a separate vehicle lifecycle management process outside CaaS scope.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:55-56]()\n\n### Service-to-Firmware Mapping\n\nThe Configuration Repository maintains the mapping between CaaS service catalog entries and the corresponding firmware configuration parameters.\n\n**Example Mapping Table:**\n\n| CaaS Service Name | Firmware Module | Configuration Parameter | Activation Value |\n|-------------------|-----------------|------------------------|------------------|\n| \"Aumento Potencia 50%\" | Engine Control Unit | `power_mode` | `HIGH` |\n| \"Conduccin Autnoma\" | ADAS System | `autonomous_highway_enabled` | `true` |\n| \"Modo Nieve\" | Traction Control | `snow_mode_available` | `1` |\n| \"Climatizacin Premium\" | HVAC System | `climate_zones` | `4` |\n\nThis mapping is critical for translating business-level service purchases into technical configuration commands sent via API IoT.\n\nSources: [enunciado.md:3-5](), [pasame las preguntas y sus respuestas a markdown.md:55-56]()\n\n## Vehicle Status Reporting\n\n### Status Data Types\n\nVehicles continuously report operational status to the IoT network, which is then accessible via API IoT. CaaS queries this data for monitoring and decision-making.\n\n**Status Categories:**\n- **Operational State**: Vehicle running, parked, charging (if electric), etc.\n- **Configuration State**: Which optional features are currently active\n- **Diagnostic State**: Error codes, system health indicators\n- **Connectivity State**: Signal strength, last communication timestamp\n- **Geolocation**: Current vehicle position (original IoT network functionality)\n\n**Important Constraint**: Vehicles do **not** report maintenance status via IoT. Maintenance information must be queried from the external VSS (Vehicle Service System) maintained by workshops. See [VSS Integration](#5.2).\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:72-73](), [enunciado.md:7-8]()\n\n### Status Query Patterns\n\n**Pull-Based Status Retrieval:**\n\n```mermaid\nsequenceDiagram\n    participant CAAS as \"CaaS System\"\n    participant IOT_API as \"API IoT\"\n    participant IOT_NET as \"IoT Network\"\n    participant VEHICLE as \"Vehicle\"\n    \n    Note over CAAS: Trigger: OTA failure or\u003cbr/\u003escheduled health check\n    \n    CAAS-\u003e\u003eIOT_API: GET /vehicle/{id}/status\n    IOT_API-\u003e\u003eIOT_NET: Query vehicle state\n    IOT_NET-\u003e\u003eVEHICLE: Status request\n    VEHICLE--\u003e\u003eIOT_NET: Current status data\n    IOT_NET--\u003e\u003eIOT_API: Formatted status response\n    IOT_API--\u003e\u003eCAAS: Vehicle status JSON\n    \n    CAAS-\u003e\u003eCAAS: Process status\u003cbr/\u003e(e.g., send to tech support)\n```\n\n**Push-Based Telemetry (Continuous):**\n\n```mermaid\nsequenceDiagram\n    participant VEHICLE as \"Vehicle\"\n    participant IOT_NET as \"IoT Network\"\n    participant IOT_API as \"API IoT\"\n    participant CAAS as \"CaaS Vehicle Monitor\"\n    \n    loop Every N seconds/minutes\n        VEHICLE-\u003e\u003eIOT_NET: Push telemetry data\u003cbr/\u003e(position, status)\n        IOT_NET-\u003e\u003eIOT_API: Forward telemetry\n        IOT_API-\u003e\u003eCAAS: Real-time status update\n        CAAS-\u003e\u003eCAAS: Update vehicle state cache\n    end\n```\n\nCaaS implements both patterns:\n- **Push**: For real-time monitoring and dashboard updates\n- **Pull**: For on-demand queries (especially during OTA failure diagnostics)\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53](), [enunciado.md:7-8]()\n\n## Communication Patterns\n\n### Bidirectional Communication\n\nThe API IoT enables bidirectional communication between CaaS and vehicles:\n\n**CaaS  Vehicle (Command Flow):**\n- OTA configuration commands for service activation/deactivation\n- Query commands for status retrieval\n- Diagnostic commands for troubleshooting\n\n**Vehicle  CaaS (Telemetry Flow):**\n- Periodic status reports (operational state, position)\n- Command acknowledgment and execution results\n- Diagnostic data and error conditions\n- Configuration state confirmation\n\n**Communication Pattern Diagram**\n\n```mermaid\ngraph LR\n    subgraph \"CaaS Platform\"\n        CMD_SENDER[\"Command Sender\u003cbr/\u003e(OTA Engine)\"]\n        TELEM_RECEIVER[\"Telemetry Receiver\u003cbr/\u003e(Status Monitor)\"]\n    end\n    \n    subgraph \"API IoT\"\n        API_CMD[\"Command API\u003cbr/\u003ePOST /configure\"]\n        API_STATUS[\"Status API\u003cbr/\u003eGET /status\"]\n        API_TELEM[\"Telemetry Webhook\u003cbr/\u003ePOST /telemetry\"]\n    end\n    \n    subgraph \"Vehicle\"\n        V_RECEIVER[\"Command Receiver\"]\n        V_SENDER[\"Status Reporter\"]\n    end\n    \n    CMD_SENDER --\u003e|\"Configuration Commands\"| API_CMD\n    API_CMD --\u003e|\"Forward\"| V_RECEIVER\n    \n    V_SENDER --\u003e|\"Status Reports\"| API_TELEM\n    API_TELEM --\u003e|\"Forward\"| TELEM_RECEIVER\n    \n    CMD_SENDER --\u003e|\"Query Status\"| API_STATUS\n    API_STATUS --\u003e|\"Query\"| V_SENDER\n    V_SENDER --\u003e|\"Response\"| API_STATUS\n    API_STATUS --\u003e|\"Return\"| CMD_SENDER\n```\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:34-38](), [enunciado.md:7-8]()\n\n### Mobile Application Direct Link\n\nThe mobile application has a **dual-path architecture** for vehicle interaction:\n\n**Path 1: Via CaaS Platform**\n- Service purchases and management\n- Expediente de compra access\n- Payment processing\n- Historical data and invoices\n\n**Path 2: Direct to Vehicle**\n- Real-time vehicle control (lock/unlock, climate pre-conditioning)\n- Direct status queries (faster response)\n- Emergency commands\n\nThis direct link operates independently of the CaaS business logic layer, providing lower latency for operational commands while the CaaS platform handles transactional operations.\n\nSources: High-level architecture diagram context (Diagram 1 from context)\n\n## Retry Logic and Failure Handling\n\n### Retry Strategy\n\nThe OTA activation system implements sophisticated retry logic to maximize activation success while avoiding infinite retry loops.\n\n**Retry Configuration:**\n\n| Parameter | Typical Value | Configurable |\n|-----------|--------------|--------------|\n| Maximum Attempts | 3-5 | Yes |\n| Retry Interval | 30-60 seconds | Yes |\n| Backoff Strategy | Fixed or Exponential | Yes |\n| Timeout per Attempt | 10-30 seconds | Yes |\n\n**Retry Decision Logic:**\n\n```mermaid\nflowchart TD\n    ATTEMPT[\"Send OTA Command\"]\n    ATTEMPT --\u003e WAIT[\"Wait for Acknowledgment\"]\n    \n    WAIT --\u003e TIMEOUT{Timeout\u003cbr/\u003eExceeded?}\n    TIMEOUT --\u003e|\"No\"| SUCCESS{Command\u003cbr/\u003eSuccessful?}\n    TIMEOUT --\u003e|\"Yes\"| FAILURE[\"Mark Attempt Failed\"]\n    \n    SUCCESS --\u003e|\"Yes\"| COMPLETE[\"Activation Complete\"]\n    SUCCESS --\u003e|\"No\"| FAILURE\n    \n    FAILURE --\u003e RETRY_CHECK{Retries\u003cbr/\u003eRemaining?}\n    RETRY_CHECK --\u003e|\"Yes\"| BACKOFF[\"Wait Retry Interval\"]\n    RETRY_CHECK --\u003e|\"No\"| QUERY[\"Proactive Status Query\"]\n    \n    BACKOFF --\u003e ATTEMPT\n    QUERY --\u003e ESCALATE[\"Escalate to Tech Support\"]\n    \n    COMPLETE --\u003e END[\"Success Path\"]\n    ESCALATE --\u003e END[\"Failure Path\"]\n```\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n### Failure Escalation\n\nWhen all retry attempts are exhausted, the system executes a **proactive diagnostic protocol**:\n\n**Escalation Steps:**\n1. **Proactive Status Query**: System actively queries vehicle via API IoT to retrieve current state, diagnostic codes, and connectivity metrics\n2. **Data Package Creation**: Assemble complete diagnostic package including:\n   - Service definition that failed to activate\n   - All retry attempt logs with timestamps and error codes\n   - Current vehicle status snapshot\n   - Customer and vehicle identification data\n3. **Technical Support Notification**: Send diagnostic package to technical support queue or ticketing system\n4. **Customer Communication**: Notify customer of activation failure with apology and resolution timeline\n5. **Financial Protection**: **Do NOT charge customer** for the undelivered service (critical business rule)\n6. **Service Record Update**: Mark service activation as failed in service database\n\n**No Charge Rule**: This is the most critical failure handling policy. Customers are never charged for services that fail to activate, regardless of the reason. This protects customer trust and ensures legal compliance (no charging for undelivered services).\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n### Failure Scenarios and Handling\n\n| Failure Type | Detection Method | Handling Strategy |\n|--------------|------------------|-------------------|\n| **Vehicle Offline** | Timeout on command acknowledgment | Retry with longer intervals; may succeed when vehicle comes online |\n| **Configuration Rejected** | Error response from vehicle | Query vehicle logs; may indicate firmware incompatibility |\n| **Partial Activation** | Status query shows inconsistent state | Attempt deactivation + reactivation; escalate if persists |\n| **Network Interruption** | Timeout during command transmission | Retry immediately; network issue likely temporary |\n| **Firmware Error** | Vehicle reports internal error code | Escalate immediately; may require firmware update outside CaaS |\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n## Integration Points\n\n### Connection to CaaS Core Systems\n\nThe vehicle communication subsystem integrates with multiple CaaS platform components:\n\n**Integration Map**\n\n```mermaid\ngraph TB\n    subgraph \"Vehicle Communication Subsystem\"\n        IOT_GW[\"IoT Gateway\"]\n        OTA_ENG[\"OTA Engine\"]\n        STATUS_MON[\"Status Monitor\"]\n    end\n    \n    subgraph \"CaaS Core Systems\"\n        PAYMENT[\"Payment Processing\"]\n        SERVICE_CAT[\"Service Catalog\"]\n        NOTIF[\"Notification Engine\"]\n        SERVICE_DB[\"Service Database\"]\n        TECH_SUP[\"Technical Support System\"]\n    end\n    \n    PAYMENT --\u003e|\"Payment Confirmed\"| OTA_ENG\n    OTA_ENG --\u003e|\"Retrieve Service Config\"| SERVICE_CAT\n    OTA_ENG --\u003e|\"Send OTA Command\"| IOT_GW\n    \n    IOT_GW --\u003e|\"Activation Success\"| NOTIF\n    IOT_GW --\u003e|\"Activation Failure\"| NOTIF\n    IOT_GW --\u003e|\"Activation Failure\"| TECH_SUP\n    \n    OTA_ENG --\u003e|\"Update Service Status\"| SERVICE_DB\n    STATUS_MON --\u003e|\"Vehicle Telemetry\"| SERVICE_DB\n    \n    NOTIF --\u003e|\"Push to Mobile\"| MOBILE[\"Mobile App\"]\n    NOTIF --\u003e|\"Send Email\"| EMAIL[\"Email Service\"]\n    \n    IOT_GW --\u003e|\"Status Query\"| API_IOT[\"API IoT Interface\"]\n    API_IOT --\u003e|\"Telemetry Stream\"| STATUS_MON\n```\n\n**Integration Responsibilities:**\n\n| Source System | Target System | Data Flow | Trigger |\n|---------------|---------------|-----------|---------|\n| Payment Processing | OTA Engine | Service purchase + customer ID | Successful payment |\n| OTA Engine | Service Catalog | Service configuration query | Pre-activation lookup |\n| OTA Engine | IoT Gateway | OTA command | Service activation request |\n| IoT Gateway | API IoT | Configuration command | OTA command forwarding |\n| API IoT | Status Monitor | Telemetry stream | Continuous vehicle reporting |\n| Status Monitor | Service Database | Vehicle state updates | Real-time telemetry |\n| OTA Engine | Notification Engine | Activation result | Post-activation (success/failure) |\n| OTA Engine | Technical Support | Diagnostic package | Activation failure after retries |\n| OTA Engine | Service Database | Service status | Activation completion (any outcome) |\n\nSources: [enunciado.md:19-20](), [pasame las preguntas y seus respuestas a markdown.md:48-53]()\n\n### Mobile Application Integration\n\nThe mobile application has dual integration paths for vehicle interaction:\n\n**Indirect Path (via CaaS):**\n- User browses opciones disponibles in service catalog\n- User initiates service purchase\n- Payment flows through CaaS payment processing\n- OTA activation occurs via CaaS  API IoT  Vehicle\n- Status updates pushed back to mobile app via notification engine\n\n**Direct Path (app to vehicle):**\n- User sends operational commands (lock, unlock, climate control)\n- Mobile app connects directly to vehicle (likely via API IoT but bypassing CaaS business logic)\n- Commands executed in real-time without CaaS mediation\n- Status updates received directly by mobile app\n\nThis architecture separates **transactional operations** (purchases, requiring CaaS validation) from **operational commands** (vehicle control, requiring low latency).\n\nSources: High-level architecture context (Diagram 1), [enunciado.md:17]()\n\n## Security and Authorization\n\n### Vehicle-Customer Association\n\nThe system must securely associate vehicles with authorized customers to prevent unauthorized configuration changes:\n\n**Authorization Model:**\n- Each vehicle has a unique identifier in the IoT network\n- Customer accounts are linked to specific vehicle IDs during delivery process\n- OTA commands include both vehicle ID and customer authorization token\n- API IoT validates authorization before executing configuration changes\n- Mobile app must authenticate and prove vehicle ownership before direct commands\n\n**Multi-Customer Scenarios:**\n- Vehicle ownership transfer requires updating vehicle-customer association\n- Used vehicle sales must revoke previous customer access\n- Temporary sharing (e.g., family members) may require role-based access control\n\nSources: [enunciado.md:17]()\n\n### API Security\n\nWhile the API IoT is pre-existing and cannot be modified, CaaS must implement security controls at the integration layer:\n\n**Security Layers:**\n- **Authentication**: API keys or tokens for CaaS-to-API IoT communication\n- **Authorization**: Vehicle ownership validation before command execution\n- **Encryption**: TLS/SSL for all API communication (assumed standard practice)\n- **Rate Limiting**: Prevent abuse or DoS attacks on vehicle fleet\n- **Audit Logging**: Record all configuration commands for compliance and debugging\n\nSources: General best practices implied by system architecture\n\n## Monitoring and Observability\n\n### Operational Metrics\n\nThe vehicle communication subsystem should expose metrics for monitoring and operational insight:\n\n**Key Metrics:**\n\n| Metric | Description | Alert Threshold |\n|--------|-------------|-----------------|\n| **OTA Success Rate** | Percentage of activations successful on first attempt | \u003c 90% |\n| **Average Retry Count** | Average retries needed for successful activation | \u003e 2.0 |\n| **Activation Latency** | Time from payment to activation confirmation | \u003e 5 minutes |\n| **Vehicle Connectivity Rate** | Percentage of fleet currently online | \u003c 95% |\n| **Failed Activation Count** | Services escalated to technical support | \u003e 10 per day |\n| **API IoT Availability** | Uptime of API IoT interface | \u003c 99.9% |\n\n**Monitoring Integration:**\n- Metrics exposed via monitoring API or dashboard\n- Alerts sent to operations team for threshold violations\n- Historical trends tracked for capacity planning\n- Per-vehicle tracking for identifying problematic units\n\nSources: Implied by system requirements for operational excellence\n\n### Diagnostic Capabilities\n\nFor troubleshooting OTA failures and vehicle communication issues:\n\n**Diagnostic Tools:**\n- **Command History**: Full log of all OTA commands sent to each vehicle\n- **Status Timeline**: Historical vehicle status reports over time\n- **Connectivity Log**: Record of when vehicles were online/offline\n- **Error Code Repository**: Database of vehicle error codes and resolutions\n- **Test Mode**: Ability to send test commands to verify communication path\n\nThese tools support technical support staff in diagnosing and resolving activation failures, ensuring rapid customer issue resolution.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n**Document Summary:**\n\nThis page documented the vehicle communication infrastructure that enables the CaaS business model. The key architectural constraints are the pre-existing API IoT interface and the pre-installed functionality model where vehicles contain all optional features at manufacture time. The OTA activation system is the critical technical differentiator, delivering purchased services remotely with sophisticated retry logic and customer-protective failure handling (no charge for failed activations). The bidirectional communication pattern enables both command delivery and continuous vehicle monitoring, while the mobile application's dual-path architecture separates transactional operations from real-time vehicle control."])</script><script>self.__next_f.push([1,"25:T5a0b,"])</script><script>self.__next_f.push([1,"# Payment Gateway Integration\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details how the CaaS platform integrates with external payment gateways to process financial transactions for vehicle purchases and service activations. It covers payment processing workflows, asynchronous settlement handling, risk management strategies, and failure scenarios.\n\nFor broader context on payment types and billing models, see [Payment Types and Flows](#7.1). For risk management strategy details, see [Risk Management and Settlement](#7.2). For payment failure scenarios, see [Payment Failure Scenarios](#9.2).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:75-104]()\n\n---\n\n## Payment Gateway as External System\n\nThe payment gateway is an **external third-party system** that CaaS integrates with to process credit card and bank payments. CaaS does not implement its own payment processing logic; instead, it delegates all financial transaction handling to certified payment service providers.\n\n### Integration Characteristics\n\n| Characteristic | Description |\n|---|---|\n| **System Type** | External third-party payment processor |\n| **Communication Model** | Asynchronous (fire-and-forget with delayed settlement) |\n| **Risk Ownership** | CaaS assumes settlement risk |\n| **Integration Pattern** | API-based request-response with webhook callbacks |\n| **Scope** | Card processing, bank transfers, settlement notifications |\n\nThe payment gateway handles PCI-DSS compliance, fraud detection, and banking network communication. CaaS receives payment confirmation asynchronously after initiating transactions.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Payment Architecture Overview\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform\"\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Dealership Sales)\"]\n        WEB[\"Web Platform\u003cbr/\u003e(Customer Self-Service)\"]\n        MOBILE[\"Mobile Application\u003cbr/\u003e(Customer Self-Service)\"]\n        PAYMENT_PROC[\"Payment Processing\u003cbr/\u003eSubsystem\"]\n        ORDER_MGT[\"Order Management\u003cbr/\u003eSubsystem\"]\n        SERVICE_CAT[\"Service Catalog\u003cbr/\u003eSubsystem\"]\n        OTA_ENGINE[\"OTA Activation Engine\"]\n        BILLING_DB[(\"Billing Database\")]\n    end\n    \n    subgraph \"External Systems\"\n        PAYMENT_GW[\"Payment Gateway\u003cbr/\u003e(External Provider)\"]\n        BANK[\"Banking Networks\"]\n    end\n    \n    INTRANET --\u003e|\"Reservation Payment\"| PAYMENT_PROC\n    INTRANET --\u003e|\"Final Payment\"| PAYMENT_PROC\n    WEB --\u003e|\"Service Payment\"| PAYMENT_PROC\n    MOBILE --\u003e|\"Service Payment\"| PAYMENT_PROC\n    \n    PAYMENT_PROC --\u003e|\"Process Transaction\"| PAYMENT_GW\n    PAYMENT_GW --\u003e|\"Connect to Banks\"| BANK\n    PAYMENT_GW -.-\u003e|\"Async Settlement\u003cbr/\u003eNotification\"| PAYMENT_PROC\n    \n    PAYMENT_PROC --\u003e|\"Payment Initiated\"| ORDER_MGT\n    PAYMENT_PROC --\u003e|\"Payment Initiated\"| SERVICE_CAT\n    PAYMENT_PROC --\u003e|\"Trigger Activation\"| OTA_ENGINE\n    \n    PAYMENT_PROC --\u003e|\"Record Transaction\"| BILLING_DB\n    ORDER_MGT --\u003e|\"Query Payment Status\"| BILLING_DB\n    SERVICE_CAT --\u003e|\"Query Payment Status\"| BILLING_DB\n    \n    style PAYMENT_GW fill:#f9f9f9,stroke:#333,stroke-width:2px\n    style PAYMENT_PROC fill:#e6e6e6,stroke:#333,stroke-width:2px\n```\n\n**Diagram 1: Payment Gateway Integration Architecture**\n\nThe architecture demonstrates **immediate service delivery despite asynchronous settlement**. CaaS initiates payment processing through the gateway and proceeds with service activation before receiving final settlement confirmation from banking networks.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Payment Types and Transaction Flows\n\nCaaS processes four distinct payment types, each with different characteristics and risk profiles:\n\n### Payment Type Matrix\n\n| Payment Type | Timing | Settlement Model | Risk Level | Business Impact |\n|---|---|---|---|---|\n| **Reservation Payment** | At vehicle reservation | Synchronous verification | Low | Blocks inventory |\n| **Final Payment** | Before vehicle registration | Synchronous verification | High | Releases vehicle |\n| **One-Time Service Payment** | At service purchase | **Asynchronous** | Medium | Immediate OTA activation |\n| **Subscription Payment** | Month-end (mes vencido) | **Asynchronous** | High | Post-paid model |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82](), [enunciado.md:13-19]()\n\n---\n\n## Reservation Payment Flow\n\n```mermaid\nsequenceDiagram\n    participant DEALER as \"Dealership\u003cbr/\u003e(Intranet)\"\n    participant PAYMENT as \"Payment Processing\u003cbr/\u003eSubsystem\"\n    participant GATEWAY as \"Payment Gateway\"\n    participant ORDER as \"Order Management\"\n    participant FACTORY as \"Factory API\"\n    \n    DEALER-\u003e\u003ePAYMENT: \"Initiate Reservation Payment\u003cbr/\u003e(Customer Data + Amount)\"\n    PAYMENT-\u003e\u003eGATEWAY: \"Process Payment Request\u003cbr/\u003e(Card/Bank Details)\"\n    GATEWAY-\u003e\u003eGATEWAY: \"Verify Funds\"\n    GATEWAY--\u003e\u003ePAYMENT: \"Payment Confirmation\u003cbr/\u003e(Synchronous)\"\n    \n    alt Payment Successful\n        PAYMENT-\u003e\u003eORDER: \"Mark Vehicle Reserved\"\n        ORDER-\u003e\u003eFACTORY: \"POST /orders\u003cbr/\u003e(Place Factory Order)\"\n        FACTORY--\u003e\u003eORDER: \"Order Confirmation\"\n        PAYMENT-\u003e\u003eDEALER: \"Reservation Complete\"\n        DEALER-\u003e\u003eCustomer: \"Send Access Credentials\"\n    else Payment Failed\n        PAYMENT-\u003e\u003eDEALER: \"Payment Failed\"\n        DEALER-\u003e\u003eCustomer: \"Notify Failure\"\n    end\n```\n\n**Diagram 2: Reservation Payment Sequence**\n\nReservation payments are processed **synchronously** because they determine whether the vehicle manufacturing process begins. The dealership waits for payment confirmation before proceeding with factory order placement.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82](), [enunciado.md:13-14]()\n\n---\n\n## Final Payment Flow and Critical Failure Handling\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant PLATFORM as \"Web/Mobile Platform\"\n    participant PAYMENT as \"Payment Processing\"\n    participant GATEWAY as \"Payment Gateway\"\n    participant ORDER as \"Order Management\"\n    participant ADMIN as \"Admin Registration API\"\n    participant TRANSPORT as \"Transport System\"\n    \n    CUSTOMER-\u003e\u003ePLATFORM: \"Vehicle Ready Notification\"\n    CUSTOMER-\u003e\u003ePLATFORM: \"Initiate Final Payment\"\n    PLATFORM-\u003e\u003ePAYMENT: \"Process Final Payment\"\n    PAYMENT-\u003e\u003eGATEWAY: \"Execute Transaction\"\n    GATEWAY--\u003e\u003ePAYMENT: \"Payment Confirmation\"\n    \n    alt Payment Successful\n        PAYMENT-\u003e\u003eORDER: \"Mark Fully Paid\"\n        ORDER-\u003e\u003eADMIN: \"Register Vehicle\u003cbr/\u003e(Matriculation)\"\n        ADMIN--\u003e\u003eORDER: \"Registration Complete\"\n        ORDER-\u003e\u003eTRANSPORT: \"Schedule Delivery\"\n        PAYMENT-\u003e\u003eCUSTOMER: \"Payment Confirmed\"\n    else Payment Failed\n        PAYMENT-\u003e\u003eORDER: \"Mark Payment Failed\"\n        ORDER-\u003e\u003eORDER: \"Mark Vehicle Sin Asignar\u003cbr/\u003e(Unassigned)\"\n        ORDER-\u003e\u003eORDER: \"Add to Stock Inventory\"\n        PAYMENT-\u003e\u003eCUSTOMER: \"Payment Failed\u003cbr/\u003eReservation Lost\"\n        Note over ORDER: \"Vehicle becomes\u003cbr/\u003eavailable for\u003cbr/\u003eimmediate sale\"\n    end\n```\n\n**Diagram 3: Final Payment Flow with Failure Scenario**\n\n**Critical Business Rule:** If the final payment fails, the customer **loses the reservation entirely**. The vehicle is immediately marked as \"sin asignar\" (unassigned) and returned to stock for immediate sale to other customers.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-28](), [enunciado.md:14-17]()\n\n---\n\n## Service Payment Flow with Asynchronous Settlement\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant PLATFORM as \"Web/Mobile Platform\"\n    participant PAYMENT as \"Payment Processing\"\n    participant GATEWAY as \"Payment Gateway\"\n    participant OTA as \"OTA Activation Engine\"\n    participant IOT as \"IoT Gateway\"\n    participant VEHICLE as \"Vehicle\"\n    participant BANK as \"Banking Network\"\n    \n    CUSTOMER-\u003e\u003ePLATFORM: \"Select Service + Duration\"\n    PLATFORM-\u003e\u003ePAYMENT: \"Initiate Service Payment\"\n    PAYMENT-\u003e\u003eGATEWAY: \"Process Payment\"\n    GATEWAY--\u003e\u003ePAYMENT: \"Payment Initiated\u003cbr/\u003e(NOT Settled)\"\n    \n    Note over PAYMENT: \"IMMEDIATE DELIVERY\u003cbr/\u003eCaaS Assumes Risk\"\n    \n    PAYMENT-\u003e\u003eOTA: \"Trigger OTA Activation\"\n    OTA-\u003e\u003eIOT: \"Send Activation Command\"\n    IOT-\u003e\u003eVEHICLE: \"Configure Service\"\n    VEHICLE--\u003e\u003eIOT: \"Configuration Applied\"\n    IOT--\u003e\u003eOTA: \"Activation Successful\"\n    OTA-\u003e\u003eCUSTOMER: \"Service Active Notification\"\n    \n    Note over GATEWAY,BANK: \"Asynchronous Process\u003cbr/\u003e(Hours/Days Later)\"\n    GATEWAY-\u003e\u003eBANK: \"Settlement Request\"\n    BANK--\u003e\u003eGATEWAY: \"Settlement Confirmation\"\n    GATEWAY-\u003e\u003ePAYMENT: \"Settlement Webhook\"\n    PAYMENT-\u003e\u003ePAYMENT: \"Record Final Settlement\"\n```\n\n**Diagram 4: Service Payment with Asynchronous Settlement**\n\n**Key Architectural Decision:** CaaS delivers services **immediately upon payment initiation**, without waiting for final bank settlement. This optimizes customer experience but means CaaS assumes the risk of chargebacks and settlement failures.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Risk Management Strategy\n\n### Immediate Delivery vs. Settlement Delay\n\nCaaS implements an **aggressive risk assumption strategy** to optimize customer experience:\n\n```mermaid\ngraph LR\n    subgraph \"Traditional Model\"\n        T1[\"Payment\u003cbr/\u003eInitiation\"]\n        T2[\"Wait for\u003cbr/\u003eSettlement\"]\n        T3[\"Service\u003cbr/\u003eDelivery\"]\n        T1 --\u003e T2\n        T2 --\u003e T3\n    end\n    \n    subgraph \"CaaS Model (Risk Assumption)\"\n        C1[\"Payment\u003cbr/\u003eInitiation\"]\n        C2[\"IMMEDIATE\u003cbr/\u003eService Delivery\"]\n        C3[\"Async\u003cbr/\u003eSettlement\"]\n        C1 --\u003e C2\n        C1 -.-\u003e C3\n    end\n    \n    style C2 fill:#f9f9f9,stroke:#333,stroke-width:2px\n```\n\n**Diagram 5: Risk Assumption Model Comparison**\n\n### Risk Mitigation Mechanisms\n\n| Risk Type | Mitigation Strategy | Business Rule |\n|---|---|---|\n| **OTA Activation Failure** | Do NOT charge customer | Critical protection rule |\n| **Settlement Failure** | Reconciliation process | Track discrepancies |\n| **Chargeback Risk** | Accept losses | Cost of better UX |\n| **Fraud Detection** | Gateway provider handles | Delegate to payment gateway |\n\n**Critical Customer Protection Rule:** If OTA activation fails after payment initiation, CaaS **must NOT charge the customer** for the undelivered service. This rule is enforced at the payment processing layer.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53, 77-82]()\n\n---\n\n## Subscription Payment Flow (Mes Vencido)\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant SERVICE as \"Service Catalog\"\n    participant BILLING as \"Billing Subsystem\"\n    participant PAYMENT as \"Payment Processing\"\n    participant GATEWAY as \"Payment Gateway\"\n    \n    CUSTOMER-\u003e\u003eSERVICE: \"Subscribe to Monthly Service\"\n    SERVICE-\u003e\u003eSERVICE: \"Activate Service Immediately\"\n    SERVICE-\u003e\u003eCUSTOMER: \"Service Active\"\n    \n    Note over CUSTOMER,SERVICE: \"Customer uses service\u003cbr/\u003ethroughout the month\"\n    \n    loop Monthly Billing Cycle\n        Note over BILLING: \"End of Month Reached\"\n        BILLING-\u003e\u003eBILLING: \"Calculate Usage Charges\"\n        BILLING-\u003e\u003ePAYMENT: \"Charge Mes Vencido\u003cbr/\u003e(Post-Paid Model)\"\n        PAYMENT-\u003e\u003eGATEWAY: \"Process Monthly Payment\"\n        GATEWAY--\u003e\u003ePAYMENT: \"Payment Result\"\n        \n        alt Payment Successful\n            PAYMENT-\u003e\u003eSERVICE: \"Continue Subscription\"\n            PAYMENT-\u003e\u003eCUSTOMER: \"Invoice Sent\"\n        else Payment Failed\n            PAYMENT-\u003e\u003eSERVICE: \"Mark Subscription Cancelled\"\n            SERVICE-\u003e\u003eSERVICE: \"Deactivate Service\"\n            PAYMENT-\u003e\u003eCUSTOMER: \"Payment Failed Notification\"\n        end\n    end\n```\n\n**Diagram 6: Subscription Payment Flow (Mes Vencido Model)**\n\n**Mes Vencido** means \"expired month\" in Spanish, referring to the **post-paid billing model** where customers are charged at the end of the month for services consumed during that month. This increases collection risk but reduces upfront friction.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Payment Failure Handling Matrix\n\nDifferent payment types have different failure handling strategies:\n\n```mermaid\ngraph TD\n    PAYMENT_FAIL[\"Payment Failure\u003cbr/\u003eDetected\"]\n    \n    PAYMENT_FAIL --\u003e CHECK_TYPE{Payment\u003cbr/\u003eType?}\n    \n    CHECK_TYPE --\u003e|Reservation| RES_FAIL[\"NO vehicle reservation\u003cbr/\u003eCustomer cannot proceed\"]\n    CHECK_TYPE --\u003e|Final| FINAL_FAIL[\"Vehicle Sin Asignar\u003cbr/\u003eAdded to stock\u003cbr/\u003eCustomer loses reservation\"]\n    CHECK_TYPE --\u003e|One-Time Service| SERVICE_FAIL[\"Check OTA status\"]\n    CHECK_TYPE --\u003e|Subscription| SUB_FAIL[\"Cancel subscription\u003cbr/\u003eDeactivate service\"]\n    \n    SERVICE_FAIL --\u003e OTA_CHECK{OTA Already\u003cbr/\u003eActivated?}\n    OTA_CHECK --\u003e|Yes| NO_CHARGE[\"DO NOT CHARGE\u003cbr/\u003eCaaS assumes loss\"]\n    OTA_CHECK --\u003e|No| CANCEL_ORDER[\"Cancel order\u003cbr/\u003eNo activation\"]\n    \n    style FINAL_FAIL fill:#f9f9f9,stroke:#333,stroke-width:2px\n    style NO_CHARGE fill:#f9f9f9,stroke:#333,stroke-width:2px\n```\n\n**Diagram 7: Payment Failure Decision Tree**\n\n### Failure Handling Rules\n\n1. **Reservation Payment Failure:**\n   - No vehicle reservation is created\n   - Customer cannot proceed with purchase\n   - No factory order is placed\n\n2. **Final Payment Failure:**\n   - Customer **loses reservation completely**\n   - Vehicle marked \"sin asignar\" (unassigned)\n   - Vehicle immediately added to stock for sale\n   - **No grace period or retry**\n\n3. **One-Time Service Payment Failure:**\n   - If OTA already activated: **DO NOT CHARGE** (customer protection)\n   - If OTA not yet activated: Cancel order, no service delivery\n   - Customer must re-initiate purchase\n\n4. **Subscription Payment Failure:**\n   - Subscription marked as cancelled\n   - Service deactivated via OTA\n   - No retroactive charges for current month\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-28, 48-53, 77-82]()\n\n---\n\n## Integration Pattern with OTA Engine\n\nThe payment processing subsystem has a **critical integration** with the OTA Activation Engine to ensure the \"do not charge\" protection rule:\n\n```mermaid\ngraph TB\n    PAYMENT[\"Payment Processing\u003cbr/\u003eSubsystem\"]\n    OTA[\"OTA Activation Engine\"]\n    BILLING[\"Billing Database\"]\n    \n    PAYMENT --\u003e|\"1. Payment Initiated\"| OTA\n    OTA --\u003e|\"2. Attempt Activation\"| IOT[\"IoT Gateway\"]\n    IOT -.-\u003e|\"3. Activation Result\"| OTA\n    \n    OTA --\u003e|\"4a. Success\"| PAYMENT\n    OTA --\u003e|\"4b. Failure After Retries\"| PAYMENT\n    \n    PAYMENT --\u003e|\"5a. Commit Charge\u003cbr/\u003e(Success)\"| BILLING\n    PAYMENT --\u003e|\"5b. VOID Charge\u003cbr/\u003e(Failure)\"| BILLING\n    \n    BILLING --\u003e|\"6. Settlement Status\"| GATEWAY[\"Payment Gateway\"]\n    \n    style PAYMENT fill:#e6e6e6,stroke:#333,stroke-width:2px\n```\n\n**Diagram 8: Payment-OTA Integration for Charge Protection**\n\n**Critical Integration Points:**\n\n1. Payment processing initiates transaction but **does NOT commit charge** until OTA confirms activation\n2. OTA engine attempts activation with retry logic (see [OTA Activation Failures](#9.1))\n3. OTA reports final status (success or exhausted retries) back to payment processing\n4. Payment processing either:\n   - **Commits the charge** if activation succeeded\n   - **Voids the charge** if activation failed (customer protection)\n\nThis ensures customers are never charged for services they did not receive.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Payment Data Model\n\nThe payment processing subsystem maintains transaction records in the Billing Database:\n\n### Payment Transaction States\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Initiated: \"Customer submits payment\"\n    \n    Initiated --\u003e Pending: \"Gateway processing\"\n    Pending --\u003e Authorized: \"Funds reserved\"\n    Pending --\u003e Failed: \"Gateway rejection\"\n    \n    Authorized --\u003e Capturing: \"Initiate settlement\"\n    Authorized --\u003e Voided: \"Cancel before capture\u003cbr/\u003e(OTA failure)\"\n    \n    Capturing --\u003e Settled: \"Bank confirms\"\n    Capturing --\u003e SettlementFailed: \"Bank rejects\"\n    \n    Settled --\u003e [*]: \"Complete\"\n    Failed --\u003e [*]: \"Complete\"\n    Voided --\u003e [*]: \"Complete\"\n    SettlementFailed --\u003e Refunding: \"Reverse transaction\"\n    Refunding --\u003e Refunded: \"Refund complete\"\n    Refunded --\u003e [*]: \"Complete\"\n```\n\n**Diagram 9: Payment Transaction State Machine**\n\n### Key States\n\n| State | Description | Business Impact |\n|---|---|---|\n| **Initiated** | Payment request submitted | No funds movement |\n| **Pending** | Gateway processing | Awaiting gateway response |\n| **Authorized** | Funds reserved, not captured | Can be voided if OTA fails |\n| **Capturing** | Settlement in progress | Async process |\n| **Settled** | Funds transferred to CaaS | Payment complete |\n| **Voided** | Cancelled before capture | Used for OTA failures |\n| **Failed** | Gateway or bank rejection | Customer must retry |\n| **Refunded** | Reversed after settlement | For desistimiento cases |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-104]()\n\n---\n\n## Reconciliation Process\n\nCaaS must reconcile payment gateway reports with internal transaction records due to asynchronous settlement:\n\n```mermaid\ngraph TB\n    subgraph \"Daily Reconciliation Process\"\n        START[\"Scheduled Job\u003cbr/\u003e(Daily/Hourly)\"]\n        FETCH[\"Fetch Gateway\u003cbr/\u003eSettlement Reports\"]\n        COMPARE[\"Compare with\u003cbr/\u003eInternal Records\"]\n        DISCREPANCY{Discrepancies\u003cbr/\u003eFound?}\n        RESOLVE[\"Generate\u003cbr/\u003eDiscrepancy Report\"]\n        MANUAL[\"Manual Investigation\u003cbr/\u003eRequired\"]\n        UPDATE[\"Update Internal\u003cbr/\u003eRecords\"]\n        END[\"Reconciliation\u003cbr/\u003eComplete\"]\n        \n        START --\u003e FETCH\n        FETCH --\u003e COMPARE\n        COMPARE --\u003e DISCREPANCY\n        DISCREPANCY --\u003e|Yes| RESOLVE\n        DISCREPANCY --\u003e|No| UPDATE\n        RESOLVE --\u003e MANUAL\n        MANUAL --\u003e UPDATE\n        UPDATE --\u003e END\n    end\n```\n\n**Diagram 10: Payment Reconciliation Workflow**\n\n### Common Discrepancy Scenarios\n\n1. **Delayed Settlement:** Gateway reports settlement later than expected\n2. **Chargebacks:** Customer disputes transaction after service delivery\n3. **Partial Settlements:** Only part of transaction amount settled\n4. **Failed Settlements:** Authorization succeeded but settlement failed\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Security and Compliance Considerations\n\n### PCI-DSS Compliance\n\nCaaS **does NOT handle card data directly**. All sensitive payment information is processed by the certified payment gateway provider:\n\n| Responsibility | Owner |\n|---|---|\n| **Card data handling** | Payment Gateway |\n| **PCI-DSS compliance** | Payment Gateway |\n| **Fraud detection** | Payment Gateway |\n| **Payment form security** | Payment Gateway (hosted forms) |\n| **Transaction logging** | CaaS (non-sensitive data only) |\n| **Settlement reconciliation** | CaaS |\n\n### Data Retention\n\nCaaS stores only:\n- Transaction IDs (gateway-provided)\n- Transaction amounts\n- Transaction timestamps\n- Transaction states\n- Customer references\n- **NO card numbers or CVV codes**\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Integration API Design\n\nThe payment processing subsystem exposes internal APIs to other CaaS subsystems:\n\n### Internal Payment API Endpoints\n\n| Endpoint | Purpose | Caller | Synchronous? |\n|---|---|---|---|\n| `initiateReservationPayment()` | Process reservation signal | Order Management | Yes |\n| `initiateFinalPayment()` | Process final vehicle payment | Order Management | Yes |\n| `initiateServicePayment()` | Process one-time service payment | Service Catalog | Yes (initiation only) |\n| `initiateSubscriptionPayment()` | Process monthly subscription charge | Billing Subsystem | Yes (initiation only) |\n| `voidPayment()` | Cancel payment before capture | OTA Engine | Yes |\n| `queryPaymentStatus()` | Check transaction state | Multiple | Yes |\n| `recordSettlement()` | Update settlement status | Webhook Handler | Yes |\n\n### External Payment Gateway API\n\nCaaS makes calls to the payment gateway provider's API:\n\n| Gateway API | Purpose | CaaS Usage |\n|---|---|---|\n| `POST /transactions` | Initiate payment | All payment flows |\n| `GET /transactions/{id}` | Query transaction status | Reconciliation |\n| `POST /transactions/{id}/void` | Cancel before capture | OTA failure handling |\n| `POST /transactions/{id}/refund` | Reverse settled payment | Desistimiento refunds |\n| `GET /settlements` | Fetch settlement reports | Daily reconciliation |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n---\n\n## Error Handling and Retry Logic\n\n### Payment Gateway Error Scenarios\n\n```mermaid\ngraph TD\n    PAYMENT_REQ[\"Payment Request\"]\n    GATEWAY_CALL[\"Call Payment Gateway\"]\n    \n    PAYMENT_REQ --\u003e GATEWAY_CALL\n    \n    GATEWAY_CALL --\u003e RESPONSE{Response?}\n    \n    RESPONSE --\u003e|Success| SUCCESS[\"Process Success\u003cbr/\u003eContinue Flow\"]\n    RESPONSE --\u003e|Declined| DECLINED[\"Card Declined\u003cbr/\u003eNotify Customer\"]\n    RESPONSE --\u003e|Network Error| RETRY{Retry\u003cbr/\u003eCount?}\n    RESPONSE --\u003e|Gateway Error| RETRY\n    \n    RETRY --\u003e|\"\u003c Max Retries\"| WAIT[\"Wait Exponential\u003cbr/\u003eBackoff\"]\n    RETRY --\u003e|\"\u003e= Max Retries\"| FAIL[\"Payment Failed\u003cbr/\u003eAlert Operations\"]\n    \n    WAIT --\u003e GATEWAY_CALL\n    \n    SUCCESS --\u003e END[\"End\"]\n    DECLINED --\u003e END\n    FAIL --\u003e END\n```\n\n**Diagram 11: Payment Gateway Error Handling**\n\n### Retry Strategy\n\n| Error Type | Retry? | Max Retries | Backoff | Customer Impact |\n|---|---|---|---|---|\n| **Network timeout** | Yes | 3 | Exponential (2s, 4s, 8s) | Delayed response |\n| **Gateway 5xx error** | Yes | 3 | Exponential | Delayed response |\n| **Card declined** | No | 0 | N/A | Immediate failure |\n| **Insufficient funds** | No | 0 | N/A | Immediate failure |\n| **Invalid card data** | No | 0 | N/A | Immediate failure |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Summary\n\nThe Payment Gateway Integration is designed around several key principles:\n\n1. **External Delegation:** All payment processing handled by certified third-party gateway\n2. **Asynchronous Settlement:** Service delivery before final bank confirmation\n3. **Risk Assumption:** CaaS optimizes customer experience by assuming settlement risk\n4. **Customer Protection:** Critical \"do not charge\" rule for failed OTA activations\n5. **Multiple Payment Types:** Different flows for reservation, final, service, and subscription payments\n6. **Strict Final Payment Rule:** Failed final payment results in immediate loss of vehicle reservation\n\nThe integration pattern balances customer experience optimization with financial risk management, ensuring that technical failures never result in customers being charged for undelivered services.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104](), [enunciado.md:1-23]()"])</script><script>self.__next_f.push([1,"26:T6888,"])</script><script>self.__next_f.push([1,"# Administrative Registration Integration\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the integration between the CaaS platform and external administrative/government bodies for vehicle registration (matriculation). This integration is a critical blocking operation in the vehicle delivery workflow that occurs after final payment completion and before physical vehicle delivery to the customer.\n\nFor information about the overall vehicle delivery process, see [Vehicle Purchase and Delivery Process](#4.1). For details on payment processing that precedes registration, see [Payment Gateway Integration](#5.4).\n\n**Sources:** [enunciado.md:15]()\n\n---\n\n## Business Context\n\n### When Registration Occurs\n\nVehicle registration is triggered automatically by the CaaS system immediately after the customer completes the final payment for their vehicle purchase. This is a legally required step in all countries where CaaS operates, and the vehicle cannot be delivered to the customer until registration is successfully completed.\n\nThe registration process is managed by the dealership (concesionario) but is initiated and orchestrated by the CaaS platform. The workflow ensures that:\n\n1. The customer has completed full payment before any registration attempt\n2. Registration is completed before vehicle transport to customer address\n3. The vehicle is legally authorized to operate on public roads in the customer's jurisdiction\n\n**Sources:** [enunciado.md:14-16](), [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Registration Workflow Position\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant CaaS as \"CaaS Platform\"\n    participant Payment as \"Payment Gateway\"\n    participant Admin as \"Administrative Bodies\"\n    participant Transport as \"Transport Company\"\n    \n    Customer-\u003e\u003eCaaS: \"Complete Final Payment\"\n    CaaS-\u003e\u003ePayment: \"Process Payment Request\"\n    Payment--\u003e\u003eCaaS: \"Payment Confirmed\"\n    \n    Note over CaaS: \"Payment successful - trigger registration\"\n    \n    CaaS-\u003e\u003eAdmin: \"Register Vehicle (Synchronous)\"\n    Note over Admin: \"Process registration\u003cbr/\u003eCountry-specific\"\n    Admin--\u003e\u003eCaaS: \"Registration Confirmation\u003cbr/\u003e(License plate, documents)\"\n    \n    Note over CaaS: \"Registration complete - can deliver\"\n    \n    CaaS-\u003e\u003eTransport: \"Schedule Vehicle Delivery\"\n    Transport-\u003e\u003eCustomer: \"Deliver to Address\"\n```\n\n**Sources:** [enunciado.md:14-17](), [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n---\n\n## Integration Pattern\n\n### Synchronous Blocking Operation\n\nUnlike other CaaS integrations (such as factory notifications or payment settlement), administrative registration follows a **synchronous request-response pattern**. This design choice reflects the critical nature of registration:\n\n- **Blocking**: The vehicle delivery process cannot proceed until registration completes successfully\n- **Synchronous**: CaaS waits for the registration response before continuing the workflow\n- **Country-specific**: Each country has different administrative bodies and registration requirements\n\n```mermaid\ngraph LR\n    subgraph \"CaaS Platform\"\n        OrderMgmt[\"Order Management\u003cbr/\u003eComponent\"]\n        RegService[\"Registration\u003cbr/\u003eService\"]\n        VehicleDB[(\"Vehicle\u003cbr/\u003eDatabase\")]\n    end\n    \n    subgraph \"External Systems\"\n        AdminAPI_ES[\"Admin API\u003cbr/\u003e(Spain)\"]\n        AdminAPI_FR[\"Admin API\u003cbr/\u003e(France)\"]\n        AdminAPI_DE[\"Admin API\u003cbr/\u003e(Germany)\"]\n        AdminAPI_XX[\"Admin API\u003cbr/\u003e(Other Countries)\"]\n    end\n    \n    OrderMgmt--\u003e|\"1. Initiate Registration\"| RegService\n    RegService--\u003e|\"2. Select Country-Specific API\"| RegService\n    \n    RegService--\u003e|\"3. Synchronous Call\"| AdminAPI_ES\n    RegService--\u003e|\"3. Synchronous Call\"| AdminAPI_FR\n    RegService--\u003e|\"3. Synchronous Call\"| AdminAPI_DE\n    RegService--\u003e|\"3. Synchronous Call\"| AdminAPI_XX\n    \n    AdminAPI_ES--\u003e|\"4. Registration Response\"| RegService\n    AdminAPI_FR--\u003e|\"4. Registration Response\"| RegService\n    AdminAPI_DE--\u003e|\"4. Registration Response\"| RegService\n    AdminAPI_XX--\u003e|\"4. Registration Response\"| RegService\n    \n    RegService--\u003e|\"5. Update Vehicle Status\"| VehicleDB\n    RegService--\u003e|\"6. Return Confirmation\"| OrderMgmt\n```\n\n**Sources:** [enunciado.md:15]()\n\n---\n\n## Registration Data Flow\n\n### Required Information\n\nThe CaaS system must provide comprehensive vehicle and customer information to the administrative bodies for successful registration:\n\n| Data Category | Information Required | Source |\n|--------------|---------------------|---------|\n| **Vehicle Identification** | VIN (Vehicle Identification Number), Manufacturer, Model, Platform Base | Factory API, Order Database |\n| **Customer Information** | Full Name, Address, National ID/Tax Number, Contact Details | Customer Database |\n| **Vehicle Specifications** | Engine Type, Power, Emissions Class, Weight, Technical Specifications | Service Catalog, Factory Data |\n| **Dealership Information** | Dealership ID, Location, Authorization Number | Corporate Intranet |\n| **Purchase Details** | Purchase Date, Final Payment Confirmation, Invoice Number | Billing Database |\n\n```mermaid\ngraph TB\n    subgraph \"Data Sources in CaaS\"\n        CustomerDB[(\"Customer\u003cbr/\u003eDatabase\")]\n        OrderDB[(\"Order\u003cbr/\u003eDatabase\")]\n        ServiceDB[(\"Service\u003cbr/\u003eCatalog\")]\n        BillingDB[(\"Billing\u003cbr/\u003eDatabase\")]\n    end\n    \n    subgraph \"Registration Service\"\n        DataAggregator[\"Registration Data\u003cbr/\u003eAggregator\"]\n        Validator[\"Data Validation\u003cbr/\u003eComponent\"]\n        CountryMapper[\"Country-Specific\u003cbr/\u003eData Mapper\"]\n    end\n    \n    subgraph \"Administrative Body\"\n        RegEndpoint[\"Registration\u003cbr/\u003eEndpoint\"]\n        ValidateReg[\"Validate\u003cbr/\u003eRegistration Data\"]\n        IssueDoc[\"Issue Registration\u003cbr/\u003eDocuments\"]\n    end\n    \n    CustomerDB--\u003e|\"Customer details\"| DataAggregator\n    OrderDB--\u003e|\"Vehicle \u0026 purchase info\"| DataAggregator\n    ServiceDB--\u003e|\"Vehicle specifications\"| DataAggregator\n    BillingDB--\u003e|\"Payment confirmation\"| DataAggregator\n    \n    DataAggregator--\u003eValidator\n    Validator--\u003e|\"Validated data\"| CountryMapper\n    CountryMapper--\u003e|\"Country-formatted request\"| RegEndpoint\n    \n    RegEndpoint--\u003eValidateReg\n    ValidateReg--\u003eIssueDoc\n    IssueDoc--\u003e|\"License plate \u0026 docs\"| CountryMapper\n```\n\n**Sources:** [enunciado.md:9](), [enunciado.md:15]()\n\n---\n\n## Country-Specific Implementation\n\n### Multi-Country Registration Strategy\n\nCaaS operates in multiple countries, each with different administrative requirements, document formats, and registration processes. The system implements a **country-adapter pattern** to handle this complexity:\n\n```mermaid\ngraph TB\n    subgraph \"Registration Service Core\"\n        RegCoordinator[\"Registration\u003cbr/\u003eCoordinator\"]\n        CountryRouter[\"Country\u003cbr/\u003eRouter\"]\n    end\n    \n    subgraph \"Country Adapters\"\n        SpainAdapter[\"Spain Adapter\u003cbr/\u003e(DGT)\"]\n        FranceAdapter[\"France Adapter\u003cbr/\u003e(ANTS)\"]\n        GermanyAdapter[\"Germany Adapter\u003cbr/\u003e(KBA)\"]\n        DefaultAdapter[\"Default Country\u003cbr/\u003eAdapter\"]\n    end\n    \n    subgraph \"External Admin Systems\"\n        SpainAPI[\"Spanish DGT\u003cbr/\u003eRegistration API\"]\n        FranceAPI[\"French ANTS\u003cbr/\u003eRegistration API\"]\n        GermanyAPI[\"German KBA\u003cbr/\u003eRegistration API\"]\n        OtherAPI[\"Other Country\u003cbr/\u003eAPIs\"]\n    end\n    \n    RegCoordinator--\u003e|\"Determine country\u003cbr/\u003efrom customer address\"| CountryRouter\n    \n    CountryRouter--\u003e|\"ES\"| SpainAdapter\n    CountryRouter--\u003e|\"FR\"| FranceAdapter\n    CountryRouter--\u003e|\"DE\"| GermanyAdapter\n    CountryRouter--\u003e|\"Other\"| DefaultAdapter\n    \n    SpainAdapter--\u003e|\"DGT-specific format\"| SpainAPI\n    FranceAdapter--\u003e|\"ANTS-specific format\"| FranceAPI\n    GermanyAdapter--\u003e|\"KBA-specific format\"| GermanyAPI\n    DefaultAdapter--\u003e|\"Generic format\"| OtherAPI\n    \n    SpainAPI--\u003e|\"Spanish license plate\"| SpainAdapter\n    FranceAPI--\u003e|\"French license plate\"| FranceAdapter\n    GermanyAPI--\u003e|\"German license plate\"| GermanyAdapter\n    OtherAPI--\u003e|\"Country-specific plate\"| DefaultAdapter\n```\n\n### Country-Specific Considerations\n\n| Country | Administrative Body | Specific Requirements | Response Format |\n|---------|--------------------|-----------------------|-----------------|\n| **Spain** | DGT (Direccin General de Trfico) | NIE/DNI validation, Environmental badge class | Spanish license plate format (1234-ABC) |\n| **France** | ANTS (Agence Nationale des Titres Scuriss) | Carte Grise issuance, French tax number | French license plate format (AB-123-CD) |\n| **Germany** | KBA (Kraftfahrt-Bundesamt) | TV certification reference, Regional authority | German license plate format (XX-AB-1234) |\n| **Other** | Country-specific | Varies by jurisdiction | Country-specific formats |\n\n**Sources:** [enunciado.md:15](), [pasame las preguntas y sus respuestas a markdown.md:15]()\n\n---\n\n## Registration Workflow States\n\n### Vehicle State Transitions\n\nThe vehicle entity in the CaaS system transitions through several states during the registration process. Understanding these states is critical for tracking vehicles and managing the delivery workflow.\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Manufactured: \"Vehicle Arrives\u003cbr/\u003eat Dealership\"\n    \n    Manufactured --\u003e AwaitingPayment: \"Customer Notified\u003cbr/\u003eVehicle Ready\"\n    \n    AwaitingPayment --\u003e PaymentProcessing: \"Customer Initiates\u003cbr/\u003eFinal Payment\"\n    \n    PaymentProcessing --\u003e PaymentFailed: \"Payment Rejected\"\n    PaymentProcessing --\u003e RegistrationPending: \"Payment Confirmed\"\n    \n    PaymentFailed --\u003e SinAsignar: \"Vehicle Unassigned\u003cbr/\u003eBecomes Stock\"\n    SinAsignar --\u003e AwaitingPayment: \"New Customer\u003cbr/\u003ePurchases Vehicle\"\n    \n    RegistrationPending --\u003e RegistrationInProgress: \"Registration API\u003cbr/\u003eCalled\"\n    \n    RegistrationInProgress --\u003e RegistrationFailed: \"API Returns Error\"\n    RegistrationInProgress --\u003e Registered: \"Registration\u003cbr/\u003eSuccessful\"\n    \n    RegistrationFailed --\u003e RetryRegistration: \"Retriable Error\"\n    RegistrationFailed --\u003e ManualIntervention: \"Non-Retriable Error\"\n    \n    RetryRegistration --\u003e RegistrationInProgress: \"Automatic Retry\"\n    ManualIntervention --\u003e RegistrationInProgress: \"Issue Resolved\u003cbr/\u003eManually\"\n    \n    Registered --\u003e ScheduledForDelivery: \"Transport Scheduled\"\n    \n    ScheduledForDelivery --\u003e InTransit: \"Vehicle Dispatched\"\n    InTransit --\u003e Delivered: \"Customer Receives\u003cbr/\u003eVehicle\"\n    \n    Delivered --\u003e [*]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### State Definitions\n\n| State | Description | System Actions |\n|-------|-------------|----------------|\n| `Manufactured` | Vehicle has arrived at dealership from factory | Store dealership location |\n| `AwaitingPayment` | Vehicle ready for customer, awaiting final payment | Send notification to customer |\n| `PaymentProcessing` | Final payment is being processed | Wait for payment gateway confirmation |\n| `PaymentFailed` | Payment was rejected or failed | Trigger vehicle unassignment |\n| `SinAsignar` | Vehicle unassigned, becomes stock for immediate sale | Make available to other customers |\n| `RegistrationPending` | Payment confirmed, registration will be triggered | Prepare registration data |\n| `RegistrationInProgress` | Synchronous registration API call in progress | Block until response received |\n| `RegistrationFailed` | Registration API returned an error | Evaluate error type for retry |\n| `RetryRegistration` | Waiting before automatic retry | Apply backoff delay |\n| `ManualIntervention` | Requires manual resolution (e.g., missing documents) | Alert dealership staff |\n| `Registered` | Vehicle successfully registered, has license plate | Update vehicle record with registration data |\n| `ScheduledForDelivery` | Transport scheduled to customer address | Coordinate with transport company |\n| `InTransit` | Vehicle is being transported to customer | Track delivery status |\n| `Delivered` | Vehicle delivered to customer | Complete purchase workflow |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27](), [enunciado.md:16-17]()\n\n---\n\n## Error Handling and Retry Logic\n\n### Registration Failure Scenarios\n\nUnlike OTA activation failures (which result in no charge to the customer), registration failures have different implications since they occur after payment has been completed. The system must handle various failure types appropriately:\n\n```mermaid\nflowchart TD\n    Start[\"Registration API\u003cbr/\u003eCalled\"]\n    \n    Start--\u003eResponse{API\u003cbr/\u003eResponse?}\n    \n    Response--\u003e|\"Success\"| Success[\"Update Vehicle Status\u003cbr/\u003eto 'Registered'\"]\n    Response--\u003e|\"Error\"| AnalyzeError[\"Analyze Error\u003cbr/\u003eType\"]\n    \n    AnalyzeError--\u003eErrorType{Error\u003cbr/\u003eCategory?}\n    \n    ErrorType--\u003e|\"Transient\u003cbr/\u003e(Network, Timeout)\"| RetryLogic[\"Apply Retry Logic\u003cbr/\u003ewith Backoff\"]\n    ErrorType--\u003e|\"Validation\u003cbr/\u003e(Missing/Invalid Data)\"| ValidationError[\"Log Validation Error\u003cbr/\u003eAlert Staff\"]\n    ErrorType--\u003e|\"Business Rule\u003cbr/\u003e(Policy Violation)\"| BusinessError[\"Log Business Error\u003cbr/\u003eAlert Staff\"]\n    ErrorType--\u003e|\"System Unavailable\u003cbr/\u003e(Admin System Down)\"| SystemDown[\"Queue for Retry\u003cbr/\u003eWhen Available\"]\n    \n    RetryLogic--\u003eRetryCount{Retry\u003cbr/\u003eCount?}\n    RetryCount--\u003e|\"\u003c Max Retries\"| WaitBackoff[\"Wait with\u003cbr/\u003eExponential Backoff\"]\n    RetryCount--\u003e|\"\u003e= Max Retries\"| ManualEscalation[\"Escalate to\u003cbr/\u003eManual Resolution\"]\n    \n    WaitBackoff--\u003eStart\n    \n    ValidationError--\u003eManualEscalation\n    BusinessError--\u003eManualEscalation\n    \n    SystemDown--\u003eQueuedRetry[\"Automatic Retry\u003cbr/\u003eWhen System Available\"]\n    QueuedRetry--\u003eStart\n    \n    ManualEscalation--\u003eStaffResolves[\"Dealership Staff\u003cbr/\u003eResolves Issue\"]\n    StaffResolves--\u003eStart\n    \n    Success--\u003eNotifyCustomer[\"Notify Customer\u003cbr/\u003eRegistration Complete\"]\n    NotifyCustomer--\u003eScheduleDelivery[\"Proceed to\u003cbr/\u003eDelivery Scheduling\"]\n    \n    ManualEscalation--\u003eBlockDelivery[\"Block Delivery\u003cbr/\u003eUntil Resolved\"]\n    \n    style Success fill:#90EE90\n    style ManualEscalation fill:#FFB6C6\n    style BlockDelivery fill:#FFB6C6\n```\n\n### Error Categories and Handling\n\n| Error Category | Examples | Retry Strategy | Customer Impact |\n|----------------|----------|----------------|-----------------|\n| **Transient** | Network timeout, Connection refused, Rate limiting | Automatic retry with exponential backoff (5 attempts) | None if resolved within retry window |\n| **Validation** | Missing NIE/DNI, Invalid VIN format, Missing required fields | No automatic retry - requires data correction | Delayed delivery until resolved |\n| **Business Rule** | Vehicle already registered, Tax debt associated with customer | No automatic retry - requires investigation | Delayed delivery until resolved |\n| **System Unavailable** | Admin system maintenance, Extended outage | Queue for retry when available | Delayed delivery, customer notified |\n| **Authentication** | Invalid API credentials, Expired certificates | Alert technical team immediately | Critical - blocks all registrations |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:47-53]()\n\n### Retry Configuration\n\n```mermaid\ngraph LR\n    Attempt1[\"Attempt 1\u003cbr/\u003e(Immediate)\"]\n    Attempt2[\"Attempt 2\u003cbr/\u003e(Wait 30s)\"]\n    Attempt3[\"Attempt 3\u003cbr/\u003e(Wait 60s)\"]\n    Attempt4[\"Attempt 4\u003cbr/\u003e(Wait 120s)\"]\n    Attempt5[\"Attempt 5\u003cbr/\u003e(Wait 300s)\"]\n    Escalate[\"Manual\u003cbr/\u003eEscalation\"]\n    \n    Attempt1--\u003e|\"Fail\"| Attempt2\n    Attempt2--\u003e|\"Fail\"| Attempt3\n    Attempt3--\u003e|\"Fail\"| Attempt4\n    Attempt4--\u003e|\"Fail\"| Attempt5\n    Attempt5--\u003e|\"Fail\"| Escalate\n    \n    Attempt1--\u003e|\"Success\"| Registered[\"Vehicle\u003cbr/\u003eRegistered\"]\n    Attempt2--\u003e|\"Success\"| Registered\n    Attempt3--\u003e|\"Success\"| Registered\n    Attempt4--\u003e|\"Success\"| Registered\n    Attempt5--\u003e|\"Success\"| Registered\n```\n\n**Key Difference from OTA Failures**: While OTA activation failures result in no charge to the customer (protecting customer satisfaction), registration failures occur AFTER payment has been completed. The customer has paid but cannot receive their vehicle until registration succeeds. This creates urgency for resolution but does not involve refunds unless the registration cannot be completed at all (extremely rare).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:47-53]()\n\n---\n\n## Registration Response Data\n\n### Information Received from Administrative Bodies\n\nUpon successful registration, the administrative body returns critical information that must be stored in the CaaS system:\n\n```mermaid\ngraph TB\n    subgraph \"Administrative Response\"\n        LicensePlate[\"License Plate Number\"]\n        RegNumber[\"Registration Number\u003cbr/\u003e(Matricula)\"]\n        RegDate[\"Registration Date\"]\n        RegDocs[\"Registration Documents\u003cbr/\u003e(Digital Copies)\"]\n        TaxBadge[\"Environmental/Tax Badge\"]\n        Expiry[\"Registration Expiry\u003cbr/\u003e(if applicable)\"]\n    end\n    \n    subgraph \"CaaS Storage\"\n        VehicleRecord[\"Vehicle Record\u003cbr/\u003eUpdate\"]\n        DocStorage[\"Document Storage\"]\n        CustomerExpediente[\"Customer Expediente\u003cbr/\u003ede Compra\"]\n        NotifService[\"Notification\u003cbr/\u003eService\"]\n    end\n    \n    LicensePlate--\u003eVehicleRecord\n    RegNumber--\u003eVehicleRecord\n    RegDate--\u003eVehicleRecord\n    TaxBadge--\u003eVehicleRecord\n    Expiry--\u003eVehicleRecord\n    \n    RegDocs--\u003eDocStorage\n    DocStorage--\u003eCustomerExpediente\n    \n    VehicleRecord--\u003eNotifService\n    CustomerExpediente--\u003eNotifService\n    \n    NotifService--\u003eEmail[\"Email to Customer\"]\n    NotifService--\u003eMobileApp[\"Mobile App\u003cbr/\u003eNotification\"]\n```\n\n### Stored Registration Data\n\nThe following information is persisted in the vehicle database and customer expediente:\n\n| Field | Type | Description | Visibility |\n|-------|------|-------------|------------|\n| `license_plate` | String | Official license plate number | Customer, Staff |\n| `registration_number` | String | Administrative registration number (matricula) | Customer, Staff |\n| `registration_date` | Timestamp | Date/time of successful registration | Customer, Staff |\n| `registration_country` | String | ISO country code where registered | Staff |\n| `registration_authority` | String | Specific administrative body | Staff |\n| `environmental_badge` | String | Emissions/environmental classification | Customer, Staff |\n| `registration_certificate_url` | String | Link to digital registration certificate | Customer, Staff |\n| `registration_expiry_date` | Timestamp | If applicable (some countries) | Customer, Staff |\n\n**Sources:** [enunciado.md:11](), [enunciado.md:15]()\n\n---\n\n## Customer Communication\n\n### Notification Flow for Registration\n\nCustomers receive multiple notifications throughout the registration process to keep them informed of their vehicle's status:\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant CaaS as \"CaaS Platform\"\n    participant NotifEngine as \"Notification Engine\"\n    participant Admin as \"Admin Body\"\n    \n    Note over Customer,Admin: \"Post-Payment Phase\"\n    \n    CaaS-\u003e\u003eNotifEngine: \"Payment Confirmed\"\n    NotifEngine-\u003e\u003eCustomer: \"Email: Payment Received\u003cbr/\u003eRegistration In Progress\"\n    \n    CaaS-\u003e\u003eAdmin: \"Register Vehicle\"\n    \n    alt Registration Successful\n        Admin--\u003e\u003eCaaS: \"Registration Complete\u003cbr/\u003e(License Plate)\"\n        CaaS-\u003e\u003eNotifEngine: \"Registration Successful\"\n        NotifEngine-\u003e\u003eCustomer: \"Email: Vehicle Registered\u003cbr/\u003eLicense Plate: ABC-1234\"\n        NotifEngine-\u003e\u003eCustomer: \"App: Registration Complete\u003cbr/\u003eView Documents\"\n        \n        Note over CaaS: \"Update Expediente\u003cbr/\u003ewith documents\"\n        \n        NotifEngine-\u003e\u003eCustomer: \"Email: Delivery Scheduled\u003cbr/\u003eExpected Date\"\n    else Registration Failed\n        Admin--\u003e\u003eCaaS: \"Registration Error\"\n        CaaS-\u003e\u003eNotifEngine: \"Registration Issue\"\n        NotifEngine-\u003e\u003eCustomer: \"Email: Registration Delayed\u003cbr/\u003eWe're Working On It\"\n        \n        Note over CaaS: \"Staff notified\u003cbr/\u003efor resolution\"\n        \n        loop \"Until Resolved\"\n            CaaS-\u003e\u003eCustomer: \"Status Updates\u003cbr/\u003e(if delayed \u003e 24h)\"\n        end\n    end\n```\n\n**Sources:** [enunciado.md:11](), [enunciado.md:13]()\n\n---\n\n## Integration with Other CaaS Systems\n\n### Dependencies and Interactions\n\nThe registration integration interacts with multiple CaaS subsystems to complete the end-to-end workflow:\n\n```mermaid\ngraph TB\n    subgraph \"Upstream Systems\"\n        OrderMgmt[\"Order Management\"]\n        PaymentProc[\"Payment Processing\"]\n        CustomerDB[(\"Customer\u003cbr/\u003eDatabase\")]\n    end\n    \n    subgraph \"Registration Service\"\n        RegCoordinator[\"Registration\u003cbr/\u003eCoordinator\"]\n        CountryAdapters[\"Country\u003cbr/\u003eAdapters\"]\n        RegistrationDB[(\"Registration\u003cbr/\u003eRecords\")]\n    end\n    \n    subgraph \"External\"\n        AdminAPIs[\"Administrative\u003cbr/\u003eBody APIs\"]\n    end\n    \n    subgraph \"Downstream Systems\"\n        TransportCoord[\"Transport\u003cbr/\u003eCoordination\"]\n        ExpedienteService[\"Expediente\u003cbr/\u003eService\"]\n        NotificationEngine[\"Notification\u003cbr/\u003eEngine\"]\n        IoTGateway[\"IoT Gateway\"]\n    end\n    \n    OrderMgmt--\u003e|\"Trigger Registration\u003cbr/\u003eon Payment\"| RegCoordinator\n    PaymentProc--\u003e|\"Confirm Final Payment\"| RegCoordinator\n    CustomerDB--\u003e|\"Customer \u0026 Address Data\"| RegCoordinator\n    \n    RegCoordinator--\u003eCountryAdapters\n    CountryAdapters--\u003e|\"Country-Specific Request\"| AdminAPIs\n    AdminAPIs--\u003e|\"Registration Response\"| CountryAdapters\n    \n    CountryAdapters--\u003e|\"Store Registration Data\"| RegistrationDB\n    \n    RegistrationDB--\u003e|\"Registration Complete\"| TransportCoord\n    RegistrationDB--\u003e|\"Add Documents\"| ExpedienteService\n    RegistrationDB--\u003e|\"Send Notifications\"| NotificationEngine\n    RegistrationDB--\u003e|\"Enable Vehicle\u003cbr/\u003efor App Linking\"| IoTGateway\n```\n\n### Workflow Coordination\n\n| Upstream Trigger | Registration Action | Downstream Effect |\n|------------------|---------------------|-------------------|\n| Payment confirmed | Initiate registration with country-specific adapter | Block delivery until complete |\n| Vehicle data from factory | Provide vehicle specifications for registration | Ensure accurate registration documents |\n| Customer address updated | Re-evaluate country/jurisdiction for registration | May require different adapter |\n| Registration successful | Update vehicle state to \"Registered\" | Enable transport scheduling |\n| Registration complete | Store license plate and documents | Add to customer expediente |\n| Registration complete | Notify customer | Email + mobile app notification |\n| Registration complete | Enable vehicle linking | IoT gateway allows mobile app to pair |\n\n**Sources:** [enunciado.md:14-17]()\n\n---\n\n## Security and Compliance\n\n### Legal and Regulatory Requirements\n\nVehicle registration is a heavily regulated process that must comply with multiple legal frameworks:\n\n```mermaid\ngraph TB\n    subgraph \"Legal Requirements\"\n        GDPR[\"GDPR/Data Protection\u003cbr/\u003e(Customer PII)\"]\n        VehicleRegs[\"Vehicle Registration Laws\u003cbr/\u003e(Country-Specific)\"]\n        TaxCompliance[\"Tax \u0026 Duty Compliance\u003cbr/\u003e(Registration Fees)\"]\n        ConsumerProtection[\"Consumer Protection\u003cbr/\u003e(Transparent Process)\"]\n    end\n    \n    subgraph \"CaaS Security Measures\"\n        Encryption[\"Data Encryption\u003cbr/\u003e(In Transit \u0026 At Rest)\"]\n        AccessControl[\"Access Control\u003cbr/\u003e(Staff Authorization)\"]\n        AuditLog[\"Audit Logging\u003cbr/\u003e(All Registration Attempts)\"]\n        DataRetention[\"Data Retention\u003cbr/\u003e(Registration Records)\"]\n    end\n    \n    subgraph \"Administrative Security\"\n        APIAuth[\"API Authentication\u003cbr/\u003e(Certificates/Tokens)\"]\n        SecureChannels[\"Secure Channels\u003cbr/\u003e(TLS 1.3+)\"]\n        RateLimiting[\"Rate Limiting\u003cbr/\u003e(Prevent Abuse)\"]\n    end\n    \n    GDPR--\u003eEncryption\n    GDPR--\u003eDataRetention\n    VehicleRegs--\u003eAuditLog\n    TaxCompliance--\u003eAuditLog\n    ConsumerProtection--\u003eAuditLog\n    \n    Encryption--\u003eAPIAuth\n    AccessControl--\u003eAPIAuth\n    AuditLog--\u003eAPIAuth\n    \n    APIAuth--\u003eSecureChannels\n    SecureChannels--\u003eRateLimiting\n```\n\n### Audit and Traceability\n\nEvery registration attempt, whether successful or failed, must be logged for audit and compliance purposes:\n\n| Audit Field | Description | Retention Period |\n|-------------|-------------|------------------|\n| `timestamp` | Exact time of registration attempt | Permanent |\n| `vehicle_vin` | Vehicle identification number | Permanent |\n| `customer_id` | Customer identifier | Permanent |\n| `country_code` | Target country for registration | Permanent |\n| `api_request` | Full API request payload (sanitized) | 7 years |\n| `api_response` | Full API response | 7 years |\n| `staff_user_id` | If manual intervention occurred | 7 years |\n| `registration_result` | Success/failure status | Permanent |\n| `license_plate` | If successful | Permanent |\n| `error_code` | If failed | 7 years |\n\n**Sources:** [enunciado.md:15]()\n\n---\n\n## System Constraints and Limitations\n\n### Known Constraints\n\n1. **Synchronous Operation Timeout**: Maximum wait time of 120 seconds for registration API response\n2. **Country Coverage**: Not all countries may have API integration; some may require manual processing\n3. **Rate Limits**: Administrative APIs often have rate limits (e.g., 100 requests/hour)\n4. **Operating Hours**: Some administrative systems only operate during business hours\n5. **Dependency**: Registration cannot proceed without successful payment confirmation\n\n### Performance Considerations\n\n- **Expected Response Time**: 5-30 seconds for normal registration\n- **Maximum Timeout**: 120 seconds before retry\n- **Concurrency**: Support for up to 50 simultaneous registration requests\n- **Queue Depth**: Can queue up to 1000 pending registrations during system unavailability\n\n**Sources:** [enunciado.md:14-17](), [pasame las preguntas y sus respuestas a markdown.md:26-29]()\n\n---\n\n## Summary\n\nThe Administrative Registration Integration is a **critical synchronous blocking operation** that enables legal vehicle ownership transfer after purchase. Key characteristics:\n\n- **Blocking**: Delivery cannot proceed until registration completes\n- **Synchronous**: Unlike other integrations, CaaS waits for the response\n- **Country-specific**: Different adapters for different jurisdictions\n- **Post-payment**: Occurs only after customer completes final payment\n- **Error-critical**: Requires careful error handling as customer has already paid\n- **Audit-required**: Full logging for legal compliance\n\nThe integration bridges the purchase workflow and delivery workflow, serving as the legal gateway that authorizes vehicle operation on public roads.\n\n**Sources:** [enunciado.md:14-17](), [pasame las preguntas y sus respuestas a markdown.md:26-29]()"])</script><script>self.__next_f.push([1,"27:T5de1,"])</script><script>self.__next_f.push([1,"# Service Lifecycle Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document provides a comprehensive overview of how services are managed throughout their complete lifecycle in the CaaS platform, from initial catalog definition through purchase, activation, usage, and eventual cancellation or expiration.\n\nService lifecycle management encompasses:\n- **Service catalog structure** and available service types (plataforma base and opciones disponibles)\n- **Activation workflows** using OTA (Over The Air) delivery mechanisms\n- **Billing models** including one-time payments, temporary services, and recurring subscriptions\n- **Maintenance-gated access** rules that link service availability to vehicle maintenance status\n- **Cancellation and refund policies** including legal desistimiento (right of withdrawal) requirements\n\nFor detailed information about specific aspects of service lifecycle management:\n- Service catalog structure and pricing models: see [Service Catalog and Pricing](#6.1)\n- OTA activation technical implementation: see [OTA Service Activation](#6.2)\n- Maintenance requirements and service access rules: see [Maintenance-Linked Service Access](#6.3)\n- Cancellation procedures and refund policies: see [Service Cancellation and Refunds](#6.4)\n\nFor payment processing and billing workflows, see [Payment and Billing](#7).\n\nSources: [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Service Types and Models\n\nThe CaaS system offers two fundamental categories of vehicle functionality:\n\n| Service Type | Description | Activation Timing | Payment Model |\n|--------------|-------------|-------------------|---------------|\n| **Plataforma Base** | Base platform with essential vehicle features that make the vehicle fully operational | Included at delivery | One-time purchase with vehicle |\n| **Opciones Disponibles** | Optional features that complement the base platform (e.g., 50% power increase, autonomous driving, climate control, entertainment systems) | On-demand after vehicle delivery | Pay-per-use (pago por uso) |\n\n### Optional Service Duration Models\n\nOptional services (opciones disponibles) can be purchased with different duration models:\n\n| Duration Model | Description | Billing Pattern | Use Case |\n|----------------|-------------|-----------------|----------|\n| **Temporary** | Service active for a specific time period (e.g., 1 month, 3 months) | Single upfront payment | Short-term needs (winter traction mode, vacation entertainment) |\n| **Permanent** | Service active until end of vehicle lifecycle | Single upfront payment | Features customer wants to keep indefinitely |\n| **Planned/Recurring** | Service scheduled for future activation or recurring subscription | Monthly billing (mes vencido) | Seasonal needs or continuous service |\n\n### Pre-installed Functionality Model\n\nAll optional services are **pre-installed in the vehicle firmware** at the factory. The CaaS system performs only **activation or deactivation** of these pre-existing capabilities. This architectural decision means:\n- No software updates required for service delivery\n- Service activation is a configuration change, not a software installation\n- All vehicle hardware capabilities are present from factory delivery\n- OTA activation is lightweight and fast\n\nSources: [enunciado.md:3-5](), [pasame las preguntas y sus respuestas a markdown.md:55-56]()\n\n---\n\n## Service Lifecycle State Machine\n\nThe following diagram illustrates the complete state machine for an optional service from catalog availability through activation and eventual cancellation:\n\n**Diagram: Service Lifecycle State Transitions**\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e \"Catalog_Available\": \"Service defined in catalog\"\n    \n    \"Catalog_Available\" --\u003e \"Maintenance_Check\": \"Customer requests service\"\n    \n    \"Maintenance_Check\" --\u003e \"Available_For_Purchase\": \"Maintenance OK or\u003cbr/\u003eservice not maintenance-linked\"\n    \"Maintenance_Check\" --\u003e \"Blocked_By_Maintenance\": \"Maintenance overdue\"\n    \n    \"Blocked_By_Maintenance\" --\u003e \"Catalog_Available\": \"Customer notified,\u003cbr/\u003emust complete maintenance\"\n    \n    \"Available_For_Purchase\" --\u003e \"Payment_Processing\": \"Customer selects duration\u003cbr/\u003eand initiates payment\"\n    \n    \"Payment_Processing\" --\u003e \"Payment_Failed\": \"Payment gateway\u003cbr/\u003ereturns failure\"\n    \"Payment_Processing\" --\u003e \"OTA_Queue\": \"Payment successful\u003cbr/\u003e(or assumed successful)\"\n    \n    \"Payment_Failed\" --\u003e \"Catalog_Available\": \"Notify customer,\u003cbr/\u003eservice not activated\"\n    \n    \"OTA_Queue\" --\u003e \"OTA_Attempt\": \"Service queued\u003cbr/\u003efor activation\"\n    \n    \"OTA_Attempt\" --\u003e \"Active\": \"OTA activation\u003cbr/\u003esuccessful\"\n    \"OTA_Attempt\" --\u003e \"OTA_Retry\": \"Activation failed\"\n    \n    \"OTA_Retry\" --\u003e \"OTA_Attempt\": \"Retry N times\"\n    \"OTA_Retry\" --\u003e \"Technical_Support\": \"All retries exhausted\"\n    \n    \"Technical_Support\" --\u003e \"Refund_Issued\": \"Customer NOT charged,\u003cbr/\u003erefund if already charged\"\n    \"Refund_Issued\" --\u003e \"Catalog_Available\": \"Service returned to\u003cbr/\u003eavailable state\"\n    \n    \"Active\" --\u003e \"In_Use\": \"Service delivered\u003cbr/\u003eto vehicle\"\n    \n    \"In_Use\" --\u003e \"Cancellation_Requested\": \"Customer requests\u003cbr/\u003ecancellation\"\n    \"In_Use\" --\u003e \"Expired\": \"Service duration ends\u003cbr/\u003e(temporary services)\"\n    \"In_Use\" --\u003e \"Subscription_Billing\": \"Monthly billing cycle\u003cbr/\u003e(recurring services)\"\n    \n    \"Cancellation_Requested\" --\u003e \"Refund_Evaluation\": \"Check desistimiento\u003cbr/\u003eeligibility\"\n    \n    \"Refund_Evaluation\" --\u003e \"Refund_Granted\": \"Within 14 days OR\u003cbr/\u003eservice \u003c 14 days duration\"\n    \"Refund_Evaluation\" --\u003e \"No_Refund\": \"After 14 days\u003cbr/\u003efor service \u003e 14 days\"\n    \n    \"Refund_Granted\" --\u003e \"Deactivated\": \"Service deactivated,\u003cbr/\u003ecustomer refunded\"\n    \"No_Refund\" --\u003e \"Deactivated\": \"Service deactivated,\u003cbr/\u003eno refund\"\n    \n    \"Subscription_Billing\" --\u003e \"Payment_OK\": \"Month-end billing\u003cbr/\u003esuccessful\"\n    \"Subscription_Billing\" --\u003e \"Subscription_Cancelled\": \"Payment failed or\u003cbr/\u003ecustomer cancels\"\n    \n    \"Payment_OK\" --\u003e \"In_Use\": \"Service continues\"\n    \"Subscription_Cancelled\" --\u003e \"Deactivated\": \"Service deactivated\"\n    \n    \"Expired\" --\u003e \"Deactivated\": \"Temporary service\u003cbr/\u003enatural expiration\"\n    \"Deactivated\" --\u003e [*]\n```\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-96]()\n\n---\n\n## Service Activation Workflow\n\nThe service activation workflow demonstrates how purchased services transition from payment to active state in the vehicle. This workflow is **asynchronous** and includes robust failure handling.\n\n**Diagram: Service Purchase to Activation Flow**\n\n```mermaid\nsequenceDiagram\n    participant \"Customer\" as Cust\n    participant \"Web/Mobile Platform\" as UI\n    participant \"Service Catalog\" as Catalog\n    participant \"VSS Integration\" as VSS\n    participant \"Payment Processor\" as Payment\n    participant \"OTA Engine\" as OTA\n    participant \"IoT Gateway\" as IoT\n    participant \"Vehicle\" as Vehicle\n    participant \"Notification Engine\" as Notify\n    \n    Cust-\u003e\u003eUI: \"Browse available services\"\n    UI-\u003e\u003eCatalog: \"Get opciones disponibles\"\n    Catalog--\u003e\u003eUI: \"Return service list with pricing\"\n    \n    Cust-\u003e\u003eUI: \"Select service + duration\"\n    \n    UI-\u003e\u003eVSS: \"Check maintenance status\u003cbr/\u003e(if service is maintenance-linked)\"\n    VSS--\u003e\u003eUI: \"Return maintenance state\"\n    \n    alt \"Maintenance overdue\"\n        UI--\u003e\u003eCust: \"Service blocked - maintenance required\"\n    else \"Maintenance OK or not required\"\n        UI-\u003e\u003ePayment: \"Initiate payment\"\n        Payment--\u003e\u003eUI: \"Payment accepted (assumed success)\"\n        \n        Note over Payment: \"Asynchronous settlement\u003cbr/\u003eCaaS assumes risk\"\n        \n        UI-\u003e\u003eOTA: \"Queue service activation\"\n        UI--\u003e\u003eCust: \"Service purchased, activating...\"\n        \n        OTA-\u003e\u003eIoT: \"Send OTA command via API IoT\"\n        IoT-\u003e\u003eVehicle: \"Push configuration\"\n        \n        alt \"Activation successful\"\n            Vehicle--\u003e\u003eIoT: \"Confirmation + status\"\n            IoT--\u003e\u003eOTA: \"Activation confirmed\"\n            OTA-\u003e\u003eNotify: \"Trigger success notification\"\n            Notify--\u003e\u003eCust: \"Service active (email, app, vehicle)\"\n        else \"Activation failed\"\n            Vehicle--\u003e\u003eIoT: \"Failure status\"\n            IoT--\u003e\u003eOTA: \"Activation failed\"\n            \n            loop \"Retry N times\"\n                OTA-\u003e\u003eIoT: \"Retry OTA command\"\n                IoT-\u003e\u003eVehicle: \"Push configuration\"\n                alt \"Success\"\n                    Vehicle--\u003e\u003eIoT: \"Confirmation\"\n                    IoT--\u003e\u003eOTA: \"Success on retry\"\n                else \"Still failing\"\n                    Vehicle--\u003e\u003eIoT: \"Failure\"\n                end\n            end\n            \n            alt \"All retries exhausted\"\n                OTA-\u003e\u003ePayment: \"Request refund (DO NOT CHARGE)\"\n                OTA-\u003e\u003eNotify: \"Escalate to technical support\"\n                Notify--\u003e\u003eCust: \"Service not activated, not charged\"\n            end\n        end\n    end\n```\n\n### Critical Business Rule: No Charge on Failed Activation\n\nThe most important rule in the activation workflow is: **If OTA activation fails after all retries, the customer MUST NOT be charged**. This rule applies even if payment was already processed. The system must issue a refund and escalate the issue to technical support.\n\nThis customer-protection policy ensures that customers only pay for services they actually receive, maintaining trust and legal compliance.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56](), [enunciado.md:19-20]()\n\n---\n\n## Billing Models and Payment Timing\n\nThe CaaS platform implements multiple billing models depending on service type:\n\n### One-Time Services (Temporary and Permanent)\n\n| Phase | Timing | Risk Management |\n|-------|--------|-----------------|\n| **Payment Initiation** | Customer completes payment via payment gateway | Payment sent to gateway |\n| **Service Delivery** | Immediate (before bank settlement) | **CaaS assumes settlement risk** |\n| **Payment Settlement** | Asynchronous (delayed bank confirmation) | May arrive minutes to hours later |\n| **Reconciliation** | Backend process matches payments to activations | Handles failed settlements |\n\nThis model prioritizes **customer experience over financial risk**. Services activate immediately without waiting for bank confirmation, accepting the possibility of chargebacks or failed settlements.\n\n### Subscription Services (Recurring)\n\nSubscription services use a **mes vencido** (post-paid, in arrears) billing model:\n\n1. **Service Activation**: Subscription service activates immediately upon sign-up\n2. **Month Usage**: Customer uses service throughout the month\n3. **Month End**: System calculates usage and charges for the completed month\n4. **Payment Collection**: Charge customer's payment method for previous month's usage\n5. **Payment Failure Handling**: \n   - Failed payment triggers subscription cancellation\n   - Service deactivated at next billing cycle\n   - No prorated refunds for partial month usage\n\n**Diagram: Subscription Billing Cycle**\n\n```mermaid\nsequenceDiagram\n    participant \"Customer\" as Cust\n    participant \"Subscription Manager\" as Sub\n    participant \"Service State\" as State\n    participant \"Payment Processor\" as Payment\n    participant \"OTA Engine\" as OTA\n    \n    Cust-\u003e\u003eSub: \"Subscribe to recurring service\"\n    Sub-\u003e\u003ePayment: \"Register payment method\"\n    Sub-\u003e\u003eOTA: \"Activate service\"\n    OTA--\u003e\u003eState: \"Service active\"\n    \n    Note over State: \"Month 1: Service in use\"\n    \n    State-\u003e\u003eSub: \"Month 1 ends\"\n    Sub-\u003e\u003ePayment: \"Charge for Month 1 usage (mes vencido)\"\n    \n    alt \"Payment successful\"\n        Payment--\u003e\u003eSub: \"Payment confirmed\"\n        Note over State: \"Month 2: Service continues\"\n    else \"Payment failed\"\n        Payment--\u003e\u003eSub: \"Payment failed\"\n        Sub-\u003e\u003eCust: \"Notify payment issue\"\n        Sub-\u003e\u003eOTA: \"Schedule deactivation\"\n        OTA--\u003e\u003eState: \"Service deactivated\"\n        Note over State: \"Subscription cancelled\"\n    end\n```\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Maintenance-Linked Service Access\n\nCertain optional services have dependencies on the vehicle's maintenance status for **safety and warranty reasons**. Before allowing purchase of these services, the system queries the **VSS (Vehicle Service System)** to verify maintenance compliance.\n\n### Maintenance Verification Flow\n\n```mermaid\nflowchart TD\n    \"ServiceRequest\"[\"Customer requests\u003cbr/\u003eoptional service\"]\n    \"CheckDependency\"{\"Service requires\u003cbr/\u003emaintenance check?\"}\n    \"QueryVSS\"[\"Query VSS API\u003cbr/\u003efor maintenance status\"]\n    \"EvaluateStatus\"{\"Maintenance\u003cbr/\u003ecurrent?\"}\n    \"AllowPurchase\"[\"Allow service\u003cbr/\u003epurchase\"]\n    \"BlockPurchase\"[\"Block service\u003cbr/\u003epurchase\"]\n    \"NotifyCustomer\"[\"Notify customer:\u003cbr/\u003eComplete maintenance required\"]\n    \"DirectToVSS\"[\"Direct to workshop\u003cbr/\u003elocator\"]\n    \n    \"ServiceRequest\" --\u003e \"CheckDependency\"\n    \"CheckDependency\" --\u003e|\"Yes\"| \"QueryVSS\"\n    \"CheckDependency\" --\u003e|\"No\"| \"AllowPurchase\"\n    \n    \"QueryVSS\" --\u003e \"EvaluateStatus\"\n    \"EvaluateStatus\" --\u003e|\"Current\"| \"AllowPurchase\"\n    \"EvaluateStatus\" --\u003e|\"Overdue\"| \"BlockPurchase\"\n    \n    \"BlockPurchase\" --\u003e \"NotifyCustomer\"\n    \"NotifyCustomer\" --\u003e \"DirectToVSS\"\n```\n\n### Maintenance Blocking Rules\n\n| Scenario | System Behavior | Rationale |\n|----------|----------------|-----------|\n| **Service not maintenance-linked** | Allow purchase without VSS check | No safety dependency |\n| **Maintenance current** | Allow purchase after VSS confirmation | Safe to activate service |\n| **Maintenance overdue** | Block new service purchase | Safety risk or warranty void |\n| **Service already active** | Continue service (no deactivation) | Cannot block already-paid services |\n| **Base platform (plataforma base)** | Never blocked by maintenance | Vehicle must remain operational |\n\n### Critical Constraint: Cannot Block Vehicle Operation\n\nPer legal and safety requirements, the system **cannot prevent the vehicle from operating** due to maintenance issues. Only the police have authority to immobilize vehicles.\n\nThe maintenance-gating mechanism:\n-  **CAN** prevent activation of new premium services\n-  **CAN** void warranty coverage\n-  **CANNOT** deactivate already-purchased services\n-  **CANNOT** disable the plataforma base\n-  **CANNOT** prevent vehicle from driving\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:60-73](), [enunciado.md:22-23]()\n\n---\n\n## Service Duration and Expiration\n\nServices have different expiration behaviors based on their duration model:\n\n### Temporary Services\n\n```mermaid\ngantt\n    title Temporary Service Lifecycle Example\n    dateFormat YYYY-MM-DD\n    section Service State\n    Payment Processed           :done, payment, 2024-01-01, 1d\n    OTA Activation             :active, activate, 2024-01-01, 1d\n    Service Active (30 days)   :active, active, 2024-01-02, 30d\n    Auto-Deactivation          :crit, expire, 2024-02-01, 1d\n    Service Expired            :done, end, 2024-02-02, 1d\n```\n\nTemporary services:\n1. Activate immediately after successful OTA delivery\n2. Remain active for the purchased duration (e.g., 1 month, 3 months)\n3. **Automatically deactivate** at expiration (no customer action required)\n4. Customer receives notification before expiration and at deactivation\n5. Can be repurchased from catalog after expiration\n\n### Permanent Services\n\nPermanent services:\n1. Activate immediately after successful OTA delivery\n2. Remain active **until end of vehicle lifecycle**\n3. No expiration date\n4. Can be cancelled subject to desistimiento (withdrawal) rules\n5. If cancelled within withdrawal period, service deactivates and customer receives refund\n\n### Subscription Services\n\nSubscription services:\n1. Activate immediately upon subscription\n2. Remain active as long as monthly payments succeed\n3. **Automatically renew** each month (no customer action required)\n4. Deactivate only on: payment failure, customer cancellation, or vehicle lifecycle end\n5. Billed monthly in arrears (mes vencido model)\n\nSources: [enunciado.md:19-22](), [pasame las preguntas y sus respuestas a markdown.md:82-89]()\n\n---\n\n## Desistimiento (Right of Withdrawal)\n\nSpanish and EU law requires that distance sales (venta a distancia) provide customers with a right of withdrawal (derecho de desistimiento). The CaaS platform implements these legal requirements with duration-dependent rules:\n\n### Refund Eligibility Rules\n\n```mermaid\nflowchart TD\n    \"CancelRequest\"[\"Customer requests\u003cbr/\u003eservice cancellation\"]\n    \"ServiceDuration\"{\"Service\u003cbr/\u003eduration?\"}\n    \"CheckTime\"{\"Time since\u003cbr/\u003eactivation?\"}\n    \"RefundGranted\"[\"Refund GRANTED\u003cbr/\u003eService deactivated\"]\n    \"RefundDenied\"[\"Refund DENIED\u003cbr/\u003eService deactivated\u003cbr/\u003eif requested\"]\n    \n    \"CancelRequest\" --\u003e \"ServiceDuration\"\n    \n    \"ServiceDuration\" --\u003e|\"Service \u003e 14 days\"| \"CheckTime\"\n    \"ServiceDuration\" --\u003e|\"Service \u003c 14 days\"| \"RefundGranted\"\n    \n    \"CheckTime\" --\u003e|\"Within 14 days\"| \"RefundGranted\"\n    \"CheckTime\" --\u003e|\"After 14 days\"| \"RefundDenied\"\n```\n\n| Service Duration | Cancellation Window | Refund Policy | Legal Basis |\n|------------------|---------------------|---------------|-------------|\n| **\u003c 14 days** | Anytime during service period | Full refund | Short duration = full withdrawal period |\n| **\u003e 14 days** | Within first 14 days only | Full refund if within 14 days, none after | EU distance selling directive |\n| **Subscription** | Anytime | Pro-rated to current month end (mes vencido) | Recurring contract rules |\n| **Failed OTA** | N/A (automatic) | Full refund (never charged) | Service not delivered |\n\n### Configurable Post-Cancellation Policy\n\nThe system includes a configurable business rule: services cancelled due to customer dissatisfaction can be **removed from that customer's catalog**, preventing repurchase. This policy:\n- Discourages abuse of refund policies\n- Can be enabled/disabled per service type\n- Tracked in customer service history\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Special Lifecycle Scenarios\n\n### Vehicle Theft\n\nWhen a vehicle is reported stolen, the service lifecycle management system handles active services according to specific rules:\n\n| Service State | System Behavior | Rationale |\n|---------------|----------------|-----------|\n| **Delivered services** | Subject to normal desistimiento rules | Service was consumed before theft |\n| **Pending services** (scheduled future activation) | Can be cancelled by customer | Service not yet delivered |\n| **Active subscriptions** | Can be cancelled by customer | Recurring charges should stop |\n| **Expired desistimiento period** | No automatic refund | Legal withdrawal period has passed |\n\n**Important**: Vehicle theft does **NOT** trigger automatic refunds. The customer must explicitly request cancellation of pending/subscription services. Already-delivered services follow standard refund rules.\n\n### Warranty Loss Due to Maintenance\n\nIf a customer fails to maintain the vehicle according to the official maintenance plan:\n\n1. **Warranty Status**: Vehicle loses manufacturer warranty\n2. **Service Blocking**: New maintenance-linked services are blocked from purchase\n3. **Active Services**: Continue to function (cannot be deactivated)\n4. **Customer Notification**: System notifies customer of warranty loss and service restrictions\n5. **Resolution**: Customer must complete overdue maintenance at official workshop to restore access\n\nThe system queries VSS to determine maintenance status and enforces these rules at the service purchase boundary, not at the activation boundary.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:91-96](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Service Lifecycle Integration Points\n\nThe service lifecycle management subsystem integrates with multiple external and internal systems to deliver end-to-end functionality:\n\n**Diagram: Service Lifecycle System Integration**\n\n```mermaid\ngraph TB\n    subgraph \"Customer Access Layer\"\n        \"WebPlatform\"[\"Web Platform\"]\n        \"MobileApp\"[\"Mobile Application\"]\n        \"Expediente\"[\"Expediente de Compra\"]\n    end\n    \n    subgraph \"Service Lifecycle Core\"\n        \"ServiceCatalog\"[\"Service Catalog\u003cbr/\u003eOpciones Disponibles\"]\n        \"ActivationEngine\"[\"OTA Activation Engine\u003cbr/\u003eRetry Logic\"]\n        \"BillingManager\"[\"Billing Manager\u003cbr/\u003eMes Vencido\"]\n        \"CancellationHandler\"[\"Cancellation Handler\u003cbr/\u003eDesistimiento Rules\"]\n    end\n    \n    subgraph \"External Integrations\"\n        \"VSSIntegration\"[\"VSS Integration\u003cbr/\u003eMaintenance Queries\"]\n        \"PaymentGateway\"[\"Payment Gateway\u003cbr/\u003eAsync Settlement\"]\n        \"IoTAPI\"[\"API IoT\u003cbr/\u003eVehicle Communication\"]\n    end\n    \n    subgraph \"Internal Services\"\n        \"NotificationEngine\"[\"Notification Engine\"]\n        \"RefundProcessor\"[\"Refund Processor\"]\n        \"TechSupport\"[\"Technical Support Queue\"]\n    end\n    \n    subgraph \"Data Stores\"\n        \"ServiceDB\"[\"Service Database\u003cbr/\u003eActivations \u0026 History\"]\n        \"ConfigRepo\"[\"Configuration Repository\u003cbr/\u003eService Definitions\"]\n    end\n    \n    \"WebPlatform\" --\u003e \"Expediente\"\n    \"MobileApp\" --\u003e \"Expediente\"\n    \n    \"Expediente\" --\u003e \"ServiceCatalog\"\n    \"ServiceCatalog\" --\u003e \"VSSIntegration\"\n    \"ServiceCatalog\" --\u003e \"PaymentGateway\"\n    \n    \"PaymentGateway\" --\u003e \"ActivationEngine\"\n    \"ActivationEngine\" --\u003e \"IoTAPI\"\n    \"ActivationEngine\" --\u003e \"ConfigRepo\"\n    \n    \"ActivationEngine\" --\u003e \"NotificationEngine\"\n    \"ActivationEngine\" --\u003e \"TechSupport\"\n    \"ActivationEngine\" --\u003e \"RefundProcessor\"\n    \n    \"ServiceCatalog\" --\u003e \"BillingManager\"\n    \"BillingManager\" --\u003e \"PaymentGateway\"\n    \n    \"Expediente\" --\u003e \"CancellationHandler\"\n    \"CancellationHandler\" --\u003e \"RefundProcessor\"\n    \"CancellationHandler\" --\u003e \"ActivationEngine\"\n    \n    \"ServiceCatalog\" --\u003e \"ServiceDB\"\n    \"ActivationEngine\" --\u003e \"ServiceDB\"\n    \"BillingManager\" --\u003e \"ServiceDB\"\n    \"CancellationHandler\" --\u003e \"ServiceDB\"\n```\n\n### Key Integration Dependencies\n\n1. **VSS (Vehicle Service System)**: Queried before allowing purchase of maintenance-linked services\n2. **API IoT**: Pre-existing, documented API for sending OTA commands to vehicles\n3. **Payment Gateway**: Processes payments asynchronously; CaaS delivers services before settlement confirmation\n4. **Notification Engine**: Multi-channel notifications (email, app push, vehicle display) for service lifecycle events\n5. **Technical Support Queue**: Receives failed activation cases for manual intervention\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:31-56](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Service Lifecycle Key Metrics\n\nThe service lifecycle management system should track the following operational metrics for business intelligence and system health monitoring:\n\n| Metric Category | Key Metrics | Purpose |\n|----------------|-------------|---------|\n| **Activation Success** | OTA activation success rate, average retry count, technical support escalations | Monitor OTA reliability |\n| **Billing Performance** | Subscription renewal rate, failed payment rate, mes vencido collection efficiency | Financial health |\n| **Customer Behavior** | Service purchase rate, cancellation rate, desistimiento usage, repurchase rate | Product optimization |\n| **Maintenance Gating** | Services blocked by maintenance, maintenance compliance rate, VSS query latency | Safety and compliance |\n| **Refund Volume** | Refunds issued, refund reasons (OTA failure vs desistimiento), refund processing time | Customer satisfaction and cost |\n\nThese metrics inform business decisions about service catalog composition, pricing strategies, and system reliability investments.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"28:T466f,"])</script><script>self.__next_f.push([1,"# Service Catalog and Pricing\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document defines the service catalog structure and pricing models used in the CaaS platform. It covers the distinction between the **plataforma base** (base platform) and **opciones disponibles** (optional services), the various pricing models (pay-per-use, temporary, permanent, subscription), and how services are organized and presented to customers.\n\nFor information about the business model context and value proposition, see [Platform Base and Optional Services](#2.1). For details on OTA activation mechanics, see [OTA Service Activation](#6.2). For maintenance requirements that gate service access, see [Maintenance-Linked Service Access](#6.3). For cancellation policies and refund rules, see [Service Cancellation and Refunds](#6.4).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Service Categories\n\nThe CaaS platform organizes vehicle functionality into two fundamental categories that define the commercial model:\n\n### Plataforma Base (Base Platform)\n\nThe **plataforma base** is the foundational vehicle configuration that customers purchase outright. It includes all features necessary to make the vehicle fully operational from delivery:\n\n- Core drivetrain and propulsion system\n- Standard safety features\n- Basic infotainment and controls\n- Essential connectivity for IoT communication\n- Standard climate control\n- Factory-mandated equipment by regulation\n\nThe base platform is **permanently active** and cannot be disabled. It represents the minimum viable product that customers own in perpetuity.\n\n### Opciones Disponibles (Optional Services)\n\n**Opciones disponibles** are optional features available for on-demand activation. These services enhance the base platform functionality and are enabled via the pay-per-use model. Example services include:\n\n| Service Category | Example Features | Activation Method |\n|-----------------|------------------|-------------------|\n| Performance | 50% power increase | OTA configuration |\n| Safety \u0026 Assistance | Driver assistance systems | OTA configuration |\n| Autonomous Driving | Highway autonomous mode | OTA configuration |\n| Traction \u0026 Handling | Terrain-specific modes (snow, off-road, sport) | OTA configuration |\n| Climate | Advanced climatization systems | OTA configuration |\n| Entertainment | Premium in-vehicle entertainment services | OTA configuration |\n\nAll optional service functionality is **pre-installed in the vehicle firmware**. The CaaS system does not deploy new software; it only activates or deactivates existing capabilities through configuration changes.\n\n**Sources:** [enunciado.md:3-4](), [pasame las preguntas y sus respuestas a markdown.md:55-56]()\n\n---\n\n## Pricing Models\n\nThe CaaS platform supports multiple pricing models to accommodate different customer usage patterns and preferences. All service payments follow the **pago por uso** (pay-per-use) principle.\n\n### Pricing Model Taxonomy\n\n```mermaid\ngraph TD\n    ROOT[\"Service Pricing Models\"]\n    \n    ROOT --\u003e ONETIME[\"One-Time Payment\"]\n    ROOT --\u003e RECURRING[\"Recurring Payment\"]\n    \n    ONETIME --\u003e TEMP[\"Temporary Service\"]\n    ONETIME --\u003e PERM[\"Permanent Service\"]\n    \n    RECURRING --\u003e SUB[\"Subscription\u003cbr/\u003e(Mes Vencido)\"]\n    \n    TEMP --\u003e TEMP_DESC[\"Duration: Fixed period\u003cbr/\u003eExamples: 1 day, 1 week, 1 month\u003cbr/\u003ePayment: Upfront\"]\n    PERM --\u003e PERM_DESC[\"Duration: Until vehicle end-of-life\u003cbr/\u003ePayment: Upfront\"]\n    SUB --\u003e SUB_DESC[\"Duration: Monthly renewal\u003cbr/\u003ePayment: Post-paid (end of month)\"]\n    \n    style ROOT fill:#f9f9f9\n    style ONETIME fill:#f9f9f9\n    style RECURRING fill:#f9f9f9\n```\n\n**Sources:** [enunciado.md:5-6](), [enunciado.md:21](), [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n### One-Time Payment Services\n\nCustomers pay once to activate a service for a defined period or permanently:\n\n- **Temporary Services**: Active for a specific duration (e.g., 1 day, 1 week, 1 month, 3 months)\n  - Payment is collected upfront before OTA activation\n  - Service automatically deactivates at the end of the period\n  - Subject to desistimiento (withdrawal rights) based on service duration\n  \n- **Permanent Services**: Active until the end of the vehicle's operational life\n  - Single upfront payment\n  - Cannot be deactivated by the system (customer owns the feature)\n  - Subject to 14-day desistimiento period\n\n### Recurring Payment Services (Subscriptions)\n\nSubscription services provide ongoing access with monthly billing:\n\n- **Billing Model**: **Mes vencido** (post-paid)  customers are charged at the end of each month for services consumed during that month\n- **Payment Timing**: Charge occurs after service delivery, accepting settlement risk\n- **Cancellation**: Customer can cancel at any time; no charges for future months\n- **Renewal**: Automatic renewal unless customer explicitly cancels\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:82](), [enunciado.md:5-6]()\n\n---\n\n## Service Duration Types and Scheduling\n\nServices can be purchased for immediate activation or scheduled for future delivery:\n\n### Immediate Activation\n\nDefault mode where service activation occurs immediately after successful payment:\n\n```mermaid\nsequenceDiagram\n    participant C as Customer\n    participant WP as Web/Mobile Platform\n    participant PP as Payment Processing\n    participant OTA as OTA Engine\n    participant V as Vehicle\n    \n    C-\u003e\u003eWP: \"Select service + duration\"\n    WP-\u003e\u003eC: \"Display price\"\n    C-\u003e\u003ePP: \"Submit payment\"\n    PP-\u003e\u003ePP: \"Process payment\"\n    PP-\u003e\u003eOTA: \"Payment successful - activate\"\n    OTA-\u003e\u003eV: \"Push OTA configuration\"\n    V-\u003e\u003eOTA: \"Confirm activation\"\n    OTA-\u003e\u003eC: \"Notification: Service active\"\n```\n\n**Sources:** [enunciado.md:19](), [pasame las preguntas y sus respuestas a markdown.md:47-53]()\n\n### Planned/Scheduled Activation\n\nCustomers can schedule service activation for a future date or create recurring activation patterns:\n\n- **Single Future Activation**: Service activates at a specified date/time\n  - Example: Activate performance mode for a planned road trip next month\n  - Payment collected upfront at time of purchase\n  - OTA activation queued for scheduled time\n  \n- **Recurring Activation**: Service automatically renews at regular intervals\n  - Example: Activate winter traction mode every December-February\n  - Functions as a scheduled subscription\n  - Payment timing depends on subscription vs. one-time model\n\n**Sources:** [enunciado.md:21]()\n\n---\n\n## Service Catalog Structure\n\nThe service catalog must support discovery, filtering, and purchase workflows across web and mobile platforms. While implementation details are in the expediente system (see [Customer-Facing Platforms](#4.3)), the catalog structure defines how services are organized.\n\n### Service Metadata\n\nEach service in the catalog contains the following attributes:\n\n| Attribute | Description | Example Values |\n|-----------|-------------|----------------|\n| Service ID | Unique identifier | `PERF_BOOST_50`, `AUTO_HIGHWAY`, `CLIMATE_ADV` |\n| Service Name | Customer-facing name | \"50% Power Increase\", \"Highway Autopilot\" |\n| Category | Functional grouping | Performance, Safety, Entertainment |\n| Base Platform | Compatible platforms | Platform A, Platform B, All |\n| Description | Feature explanation | \"Increases engine output by 50% for enhanced acceleration\" |\n| Pricing Tiers | Available durations/types | 1-day: 10, 1-month: 50, Permanent: 500 |\n| Maintenance Required | VSS check required | true/false |\n| Maintenance Block | Required maintenance category | Engine, Electronics, None |\n\n### Pricing Tiers and Duration Options\n\nServices can offer multiple pricing tiers based on duration:\n\n```mermaid\ngraph LR\n    SERVICE[\"Service: 50% Power Increase\"]\n    \n    SERVICE --\u003e T1[\"1 Day\u003cbr/\u003e10\"]\n    SERVICE --\u003e T2[\"1 Week\u003cbr/\u003e50\"]\n    SERVICE --\u003e T3[\"1 Month\u003cbr/\u003e150\"]\n    SERVICE --\u003e T4[\"3 Months\u003cbr/\u003e400\"]\n    SERVICE --\u003e T5[\"Permanent\u003cbr/\u003e1,200\"]\n    SERVICE --\u003e T6[\"Subscription\u003cbr/\u003e180/month\"]\n    \n    style SERVICE fill:#f9f9f9\n```\n\nPricing tiers typically follow diminishing marginal costs to incentivize longer commitments. The permanent option represents the full feature purchase, while subscription provides flexibility.\n\n**Sources:** [enunciado.md:3-4](), [enunciado.md:21]()\n\n---\n\n## Maintenance-Linked Pricing Dependencies\n\nSome services have maintenance requirements that affect availability and pricing. This creates conditional access rules in the catalog.\n\n### Maintenance-Gated Services\n\nCertain high-performance or safety-critical services require current maintenance to be purchased:\n\n```mermaid\nflowchart TD\n    BROWSE[\"Customer browses\u003cbr/\u003emaintenance-gated service\"]\n    CHECK[\"System queries VSS\u003cbr/\u003emaintenance status\"]\n    STATUS{Maintenance\u003cbr/\u003ecurrent?}\n    \n    BROWSE --\u003e CHECK\n    CHECK --\u003e STATUS\n    \n    STATUS --\u003e|Yes| AVAILABLE[\"Service available\u003cbr/\u003efor purchase\"]\n    STATUS --\u003e|No| BLOCKED[\"Service unavailable\u003cbr/\u003eMessage: Complete maintenance\"]\n    \n    BLOCKED --\u003e CANT_BUY[\"Cannot purchase\u003cbr/\u003eCannot display pricing\"]\n    AVAILABLE --\u003e CAN_BUY[\"Display pricing\u003cbr/\u003eAllow purchase\"]\n    \n    style BLOCKED fill:#f9f9f9\n    style AVAILABLE fill:#f9f9f9\n```\n\n**Key Rules:**\n- If maintenance is **overdue**, maintenance-gated services are **hidden or marked unavailable** in the catalog\n- Already-activated services remain active; only **new purchases** are blocked\n- The base platform is never affected by maintenance status\n- Customers are notified to complete maintenance to unlock gated services\n\nFor full details on maintenance checking and VSS integration, see [Maintenance-Linked Service Access](#6.3).\n\n**Sources:** [enunciado.md:23](), [pasame las preguntas y sus respuestas a markdown.md:66-70]()\n\n---\n\n## Payment Processing and Service Delivery\n\nThe pricing model integrates tightly with payment processing and OTA activation workflows.\n\n### Payment-to-Activation Flow\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant Catalog as \"Service Catalog\"\n    participant Payment as \"Payment Gateway\"\n    participant OTA as \"OTA Engine\"\n    participant Vehicle\n    \n    Customer-\u003e\u003eCatalog: \"Browse opciones disponibles\"\n    Catalog-\u003e\u003eCustomer: \"Display services + pricing tiers\"\n    Customer-\u003e\u003eCatalog: \"Select service + duration\"\n    Catalog-\u003e\u003eCustomer: \"Display total price\"\n    Customer-\u003e\u003ePayment: \"Submit payment\"\n    \n    Note over Payment: Async settlement\u003cbr/\u003eCaaS assumes risk\n    \n    Payment-\u003e\u003eOTA: \"Payment initiated - proceed\"\n    OTA-\u003e\u003eVehicle: \"OTA activation command\"\n    \n    alt Activation Successful\n        Vehicle-\u003e\u003eOTA: \"Activation confirmed\"\n        OTA-\u003e\u003eCustomer: \"Service active notification\"\n    else Activation Failed\n        Vehicle-\u003e\u003eOTA: \"Activation failed\"\n        OTA-\u003e\u003eOTA: \"Retry logic\"\n        alt Retry Succeeds\n            OTA-\u003e\u003eCustomer: \"Service active (delayed)\"\n        else All Retries Fail\n            OTA-\u003e\u003eCustomer: \"Technical issue - NO CHARGE\"\n            Note over Payment: Refund or do not settle\n        end\n    end\n```\n\n**Critical Business Rule:** If OTA activation fails after all retries, the customer is **not charged** for the service. The payment must either be refunded or never settled. This protects customer trust and meets legal obligations for delivered services.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:47-53](), [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Subscription Billing (Mes Vencido)\n\nSubscription services use a post-paid billing model unique from one-time purchases.\n\n### Billing Cycle\n\n```mermaid\ngantt\n    title Monthly Subscription Billing Cycle (Mes Vencido)\n    dateFormat YYYY-MM-DD\n    axisFormat %b %d\n    \n    section Service Usage\n    Customer uses subscription service :active, use, 2024-01-01, 31d\n    \n    section Billing\n    Billing period ends          :milestone, m1, 2024-01-31, 0d\n    Charge customer for January  :crit, bill, 2024-01-31, 2d\n    \n    section Next Month\n    Service continues (if paid)  :active, use2, 2024-02-01, 28d\n```\n\n**Billing Process:**\n1. **Start of Month**: Subscription activates via OTA\n2. **During Month**: Customer uses service; no charges\n3. **End of Month**: System calculates usage charge\n4. **Billing Event**: Payment gateway processes charge for completed month\n5. **Payment Success**: Subscription continues into next month\n6. **Payment Failure**: Subscription cancelled; service deactivated\n\nThis **mes vencido** (past month) model means customers pay for consumption after delivery, creating settlement risk that CaaS accepts for improved customer experience.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n---\n\n## Pricing Rules and Business Logic\n\nThe service catalog enforces several business rules that affect pricing and availability:\n\n### Desistimiento-Based Pricing Display\n\nService pricing must account for withdrawal rights (desistimiento):\n\n| Service Duration | Withdrawal Period | Pricing Implication |\n|------------------|-------------------|---------------------|\n| \u003c 14 days | Anytime | Lower pricing to offset refund risk |\n| \u003e 14 days | First 14 days only | Standard pricing |\n| Subscription | Anytime (cancel future) | Monthly rate accounts for churn |\n| Permanent | First 14 days | Premium pricing with refund risk |\n\nServices shorter than 14 days face higher refund risk since customers can cancel anytime, which may influence pricing strategy.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:85-89]()\n\n### Platform-Specific Service Availability\n\nNot all services are available for all base platforms. The catalog must filter services based on the customer's vehicle platform:\n\n```mermaid\ngraph TD\n    CUSTOMER[\"Customer Vehicle:\u003cbr/\u003ePlatform A\"]\n    CATALOG[\"Service Catalog\"]\n    \n    CATALOG --\u003e ALL[\"Services for All Platforms\"]\n    CATALOG --\u003e PLAT_A[\"Services for Platform A\"]\n    CATALOG --\u003e PLAT_B[\"Services for Platform B\"]\n    CATALOG --\u003e PLAT_C[\"Services for Platform C\"]\n    \n    CUSTOMER --\u003e DISPLAY[\"Display to Customer\"]\n    ALL --\u003e DISPLAY\n    PLAT_A --\u003e DISPLAY\n    \n    style PLAT_B fill:#f9f9f9\n    style PLAT_C fill:#f9f9f9\n```\n\nThe catalog must know the customer's base platform (stored during initial sale registration) to filter available services.\n\n**Sources:** [enunciado.md:3]()\n\n---\n\n## Service Pricing Examples\n\nThe following table illustrates realistic pricing structures for various service types:\n\n| Service | Category | 1 Day | 1 Week | 1 Month | 3 Months | Permanent | Subscription |\n|---------|----------|-------|--------|---------|----------|-----------|--------------|\n| 50% Power Increase | Performance | 15 | 60 | 180 | 450 | 1,500 | 200/mo |\n| Highway Autopilot | Autonomous | 20 | 80 | 240 | 600 | 2,000 | 260/mo |\n| Advanced Climate | Comfort | 5 | 20 | 60 | 150 | 500 | 70/mo |\n| Off-Road Mode | Traction | 10 | 40 | 120 | 300 | 800 | 130/mo |\n| Premium Entertainment | Entertainment | 8 | 30 | 90 | 225 | 600 | 100/mo |\n\n**Pricing Patterns:**\n- **Volume Discounts**: Longer durations have lower daily/weekly cost\n- **Permanent Premium**: Permanent purchase costs 6-10x monthly price (break-even at 6-10 months)\n- **Subscription Trade-off**: Higher monthly cost than one-time monthly purchase, but no upfront commitment\n\n---\n\n## Service Catalog System Integration\n\nThe service catalog interfaces with multiple CaaS subsystems:\n\n```mermaid\ngraph TB\n    CATALOG[\"Service Catalog\u003cbr/\u003e(Database + API)\"]\n    \n    WEB[\"Web Platform\"]\n    MOBILE[\"Mobile App\"]\n    INTRANET[\"Corporate Intranet\"]\n    \n    VSS[\"VSS System\u003cbr/\u003e(Maintenance Status)\"]\n    PAYMENT[\"Payment Gateway\"]\n    OTA[\"OTA Engine\"]\n    CUSTOMER_DB[\"Customer Database\u003cbr/\u003e(Vehicle + Platform)\"]\n    \n    WEB --\u003e CATALOG\n    MOBILE --\u003e CATALOG\n    INTRANET --\u003e CATALOG\n    \n    CATALOG --\u003e CUSTOMER_DB\n    CATALOG --\u003e VSS\n    CATALOG --\u003e PAYMENT\n    CATALOG --\u003e OTA\n    \n    CUSTOMER_DB --\u003e|\"Vehicle platform type\"| CATALOG\n    VSS --\u003e|\"Maintenance status\"| CATALOG\n    CATALOG --\u003e|\"Service details + price\"| PAYMENT\n    PAYMENT --\u003e|\"Payment success\"| OTA\n```\n\n**Integration Points:**\n- **Customer Database**: Provides vehicle platform type to filter available services\n- **VSS System**: Provides maintenance status to gate service access\n- **Payment Gateway**: Receives pricing information and processes transactions\n- **OTA Engine**: Receives service activation requests after successful payment\n- **Web/Mobile/Intranet**: All access channels query catalog for available services\n\n**Sources:** [enunciado.md:9-19](), [pasame las preguntas y sus respuestas a markdown.md:31-44]()\n\n---\n\n## Summary\n\nThe CaaS service catalog implements a flexible pricing model that supports:\n\n1. **Two-tier service model**: Plataforma base (owned) + opciones disponibles (pay-per-use)\n2. **Multiple pricing models**: One-time (temporary/permanent) and recurring (subscription/mes vencido)\n3. **Scheduled activation**: Immediate or future-planned service delivery\n4. **Maintenance-gated access**: Premium/safety services require current maintenance\n5. **Risk-based pricing**: Desistimiento rules and settlement risk factored into pricing\n6. **Pre-installed activation**: All services exist in firmware; CaaS only activates features\n7. **Customer protection**: Failed activations result in no charge\n\nThe catalog serves as the central reference for service availability, pricing, and business rules, integrating with payment processing, OTA activation, and maintenance verification systems.\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"29:T5c49,"])</script><script>self.__next_f.push([1,"# OTA Service Activation\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the Over-The-Air (OTA) service activation mechanism used to remotely enable optional services on customer vehicles after payment. OTA activation is the technical delivery mechanism for all services sold through the CaaS platform.\n\n**Scope of this document:**\n- Pre-installed functionality model and activation mechanics\n- Integration with the existing API IoT infrastructure\n- Activation workflow from payment to service delivery\n- Retry logic and failure handling mechanisms\n- The critical \"do not charge\" rule for failed activations\n- Technical support escalation procedures\n\n**Related pages:**\n- For service catalog and pricing models, see [Service Catalog and Pricing](#6.1)\n- For maintenance requirements that may block activation, see [Maintenance-Linked Service Access](#6.3)\n- For payment processing before activation, see [Payment Types and Flows](#7.1)\n- For the broader IoT infrastructure, see [Vehicle Communication (IoT and OTA)](#5.3)\n\nSources: [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:31-56]()\n\n---\n\n## Pre-Installed Functionality Model\n\nAll vehicles sold through CaaS are delivered with **complete firmware pre-installed** containing all optional features in a dormant state. The OTA activation process does not install new software or update the vehicle's firmware; it merely **enables or disables** existing functionality through configuration changes.\n\n```mermaid\ngraph TB\n    subgraph \"Vehicle Firmware\"\n        BASE[\"Plataforma Base\u003cbr/\u003e(Always Active)\"]\n        OPT1[\"Optional Feature 1\u003cbr/\u003e(Dormant)\"]\n        OPT2[\"Optional Feature 2\u003cbr/\u003e(Dormant)\"]\n        OPT3[\"Optional Feature 3\u003cbr/\u003e(Dormant)\"]\n        OPTN[\"Optional Feature N\u003cbr/\u003e(Dormant)\"]\n    end\n    \n    subgraph \"OTA Activation\"\n        CONFIG[\"Configuration Command\u003cbr/\u003evia API IoT\"]\n    end\n    \n    CONFIG --\u003e|\"Enable Feature 1\"| OPT1\n    CONFIG --\u003e|\"Enable Feature 2\"| OPT2\n    OPT1 -.-\u003e|\"State: Active\"| OPT1\n    OPT2 -.-\u003e|\"State: Active\"| OPT2\n    \n    BASE -.-\u003e|\"Always Enabled\"| BASE\n    OPT3 -.-\u003e|\"Remains Dormant\"| OPT3\n    OPTN -.-\u003e|\"Remains Dormant\"| OPTN\n```\n\n**Key characteristics:**\n\n| Aspect | Description |\n|--------|-------------|\n| **Software Updates** | Independent process, not managed by CaaS sales system |\n| **Activation Mechanism** | Configuration flag changes sent via API IoT |\n| **Hardware Requirements** | All hardware for optional features already present in vehicle |\n| **Activation Speed** | Near-instantaneous once configuration received by vehicle |\n| **Deactivation** | Services can be disabled by sending deactivation commands |\n| **Workshop Visit** | Never required for CaaS-managed optional services |\n\nThis architecture enables:\n- Fast service delivery (no software installation required)\n- Reliable activation (no risk of failed downloads or corrupted installs)\n- Reversibility (features can be disabled if subscription ends)\n- Offline capability (vehicle doesn't need internet to use activated features, only to receive activation)\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:55-56](), [enunciado.md:3-4]()\n\n---\n\n## OTA Activation Process Flow\n\nThe following sequence diagram illustrates the end-to-end flow from payment to service activation, including success and failure paths.\n\n### OTA Activation Sequence Diagram\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebApp as \"Web/Mobile\u003cbr/\u003ePlatform\"\n    participant PaymentSvc as \"Payment\u003cbr/\u003eService\"\n    participant OTAEngine as \"OTA Activation\u003cbr/\u003eEngine\"\n    participant APIIoT as \"API IoT\u003cbr/\u003e(Existing)\"\n    participant IoTNetwork as \"IoT Network\"\n    participant Vehicle\n    participant NotificationSvc as \"Notification\u003cbr/\u003eService\"\n    participant TechSupport as \"Technical\u003cbr/\u003eSupport\"\n    \n    Customer-\u003e\u003eWebApp: \"Select service \u0026 duration\"\n    WebApp-\u003e\u003ePaymentSvc: \"Initiate payment\"\n    PaymentSvc-\u003e\u003eCustomer: \"Payment confirmed\"\n    \n    Note over PaymentSvc,OTAEngine: Payment successful,\u003cbr/\u003etrigger activation\n    \n    PaymentSvc-\u003e\u003eOTAEngine: \"Activate service\"\n    OTAEngine-\u003e\u003eOTAEngine: \"Queue activation request\"\n    \n    rect rgb(240, 240, 240)\n        Note over OTAEngine,Vehicle: Activation Attempt Loop\n        \n        OTAEngine-\u003e\u003eAPIIoT: \"POST /vehicle/{vin}/configure\"\n        APIIoT-\u003e\u003eIoTNetwork: \"Push configuration\"\n        IoTNetwork-\u003e\u003eVehicle: \"Apply configuration\"\n        \n        alt Vehicle Successfully Configured\n            Vehicle-\u003e\u003eIoTNetwork: \"Configuration applied\"\n            IoTNetwork-\u003e\u003eAPIIoT: \"Success status\"\n            APIIoT-\u003e\u003eOTAEngine: \"200 OK + confirmation\"\n            OTAEngine-\u003e\u003eNotificationSvc: \"Service activated\"\n            NotificationSvc-\u003e\u003eCustomer: \"Service active notification\"\n        else Vehicle Communication Failed\n            IoTNetwork--\u003e\u003eAPIIoT: \"Timeout / Error\"\n            APIIoT--\u003e\u003eOTAEngine: \"4xx/5xx Error\"\n            OTAEngine-\u003e\u003eOTAEngine: \"Increment retry count\"\n            \n            alt Retries Remaining\n                Note over OTAEngine: Wait backoff period,\u003cbr/\u003eretry activation\n            else Max Retries Exceeded\n                OTAEngine-\u003e\u003eAPIIoT: \"GET /vehicle/{vin}/status\"\n                APIIoT-\u003e\u003eOTAEngine: \"Vehicle telemetry\"\n                OTAEngine-\u003e\u003eTechSupport: \"Escalate with diagnostics\"\n                OTAEngine-\u003e\u003ePaymentSvc: \"DO NOT CHARGE customer\"\n                OTAEngine-\u003e\u003eNotificationSvc: \"Activation failed\"\n                NotificationSvc-\u003e\u003eCustomer: \"Issue notification + no charge\"\n            end\n        end\n    end\n```\n\n**Process steps:**\n\n1. **Payment Confirmation**: Customer pays, payment service confirms success\n2. **Activation Queuing**: OTA Engine receives activation request and queues it\n3. **Configuration Push**: OTA Engine calls API IoT to push configuration to vehicle\n4. **Vehicle Application**: IoT Network delivers configuration to physical vehicle\n5. **Confirmation Loop**: System waits for vehicle to confirm configuration applied\n6. **Success Path**: Notify customer and mark service as active\n7. **Failure Path**: Retry with backoff, escalate to tech support if all retries fail\n8. **Customer Protection**: Ensure customer is not charged if activation fails\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:46-53](), [enunciado.md:18-20]()\n\n---\n\n## API IoT Integration\n\nThe CaaS platform integrates with a **pre-existing, documented, and tested** API IoT infrastructure. This API is a constraint of the systemit already exists and cannot be modified by the CaaS project.\n\n### API IoT Architecture\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform\"\n        OTAEngine[\"OTA Activation Engine\"]\n        ConfigRepo[(\"Configuration\u003cbr/\u003eRepository\")]\n        ServiceDB[(\"Service\u003cbr/\u003eDatabase\")]\n    end\n    \n    subgraph \"API IoT (Pre-Existing System)\"\n        APIEndpoint[\"API IoT REST Interface\"]\n        AuthLayer[\"Authentication Layer\"]\n        CommandQueue[\"Command Queue\"]\n        TelemetryReceiver[\"Telemetry Receiver\"]\n        StateCache[(\"Vehicle State Cache\")]\n    end\n    \n    subgraph \"IoT Network Infrastructure\"\n        MessageBroker[\"Message Broker\u003cbr/\u003e(e.g., MQTT)\"]\n        ConnMgr[\"Connection Manager\"]\n    end\n    \n    subgraph \"Vehicle Fleet\"\n        V1[\"Vehicle 1\u003cbr/\u003eECU\"]\n        V2[\"Vehicle 2\u003cbr/\u003eECU\"]\n        VN[\"Vehicle N\u003cbr/\u003eECU\"]\n    end\n    \n    OTAEngine --\u003e|\"POST /vehicle/{vin}/configure\"| APIEndpoint\n    OTAEngine --\u003e|\"GET /vehicle/{vin}/status\"| APIEndpoint\n    OTAEngine -.-\u003e|\"Read config templates\"| ConfigRepo\n    OTAEngine -.-\u003e|\"Log activation attempts\"| ServiceDB\n    \n    APIEndpoint --\u003e AuthLayer\n    AuthLayer --\u003e CommandQueue\n    AuthLayer --\u003e StateCache\n    \n    CommandQueue --\u003e MessageBroker\n    TelemetryReceiver --\u003e StateCache\n    \n    MessageBroker \u003c--\u003e ConnMgr\n    ConnMgr \u003c--\u003e|\"Bidirectional\u003cbr/\u003eVehicle Link\"| V1\n    ConnMgr \u003c--\u003e|\"Bidirectional\u003cbr/\u003eVehicle Link\"| V2\n    ConnMgr \u003c--\u003e|\"Bidirectional\u003cbr/\u003eVehicle Link\"| VN\n    \n    V1 --\u003e|\"Status \u0026 telemetry\"| TelemetryReceiver\n    V2 --\u003e|\"Status \u0026 telemetry\"| TelemetryReceiver\n    VN --\u003e|\"Status \u0026 telemetry\"| TelemetryReceiver\n```\n\n### Key API IoT Endpoints\n\n| Endpoint | Method | Purpose | CaaS Usage |\n|----------|--------|---------|------------|\n| `/vehicle/{vin}/configure` | POST | Send configuration command to vehicle | Activate/deactivate services |\n| `/vehicle/{vin}/status` | GET | Query current vehicle state and telemetry | Pre-activation checks, failure diagnostics |\n| `/vehicle/{vin}/health` | GET | Query vehicle connectivity and health | Determine if vehicle is reachable |\n| `/vehicle/{vin}/history` | GET | Retrieve configuration history | Audit trail, troubleshooting |\n\n**Integration characteristics:**\n\n- **Synchronicity**: API calls are synchronous (request-response), but vehicle communication is asynchronous\n- **Response Model**: API IoT returns immediate acceptance (202 Accepted) and requires polling or callback for final status\n- **Authentication**: OAuth 2.0 client credentials flow for CaaS service account\n- **Rate Limiting**: Maximum 10 configuration commands per vehicle per hour (prevent flooding)\n- **Timeout**: Configuration commands timeout after 5 minutes if vehicle doesn't respond\n- **Idempotency**: Configuration commands are idempotent (safe to retry)\n\n**Responsibility boundaries:**\n\n| Responsibility | API IoT | CaaS OTA Engine |\n|----------------|---------|-----------------|\n| **Message routing to vehicle** |  | |\n| **Vehicle connectivity management** |  | |\n| **Configuration persistence on vehicle** |  | |\n| **Retry logic for failed activation** | |  |\n| **Business rule enforcement** | |  |\n| **Customer notification** | |  |\n| **Payment reversal on failure** | |  |\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:33-38]()\n\n---\n\n## Retry and Failure Handling\n\nThe OTA Activation Engine implements **robust retry logic with exponential backoff** to handle transient failures in vehicle communication. The system distinguishes between recoverable errors (retry) and terminal failures (escalate).\n\n### OTA Activation State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e PaymentConfirmed: \"Payment successful\"\n    \n    PaymentConfirmed --\u003e QueuedForActivation: \"Queue activation request\"\n    \n    QueuedForActivation --\u003e AttemptingActivation: \"Start activation\"\n    \n    state AttemptingActivation {\n        [*] --\u003e SendingCommand\n        SendingCommand --\u003e WaitingResponse: \"API IoT call sent\"\n        WaitingResponse --\u003e CheckingResponse: \"Response received\"\n        \n        CheckingResponse --\u003e Success: \"200 OK + vehicle confirmed\"\n        CheckingResponse --\u003e Failure: \"Error response or timeout\"\n        \n        Failure --\u003e EvaluatingRetry: \"Check retry count\"\n        EvaluatingRetry --\u003e CalculateBackoff: \"Retries \u003c max\"\n        CalculateBackoff --\u003e WaitingBackoff: \"Delay = 2^retry * base_delay\"\n        WaitingBackoff --\u003e SendingCommand: \"Backoff complete\"\n        \n        EvaluatingRetry --\u003e MaxRetriesExceeded: \"Retries \u003e= max\"\n    }\n    \n    Success --\u003e NotifyingCustomer: \"Mark service active\"\n    NotifyingCustomer --\u003e Active: \"Send success notification\"\n    Active --\u003e [*]\n    \n    MaxRetriesExceeded --\u003e QueryingVehicleState: \"GET vehicle status\"\n    QueryingVehicleState --\u003e EscalatingToSupport: \"Collect diagnostics\"\n    EscalatingToSupport --\u003e ReversingPayment: \"Create support ticket\"\n    ReversingPayment --\u003e NotifyingFailure: \"DO NOT CHARGE\"\n    NotifyingFailure --\u003e Failed: \"Notify customer of issue\"\n    Failed --\u003e [*]\n    \n    note right of ReversingPayment\n        Critical Business Rule:\n        Customer NEVER pays for\n        undelivered service\n    end note\n```\n\n### Retry Configuration\n\n```mermaid\ngraph LR\n    subgraph \"Retry Parameters\"\n        MaxRetries[\"Max Retries: N\u003cbr/\u003e(configurable, e.g., 5)\"]\n        BaseDelay[\"Base Delay: T\u003cbr/\u003e(configurable, e.g., 30s)\"]\n        MaxDelay[\"Max Delay: M\u003cbr/\u003e(configurable, e.g., 15min)\"]\n    end\n    \n    subgraph \"Backoff Calculation\"\n        Formula[\"delay = min(2^retry  T, M)\"]\n    end\n    \n    subgraph \"Example Timeline\"\n        A1[\"Attempt 1: t=0\"]\n        A2[\"Attempt 2: t=30s\"]\n        A3[\"Attempt 3: t=90s\"]\n        A4[\"Attempt 4: t=210s\"]\n        A5[\"Attempt 5: t=450s\"]\n        A6[\"Attempt 6: t=900s\"]\n        ESC[\"Escalate: t=1800s\"]\n    end\n    \n    MaxRetries --\u003e Formula\n    BaseDelay --\u003e Formula\n    MaxDelay --\u003e Formula\n    \n    Formula --\u003e A1\n    A1 --\u003e A2\n    A2 --\u003e A3\n    A3 --\u003e A4\n    A4 --\u003e A5\n    A5 --\u003e A6\n    A6 --\u003e ESC\n```\n\n**Failure categories and handling:**\n\n| Failure Type | Example | Retry? | Action |\n|--------------|---------|--------|--------|\n| **Transient Network** | IoT network congestion | Yes | Retry with backoff |\n| **Vehicle Offline** | Vehicle in garage, no signal | Yes | Retry with backoff |\n| **API IoT Error** | 5xx server error | Yes | Retry with backoff |\n| **Invalid Configuration** | Malformed config data | No | Immediate escalation, code bug |\n| **Vehicle Incompatible** | Service not supported by vehicle model | No | Immediate escalation, data error |\n| **Authorization Failure** | Invalid API credentials | No | Immediate escalation, config error |\n| **Max Retries Exceeded** | Vehicle persistently unreachable | No | Escalate to tech support |\n\n**Critical rule: DO NOT CHARGE customer**\n\nWhen activation fails after all retries are exhausted:\n\n1. **Payment Reversal**: If payment was processed, initiate immediate refund\n2. **Service Database**: Mark service as \"Failed Activation\" (not \"Active\")\n3. **Customer Notification**: Send clear explanation that service was NOT delivered\n4. **Audit Trail**: Log all retry attempts and final failure reason\n5. **Technical Support**: Create ticket with vehicle diagnostics for manual intervention\n\nThis rule is **non-negotiable** and protects customer trust. The system must never charge for services it cannot deliver.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Customer Notifications\n\nCustomers receive **real-time notifications** about OTA activation status through multiple channels. Notifications are sent at key points in the activation process.\n\n### Notification Flow\n\n```mermaid\ngraph TD\n    subgraph \"Activation Events\"\n        E1[\"Payment Confirmed\"]\n        E2[\"Activation Started\"]\n        E3[\"Activation In Progress\"]\n        E4[\"Activation Successful\"]\n        E5[\"Activation Failed\"]\n        E6[\"Retry Attempt\"]\n    end\n    \n    subgraph \"Notification Service\"\n        Router[\"Notification Router\"]\n        EmailSvc[\"Email Service\"]\n        PushSvc[\"Push Notification\u003cbr/\u003eService\"]\n        VehicleHMI[\"Vehicle HMI\u003cbr/\u003evia API IoT\"]\n    end\n    \n    subgraph \"Customer Touchpoints\"\n        Email[\"Customer Email\"]\n        MobileApp[\"Mobile App\"]\n        VehicleDisplay[\"Vehicle Display\u003cbr/\u003eScreen\"]\n    end\n    \n    E1 --\u003e Router\n    E2 --\u003e Router\n    E3 --\u003e Router\n    E4 --\u003e Router\n    E5 --\u003e Router\n    E6 -.-\u003e|\"Optional\"| Router\n    \n    Router --\u003e EmailSvc\n    Router --\u003e PushSvc\n    Router --\u003e VehicleHMI\n    \n    EmailSvc --\u003e Email\n    PushSvc --\u003e MobileApp\n    VehicleHMI --\u003e VehicleDisplay\n    \n    Email -.-\u003e|\"Links to\"| WebPlatform[\"Expediente de Compra\u003cbr/\u003eWeb Platform\"]\n    MobileApp -.-\u003e|\"In-app view\"| ServiceStatus[\"Service Status Screen\"]\n```\n\n### Notification Content by Event\n\n| Event | Email | Push Notification | Vehicle HMI | Timing |\n|-------|-------|-------------------|-------------|--------|\n| **Payment Confirmed** | Receipt + activation notice | \"Service purchased\" | None | Immediate |\n| **Activation Started** | \"Activating your service\" | \"Activating...\" | \"Receiving configuration\" | Within 1 minute |\n| **Activation Successful** | \"Service now active\" | \"Service ready to use\" | \"Feature enabled\" | Immediately after confirmation |\n| **First Retry** | None (silent) | None (silent) | None | N/A |\n| **Activation Failed** | Detailed explanation + no charge notice | \"Activation issue - not charged\" | None | After all retries exhausted |\n\n**Key notification principles:**\n\n1. **Multi-channel redundancy**: Critical notifications (success, failure) sent to all channels\n2. **Customer reassurance**: Failed activation messages emphasize \"not charged\"\n3. **In-vehicle feedback**: Vehicle display shows activation status in real-time\n4. **Expediente integration**: All activation events logged in customer's purchase record\n5. **Silent retries**: Don't alarm customer with transient failures; notify only on final outcome\n\n**Example notification messages:**\n\n**Success:**\n```\nSubject: Your [Service Name] is now active\n\nHello [Customer Name],\n\nYour [Service Name] has been successfully activated on your [Vehicle Model].\nYou can start using this feature immediately.\n\nActivation details:\n- Service: [Service Name]\n- Duration: [Duration]\n- Cost: [Amount]\n- Activated: [Timestamp]\n\nView full details in your expediente de compra:\n[Link to Web Platform]\n\nThank you for choosing CaaS.\n```\n\n**Failure:**\n```\nSubject: Service activation issue - You have NOT been charged\n\nHello [Customer Name],\n\nWe were unable to activate [Service Name] on your [Vehicle Model] due to\na technical issue. We have escalated this to our technical support team.\n\nImportant: You have NOT been charged for this service.\n\nOur team will contact you shortly to resolve this issue. If you have any\nquestions, please contact support at [Contact Info].\n\nReference number: [Ticket ID]\n\nWe apologize for the inconvenience.\n```\n\nSources: [enunciado.md:18-20](), [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Technical Support Escalation\n\nWhen OTA activation fails after exhausting all retries, the system **automatically escalates** to technical support with comprehensive diagnostics.\n\n### Escalation Workflow\n\n```mermaid\nflowchart TD\n    MaxRetries[\"Max Retries Exceeded\"]\n    \n    MaxRetries --\u003e CollectDiagnostics[\"Collect Diagnostics\"]\n    \n    CollectDiagnostics --\u003e GetVehicleStatus[\"GET /vehicle/{vin}/status\"]\n    CollectDiagnostics --\u003e GetNetworkStatus[\"Query IoT Network\u003cbr/\u003eConnection Status\"]\n    CollectDiagnostics --\u003e GetActivationHistory[\"Retrieve Activation\u003cbr/\u003eAttempt Log\"]\n    CollectDiagnostics --\u003e GetCustomerInfo[\"Retrieve Customer\u003cbr/\u003e\u0026 Vehicle Info\"]\n    \n    GetVehicleStatus --\u003e BuildTicket[\"Build Support Ticket\"]\n    GetNetworkStatus --\u003e BuildTicket\n    GetActivationHistory --\u003e BuildTicket\n    GetCustomerInfo --\u003e BuildTicket\n    \n    BuildTicket --\u003e TicketFields{{\"Ticket Contains:\u003cbr/\u003e- VIN\u003cbr/\u003e- Customer ID\u003cbr/\u003e- Service ID\u003cbr/\u003e- All retry timestamps\u003cbr/\u003e- Error responses\u003cbr/\u003e- Vehicle telemetry\u003cbr/\u003e- Network status\"}}\n    \n    TicketFields --\u003e CreateTicket[\"Create Ticket in\u003cbr/\u003eSupport System\"]\n    \n    CreateTicket --\u003e Priority{{\"Determine Priority\"}}\n    \n    Priority --\u003e|\"Customer paid\"| HighPriority[\"HIGH Priority:\u003cbr/\u003eCustomer waiting\"]\n    Priority --\u003e|\"Pre-delivery activation\"| MediumPriority[\"MEDIUM Priority:\u003cbr/\u003eVehicle not yet delivered\"]\n    \n    HighPriority --\u003e AssignTechnician[\"Auto-assign to\u003cbr/\u003eOn-duty Technician\"]\n    MediumPriority --\u003e AssignTechnician\n    \n    AssignTechnician --\u003e ReversePayment[\"Trigger Payment Reversal\"]\n    ReversePayment --\u003e NotifyCustomer[\"Send Customer\u003cbr/\u003eFailure Notification\"]\n    \n    NotifyCustomer --\u003e TechnicianWorks[\"Technician\u003cbr/\u003eInvestigates \u0026 Resolves\"]\n    \n    TechnicianWorks --\u003e Resolution{{\"Resolution\"}}\n    \n    Resolution --\u003e|\"Issue resolved\"| ManualActivation[\"Manual Activation\u003cbr/\u003evia API IoT\"]\n    Resolution --\u003e|\"Vehicle hardware issue\"| ServiceAppointment[\"Schedule Service\u003cbr/\u003eAppointment\"]\n    Resolution --\u003e|\"CaaS system bug\"| BugReport[\"File Bug Report\u003cbr/\u003efor Development\"]\n    \n    ManualActivation --\u003e NotifySuccess[\"Notify Customer:\u003cbr/\u003eService Now Active\"]\n    ServiceAppointment --\u003e NotifyWorkshop[\"Notify Customer:\u003cbr/\u003eWorkshop Visit Required\"]\n    BugReport --\u003e NotifyWorkaround[\"Notify Customer:\u003cbr/\u003eAlternative Solution\"]\n```\n\n### Support Ticket Data Structure\n\nThe escalation system creates a comprehensive support ticket containing all diagnostic information:\n\n| Field | Source | Purpose |\n|-------|--------|---------|\n| **Ticket ID** | Auto-generated | Unique identifier for tracking |\n| **VIN** | Service request | Identify specific vehicle |\n| **Customer ID** | Service request | Contact information |\n| **Customer Email** | Customer database | Notification endpoint |\n| **Service ID** | Service catalog | Identify which feature to activate |\n| **Service Name** | Service catalog | Human-readable service description |\n| **Payment Transaction ID** | Payment service | For refund processing |\n| **Payment Amount** | Payment service | For refund processing |\n| **Activation Request Time** | OTA Engine | When activation was requested |\n| **Retry Attempts** | OTA Engine logs | Array of all retry timestamps and responses |\n| **Last Error Code** | API IoT response | Most recent failure reason |\n| **Last Error Message** | API IoT response | Detailed error description |\n| **Vehicle Status Snapshot** | API IoT | Telemetry at time of failure |\n| **Vehicle Online Status** | API IoT | Is vehicle reachable? |\n| **Network Signal Strength** | API IoT | Connection quality metrics |\n| **Vehicle Firmware Version** | API IoT | For compatibility checking |\n| **Configuration Payload** | Config repository | What configuration was attempted |\n| **Priority** | Business rules | HIGH if customer already paid |\n\n**Automatic actions triggered on escalation:**\n\n1. **Payment reversal initiated** (if payment was processed)\n2. **Customer notification sent** (via email and push)\n3. **Service marked as \"Pending Support\"** in service database\n4. **Ticket assigned to on-duty technician**\n5. **SLA timer started** (response required within defined timeframe)\n\n**Technician manual intervention options:**\n\n- **Retry activation manually** if issue was transient\n- **Modify configuration payload** if format issue detected\n- **Schedule vehicle inspection** if hardware problem suspected\n- **Escalate to API IoT team** if network infrastructure issue\n- **Escalate to development** if CaaS system bug identified\n- **Contact customer directly** for additional information\n\nThe goal is to **resolve activation issues quickly** while ensuring the customer is never charged for undelivered services.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Summary\n\nOTA Service Activation is a critical component of the CaaS system, responsible for the technical delivery of purchased services to customer vehicles. Key takeaways:\n\n| Aspect | Key Point |\n|--------|-----------|\n| **Delivery Model** | Pre-installed firmware + configuration activation |\n| **Integration** | Existing API IoT infrastructure (constraint) |\n| **Reliability** | Retry logic with exponential backoff |\n| **Customer Protection** | Never charge for failed activations |\n| **Failure Handling** | Automatic escalation to technical support |\n| **Transparency** | Real-time notifications across multiple channels |\n\nThe system prioritizes **customer trust and satisfaction** by implementing robust failure handling and ensuring that customers are never charged for services that cannot be activated. This \"customer-first\" approach is embedded in the technical architecture and business logic of the OTA activation process.\n\nSources: [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:31-56]()"])</script><script>self.__next_f.push([1,"2a:T4d8c,"])</script><script>self.__next_f.push([1,"# Maintenance-Linked Service Access\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details how the official maintenance status of a vehicle affects the availability and activation of optional services (opciones disponibles) within the CaaS platform. It covers the technical mechanisms for verifying maintenance compliance through the VSS (Vehicle Service System), the business rules governing service access based on maintenance status, and the critical distinctions between blocking future service purchases versus disabling already-delivered functionality.\n\nFor information about the broader service lifecycle and activation process, see [Service Lifecycle Management](#6). For details on the service catalog structure, see [Service Catalog and Pricing](#6.1). For the technical OTA activation process, see [OTA Service Activation](#6.2).\n\n---\n\n## Maintenance Prerequisites for Services\n\nThe CaaS system implements a **safety-driven gating mechanism** where certain optional services require the vehicle to be current with its official maintenance plan before they can be purchased or activated. This requirement is configured per service in the service catalog and is enforced at the point of purchase.\n\n### Service Categories by Maintenance Dependency\n\n| Service Category | Maintenance Requirement | Rationale |\n|-----------------|-------------------------|-----------|\n| **Safety-Critical Services** | Must be current with maintenance | Services affecting vehicle dynamics, power, or ADAS features require verified mechanical integrity |\n| **Entertainment Services** | No maintenance requirement | Media, connectivity, and comfort features operate independently of mechanical condition |\n| **Performance Services** | Must be current with maintenance | Power increases (e.g., 50% boost) require verified drivetrain maintenance |\n| **Autonomous Driving Features** | Must be current with maintenance | Sensor calibration and system health depend on regular maintenance schedules |\n| **Climate Control Enhancements** | Typically no requirement | Climate systems generally independent of critical maintenance |\n\nThe specific mapping of individual services to maintenance requirements is defined in the service catalog configuration, allowing business flexibility to adjust requirements based on safety assessments and regulatory compliance.\n\n**Sources:** [enunciado.md:23-24](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## VSS Integration for Maintenance Verification\n\nThe CaaS platform integrates with the **VSS (Vehicle Service System)**, an external system maintained by the workshop network (official dealerships and approved multi-brand workshops) that tracks all maintenance activities across the vehicle fleet.\n\n### VSS System Architecture\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform\"\n        ServiceCatalog[\"Service Catalog\u003cbr/\u003eService Definitions\"]\n        PurchaseFlow[\"Purchase Flow\u003cbr/\u003eCustomer Request\"]\n        MaintenanceGate[\"Maintenance Gate\u003cbr/\u003eVerification Logic\"]\n        VSSAdapter[\"VSS Adapter\u003cbr/\u003eIntegration Component\"]\n    end\n    \n    subgraph \"External VSS System\"\n        VSSAPI[\"VSS API\u003cbr/\u003eMaintenance Query\"]\n        VSSDatabase[(\"VSS Database\u003cbr/\u003eService Records\")]\n    end\n    \n    subgraph \"Workshop Network\"\n        OfficialWorkshops[\"Official Workshops\"]\n        ApprovedWorkshops[\"Approved Multi-brand\u003cbr/\u003eWorkshops\"]\n    end\n    \n    PurchaseFlow --\u003e|\"Request Service\"| ServiceCatalog\n    ServiceCatalog --\u003e|\"Check Requirement\"| MaintenanceGate\n    MaintenanceGate --\u003e|\"Query Status\"| VSSAdapter\n    VSSAdapter --\u003e|\"HTTP Query\u003cbr/\u003eVIN + Service Type\"| VSSAPI\n    VSSAPI --\u003e|\"Query Records\"| VSSDatabase\n    VSSDatabase --\u003e|\"Maintenance Status\u003cbr/\u003e+ Compliance %\"| VSSAPI\n    VSSAPI --\u003e|\"Status Response\"| VSSAdapter\n    VSSAdapter --\u003e|\"Allow/Deny\"| MaintenanceGate\n    \n    OfficialWorkshops --\u003e|\"Record Service\"| VSSDatabase\n    ApprovedWorkshops --\u003e|\"Record Service\"| VSSDatabase\n    \n    MaintenanceGate --\u003e|\"Deny Purchase\"| PurchaseFlow\n    MaintenanceGate --\u003e|\"Proceed to Payment\"| PaymentGateway[\"Payment Gateway\"]\n```\n\n**Diagram: Maintenance Verification Flow via VSS Integration**\n\n### Key Integration Characteristics\n\n1. **Pull-Based Query Pattern**: CaaS initiates queries to VSS when needed; vehicles do NOT push maintenance status via IoT\n2. **Real-Time Verification**: Maintenance status is checked at the moment of service purchase, not cached\n3. **External Data Ownership**: VSS is maintained independently by workshops; CaaS has read-only access\n4. **VIN-Based Lookup**: Queries use the Vehicle Identification Number (VIN) to retrieve maintenance records\n5. **Functional Block Compliance**: VSS tracks maintenance compliance by functional system blocks (engine, brakes, sensors, etc.)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Maintenance Verification Decision Flow\n\nThe following diagram illustrates the complete decision tree for service access based on maintenance status:\n\n```mermaid\nflowchart TD\n    Start[\"Customer Selects\u003cbr/\u003eOptional Service\"] --\u003e CheckCatalog[\"Retrieve Service\u003cbr/\u003eConfiguration\"]\n    \n    CheckCatalog --\u003e MaintenanceRequired{\"Service Requires\u003cbr/\u003eMaintenance Check?\"}\n    \n    MaintenanceRequired --\u003e|\"No\"| ProceedToPurchase[\"Proceed to\u003cbr/\u003ePurchase Flow\"]\n    \n    MaintenanceRequired --\u003e|\"Yes\"| QueryVSS[\"Query VSS API\u003cbr/\u003eGET /maintenance-status?vin=XXX\"]\n    \n    QueryVSS --\u003e VSSResponse{\"VSS Response\"}\n    \n    VSSResponse --\u003e|\"API Error\"| HandleError[\"Log Error\u003cbr/\u003eDeny Purchase\u003cbr/\u003eNotify Customer\"]\n    \n    VSSResponse --\u003e|\"Success\"| ParseCompliance[\"Parse Compliance\u003cbr/\u003ePercentage by Block\"]\n    \n    ParseCompliance --\u003e CheckThreshold{\"Maintenance Current\u003cbr/\u003efor Required Blocks?\"}\n    \n    CheckThreshold --\u003e|\"Not Current\"| DenyService[\"Service Unavailable\u003cbr/\u003eDisplay Message:\u003cbr/\u003e'Complete maintenance\u003cbr/\u003eto access this service'\"]\n    \n    CheckThreshold --\u003e|\"Current\"| ProceedToPurchase\n    \n    DenyService --\u003e OfferWorkshop[\"Offer Workshop\u003cbr/\u003eLocator Link\"]\n    OfferWorkshop --\u003e End[\"End Purchase Flow\"]\n    \n    ProceedToPurchase --\u003e PaymentProcessing[\"Payment Processing\"]\n    PaymentProcessing --\u003e OTAActivation[\"OTA Activation\"]\n    OTAActivation --\u003e ServiceActive[\"Service Active\"]\n    ServiceActive --\u003e End2[\"Service Delivered\"]\n    \n    HandleError --\u003e End\n```\n\n**Diagram: Service Purchase Decision Flow with Maintenance Gate**\n\n### Critical Decision Points\n\n1. **Service Configuration Check**: The service catalog defines which services require maintenance verification\n2. **VSS Query**: Real-time API call to external VSS system using vehicle VIN\n3. **Compliance Threshold**: Each service specifies which functional blocks must be current (e.g., \"engine maintenance\" for power boost)\n4. **Deny vs. Allow**: Failed maintenance checks prevent purchase initiation; customer cannot proceed to payment\n5. **Error Handling**: VSS API failures are treated as deny scenarios (fail-safe approach)\n\n**Sources:** [enunciado.md:23-24](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Service Blocking Rules and Restrictions\n\nThe CaaS system enforces **strict separation** between preventing new service purchases and disabling existing functionality. This distinction is critical for customer experience, legal compliance, and safety.\n\n### What CAN Be Blocked\n\n```mermaid\ngraph LR\n    subgraph \"Blockable Actions\"\n        NewPurchase[\"New Service Purchase\u003cbr/\u003efor Maintenance-Dependent\u003cbr/\u003eServices\"]\n        FutureActivation[\"Future Scheduled\u003cbr/\u003eService Activation\"]\n        SubscriptionRenewal[\"Subscription Auto-Renewal\u003cbr/\u003efor Maintenance-Dependent\u003cbr/\u003eServices\"]\n    end\n    \n    MaintenanceExpired[\"Maintenance\u003cbr/\u003eStatus: Expired\"] --\u003e NewPurchase\n    MaintenanceExpired --\u003e FutureActivation\n    MaintenanceExpired --\u003e SubscriptionRenewal\n    \n    NewPurchase --\u003e CustomerMessage[\"Display:\u003cbr/\u003e'Maintenance required\u003cbr/\u003ebefore purchase'\"]\n    FutureActivation --\u003e CustomerMessage\n    SubscriptionRenewal --\u003e CancelRenewal[\"Auto-Cancel\u003cbr/\u003eRenewal\"]\n```\n\n**Diagram: Permitted Service Blocking Actions**\n\n### What CANNOT Be Blocked\n\n```mermaid\ngraph LR\n    subgraph \"Protected Functionality - NEVER Block\"\n        BaseVehicle[\"Plataforma Base\u003cbr/\u003eBasic Vehicle Operation\"]\n        AlreadyPaid[\"Already Purchased\u003cbr/\u003eand Paid Services\"]\n        VehicleCirculation[\"Vehicle Ability\u003cbr/\u003eto Circulate\"]\n        EmergencySystems[\"Emergency and\u003cbr/\u003eSafety Systems\"]\n    end\n    \n    MaintenanceExpired[\"Maintenance\u003cbr/\u003eStatus: Expired\"] -.-\u003e|\"CANNOT Block\"| BaseVehicle\n    MaintenanceExpired -.-\u003e|\"CANNOT Block\"| AlreadyPaid\n    MaintenanceExpired -.-\u003e|\"CANNOT Block\"| VehicleCirculation\n    MaintenanceExpired -.-\u003e|\"CANNOT Block\"| EmergencySystems\n    \n    Note1[\"Legal Restriction:\u003cbr/\u003eOnly police can prevent\u003cbr/\u003evehicle circulation\"]\n    Note2[\"Customer Protection:\u003cbr/\u003ePaid services cannot\u003cbr/\u003ebe retroactively disabled\"]\n    \n    VehicleCirculation -.-\u003e Note1\n    AlreadyPaid -.-\u003e Note2\n```\n\n**Diagram: Protected Vehicle Functionality**\n\n### Blocking Rules Summary\n\n| Scenario | Action Permitted | Rationale |\n|----------|------------------|-----------|\n| Customer attempts to purchase maintenance-dependent service | **Block purchase** | Safety requirement; service may not function correctly without proper maintenance |\n| Customer has existing active service, maintenance expires | **Do NOT disable service** | Service already paid for; retroactive removal violates customer rights |\n| Vehicle maintenance expired | **Do NOT prevent vehicle operation** | Only law enforcement can legally prevent vehicle circulation |\n| Plataforma base functionality | **Always available** | Base platform is owned functionality, never restricted |\n| Emergency braking, airbags, basic safety | **Always available** | Safety-critical systems must never be disabled |\n| Subscription renewal approaching, maintenance expired | **Cancel auto-renewal** | Prevent new billing for services that cannot be safely activated |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Warranty Implications\n\nFailure to follow the official maintenance plan has **warranty consequences** that are separate from but related to service access restrictions.\n\n### Warranty Loss Mechanism\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e WarrantyActive: Vehicle Delivered\u003cbr/\u003ewith Full Warranty\n    \n    WarrantyActive --\u003e MaintenanceDue: Maintenance\u003cbr/\u003eInterval Reached\n    \n    MaintenanceDue --\u003e WarrantyActive: Maintenance\u003cbr/\u003eCompleted On Time\n    \n    MaintenanceDue --\u003e WarrantyAtRisk: Maintenance\u003cbr/\u003eOverdue (Grace Period)\n    \n    WarrantyAtRisk --\u003e WarrantyActive: Maintenance\u003cbr/\u003eCompleted in Grace\n    \n    WarrantyAtRisk --\u003e WarrantyLostPartial: Grace Period\u003cbr/\u003eExceeded\n    \n    WarrantyLostPartial --\u003e WarrantyLostFull: Multiple Missed\u003cbr/\u003eServices\n    \n    WarrantyActive --\u003e CustomerNotified: VSS Records\u003cbr/\u003eMaintenance\n    CustomerNotified --\u003e WarrantyActive: Status Updated\n    \n    note right of WarrantyLostPartial\n        Specific functional blocks\n        lose warranty coverage\n        (e.g., engine, transmission)\n    end note\n    \n    note right of WarrantyLostFull\n        Full vehicle warranty\n        voided; only statutory\n        rights remain\n    end note\n```\n\n**Diagram: Warranty Status State Machine**\n\n### Relationship Between Maintenance, Warranty, and Service Access\n\n| Customer Action | Warranty Status | Service Access | Business Impact |\n|----------------|----------------|----------------|-----------------|\n| Maintenance current | Full warranty active | All services available for purchase | Optimal customer state |\n| Maintenance overdue (minor) | Warranty at risk | Maintenance-dependent services blocked | Revenue loss opportunity |\n| Maintenance significantly overdue | Partial warranty loss | Maintenance-dependent services blocked | Customer dissatisfaction risk |\n| Maintenance never performed | Full warranty void | Maintenance-dependent services permanently blocked | Customer relationship damaged |\n\n### Warranty Loss vs. Service Blocking\n\n**Important distinction:**\n- **Warranty Loss**: Affects manufacturer liability for repairs; customer bears cost of failures\n- **Service Blocking**: Prevents purchase of new optional services for safety reasons\n\nThese are **independent mechanisms**:\n- A vehicle can have warranty voided but still operate with its plataforma base\n- Service blocking prevents unsafe configurations; warranty loss is a financial consequence\n- VSS tracks both warranty status and maintenance compliance separately\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:68-70]()\n\n---\n\n## Technical Implementation Considerations\n\n### VSS API Integration Points\n\nThe CaaS platform integrates with VSS at specific points in the customer journey:\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebUI as \"Web/Mobile UI\"\n    participant ServiceCatalog as \"Service Catalog\"\n    participant MaintenanceGate as \"Maintenance Gate\"\n    participant VSSAdapter as \"VSS Adapter\"\n    participant VSSAPI as \"VSS External API\"\n    participant PaymentGateway as \"Payment Gateway\"\n    \n    Customer-\u003e\u003eWebUI: \"Browse Available Services\"\n    WebUI-\u003e\u003eServiceCatalog: \"GET /services/available?vin=XXX\"\n    ServiceCatalog-\u003e\u003eMaintenanceGate: \"Filter by Maintenance Status\"\n    MaintenanceGate-\u003e\u003eVSSAdapter: \"Check Maintenance Status\"\n    VSSAdapter-\u003e\u003eVSSAPI: \"GET /vehicles/{vin}/maintenance\"\n    VSSAPI--\u003e\u003eVSSAdapter: \"Maintenance Record + Compliance %\"\n    VSSAdapter--\u003e\u003eMaintenanceGate: \"Parsed Status\"\n    MaintenanceGate--\u003e\u003eServiceCatalog: \"Filtered Service List\"\n    ServiceCatalog--\u003e\u003eWebUI: \"Available Services + Blocked Services\"\n    WebUI--\u003e\u003eCustomer: \"Display Services\u003cbr/\u003e(with maintenance warnings)\"\n    \n    Customer-\u003e\u003eWebUI: \"Select Service + Duration\"\n    WebUI-\u003e\u003eServiceCatalog: \"POST /services/purchase\"\n    ServiceCatalog-\u003e\u003eMaintenanceGate: \"Verify Purchase Allowed\"\n    MaintenanceGate-\u003e\u003eVSSAdapter: \"Recheck Status (Anti-Stale)\"\n    VSSAdapter-\u003e\u003eVSSAPI: \"GET /vehicles/{vin}/maintenance\"\n    VSSAPI--\u003e\u003eVSSAdapter: \"Current Status\"\n    VSSAdapter--\u003e\u003eMaintenanceGate: \"Verification Result\"\n    \n    alt Maintenance Not Current\n        MaintenanceGate--\u003e\u003eServiceCatalog: \"Purchase Denied\"\n        ServiceCatalog--\u003e\u003eWebUI: \"Error: Maintenance Required\"\n        WebUI--\u003e\u003eCustomer: \"Cannot Purchase - Complete Maintenance\"\n    else Maintenance Current\n        MaintenanceGate--\u003e\u003eServiceCatalog: \"Purchase Allowed\"\n        ServiceCatalog-\u003e\u003ePaymentGateway: \"Process Payment\"\n        PaymentGateway--\u003e\u003eServiceCatalog: \"Payment Confirmed\"\n        ServiceCatalog-\u003e\u003eCustomer: \"Proceed to OTA Activation\"\n    end\n```\n\n**Diagram: End-to-End Maintenance Verification Sequence**\n\n### Key Technical Requirements\n\n1. **Real-Time Verification**: Maintenance status is checked twice:\n   - During service browsing (to filter catalog)\n   - At purchase time (to prevent stale data attacks)\n\n2. **Graceful Degradation**: If VSS is unavailable:\n   - Allow browsing of all services\n   - Block purchases of maintenance-dependent services (fail-safe)\n   - Log incidents for technical support review\n\n3. **Caching Strategy**: \n   - Short-lived cache (5-15 minutes) for service catalog filtering\n   - Always revalidate before payment processing\n   - No caching for purchase verification\n\n4. **Error Handling**:\n   - VSS timeout: Treat as \"maintenance status unknown\"  block purchase\n   - VSS returns partial data: Use most conservative interpretation\n   - Network errors: Retry with exponential backoff, then fail-safe block\n\n5. **Customer Communication**:\n   - Clear messaging when services are blocked\n   - Link to workshop locator\n   - Estimated maintenance costs if available from VSS\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Business Rules and Safety Considerations\n\n### Safety-First Design Principle\n\nThe maintenance-linked service access system is designed with a **safety-first philosophy**:\n\n1. **Prevent Unsafe Configurations**: Services that depend on mechanical integrity (power boosts, autonomous features) cannot be activated on poorly maintained vehicles\n2. **Never Compromise Base Safety**: The plataforma base and all safety-critical systems remain operational regardless of maintenance status\n3. **Customer Choice**: Customers cannot be forced to perform maintenance, but consequences (service blocking, warranty loss) are clearly communicated\n4. **No Retroactive Punishment**: Already-purchased services are not disabled when maintenance lapses; only new purchases are blocked\n\n### Business Policy Decisions\n\nThe following policies are implemented in the maintenance gate logic:\n\n| Policy Area | Rule | Implementation |\n|------------|------|----------------|\n| **Compliance Threshold** | Service requires  90% maintenance compliance for related functional blocks | Configurable per service in catalog |\n| **Grace Periods** | 30-day grace period after scheduled maintenance date before blocking services | Handled by VSS; CaaS queries final status |\n| **Warning Notifications** | Customer receives email/app notification 14 days before maintenance blocks services | Notification engine triggered by VSS webhook (if implemented) |\n| **Emergency Override** | Technical support can manually override blocks for documented edge cases | Admin panel with audit logging |\n| **Subscription Handling** | Maintenance-dependent subscriptions auto-cancel if maintenance lapses during billing cycle | Billing engine checks maintenance at renewal time |\n\n### Customer Experience Flow\n\n```mermaid\nflowchart LR\n    A[\"Customer\u003cbr/\u003eBrowses Services\"] --\u003e B{\"Service\u003cbr/\u003eMaintenance-Dependent?\"}\n    B --\u003e|\"No\"| C[\"Service Displayed\u003cbr/\u003eas Available\"]\n    B --\u003e|\"Yes\"| D[\"Query VSS Status\"]\n    D --\u003e E{\"Maintenance\u003cbr/\u003eCurrent?\"}\n    E --\u003e|\"Yes\"| C\n    E --\u003e|\"No\"| F[\"Service Displayed\u003cbr/\u003ewith Warning Badge\"]\n    F --\u003e G[\"Customer Clicks\u003cbr/\u003eService Details\"]\n    G --\u003e H[\"Display:\u003cbr/\u003e'Maintenance required\u003cbr/\u003ebefore purchase'\"]\n    H --\u003e I[\"Show Workshop\u003cbr/\u003eLocator + Book Appt\"]\n    I --\u003e J{\"Customer\u003cbr/\u003eBooks Maintenance?\"}\n    J --\u003e|\"Yes\"| K[\"Redirect to\u003cbr/\u003eWorkshop Portal\"]\n    J --\u003e|\"No\"| L[\"Return to\u003cbr/\u003eService Catalog\"]\n    \n    C --\u003e M[\"Customer Attempts\u003cbr/\u003ePurchase\"]\n    M --\u003e N[\"Revalidate\u003cbr/\u003eMaintenance Status\"]\n    N --\u003e O{\"Still Current?\"}\n    O --\u003e|\"Yes\"| P[\"Proceed to\u003cbr/\u003ePayment\"]\n    O --\u003e|\"No\"| H\n```\n\n**Diagram: Customer Experience with Maintenance-Blocked Services**\n\n**Sources:** [enunciado.md:23-24](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Summary\n\nThe maintenance-linked service access system implements critical safety and business logic by:\n\n1. **Integrating with VSS** to obtain authoritative maintenance status from the workshop network\n2. **Blocking new purchases** of maintenance-dependent services when maintenance is not current\n3. **Protecting already-paid services** from retroactive disabling\n4. **Maintaining vehicle operability** regardless of maintenance status (legal requirement)\n5. **Separating warranty consequences** from service access restrictions\n6. **Providing clear customer communication** about maintenance requirements and consequences\n\nThis system balances customer autonomy (cannot force maintenance), safety requirements (prevent unsafe configurations), and business interests (encourage proper maintenance for warranty coverage and premium service access).\n\n**Sources:** [enunciado.md:23-24](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()"])</script><script>self.__next_f.push([1,"2b:T4ea7,"])</script><script>self.__next_f.push([1,"# Service Cancellation and Refunds\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document explains the service cancellation and refund policies implemented in the CaaS platform, focusing on legal compliance with distance selling regulations (desistimiento), service duration-based refund eligibility, and subscription cancellation workflows.\n\nFor information about payment processing and billing models, see [Payment Types and Flows](#7.1). For details on how services are activated and delivered, see [OTA Service Activation](#6.2). For handling of failed service activations (which do not charge the customer), see [OTA Activation Failures](#9.1).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Legal Framework: Desistimiento (Right of Withdrawal)\n\nThe CaaS platform implements **desistimiento** (derecho de desistimiento), a legal requirement for distance selling that grants customers the right to cancel purchases within specific timeframes without providing justification.\n\n### Regulatory Basis\n\nUnder distance selling laws applicable to the CaaS business model, customers purchasing services remotely (via web platform or mobile application) are entitled to withdraw from the purchase and receive a full refund, subject to time-based conditions.\n\n### Key Principles\n\n| Principle | Implementation |\n|-----------|----------------|\n| **No Justification Required** | Customer may cancel without stating a reason |\n| **Full Refund** | Customer receives 100% refund of paid amount when eligible |\n| **Time-Based Eligibility** | Refund window depends on service duration |\n| **Already Consumed Services** | No refund for services consumed beyond withdrawal period |\n| **Pending Services** | Customer can always cancel services not yet delivered/activated |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-89]()\n\n---\n\n## Refund Eligibility Rules\n\nThe CaaS platform applies different refund rules based on the **contracted duration** of the service.\n\n### Duration-Based Policy Matrix\n\n```mermaid\ngraph TB\n    CancelRequest[\"Cancellation Request\u003cbr/\u003eInitiated by Customer\"]\n    \n    CheckDuration{\"Service\u003cbr/\u003eContracted Duration\"}\n    \n    LongService[\"Service Duration \u003e 14 days\"]\n    ShortService[\"Service Duration  14 days\"]\n    \n    CheckWindow{\"Time Since\u003cbr/\u003eActivation\"}\n    \n    Within14[\"Within 14 days\u003cbr/\u003eof activation\"]\n    After14[\"After 14 days\u003cbr/\u003eof activation\"]\n    \n    AnytimeRefund[\"Anytime\u003cbr/\u003eRefund Eligible\"]\n    \n    GrantRefund[\"Grant Full Refund\u003cbr/\u003eDeactivateService\u003cbr/\u003eProcess Reimbursement\"]\n    DenyRefund[\"Deny Refund\u003cbr/\u003eService Consumed\u003cbr/\u003eBeyond Withdrawal Period\"]\n    \n    CancelRequest --\u003e CheckDuration\n    CheckDuration --\u003e|\"\u003e 14 days\"| LongService\n    CheckDuration --\u003e|\" 14 days\"| ShortService\n    \n    LongService --\u003e CheckWindow\n    CheckWindow --\u003e|\" 14 days\"| Within14\n    CheckWindow --\u003e|\"\u003e 14 days\"| After14\n    \n    Within14 --\u003e GrantRefund\n    After14 --\u003e DenyRefund\n    \n    ShortService --\u003e AnytimeRefund\n    AnytimeRefund --\u003e GrantRefund\n```\n\n**Figure 1: Refund Eligibility Decision Flow**\n\n### Rule Definitions\n\n#### Rule 1: Services with Duration \u003e 14 Days\n\nFor services contracted for more than 14 days (e.g., 30-day temporary service, 90-day seasonal service, permanent service):\n\n- **Refund Window:** 14 calendar days from activation date\n- **Within Window:** Full refund granted\n- **Beyond Window:** No refund; service considered consumed\n\n#### Rule 2: Services with Duration  14 Days\n\nFor short-duration services contracted for 14 days or less (e.g., weekend package, 7-day trial):\n\n- **Refund Window:** Anytime during the contracted period\n- **Rationale:** Since the entire service duration falls within the legal 14-day desistimiento period, the customer can cancel at any point\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-89]()\n\n---\n\n## Cancellation Request Processing\n\n### State Machine for Service Cancellation\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ServiceActive: \"Service Activated\u003cbr/\u003eand In Use\"\n    \n    ServiceActive --\u003e CancellationRequested: \"Customer Initiates\u003cbr/\u003eCancellation\"\n    \n    CancellationRequested --\u003e EligibilityCheck: \"System Evaluates\u003cbr/\u003eRefund Eligibility\"\n    \n    state EligibilityCheck {\n        [*] --\u003e CheckServiceDuration\n        CheckServiceDuration --\u003e ShortDuration: \"duration  14 days\"\n        CheckServiceDuration --\u003e LongDuration: \"duration \u003e 14 days\"\n        \n        ShortDuration --\u003e RefundEligible: \"Always eligible\"\n        \n        LongDuration --\u003e CheckActivationDate\n        CheckActivationDate --\u003e RefundEligible: \" 14 days since activation\"\n        CheckActivationDate --\u003e RefundIneligible: \"\u003e 14 days since activation\"\n    }\n    \n    EligibilityCheck --\u003e ProcessRefund: \"Eligible\"\n    EligibilityCheck --\u003e DenyCancellation: \"Ineligible\"\n    \n    ProcessRefund --\u003e DeactivateService: \"Initiate Refund\u003cbr/\u003eTransaction\"\n    DeactivateService --\u003e SendOTADeactivation: \"Send OTA Command\u003cbr/\u003eto Disable Service\"\n    SendOTADeactivation --\u003e NotifyCustomer: \"Confirm Deactivation\"\n    NotifyCustomer --\u003e Refunded\n    \n    DenyCancellation --\u003e NotifyNoRefund: \"Inform Customer\u003cbr/\u003eService Consumed\"\n    NotifyNoRefund --\u003e ServiceRemainActive\n    \n    Refunded --\u003e [*]: \"Service Cancelled\u003cbr/\u003eMoney Returned\"\n    ServiceRemainActive --\u003e ServiceActive: \"Service Continues\u003cbr/\u003eUntil Expiration\"\n```\n\n**Figure 2: Service Cancellation State Machine**\n\n### Technical Components\n\nThe cancellation process involves several system components:\n\n| Component | Responsibility |\n|-----------|----------------|\n| `CancellationRequestHandler` | Receives and validates cancellation requests |\n| `DesistimientoValidator` | Evaluates eligibility based on duration and activation date |\n| `ServiceDurationCalculator` | Calculates contracted duration and elapsed time |\n| `RefundProcessor` | Initiates refund transaction with payment gateway |\n| `OTADeactivationService` | Sends OTA command to disable service on vehicle |\n| `NotificationService` | Informs customer of cancellation status |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-89]()\n\n---\n\n## Subscription Service Cancellation\n\nSubscription services (billed **mes vencido** - at month end for consumed services) have distinct cancellation rules.\n\n### Subscription Cancellation Flow\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebPlatform as \"Web/Mobile Platform\"\n    participant SubscriptionMgr as \"SubscriptionManager\"\n    participant BillingEngine as \"BillingEngine\"\n    participant OTA as \"OTADeactivationService\"\n    participant Vehicle\n    \n    Customer-\u003e\u003eWebPlatform: \"Request Subscription\u003cbr/\u003eCancellation\"\n    WebPlatform-\u003e\u003eSubscriptionMgr: \"cancelSubscription(customerId, serviceId)\"\n    \n    SubscriptionMgr-\u003e\u003eSubscriptionMgr: \"Check Subscription Status\"\n    \n    alt Subscription Active\n        SubscriptionMgr-\u003e\u003eBillingEngine: \"stopFutureCharges(subscriptionId)\"\n        BillingEngine--\u003e\u003eSubscriptionMgr: \"Future billing cancelled\"\n        \n        SubscriptionMgr-\u003e\u003eSubscriptionMgr: \"Calculate Current Month\u003cbr/\u003ePro-rated Usage\"\n        \n        Note over SubscriptionMgr,BillingEngine: Current month already consumed\u003cbr/\u003ewill be billed at month end\n        \n        SubscriptionMgr-\u003e\u003eOTA: \"scheduleDeactivation(serviceId, endOfMonth)\"\n        OTA--\u003e\u003eSubscriptionMgr: \"Deactivation scheduled\"\n        \n        SubscriptionMgr-\u003e\u003eWebPlatform: \"Cancellation Confirmed\u003cbr/\u003eActive Until Month End\"\n        WebPlatform-\u003e\u003eCustomer: \"Service will deactivate\u003cbr/\u003eon [end date]\"\n        \n    else Subscription Already Inactive\n        SubscriptionMgr-\u003e\u003eWebPlatform: \"Already Inactive\"\n        WebPlatform-\u003e\u003eCustomer: \"Subscription not active\"\n    end\n    \n    Note over OTA,Vehicle: At end of billing period\n    OTA-\u003e\u003eVehicle: \"OTA: Deactivate Service\"\n    Vehicle--\u003e\u003eOTA: \"Confirmation\"\n```\n\n**Figure 3: Subscription Cancellation Sequence**\n\n### Subscription-Specific Rules\n\n| Scenario | Policy |\n|----------|--------|\n| **Customer-Initiated Cancellation** | Subscription continues until end of current billing period |\n| **Current Month Billing** | Customer is charged for partial month usage (no refund) |\n| **Future Billing** | No charges for subsequent months |\n| **Service Deactivation** | OTA deactivation sent at end of billing period |\n| **Re-activation** | Customer can subscribe again in the future |\n\n### Payment Failure Cancellation\n\nIf a subscription payment fails (payment method declined, insufficient funds):\n\n1. **Automatic Cancellation:** Subscription is cancelled by the system\n2. **Service Deactivation:** OTA command sent to disable service\n3. **No Refund Owed:** No money was successfully collected\n4. **Customer Notification:** Customer informed of cancellation reason\n5. **Re-subscription Required:** Customer must manually re-subscribe and provide valid payment\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:80-82]()\n\n---\n\n## Optional Business Policy: Service Catalog Restriction\n\nThe CaaS platform supports an **optional business policy** for handling services cancelled due to customer dissatisfaction.\n\n### Policy Configuration\n\n```mermaid\ngraph LR\n    RefundGranted[\"Refund Granted\u003cbr/\u003eService Cancelled\"]\n    \n    CheckReason{\"Cancellation\u003cbr/\u003eReason Analysis\"}\n    \n    Technical[\"Technical Issue\u003cbr/\u003eOTA Failure, Bug\"]\n    Dissatisfaction[\"Customer\u003cbr/\u003eDissatisfaction\"]\n    \n    NoRestriction[\"No Restriction\u003cbr/\u003eService Remains\u003cbr/\u003ein Catalog\"]\n    \n    RemoveFromCatalog[\"Remove Service\u003cbr/\u003efrom Customer's\u003cbr/\u003eCatalog View\"]\n    \n    RefundGranted --\u003e CheckReason\n    CheckReason --\u003e Technical\n    CheckReason --\u003e Dissatisfaction\n    \n    Technical --\u003e NoRestriction\n    Dissatisfaction --\u003e RemoveFromCatalog\n    \n    RemoveFromCatalog --\u003e CustomerCatalog[\"Customer's Personalized\u003cbr/\u003eService Catalog\u003cbr/\u003eService Hidden\"]\n```\n\n**Figure 4: Optional Catalog Restriction Policy**\n\n### Policy Details\n\nWhen enabled, this policy:\n\n- **Identifies Dissatisfaction:** Distinguishes between technical failures and customer preference\n- **Personalizes Catalog:** Removes cancelled service from that specific customer's view\n- **Prevents Re-purchase:** Customer cannot purchase the same service again\n- **Business Rationale:** Reduces repeat cancellations and support overhead\n- **Configuration:** Can be enabled/disabled per service type or globally\n\n**Note:** This policy is **configurable** and may not be active for all CaaS deployments.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:89]()\n\n---\n\n## Special Scenarios\n\n### Vehicle Theft and Service Refunds\n\nWhen a vehicle is stolen, specific rules govern service cancellations and refunds.\n\n#### Theft Impact on Services\n\n```mermaid\ngraph TB\n    VehicleStolen[\"Vehicle Theft\u003cbr/\u003eReported by Customer\"]\n    \n    EvaluateServices[\"Evaluate Active Services\"]\n    \n    AlreadyDelivered[\"Services Already\u003cbr/\u003eDelivered/Activated\"]\n    PendingServices[\"Services Pending\u003cbr/\u003eFuture Activation\"]\n    \n    CheckDesistimiento{\"Within 14-day\u003cbr/\u003eDesistimiento Period\"}\n    \n    EligibleRefund[\"Eligible for Refund\u003cbr/\u003eUnder Standard Rules\"]\n    NoRefundTheft[\"No Refund\u003cbr/\u003eService Already Consumed\"]\n    \n    CustomerCanCancel[\"Customer Can Cancel\u003cbr/\u003ePending Services\"]\n    \n    FullRefund[\"Grant Full Refund\u003cbr/\u003eService Never Delivered\"]\n    \n    VehicleStolen --\u003e EvaluateServices\n    EvaluateServices --\u003e AlreadyDelivered\n    EvaluateServices --\u003e PendingServices\n    \n    AlreadyDelivered --\u003e CheckDesistimiento\n    CheckDesistimiento --\u003e|\"Yes\"| EligibleRefund\n    CheckDesistimiento --\u003e|\"No\"| NoRefundTheft\n    \n    PendingServices --\u003e CustomerCanCancel\n    CustomerCanCancel --\u003e FullRefund\n```\n\n**Figure 5: Vehicle Theft Service Refund Logic**\n\n#### Theft Scenario Rules\n\n| Service Status | Refund Policy |\n|----------------|---------------|\n| **Already Delivered ( 14 days)** | Standard desistimiento applies; eligible for refund |\n| **Already Delivered (\u003e 14 days)** | No refund; service was consumed before theft |\n| **Pending/Scheduled** | Full refund; service not yet delivered |\n| **Active Subscriptions** | Customer can cancel; no charges for future periods |\n\n**Key Principle:** Vehicle theft does **not** trigger automatic refunds. Normal desistimiento rules apply to delivered services. Only pending/future services are eligible for cancellation with full refund.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:91-96]()\n\n---\n\n## Technical Implementation Reference\n\n### Core Classes and Services\n\nThe following conceptual components implement cancellation and refund logic:\n\n#### Refund Eligibility Evaluation\n\n```\nRefundEligibilityService\n evaluateEligibility(serviceActivation, cancellationRequest)\n checkServiceDuration(service)\n calculateDaysSinceActivation(activationDate)\n determineRefundAmount(service, activationDate)\n\nDesistimientoValidator\n isWithinWithdrawalPeriod(activationDate, serviceDuration)\n LONG_SERVICE_THRESHOLD = 14 days\n WITHDRAWAL_WINDOW = 14 days\n```\n\n#### Cancellation Processing\n\n```\nCancellationProcessor\n processCancellation(cancellationRequest)\n validateCancellationRequest(request)\n evaluateRefundEligibility(request)\n initiateRefund(amount, paymentMethod)\n scheduleServiceDeactivation(serviceId)\n notifyCustomer(result)\n\nOTADeactivationService\n sendDeactivationCommand(vehicleId, serviceId)\n verifyDeactivation(vehicleId, serviceId)\n retryOnFailure(vehicleId, serviceId, maxRetries)\n```\n\n#### Subscription Management\n\n```\nSubscriptionManager\n cancelSubscription(subscriptionId)\n stopFutureCharges(subscriptionId)\n calculateProRatedCharge(subscriptionId)\n scheduleEndOfPeriodDeactivation(subscriptionId)\n handlePaymentFailure(subscriptionId)\n```\n\n### Data Models\n\n#### Service Activation Record\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `activationId` | UUID | Unique activation identifier |\n| `customerId` | UUID | Customer who purchased service |\n| `serviceId` | UUID | Service type identifier |\n| `activationDate` | DateTime | When service was activated |\n| `contractedDuration` | Integer | Duration in days (null for permanent) |\n| `expirationDate` | DateTime | When service expires (null for permanent) |\n| `cancellationDate` | DateTime | When cancelled (null if active) |\n| `refundAmount` | Decimal | Amount refunded (0 if not refunded) |\n| `refundStatus` | Enum | NONE, PENDING, COMPLETED, DENIED |\n\n#### Cancellation Request\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `requestId` | UUID | Unique request identifier |\n| `activationId` | UUID | Service activation being cancelled |\n| `requestDate` | DateTime | When cancellation was requested |\n| `reason` | String | Optional customer-provided reason |\n| `eligibilityResult` | Enum | ELIGIBLE, INELIGIBLE |\n| `refundAmount` | Decimal | Calculated refund amount |\n| `processingStatus` | Enum | SUBMITTED, EVALUATING, APPROVED, DENIED, COMPLETED |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Integration with Payment System\n\n### Refund Transaction Flow\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant CancellationProcessor as \"CancellationProcessor\"\n    participant RefundService as \"RefundService\"\n    participant PaymentGateway as \"Payment Gateway\"\n    participant BillingDB as \"Billing Database\"\n    participant NotificationEngine as \"NotificationEngine\"\n    \n    Customer-\u003e\u003eCancellationProcessor: \"Request Cancellation\"\n    CancellationProcessor-\u003e\u003eCancellationProcessor: \"Evaluate Eligibility\"\n    \n    alt Refund Eligible\n        CancellationProcessor-\u003e\u003eRefundService: \"initiateRefund(activationId, amount)\"\n        RefundService-\u003e\u003eBillingDB: \"Retrieve Original Payment\"\n        BillingDB--\u003e\u003eRefundService: \"Payment Details\"\n        \n        RefundService-\u003e\u003ePaymentGateway: \"POST /refunds\u003cbr/\u003e{originalTransactionId, amount}\"\n        PaymentGateway--\u003e\u003eRefundService: \"Refund Initiated\u003cbr/\u003e{refundId, status: PENDING}\"\n        \n        RefundService-\u003e\u003eBillingDB: \"Record Refund Transaction\"\n        \n        Note over PaymentGateway: Asynchronous processing\u003cbr/\u003eby payment provider\n        \n        PaymentGateway--\u003e\u003eRefundService: \"Webhook: Refund Completed\"\n        RefundService-\u003e\u003eBillingDB: \"Update Status: COMPLETED\"\n        \n        RefundService-\u003e\u003eCancellationProcessor: \"Refund Successful\"\n        CancellationProcessor-\u003e\u003eNotificationEngine: \"Send Confirmation\"\n        NotificationEngine-\u003e\u003eCustomer: \"Refund Processed\u003cbr/\u003eExpect 3-5 business days\"\n        \n    else Refund Ineligible\n        CancellationProcessor-\u003e\u003eNotificationEngine: \"Send Denial Notice\"\n        NotificationEngine-\u003e\u003eCustomer: \"Cancellation Denied\u003cbr/\u003eService Consumed\"\n    end\n```\n\n**Figure 6: Refund Transaction Processing Flow**\n\n### Refund Settlement Timeline\n\n| Phase | Duration | Status |\n|-------|----------|--------|\n| **Refund Initiation** | Immediate | `PENDING` |\n| **Payment Gateway Processing** | 1-3 business days | `PROCESSING` |\n| **Bank Settlement** | 3-5 business days | `SETTLING` |\n| **Customer Account Credit** | 5-7 business days total | `COMPLETED` |\n\n**Note:** The CaaS platform marks the refund as `COMPLETED` once the payment gateway confirms processing. The actual appearance of funds in the customer's account depends on their bank's processing time.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:80-82]()\n\n---\n\n## Business Metrics and Reporting\n\n### Key Metrics for Cancellation Management\n\n| Metric | Description | Business Value |\n|--------|-------------|----------------|\n| **Cancellation Rate** | (Cancellations / Total Service Activations)  100 | Measure service satisfaction |\n| **Refund Rate** | (Refunds Granted / Total Cancellations)  100 | Track desistimiento compliance |\n| **Avg Days to Cancellation** | Average time between activation and cancellation | Identify problematic services |\n| **Refund Amount Total** | Total monetary value refunded per period | Financial impact tracking |\n| **Service-Specific Cancellation** | Cancellation rate per service type | Service quality assessment |\n| **Repeat Cancellations** | Customers who cancel multiple services | Identify dissatisfied customers |\n\n### Operational Dashboards\n\nThe CaaS platform should provide operational visibility into cancellation patterns:\n\n- **Daily Cancellation Queue:** Pending cancellation requests awaiting processing\n- **Refund Processing Status:** Current refunds in each settlement stage\n- **Ineligible Cancellations:** Customers attempting to cancel beyond withdrawal period\n- **High-Risk Services:** Services with cancellation rates exceeding threshold\n- **Customer Satisfaction Scores:** Correlation between cancellations and satisfaction surveys\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-89]()\n\n---\n\n## Summary\n\nThe CaaS service cancellation and refund system implements:\n\n1. **Legal Compliance:** Full desistimiento (right of withdrawal) support for distance selling\n2. **Duration-Based Rules:** Different refund windows based on service contracted duration\n3. **Fair Customer Treatment:** No charge for undelivered services, full refunds within withdrawal periods\n4. **Subscription Flexibility:** Customers can cancel subscriptions with clear end-of-period deactivation\n5. **Special Scenario Handling:** Appropriate policies for vehicle theft and other edge cases\n6. **Technical Integration:** Automated refund processing with payment gateway and OTA deactivation\n\nThe system prioritizes customer protection while maintaining business viability through clear, legally compliant policies that balance customer rights with revenue protection.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-96]()"])</script><script>self.__next_f.push([1,"2c:T6b86,"])</script><script>self.__next_f.push([1,"# Payment and Billing\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the payment processing architecture, billing models, and financial workflows within the CaaS platform. It covers all payment types (reservation, final, service), settlement strategies, and financial risk management.\n\nFor information about specific service payment flows and OTA activation consequences, see [Service Lifecycle Management](#6). For detailed refund policies related to desistimiento (right of withdrawal), see [Service Cancellation and Refunds](#6.4). For payment failure scenarios, see [Payment Failure Scenarios](#9.2).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:75-96](), [enunciado.md:1-23]()\n\n---\n\n## Payment Architecture Overview\n\nThe CaaS platform implements a multi-tiered payment architecture supporting three distinct payment types with different processing characteristics, risk profiles, and business rules.\n\n### Payment System Components\n\n```mermaid\ngraph TB\n    subgraph \"Customer Channels\"\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile Application\"]\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Dealership)\"]\n    end\n    \n    subgraph \"Payment Processing Layer\"\n        PAYMENT_ORCHESTRATOR[\"Payment Orchestrator\"]\n        RESERVATION_PROCESSOR[\"Reservation Payment\u003cbr/\u003eProcessor\"]\n        FINAL_PROCESSOR[\"Final Payment\u003cbr/\u003eProcessor\"]\n        SERVICE_PROCESSOR[\"Service Payment\u003cbr/\u003eProcessor\"]\n        SUBSCRIPTION_PROCESSOR[\"Subscription Billing\u003cbr/\u003eProcessor\"]\n    end\n    \n    subgraph \"Risk Management\"\n        RISK_ENGINE[\"Risk Assessment Engine\"]\n        SETTLEMENT_MONITOR[\"Settlement Monitor\u003cbr/\u003e(Async Tracking)\"]\n        IMMEDIATE_DELIVERY[\"Immediate Delivery\u003cbr/\u003eDecision Engine\"]\n    end\n    \n    subgraph \"External Payment Infrastructure\"\n        PAYMENT_GATEWAY[\"Payment Gateway\"]\n        BANK_SETTLEMENT[\"Bank Settlement\u003cbr/\u003e(Asynchronous)\"]\n        CARD_NETWORKS[\"Card Networks\"]\n    end\n    \n    subgraph \"Service Delivery\"\n        OTA_ENGINE[\"OTA Activation Engine\"]\n        VEHICLE_ASSIGNMENT[\"Vehicle Assignment\u003cbr/\u003eManager\"]\n        FACTORY_API[\"Factory Order API\"]\n    end\n    \n    subgraph \"Financial Records\"\n        BILLING_DB[(\"Billing Database\")]\n        INVOICE_GEN[\"Invoice Generator\"]\n        REFUND_PROCESSOR[\"Refund Processor\"]\n    end\n    \n    WEB --\u003e PAYMENT_ORCHESTRATOR\n    MOBILE --\u003e PAYMENT_ORCHESTRATOR\n    INTRANET --\u003e PAYMENT_ORCHESTRATOR\n    \n    PAYMENT_ORCHESTRATOR --\u003e RESERVATION_PROCESSOR\n    PAYMENT_ORCHESTRATOR --\u003e FINAL_PROCESSOR\n    PAYMENT_ORCHESTRATOR --\u003e SERVICE_PROCESSOR\n    PAYMENT_ORCHESTRATOR --\u003e SUBSCRIPTION_PROCESSOR\n    \n    RESERVATION_PROCESSOR --\u003e RISK_ENGINE\n    FINAL_PROCESSOR --\u003e RISK_ENGINE\n    SERVICE_PROCESSOR --\u003e RISK_ENGINE\n    \n    RISK_ENGINE --\u003e IMMEDIATE_DELIVERY\n    IMMEDIATE_DELIVERY --\u003e PAYMENT_GATEWAY\n    \n    PAYMENT_GATEWAY --\u003e CARD_NETWORKS\n    CARD_NETWORKS -.Async Settlement.-\u003e BANK_SETTLEMENT\n    BANK_SETTLEMENT -.Confirmation.-\u003e SETTLEMENT_MONITOR\n    SETTLEMENT_MONITOR --\u003e BILLING_DB\n    \n    RESERVATION_PROCESSOR --\u003e FACTORY_API\n    FINAL_PROCESSOR --\u003e VEHICLE_ASSIGNMENT\n    SERVICE_PROCESSOR --\u003e OTA_ENGINE\n    \n    PAYMENT_ORCHESTRATOR --\u003e INVOICE_GEN\n    INVOICE_GEN --\u003e BILLING_DB\n    \n    REFUND_PROCESSOR --\u003e PAYMENT_GATEWAY\n    REFUND_PROCESSOR --\u003e BILLING_DB\n    \n    SUBSCRIPTION_PROCESSOR --\u003e BILLING_DB\n```\n\n**Architectural Responsibilities:**\n\n| Component | Responsibility | Risk Characteristics |\n|-----------|---------------|---------------------|\n| `RESERVATION_PROCESSOR` | Process initial reservation payment (seal) | Low risk - small amount, triggers factory order |\n| `FINAL_PROCESSOR` | Process final vehicle payment before registration | High risk - large amount, blocks vehicle delivery |\n| `SERVICE_PROCESSOR` | Process one-time service payments | Medium risk - immediate OTA delivery despite async settlement |\n| `SUBSCRIPTION_PROCESSOR` | Bill monthly subscriptions at end of period (mes vencido) | High risk - post-paid model with collection risk |\n| `IMMEDIATE_DELIVERY` | Decide whether to deliver service before settlement confirmation | Core risk management component |\n| `SETTLEMENT_MONITOR` | Track async bank settlements and reconcile with delivered services | Detects settlement failures post-delivery |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:78-82](), [enunciado.md:13-19]()\n\n---\n\n## Payment Types\n\nThe CaaS platform processes three distinct payment types, each with unique characteristics and business rules.\n\n### Payment Type Taxonomy\n\n| Payment Type | Purpose | Timing | Amount | Settlement Risk | Refundable |\n|--------------|---------|--------|--------|-----------------|------------|\n| **Reservation Payment** | Secure vehicle allocation | At sales registration | Partial (seal/deposit) | Low | No (lost if final payment fails) |\n| **Final Payment** | Complete vehicle purchase | Before vehicle registration | Remaining balance | None (blocking) | No |\n| **Service Payment (One-time)** | Activate optional service | At service purchase | Service price | Medium (async settlement) | Yes (desistimiento rules apply) |\n| **Service Payment (Subscription)** | Monthly recurring service | End of month (mes vencido) | Monthly fee | High (post-paid) | Yes (can cancel anytime) |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:78-96](), [enunciado.md:13-21]()\n\n### Reservation Payment Flow\n\n```mermaid\nsequenceDiagram\n    participant DEALER as Dealership Staff\u003cbr/\u003e(Intranet)\n    participant INTRANET as Corporate Intranet\n    participant PAY_PROC as Reservation Processor\n    participant GATEWAY as Payment Gateway\n    participant FACTORY as Factory API\n    participant CUSTOMER as Customer\n    \n    DEALER-\u003e\u003eINTRANET: Register sale\u003cbr/\u003e(customer data + plan comercial)\n    INTRANET-\u003e\u003ePAY_PROC: Request reservation payment\n    PAY_PROC-\u003e\u003eGATEWAY: Process seal payment\n    GATEWAY--\u003e\u003ePAY_PROC: Payment initiated\n    \n    Note over PAY_PROC: Assumes successful settlement\n    \n    PAY_PROC-\u003e\u003eFACTORY: POST /orders\u003cbr/\u003e(automatic order placement)\n    FACTORY--\u003e\u003ePAY_PROC: Order confirmation\n    \n    PAY_PROC-\u003e\u003eCUSTOMER: Email credentials\u003cbr/\u003e+ order confirmation\n    \n    Note over GATEWAY,PAY_PROC: Async settlement occurs\u003cbr/\u003e(reconciled later)\n```\n\n**Critical Rule:** Once reservation payment is initiated, the factory order is placed immediately. This creates financial exposure if the payment later fails, but optimizes manufacturing lead time.\n\n**Sources:** [enunciado.md:8-13](), [pasame las preguntas y sus respuestas a markdown.md:78-82]()\n\n### Final Payment Flow\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as Customer\n    participant PLATFORM as Web/Mobile Platform\n    participant FINAL_PROC as Final Payment Processor\n    participant GATEWAY as Payment Gateway\n    participant VEHICLE_MGT as Vehicle Assignment Manager\n    participant ADMIN_API as Administrative API\n    \n    PLATFORM-\u003e\u003eCUSTOMER: Notify: Vehicle ready\u003cbr/\u003ein dealership\n    CUSTOMER-\u003e\u003ePLATFORM: Initiate final payment\n    PLATFORM-\u003e\u003eFINAL_PROC: Request final payment\n    FINAL_PROC-\u003e\u003eGATEWAY: Process payment\n    GATEWAY--\u003e\u003eFINAL_PROC: Payment result\n    \n    alt Payment Successful\n        FINAL_PROC-\u003e\u003eVEHICLE_MGT: Confirm payment\n        VEHICLE_MGT-\u003e\u003eADMIN_API: Register vehicle\u003cbr/\u003e(matricular)\n        ADMIN_API--\u003e\u003eVEHICLE_MGT: Registration complete\n        VEHICLE_MGT-\u003e\u003eCUSTOMER: Schedule delivery\n    else Payment Failed\n        FINAL_PROC-\u003e\u003eVEHICLE_MGT: Mark vehicle \"sin asignar\"\n        VEHICLE_MGT-\u003e\u003eVEHICLE_MGT: Convert to stock\u003cbr/\u003efor immediate sale\n        FINAL_PROC-\u003e\u003eCUSTOMER: Notify: Reservation lost\n    end\n```\n\n**Critical Rule:** Final payment is **blocking**. If payment fails, the vehicle immediately becomes unassigned stock. Customer loses their reservation entirely. This is non-negotiable for cash flow protection.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27](), [enunciado.md:14-17]()\n\n### Service Payment Flow (One-time)\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as Customer\n    participant EXPEDIENTE as Expediente System\n    participant SERVICE_PROC as Service Payment Processor\n    participant GATEWAY as Payment Gateway\n    participant OTA as OTA Activation Engine\n    participant IOT as IoT Gateway\n    participant VEHICLE as Vehicle\n    \n    CUSTOMER-\u003e\u003eEXPEDIENTE: Browse opciones disponibles\n    EXPEDIENTE-\u003e\u003eCUSTOMER: Display service catalog\u003cbr/\u003e+ pricing\n    CUSTOMER-\u003e\u003eEXPEDIENTE: Select service + duration\n    EXPEDIENTE-\u003e\u003eSERVICE_PROC: Initiate payment\n    SERVICE_PROC-\u003e\u003eGATEWAY: Process payment\n    GATEWAY--\u003e\u003eSERVICE_PROC: Payment initiated\n    \n    Note over SERVICE_PROC: Immediate delivery decision\u003cbr/\u003e(assumes settlement risk)\n    \n    SERVICE_PROC-\u003e\u003eOTA: Trigger OTA activation\n    OTA-\u003e\u003eIOT: Send configuration command\n    IOT-\u003e\u003eVEHICLE: Apply configuration\n    VEHICLE--\u003e\u003eIOT: Configuration status\n    \n    alt OTA Success\n        IOT--\u003e\u003eOTA: Activation confirmed\n        OTA-\u003e\u003eSERVICE_PROC: Service delivered\n        SERVICE_PROC-\u003e\u003eCUSTOMER: Notify: Service active\n        \n        Note over GATEWAY,SERVICE_PROC: Async settlement\u003cbr/\u003etracked separately\n    else OTA Failure (after retries)\n        IOT--\u003e\u003eOTA: Activation failed\n        OTA-\u003e\u003eSERVICE_PROC: Delivery failed\n        SERVICE_PROC-\u003e\u003eGATEWAY: Void/refund payment\n        SERVICE_PROC-\u003e\u003eCUSTOMER: Notify: NOT CHARGED\n    end\n```\n\n**Critical Rule:** If OTA activation fails after all retries, the customer is **NEVER CHARGED** for the service. This is a core customer protection policy. The payment is voided or refunded if already settled.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53](), [enunciado.md:18-19]()\n\n### Subscription Billing Flow (Mes Vencido)\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as Customer\n    participant PLATFORM as Web/Mobile Platform\n    participant SUB_PROC as Subscription Processor\n    participant USAGE_TRACKER as Usage Tracker\n    participant GATEWAY as Payment Gateway\n    participant BILLING_DB as Billing Database\n    \n    CUSTOMER-\u003e\u003ePLATFORM: Subscribe to service\n    PLATFORM-\u003e\u003eSUB_PROC: Activate subscription\n    SUB_PROC-\u003e\u003eUSAGE_TRACKER: Start tracking usage\n    \n    Note over CUSTOMER,USAGE_TRACKER: Customer uses service\u003cbr/\u003ethroughout month\n    \n    USAGE_TRACKER-\u003e\u003eUSAGE_TRACKER: Month ends\n    USAGE_TRACKER-\u003e\u003eSUB_PROC: Trigger mes vencido billing\n    SUB_PROC-\u003e\u003eBILLING_DB: Calculate charges\n    BILLING_DB--\u003e\u003eSUB_PROC: Total amount due\n    \n    SUB_PROC-\u003e\u003eGATEWAY: Charge for consumed services\n    GATEWAY--\u003e\u003eSUB_PROC: Payment result\n    \n    alt Payment Successful\n        SUB_PROC-\u003e\u003eBILLING_DB: Record payment\n        SUB_PROC-\u003e\u003eUSAGE_TRACKER: Continue subscription\n    else Payment Failed\n        SUB_PROC-\u003e\u003eUSAGE_TRACKER: Cancel subscription\n        SUB_PROC-\u003e\u003eCUSTOMER: Notify: Subscription cancelled\n    end\n```\n\n**Billing Model:** **Mes vencido** (post-paid) - customers are charged at the **end of each month** for services consumed during that month. This increases customer satisfaction but creates collection risk.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n---\n\n## Payment Processing Architecture\n\n### Payment Gateway Integration Pattern\n\nThe CaaS platform integrates with external payment gateways using an **asynchronous settlement pattern** where service delivery occurs before final settlement confirmation.\n\n```mermaid\ngraph LR\n    subgraph \"CaaS Platform\"\n        PAYMENT_INIT[\"Payment Initiation\"]\n        DELIVERY_ENGINE[\"Service Delivery Engine\"]\n        SETTLEMENT_RECONCILE[\"Settlement Reconciliation\"]\n    end\n    \n    subgraph \"Payment Gateway\"\n        AUTHORIZATION[\"Authorization\"]\n        CAPTURE[\"Capture\"]\n        SETTLEMENT[\"Settlement\"]\n    end\n    \n    subgraph \"Banking Network\"\n        CARD_NETWORK[\"Card Networks\"]\n        BANK[\"Issuing Bank\"]\n    end\n    \n    PAYMENT_INIT --\u003e|1. Authorize payment| AUTHORIZATION\n    AUTHORIZATION --\u003e|2. Authorization OK| PAYMENT_INIT\n    PAYMENT_INIT --\u003e|3. Immediate delivery| DELIVERY_ENGINE\n    \n    DELIVERY_ENGINE --\u003e|4. Deliver service to customer| DELIVERY_ENGINE\n    \n    AUTHORIZATION -.5. Async: Capture funds.-\u003e CAPTURE\n    CAPTURE -.6. Async: Send to network.-\u003e CARD_NETWORK\n    CARD_NETWORK -.7. Async: Settlement.-\u003e BANK\n    BANK -.8. Async: Confirmation.-\u003e SETTLEMENT\n    SETTLEMENT -.9. Async: Notify CaaS.-\u003e SETTLEMENT_RECONCILE\n```\n\n**Timeline Analysis:**\n\n| Time | CaaS Action | Payment Status | Risk Level |\n|------|-------------|----------------|------------|\n| T+0 seconds | Payment initiated | Authorization only | **CaaS assumes risk** |\n| T+1 second | Service delivered to customer | Not settled | **Maximum exposure** |\n| T+2-4 hours | (waiting) | Capture processing | Elevated risk |\n| T+24-72 hours | (waiting) | Settlement in progress | Moderate risk |\n| T+3-5 days | Settlement confirmation received | Confirmed | Risk resolved |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:78-82]()\n\n### Risk Assumption Strategy\n\n```mermaid\ngraph TD\n    PAYMENT_INIT[\"Payment Initiated\"]\n    RISK_EVAL[\"Risk Evaluation\"]\n    \n    PAYMENT_INIT --\u003e RISK_EVAL\n    \n    RISK_EVAL --\u003e DECISION{Service Type?}\n    \n    DECISION --\u003e|Reservation| RESERVE_FLOW[\"Low Risk:\u003cbr/\u003eDeliver immediately\u003cbr/\u003e(small amount)\"]\n    DECISION --\u003e|Final Payment| FINAL_FLOW[\"No Risk:\u003cbr/\u003eBlocking operation\u003cbr/\u003e(must confirm)\"]\n    DECISION --\u003e|Service Payment| SERVICE_FLOW[\"Medium Risk:\u003cbr/\u003eDeliver immediately\u003cbr/\u003e(async settlement)\"]\n    DECISION --\u003e|Subscription| SUB_FLOW[\"High Risk:\u003cbr/\u003ePost-paid model\u003cbr/\u003e(collect after use)\"]\n    \n    RESERVE_FLOW --\u003e DELIVER[\"Deliver Service\"]\n    SERVICE_FLOW --\u003e DELIVER\n    SUB_FLOW --\u003e MONTH_END[\"Bill at Month End\"]\n    \n    FINAL_FLOW --\u003e BLOCK[\"Block Until Confirmed\"]\n    BLOCK --\u003e DELIVER\n    \n    DELIVER --\u003e SETTLE_WAIT[\"Wait for Settlement\"]\n    MONTH_END --\u003e SETTLE_WAIT\n    \n    SETTLE_WAIT --\u003e SETTLE_RESULT{Settlement Result}\n    \n    SETTLE_RESULT --\u003e|Success| RECORD_SUCCESS[\"Record Successful\u003cbr/\u003eTransaction\"]\n    SETTLE_RESULT --\u003e|Failure| HANDLE_FAIL[\"Handle Settlement\u003cbr/\u003eFailure\"]\n    \n    HANDLE_FAIL --\u003e ALREADY_DELIVERED{Service Already\u003cbr/\u003eDelivered?}\n    \n    ALREADY_DELIVERED --\u003e|Yes - OTA Success| WRITE_OFF[\"Write-off Loss\u003cbr/\u003e(customer keeps service)\"]\n    ALREADY_DELIVERED --\u003e|Yes - OTA Failed| NO_LOSS[\"No Loss\u003cbr/\u003e(customer not charged)\"]\n    ALREADY_DELIVERED --\u003e|No - Pending| CANCEL_SERVICE[\"Cancel Pending\u003cbr/\u003eService\"]\n```\n\n**Business Rationale:** CaaS prioritizes **customer experience over financial risk** by delivering services immediately upon payment authorization, before settlement confirmation. This creates financial exposure but improves customer satisfaction significantly.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:78-82]()\n\n---\n\n## Billing Models\n\n### Pago por Uso (Pay-per-Use)\n\nThe fundamental billing model for optional services is **pago por uso** (pay-per-use), where customers pay for each service activation based on duration.\n\n**Pricing Structure:**\n\n| Duration Type | Payment Model | Example |\n|--------------|---------------|---------|\n| **Temporary** | One-time payment for fixed period | \"Heated seats for 30 days: 50\" |\n| **Permanent** | One-time payment for vehicle lifetime | \"50% power increase: 2,000\" |\n| **Planned** | One-time payment for future activation | \"Winter mode from Dec 1-Feb 28: 150\" |\n| **Recurring** | Subscription with monthly billing | \"Entertainment package: 30/month\" |\n\n**Sources:** [enunciado.md:3-5](), [enunciado.md:21]()\n\n### Mes Vencido (Post-paid) Billing\n\nFor **subscription services**, CaaS implements **mes vencido** billing, a post-paid model where customers are charged at the end of each billing period for services consumed.\n\n```mermaid\ngraph LR\n    START[\"Subscription Activated\"]\n    USE[\"Customer Uses Service\u003cbr/\u003e(Month 1)\"]\n    END_MONTH[\"Month 1 Ends\"]\n    BILL[\"Generate Bill\u003cbr/\u003efor Month 1\"]\n    CHARGE[\"Charge Customer\"]\n    \n    START --\u003e USE\n    USE --\u003e END_MONTH\n    END_MONTH --\u003e BILL\n    BILL --\u003e CHARGE\n    \n    CHARGE --\u003e SUCCESS{Payment\u003cbr/\u003eSuccessful?}\n    \n    SUCCESS --\u003e|Yes| CONTINUE[\"Continue to Month 2\"]\n    SUCCESS --\u003e|No| CANCEL[\"Cancel Subscription\"]\n    \n    CONTINUE --\u003e USE2[\"Customer Uses Service\u003cbr/\u003e(Month 2)\"]\n    USE2 --\u003e END_MONTH\n```\n\n**Advantages:**\n- Lower friction for customer adoption (no upfront payment)\n- Aligns billing with actual usage\n- Customer only pays for what they've consumed\n\n**Risks:**\n- Collection risk for services already delivered\n- Requires dunning processes for failed payments\n- Potential write-offs for uncollectable amounts\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n---\n\n## Refund and Cancellation Policies\n\n### Desistimiento (Right of Withdrawal)\n\nCaaS complies with **distance selling regulations** that grant customers a **right of withdrawal (desistimiento)** for remotely purchased services.\n\n**Refund Rules by Service Duration:**\n\n```mermaid\ngraph TD\n    CANCEL_REQUEST[\"Customer Requests\u003cbr/\u003eService Cancellation\"]\n    \n    CANCEL_REQUEST --\u003e SERVICE_DURATION{Service\u003cbr/\u003eDuration?}\n    \n    SERVICE_DURATION --\u003e|Duration \u003e 14 days| LONG_SERVICE[\"Long-duration Service\"]\n    SERVICE_DURATION --\u003e|Duration \u003c= 14 days| SHORT_SERVICE[\"Short-duration Service\"]\n    \n    LONG_SERVICE --\u003e TIME_CHECK{Time Since\u003cbr/\u003ePurchase?}\n    TIME_CHECK --\u003e|\u003c= 14 days| REFUND_LONG[\"REFUND GRANTED\u003cbr/\u003e(within withdrawal period)\"]\n    TIME_CHECK --\u003e|\u003e 14 days| NO_REFUND_LONG[\"NO REFUND\u003cbr/\u003e(service consumed)\"]\n    \n    SHORT_SERVICE --\u003e REFUND_SHORT[\"REFUND GRANTED\u003cbr/\u003e(anytime during duration)\"]\n    \n    REFUND_LONG --\u003e PROCESS_REFUND[\"Process Refund\"]\n    REFUND_SHORT --\u003e PROCESS_REFUND\n    NO_REFUND_LONG --\u003e NOTIFY[\"Notify Customer:\u003cbr/\u003eNo refund available\"]\n    \n    PROCESS_REFUND --\u003e DEACTIVATE[\"Deactivate Service\u003cbr/\u003e(if still active)\"]\n```\n\n**Refund Policy Table:**\n\n| Service Duration | Refund Window | Business Logic |\n|-----------------|---------------|----------------|\n| **\u003e 14 days** | First 14 days after purchase | Customer can test service and withdraw if unsatisfied |\n| ** 14 days** | Anytime during service duration | Service hasn't fully elapsed, so withdrawal always possible |\n| **Subscription** | Anytime (cancel future billing) | Can cancel to stop future charges, but no refund for current period already used |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-89]()\n\n### Special Scenarios\n\n#### Vehicle Theft\n\n```mermaid\ngraph TD\n    THEFT[\"Vehicle Stolen\"]\n    \n    THEFT --\u003e SERVICES{Services Status?}\n    \n    SERVICES --\u003e DELIVERED[\"Already Delivered\u003cbr/\u003eServices\"]\n    SERVICES --\u003e PENDING[\"Pending/Future\u003cbr/\u003eServices\"]\n    \n    DELIVERED --\u003e DESIST_CHECK{Within Desistimiento\u003cbr/\u003ePeriod?}\n    \n    DESIST_CHECK --\u003e|Yes| MAY_REFUND[\"May Refund\u003cbr/\u003e(if eligible)\"]\n    DESIST_CHECK --\u003e|No| NO_REFUND_THEFT[\"NO REFUND\u003cbr/\u003e(service consumed)\"]\n    \n    PENDING --\u003e CAN_CANCEL[\"Customer CAN Cancel\u003cbr/\u003e(no delivery yet)\"]\n    \n    CAN_CANCEL --\u003e CANCEL_PENDING[\"Cancel Service\"]\n    CANCEL_PENDING --\u003e REFUND_PENDING[\"Refund Pending\u003cbr/\u003ePayments\"]\n    \n    NO_REFUND_THEFT --\u003e INSURANCE[\"Customer Deals with\u003cbr/\u003eInsurance Separately\"]\n```\n\n**Key Rule:** Vehicle theft does **not** automatically trigger special refund logic. Already-delivered services follow normal desistimiento rules. Customers can cancel pending services and future subscriptions.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:91-96]()\n\n---\n\n## Payment Failure Handling\n\n### OTA Activation Failure  No Charge\n\nThe most critical payment protection rule in the CaaS system is: **if OTA activation fails, the customer is NOT charged**.\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as Customer\n    participant SERVICE_PROC as Service Payment Processor\n    participant OTA as OTA Activation Engine\n    participant IOT as IoT Gateway\n    participant GATEWAY as Payment Gateway\n    \n    CUSTOMER-\u003e\u003eSERVICE_PROC: Purchase service\n    SERVICE_PROC-\u003e\u003eGATEWAY: Initiate payment authorization\n    GATEWAY--\u003e\u003eSERVICE_PROC: Authorization OK\n    \n    Note over SERVICE_PROC: Payment authorized\u003cbr/\u003ebut not captured yet\n    \n    SERVICE_PROC-\u003e\u003eOTA: Trigger activation\n    OTA-\u003e\u003eIOT: Attempt 1\n    IOT--\u003e\u003eOTA: Failed\n    OTA-\u003e\u003eIOT: Attempt 2\n    IOT--\u003e\u003eOTA: Failed\n    OTA-\u003e\u003eIOT: Attempt N\n    IOT--\u003e\u003eOTA: Failed\n    \n    OTA-\u003e\u003eOTA: Retrieve vehicle status\n    OTA-\u003e\u003eOTA: Send to tech support\n    \n    OTA-\u003e\u003eSERVICE_PROC: Activation FAILED\n    SERVICE_PROC-\u003e\u003eGATEWAY: VOID authorization\u003cbr/\u003eDO NOT CAPTURE\n    SERVICE_PROC-\u003e\u003eCUSTOMER: Notify: Service not delivered\u003cbr/\u003eNO CHARGE applied\n    \n    Note over CUSTOMER,GATEWAY: Customer never charged\u003cbr/\u003efor undelivered service\n```\n\n**Implementation Requirements:**\n- Payment **authorization** (hold) occurs immediately\n- Payment **capture** only occurs after OTA confirms successful activation\n- If activation fails, authorization is **voided** before capture\n- If already captured (due to gateway timing), **refund** is issued immediately\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n### Final Payment Failure\n\n```mermaid\ngraph TD\n    READY[\"Vehicle Ready\u003cbr/\u003eat Dealership\"]\n    NOTIFY[\"Notify Customer:\u003cbr/\u003eMake final payment\"]\n    \n    READY --\u003e NOTIFY\n    NOTIFY --\u003e ATTEMPT[\"Customer Attempts\u003cbr/\u003eFinal Payment\"]\n    \n    ATTEMPT --\u003e RESULT{Payment\u003cbr/\u003eResult?}\n    \n    RESULT --\u003e|Success| REGISTER[\"Register Vehicle\u003cbr/\u003e(Matriculate)\"]\n    REGISTER --\u003e SCHEDULE[\"Schedule Delivery\u003cbr/\u003eto Customer\"]\n    \n    RESULT --\u003e|Failure| UNASSIGN[\"Mark Vehicle\u003cbr/\u003e'sin asignar'\"]\n    UNASSIGN --\u003e STOCK[\"Convert to\u003cbr/\u003eDealership Stock\"]\n    STOCK --\u003e IMMEDIATE_SALE[\"Available for\u003cbr/\u003eImmediate Sale\"]\n    \n    UNASSIGN --\u003e LOSE_RESERVATION[\"Customer Loses\u003cbr/\u003eReservation\"]\n    LOSE_RESERVATION --\u003e FORFEIT[\"Forfeit Reservation\u003cbr/\u003ePayment\"]\n```\n\n**Consequences of Final Payment Failure:**\n\n| Action | System State | Customer Impact |\n|--------|--------------|-----------------|\n| Vehicle Status | Changed to `\"sin asignar\"` | Loses assigned vehicle |\n| Inventory | Becomes stock for immediate sale | Another customer can purchase |\n| Reservation Payment | Forfeited (not refunded) | Loses deposit |\n| Customer Record | Reservation marked cancelled | Must start new purchase process |\n\n**Business Rationale:** Protects company cash flow and prevents manufactured vehicles from sitting unsold. Harsh but necessary boundary.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Subscription Payment Failure\n\n```mermaid\ngraph TD\n    MONTH_END[\"Month Ends\"]\n    CALCULATE[\"Calculate Charges\u003cbr/\u003efor Services Used\"]\n    \n    MONTH_END --\u003e CALCULATE\n    CALCULATE --\u003e ATTEMPT[\"Attempt to Charge\u003cbr/\u003eCustomer\"]\n    \n    ATTEMPT --\u003e RESULT{Payment\u003cbr/\u003eSuccessful?}\n    \n    RESULT --\u003e|Yes| CONTINUE[\"Continue Subscription\u003cbr/\u003einto Next Month\"]\n    \n    RESULT --\u003e|No| RETRY[\"Retry Payment\u003cbr/\u003e(configurable attempts)\"]\n    \n    RETRY --\u003e RETRY_RESULT{Retry\u003cbr/\u003eSuccessful?}\n    \n    RETRY_RESULT --\u003e|Yes| CONTINUE\n    RETRY_RESULT --\u003e|No| CANCEL[\"Cancel Subscription\"]\n    \n    CANCEL --\u003e DEACTIVATE[\"Deactivate Service\u003cbr/\u003evia OTA\"]\n    CANCEL --\u003e DUNNING[\"Send to Collections\u003cbr/\u003e(for outstanding amount)\"]\n    CANCEL --\u003e NOTIFY[\"Notify Customer\"]\n```\n\n**Collection Process:**\n1. **First Attempt:** At month end (mes vencido billing)\n2. **Retries:** Configurable retry schedule (e.g., +3 days, +7 days)\n3. **Cancellation:** If all retries fail, cancel subscription\n4. **Service Deactivation:** Remove service via OTA\n5. **Collections:** Outstanding amount sent to dunning process\n\n**Write-off Risk:** Services already consumed but not paid for represent a loss. This is the inherent risk of the mes vencido model.\n\n**Sources:** [pasame las preguntas y sua respuestas a markdown.md:82]()\n\n---\n\n## Financial Records and Invoicing\n\n### Invoice Generation Flow\n\n```mermaid\ngraph LR\n    subgraph \"Payment Events\"\n        RES_PAY[\"Reservation\u003cbr/\u003ePayment\"]\n        FINAL_PAY[\"Final\u003cbr/\u003ePayment\"]\n        SERVICE_PAY[\"Service\u003cbr/\u003ePayment\"]\n        SUB_PAY[\"Subscription\u003cbr/\u003eBilling\"]\n    end\n    \n    subgraph \"Invoice Generation\"\n        INVOICE_GEN[\"Invoice\u003cbr/\u003eGenerator\"]\n        TEMPLATE[\"Invoice\u003cbr/\u003eTemplates\"]\n    end\n    \n    subgraph \"Storage and Delivery\"\n        BILLING_DB[(\"Billing\u003cbr/\u003eDatabase\")]\n        EXPEDIENTE[\"Expediente\u003cbr/\u003ede Compra\"]\n        EMAIL[\"Email\u003cbr/\u003eService\"]\n    end\n    \n    RES_PAY --\u003e INVOICE_GEN\n    FINAL_PAY --\u003e INVOICE_GEN\n    SERVICE_PAY --\u003e INVOICE_GEN\n    SUB_PAY --\u003e INVOICE_GEN\n    \n    INVOICE_GEN --\u003e TEMPLATE\n    TEMPLATE --\u003e INVOICE_GEN\n    \n    INVOICE_GEN --\u003e BILLING_DB\n    INVOICE_GEN --\u003e EXPEDIENTE\n    INVOICE_GEN --\u003e EMAIL\n    \n    EXPEDIENTE --\u003e CUSTOMER[\"Customer Access\u003cbr/\u003e(Web/Mobile)\"]\n```\n\n**Invoice Types:**\n\n| Invoice Type | Trigger | Contents | Storage |\n|-------------|---------|----------|---------|\n| **Reservation Invoice** | Reservation payment successful | Deposit amount, vehicle details, order number | Expediente + Billing DB |\n| **Final Payment Invoice** | Final payment successful | Remaining balance, vehicle VIN, registration details | Expediente + Billing DB |\n| **Service Invoice** | Service payment successful + OTA confirmed | Service description, duration, price | Expediente + Billing DB |\n| **Monthly Subscription Invoice** | End of month billing | List of services used, usage days, total charge | Expediente + Billing DB |\n| **Refund Credit Note** | Desistimiento refund processed | Original invoice reference, refund amount, reason | Expediente + Billing DB |\n\nAll invoices are stored in the customer's **Expediente de Compra** and accessible via web/mobile platforms.\n\n**Sources:** [enunciado.md:11]()\n\n---\n\n## Summary\n\nThe CaaS payment and billing architecture implements a **customer-first financial strategy** that prioritizes user experience while carefully managing financial risk:\n\n**Key Characteristics:**\n\n1. **Risk Assumption:** Delivers services immediately despite asynchronous payment settlement\n2. **Customer Protection:** Never charges for failed OTA activations\n3. **Legal Compliance:** Implements desistimiento (withdrawal) rules per EU distance selling regulations\n4. **Flexible Billing:** Supports multiple models (one-time, temporary, permanent, subscription)\n5. **Post-paid Option:** Mes vencido billing for subscriptions reduces adoption friction\n6. **Strict Boundaries:** Final payment failure results in immediate loss of vehicle reservation\n\n**Financial Risk Profile:**\n\n| Risk Area | Exposure | Mitigation |\n|-----------|----------|------------|\n| OTA Failure | Medium | Void/refund if activation fails |\n| Service Settlement Delay | Low-Medium | Monitor settlement, write off rare failures |\n| Subscription Non-payment | High | Dunning process, service deactivation |\n| Final Payment Failure | None | Blocking operation, vehicle returns to stock |\n\nThis architecture balances **business agility** (fast service delivery) with **customer protection** (no charge for failed delivery) and **financial prudence** (strict controls on high-value transactions).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:75-96](), [enunciado.md:1-23]()"])</script><script>self.__next_f.push([1,"2d:T60db,"])</script><script>self.__next_f.push([1,"# Payment Types and Flows\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details all payment types within the CaaS system, their processing flows, timing characteristics, and failure handling mechanisms. It covers payments for vehicle acquisition (reservation and final payment), one-time service purchases, and subscription-based services.\n\nFor information about risk management and asynchronous settlement strategies, see [Risk Management and Settlement](#7.2). For service cancellation and refund eligibility rules, see [Service Cancellation and Refunds](#6.4). For payment failure scenarios and system behavior, see [Payment Failure Scenarios](#9.2).\n\n---\n\n## Payment Type Taxonomy\n\nThe CaaS system processes four distinct payment types, each with different timing characteristics, settlement patterns, and business rules:\n\n```mermaid\ngraph TB\n    PAYMENT_ROOT[\"CaaS Payment Types\"]\n    \n    VEHICLE[\"Vehicle Acquisition Payments\"]\n    SERVICES[\"Service Payments\"]\n    \n    RESERVATION[\"Reservation Payment\u003cbr/\u003e(Seal)\"]\n    FINAL[\"Final Payment\u003cbr/\u003e(Before Registration)\"]\n    \n    ONETIME[\"One-time Service Payment\u003cbr/\u003e(Pago por Uso)\"]\n    SUBSCRIPTION[\"Subscription Payment\u003cbr/\u003e(Mes Vencido)\"]\n    \n    PAYMENT_ROOT --\u003e VEHICLE\n    PAYMENT_ROOT --\u003e SERVICES\n    \n    VEHICLE --\u003e RESERVATION\n    VEHICLE --\u003e FINAL\n    \n    SERVICES --\u003e ONETIME\n    SERVICES --\u003e SUBSCRIPTION\n    \n    RESERVATION -.-\u003e|\"Synchronous\u003cbr/\u003eBlocking\"| RES_GATEWAY[\"Payment Gateway\"]\n    FINAL -.-\u003e|\"Synchronous\u003cbr/\u003eBlocking\"| FIN_GATEWAY[\"Payment Gateway\"]\n    ONETIME -.-\u003e|\"Async Settlement\u003cbr/\u003eCaaS Assumes Risk\"| ONE_GATEWAY[\"Payment Gateway\"]\n    SUBSCRIPTION -.-\u003e|\"Post-paid\u003cbr/\u003eMonthly Billing\"| SUB_GATEWAY[\"Payment Gateway\"]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82](), [enunciado.md:1-23]()\n\n| Payment Type | Timing | Settlement Model | Risk Assumption | Criticality |\n|-------------|--------|------------------|-----------------|-------------|\n| **Reservation Payment (Seal)** | At vehicle reservation | Synchronous, blocking | None - must succeed | High - gates factory order |\n| **Final Payment** | Before vehicle registration | Synchronous, blocking | None - must succeed | Critical - no vehicle without payment |\n| **One-time Service Payment** | At service purchase | Async settlement | CaaS assumes settlement risk | Medium - service delivered immediately |\n| **Subscription Payment (Mes Vencido)** | End of billing period | Post-paid, async | CaaS assumes collection risk | Medium - billed after consumption |\n\n---\n\n## Reservation Payment Flow\n\nThe reservation payment (seal) is the first financial transaction in the vehicle acquisition process. This payment triggers the factory order and reserves the vehicle for the customer.\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebPlatform as \"Web Platform /\u003cbr/\u003eMobile App\"\n    participant SalesSystem as \"Corporate Intranet\u003cbr/\u003eSales System\"\n    participant PaymentGateway as \"Payment Gateway\"\n    participant FactoryAPI as \"Factory API\"\n    participant Database as \"Order Database\"\n    \n    Customer-\u003e\u003eSalesSystem: \"Complete vehicle selection\u003cbr/\u003e(Plataforma Base + Options)\"\n    SalesSystem-\u003e\u003eCustomer: \"Display reservation amount\"\n    \n    Customer-\u003e\u003eSalesSystem: \"Initiate reservation payment\"\n    SalesSystem-\u003e\u003ePaymentGateway: \"POST /payments\u003cbr/\u003e{amount, customer, vehicle}\"\n    \n    PaymentGateway--\u003e\u003eSalesSystem: \"Payment processing...\"\n    \n    alt Payment Successful\n        PaymentGateway--\u003e\u003eSalesSystem: \"200 OK\u003cbr/\u003e{transaction_id, status: confirmed}\"\n        SalesSystem-\u003e\u003eDatabase: \"Create order record\u003cbr/\u003e(status: RESERVED)\"\n        SalesSystem-\u003e\u003eFactoryAPI: \"POST /orders\u003cbr/\u003e{vehicle_spec, customer_id}\"\n        FactoryAPI--\u003e\u003eSalesSystem: \"200 OK\u003cbr/\u003e{order_id, estimated_delivery}\"\n        SalesSystem-\u003e\u003eDatabase: \"Update order\u003cbr/\u003e(factory_order_id, status: ORDERED)\"\n        SalesSystem-\u003e\u003eCustomer: \"Generate access credentials\u003cbr/\u003eSend email\"\n        SalesSystem-\u003e\u003eWebPlatform: \"Create expediente de compra\"\n        WebPlatform--\u003e\u003eCustomer: \"Access to platform granted\"\n    else Payment Failed\n        PaymentGateway--\u003e\u003eSalesSystem: \"402 Payment Required\u003cbr/\u003e{error_code, reason}\"\n        SalesSystem-\u003e\u003eCustomer: \"Payment failed - retry required\"\n        SalesSystem-\u003e\u003eDatabase: \"Log failed attempt\u003cbr/\u003e(no order created)\"\n    end\n```\n\n**Sources:** [enunciado.md:9-13](), [pasame las preguntas y sus respuestas a markdown.md:80]()\n\n### Key Characteristics\n\n- **Synchronous Processing**: The payment must succeed before proceeding with factory order\n- **Blocking Operation**: Sales process cannot continue without successful reservation payment\n- **Triggers Multiple Actions**:\n  - Factory order placement via API\n  - Customer credential generation\n  - Expediente de compra creation\n  - Email notification with access credentials\n- **No Risk Assumption**: CaaS does not proceed unless payment is confirmed\n\n---\n\n## Final Payment Flow\n\nThe final payment completes the vehicle acquisition and triggers the registration and delivery process. This is the most critical payment in the system.\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebPlatform as \"Web Platform /\u003cbr/\u003eExpediente\"\n    participant PaymentSystem as \"Payment Processing\"\n    participant PaymentGateway as \"Payment Gateway\"\n    participant AdminAPI as \"Admin Registration API\"\n    participant Database as \"Order Database\"\n    participant TransportSystem as \"Transport Coordination\"\n    \n    Note over Customer,TransportSystem: Vehicle manufactured and available in dealership\n    \n    WebPlatform-\u003e\u003eCustomer: \"Notify: Vehicle ready for final payment\"\n    Customer-\u003e\u003eWebPlatform: \"Access expediente\"\n    WebPlatform-\u003e\u003eCustomer: \"Display final payment amount\u003cbr/\u003e(Total - Reservation)\"\n    \n    Customer-\u003e\u003eWebPlatform: \"Initiate final payment\"\n    WebPlatform-\u003e\u003ePaymentSystem: \"Process final payment\"\n    PaymentSystem-\u003e\u003ePaymentGateway: \"POST /payments/final\u003cbr/\u003e{amount, customer, vehicle}\"\n    \n    PaymentGateway--\u003e\u003ePaymentSystem: \"Processing...\"\n    \n    alt Payment Successful\n        PaymentGateway--\u003e\u003ePaymentSystem: \"200 OK\u003cbr/\u003e{transaction_id, confirmed}\"\n        PaymentSystem-\u003e\u003eDatabase: \"Update order\u003cbr/\u003e(status: PAID, payment_complete: true)\"\n        PaymentSystem-\u003e\u003eAdminAPI: \"POST /register-vehicle\u003cbr/\u003e{vehicle_id, customer_id, country}\"\n        AdminAPI--\u003e\u003ePaymentSystem: \"Registration initiated\"\n        AdminAPI--\u003e\u003ePaymentSystem: \"Registration complete\u003cbr/\u003e{registration_number, plates}\"\n        PaymentSystem-\u003e\u003eDatabase: \"Update order\u003cbr/\u003e(status: REGISTERED)\"\n        PaymentSystem-\u003e\u003eTransportSystem: \"Schedule delivery\u003cbr/\u003e{customer_address, vehicle}\"\n        PaymentSystem-\u003e\u003eCustomer: \"Payment confirmed\u003cbr/\u003eVehicle will be delivered\"\n    else Payment Failed\n        PaymentGateway--\u003e\u003ePaymentSystem: \"402 Payment Required\u003cbr/\u003e{error}\"\n        PaymentSystem-\u003e\u003eDatabase: \"Update order\u003cbr/\u003e(status: PAYMENT_FAILED)\"\n        PaymentSystem-\u003e\u003eDatabase: \"Mark vehicle: SIN_ASIGNAR\"\n        PaymentSystem-\u003e\u003eDatabase: \"Mark vehicle: AVAILABLE_STOCK\"\n        PaymentSystem-\u003e\u003eCustomer: \"Payment failed\u003cbr/\u003eReservation lost\"\n        Note over Database: Vehicle immediately available for sale to other customers\n    end\n```\n\n**Sources:** [enunciado.md:14-17](), [pasame las preguntas y sus respuestas a markdown.md:26-27](), [pasame las preguntas y sus respuestas a markdown.md:80]()\n\n### Critical Business Rules\n\n1. **Payment Must Succeed**: No vehicle delivery without complete final payment\n2. **Immediate Consequence of Failure**: \n   - Vehicle marked as `SIN_ASIGNAR` (unassigned)\n   - Vehicle becomes available stock for immediate sale\n   - Customer loses reservation entirely\n3. **Triggers Registration**: Only after successful payment does registration begin\n4. **Blocking Operation**: Customer cannot proceed to delivery without payment confirmation\n\n---\n\n## One-Time Service Payment Flow\n\nOne-time service payments enable customers to purchase optional features (opciones disponibles) on a pay-per-use basis. These payments follow an **asynchronous settlement model** where CaaS delivers the service immediately while assuming settlement risk.\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebPlatform as \"Web/Mobile Platform\"\n    participant ServiceCatalog as \"Service Catalog\"\n    participant VSSSystem as \"VSS System\"\n    participant PaymentSystem as \"Payment Processing\"\n    participant PaymentGateway as \"Payment Gateway\"\n    participant OTAEngine as \"OTA Activation Engine\"\n    participant IoTGateway as \"IoT Gateway\"\n    participant Database as \"Service Database\"\n    \n    Customer-\u003e\u003eWebPlatform: \"Browse opciones disponibles\"\n    WebPlatform-\u003e\u003eServiceCatalog: \"Get available services\u003cbr/\u003efor customer vehicle\"\n    ServiceCatalog--\u003e\u003eWebPlatform: \"Service catalog\u003cbr/\u003e(with prices, durations)\"\n    \n    Customer-\u003e\u003eWebPlatform: \"Select service + duration\"\n    \n    alt Service Requires Maintenance Check\n        WebPlatform-\u003e\u003eVSSSystem: \"GET /maintenance-status\u003cbr/\u003e{vehicle_id, service_id}\"\n        VSSSystem--\u003e\u003eWebPlatform: \"Maintenance status\"\n        \n        alt Maintenance Not Current\n            WebPlatform-\u003e\u003eCustomer: \"Service blocked\u003cbr/\u003eComplete maintenance first\"\n            Note over Customer: Flow terminates - see Service Blocking\n        end\n    end\n    \n    WebPlatform-\u003e\u003eCustomer: \"Display final price\"\n    Customer-\u003e\u003eWebPlatform: \"Confirm purchase\"\n    \n    WebPlatform-\u003e\u003ePaymentSystem: \"Initiate service payment\"\n    PaymentSystem-\u003e\u003ePaymentGateway: \"POST /payments/service\u003cbr/\u003e{amount, customer, service}\"\n    \n    Note over PaymentGateway: Payment processing (async settlement)\n    PaymentGateway--\u003e\u003ePaymentSystem: \"202 Accepted\u003cbr/\u003e{transaction_id, status: pending}\"\n    \n    critical CaaS Assumes Risk - Immediate Delivery\n        PaymentSystem-\u003e\u003eDatabase: \"Create service activation record\u003cbr/\u003e(status: PAYMENT_PENDING)\"\n        PaymentSystem-\u003e\u003eOTAEngine: \"Queue OTA activation\u003cbr/\u003e{vehicle, service, config}\"\n        OTAEngine-\u003e\u003eIoTGateway: \"Send OTA command\u003cbr/\u003e{vehicle_id, service_config}\"\n        \n        IoTGateway--\u003e\u003eOTAEngine: \"Command sent\"\n        \n        alt OTA Activation Successful\n            IoTGateway--\u003e\u003eOTAEngine: \"Activation confirmed\u003cbr/\u003e(vehicle reports success)\"\n            OTAEngine-\u003e\u003eDatabase: \"Update record\u003cbr/\u003e(status: ACTIVE)\"\n            OTAEngine-\u003e\u003eCustomer: \"Notify: Service activated\"\n            \n            par Async Payment Settlement\n                PaymentGateway--\u003e\u003ePaymentSystem: \"Webhook: Payment settled\u003cbr/\u003e{transaction_id, status: confirmed}\"\n                PaymentSystem-\u003e\u003eDatabase: \"Update record\u003cbr/\u003e(payment_status: CONFIRMED)\"\n            end\n        else OTA Activation Failed\n            Note over OTAEngine: See OTA failure handling\n            OTAEngine-\u003e\u003ePaymentSystem: \"Activation failed after retries\"\n            PaymentSystem-\u003e\u003ePaymentGateway: \"POST /refund\u003cbr/\u003e{transaction_id}\"\n            PaymentSystem-\u003e\u003eDatabase: \"Update record\u003cbr/\u003e(status: FAILED, charged: false)\"\n            PaymentSystem-\u003e\u003eCustomer: \"Service unavailable\u003cbr/\u003eNO CHARGE applied\"\n        end\n    end\n```\n\n**Sources:** [enunciado.md:18-19](), [pasame las preguntas y sus respuestas a markdown.md:77-82](), [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n### Key Characteristics\n\n| Aspect | Behavior |\n|--------|----------|\n| **Settlement Model** | Asynchronous - CaaS proceeds before bank confirms |\n| **Risk Assumption** | CaaS assumes risk of payment failure/chargeback |\n| **Service Delivery** | Immediate upon payment initiation (not settlement) |\n| **Failure Handling** | **DO NOT CHARGE** customer if OTA activation fails |\n| **Maintenance Gating** | Some services blocked if maintenance not current |\n| **Customer Protection** | No charge for undelivered functionality |\n\n### Critical Rule: No Charge for Failed Activation\n\nThe most important business rule for one-time service payments is:\n\n**If OTA activation fails after all retry attempts, the customer must NOT be charged for the service.**\n\nThis rule protects customers from paying for functionality they cannot use and is implemented by:\n1. Initiating refund immediately upon final OTA failure\n2. Marking the service record as `charged: false`\n3. Notifying the customer that no charge has been applied\n4. Escalating to technical support for resolution\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Subscription Payment Flow (Mes Vencido)\n\nSubscription payments follow a **post-paid billing model** where customers are charged at the end of each billing period for services consumed during that period. This model is referred to as \"mes vencido\" (expired month) billing.\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebPlatform as \"Web/Mobile Platform\"\n    participant SubscriptionMgmt as \"Subscription Management\"\n    participant ServiceUsage as \"Service Usage Tracker\"\n    participant BillingEngine as \"Billing Engine\"\n    participant PaymentGateway as \"Payment Gateway\"\n    participant Database as \"Billing Database\"\n    \n    Customer-\u003e\u003eWebPlatform: \"Subscribe to recurring service\"\n    WebPlatform-\u003e\u003eSubscriptionMgmt: \"Create subscription\u003cbr/\u003e{customer, service, start_date}\"\n    \n    SubscriptionMgmt-\u003e\u003eDatabase: \"Create subscription record\u003cbr/\u003e(status: ACTIVE, billing_period: MONTHLY)\"\n    SubscriptionMgmt-\u003e\u003eCustomer: \"Subscription activated\u003cbr/\u003eBilling: mes vencido\"\n    \n    Note over Customer,Database: Customer uses service during billing period\n    \n    loop During Billing Period\n        Customer-\u003e\u003eServiceUsage: \"Use subscribed service\"\n        ServiceUsage-\u003e\u003eDatabase: \"Log usage\u003cbr/\u003e{date, service, duration}\"\n    end\n    \n    Note over BillingEngine: End of billing period (month end)\n    \n    BillingEngine-\u003e\u003eDatabase: \"Query usage for billing period\u003cbr/\u003e{customer, start_date, end_date}\"\n    Database--\u003e\u003eBillingEngine: \"Usage records\"\n    \n    BillingEngine-\u003e\u003eBillingEngine: \"Calculate total charge\u003cbr/\u003e(usage * rate)\"\n    BillingEngine-\u003e\u003eDatabase: \"Create invoice\u003cbr/\u003e{amount, period, due_date}\"\n    \n    BillingEngine-\u003e\u003eCustomer: \"Send invoice notification\u003cbr/\u003e(email + app)\"\n    \n    BillingEngine-\u003e\u003ePaymentGateway: \"POST /payments/subscription\u003cbr/\u003e{amount, customer, invoice_id}\"\n    \n    alt Payment Successful\n        PaymentGateway--\u003e\u003eBillingEngine: \"200 OK\u003cbr/\u003e{transaction_id, confirmed}\"\n        BillingEngine-\u003e\u003eDatabase: \"Update invoice\u003cbr/\u003e(status: PAID)\"\n        BillingEngine-\u003e\u003eSubscriptionMgmt: \"Subscription remains active\"\n        BillingEngine-\u003e\u003eCustomer: \"Payment confirmed\"\n        Note over SubscriptionMgmt: Next billing period begins\n    else Payment Failed\n        PaymentGateway--\u003e\u003eBillingEngine: \"402 Payment Required\"\n        BillingEngine-\u003e\u003eDatabase: \"Update invoice\u003cbr/\u003e(status: UNPAID)\"\n        BillingEngine-\u003e\u003eSubscriptionMgmt: \"Payment failed\"\n        \n        alt Retry Logic\n            Note over BillingEngine: Retry payment attempts (e.g., 3x)\n            BillingEngine-\u003e\u003ePaymentGateway: \"Retry payment\"\n        end\n        \n        alt All Retries Failed\n            SubscriptionMgmt-\u003e\u003eDatabase: \"Update subscription\u003cbr/\u003e(status: CANCELLED_NONPAYMENT)\"\n            SubscriptionMgmt-\u003e\u003eCustomer: \"Subscription cancelled\u003cbr/\u003ePayment failure\"\n        end\n    end\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n### Mes Vencido Billing Characteristics\n\n| Aspect | Detail |\n|--------|--------|\n| **Billing Timing** | End of billing period (month end) |\n| **Payment Model** | Post-paid (charge after consumption) |\n| **Service Delivery** | Immediate upon subscription activation |\n| **Billing Period** | Monthly (configurable) |\n| **Risk** | CaaS bears collection risk |\n| **Cancellation** | Automatic if payment fails after retries |\n\n### Subscription Lifecycle States\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ACTIVE: \"Customer subscribes\"\n    \n    ACTIVE --\u003e BILLING: \"End of month\"\n    BILLING --\u003e PAYMENT_PROCESSING: \"Generate invoice\"\n    \n    PAYMENT_PROCESSING --\u003e PAID: \"Payment successful\"\n    PAYMENT_PROCESSING --\u003e RETRY: \"Payment failed\"\n    \n    PAID --\u003e ACTIVE: \"Next billing period\"\n    \n    RETRY --\u003e PAID: \"Retry successful\"\n    RETRY --\u003e CANCELLED_NONPAYMENT: \"All retries failed\"\n    \n    ACTIVE --\u003e CANCELLED_CUSTOMER: \"Customer cancels\"\n    \n    CANCELLED_NONPAYMENT --\u003e [*]\n    CANCELLED_CUSTOMER --\u003e [*]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:82]()\n\n---\n\n## Planned and Recurring Service Payments\n\nThe CaaS system supports future-scheduled service activations and recurring purchases, which combine aspects of both one-time and subscription payments.\n\n```mermaid\ngraph TB\n    subgraph \"Planned Service Purchase\"\n        PLAN_PURCHASE[\"Customer purchases\u003cbr/\u003eservice for future date\"]\n        PLAN_PAYMENT[\"Immediate payment\"]\n        PLAN_SCHEDULE[\"Schedule activation\u003cbr/\u003efor future date\"]\n        PLAN_ACTIVATION[\"OTA activation\u003cbr/\u003eon scheduled date\"]\n        \n        PLAN_PURCHASE --\u003e PLAN_PAYMENT\n        PLAN_PAYMENT --\u003e PLAN_SCHEDULE\n        PLAN_SCHEDULE -.-\u003e|\"Wait until scheduled date\"| PLAN_ACTIVATION\n    end\n    \n    subgraph \"Recurring Service Purchase\"\n        RECUR_SETUP[\"Customer sets up\u003cbr/\u003erecurring purchase\"]\n        RECUR_FIRST[\"First payment\u003cbr/\u003e+ activation\"]\n        RECUR_SCHEDULE[\"Schedule recurrence\u003cbr/\u003e(e.g., monthly)\"]\n        RECUR_REPEAT[\"Automatic renewal\u003cbr/\u003e+ payment\"]\n        \n        RECUR_SETUP --\u003e RECUR_FIRST\n        RECUR_FIRST --\u003e RECUR_SCHEDULE\n        RECUR_SCHEDULE -.-\u003e|\"Each period\"| RECUR_REPEAT\n        RECUR_REPEAT -.-\u003e|\"Loop\"| RECUR_SCHEDULE\n    end\n    \n    PLAN_ACTIVATION -.-\u003e|\"Can be recurring\"| RECUR_SETUP\n```\n\n**Sources:** [enunciado.md:21-22]()\n\n### Planned Service Characteristics\n\n- **Payment Timing**: Immediate (at purchase time)\n- **Service Activation**: Scheduled for future date\n- **Cancellation Rights**: Subject to desistimiento rules (14-day window if service \u003e 14 days)\n- **OTA Delivery**: Standard retry logic applies at activation time\n\n### Recurring Service Characteristics\n\n- **Initial Payment**: First period charged immediately\n- **Renewal Payments**: Automatic at each recurrence interval\n- **Cancellation**: Customer can cancel anytime (affects future renewals only)\n- **Failed Payment**: Cancels future recurrences\n\n---\n\n## Payment Gateway Integration Architecture\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Payment System\"\n        PaymentController[\"Payment Controller\"]\n        PaymentService[\"Payment Service\"]\n        PaymentRepo[\"Payment Repository\"]\n        \n        PaymentController --\u003e PaymentService\n        PaymentService --\u003e PaymentRepo\n    end\n    \n    subgraph \"Payment Gateway (External)\"\n        GatewayAPI[\"Gateway REST API\"]\n        CardProcessing[\"Card Processing\"]\n        BankNetwork[\"Banking Network\"]\n        \n        GatewayAPI --\u003e CardProcessing\n        CardProcessing --\u003e BankNetwork\n    end\n    \n    subgraph \"Payment Flows by Type\"\n        SyncFlow[\"Synchronous Flows:\u003cbr/\u003e- Reservation Payment\u003cbr/\u003e- Final Payment\"]\n        AsyncFlow[\"Async Settlement:\u003cbr/\u003e- Service Payments\u003cbr/\u003e- Subscription Payments\"]\n        \n        SyncFlow -.-\u003e|\"Wait for confirmation\"| GatewayAPI\n        AsyncFlow -.-\u003e|\"Proceed immediately\"| GatewayAPI\n    end\n    \n    PaymentService --\u003e|\"POST /payments\"| GatewayAPI\n    GatewayAPI -.-\u003e|\"Webhook callbacks\"| PaymentService\n    \n    PaymentService --\u003e PaymentEvents[\"Payment Events:\u003cbr/\u003e- PaymentInitiated\u003cbr/\u003e- PaymentConfirmed\u003cbr/\u003e- PaymentFailed\u003cbr/\u003e- PaymentSettled\"]\n    \n    PaymentEvents --\u003e|\"Triggers\"| ServiceActivation[\"Service Activation\"]\n    PaymentEvents --\u003e|\"Triggers\"| Notifications[\"Customer Notifications\"]\n    PaymentEvents --\u003e|\"Triggers\"| Accounting[\"Accounting System\"]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n### Integration Patterns by Payment Type\n\n| Payment Type | Integration Pattern | Behavior |\n|-------------|-------------------|----------|\n| **Reservation** | Synchronous request-response | Wait for payment confirmation before proceeding |\n| **Final Payment** | Synchronous request-response | Block until payment confirmed or failed |\n| **Service Payment** | Async initiate + webhook settlement | Deliver service immediately, settle later |\n| **Subscription** | Async post-paid billing | Charge at period end, use webhooks for confirmation |\n\n---\n\n## Payment State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e INITIATED: \"Payment request\"\n    \n    INITIATED --\u003e PROCESSING: \"Sent to gateway\"\n    \n    PROCESSING --\u003e CONFIRMED: \"Sync: immediate confirmation\"\n    PROCESSING --\u003e PENDING: \"Async: accepted for processing\"\n    PROCESSING --\u003e FAILED: \"Declined/error\"\n    \n    PENDING --\u003e SETTLED: \"Bank settlement complete\"\n    PENDING --\u003e FAILED: \"Settlement failed\"\n    \n    CONFIRMED --\u003e SETTLED: \"Final settlement\"\n    \n    SETTLED --\u003e REFUNDED: \"Refund requested\"\n    \n    FAILED --\u003e RETRY: \"Retry attempt\"\n    RETRY --\u003e PROCESSING\n    RETRY --\u003e ABANDONED: \"Max retries exceeded\"\n    \n    SETTLED --\u003e [*]\n    REFUNDED --\u003e [*]\n    ABANDONED --\u003e [*]\n    \n    note right of PENDING\n        Service delivered\n        in this state for\n        one-time payments\n    end note\n    \n    note right of FAILED\n        For service payments:\n        DO NOT CHARGE if\n        OTA activation failed\n    end note\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82](), [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Payment Failure Handling Summary\n\nPayment failures are handled differently based on payment type and failure timing:\n\n| Failure Scenario | System Behavior | Customer Impact |\n|-----------------|-----------------|-----------------|\n| **Reservation payment fails** | No order created, no factory order placed | Cannot proceed with purchase |\n| **Final payment fails** | Vehicle marked `SIN_ASIGNAR`, becomes available stock | Loses reservation entirely |\n| **Service payment fails (before OTA)** | No service activation attempted | No charge, can retry |\n| **Service payment fails (after OTA success)** | Service delivered, payment still pending | CaaS assumes settlement risk |\n| **OTA activation fails** | Payment refunded immediately | **NO CHARGE** - critical protection |\n| **Subscription payment fails** | Retry attempts, then cancel subscription | Service terminates after grace period |\n\n**Critical Business Rule**: The most important customer protection is: **Never charge for services that could not be activated via OTA**.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27](), [pasame las preguntas y sus respuestas a markdown.md:48-53](), [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## Payment Data Flow Summary\n\n```mermaid\ngraph LR\n    subgraph \"Payment Initiation\"\n        CustomerUI[\"Customer Interface\"]\n        PaymentReq[\"Payment Request\"]\n    end\n    \n    subgraph \"Payment Processing\"\n        PaymentSvc[\"Payment Service\"]\n        Gateway[\"Payment Gateway\"]\n        BankNet[\"Bank Network\"]\n    end\n    \n    subgraph \"Business Actions\"\n        FactoryOrder[\"Factory Order\u003cbr/\u003e(Reservation)\"]\n        VehicleReg[\"Vehicle Registration\u003cbr/\u003e(Final Payment)\"]\n        OTAActivation[\"OTA Activation\u003cbr/\u003e(Service Payment)\"]\n        BillingInvoice[\"Invoice Generation\u003cbr/\u003e(Subscription)\"]\n    end\n    \n    subgraph \"Data Persistence\"\n        OrderDB[\"Order Database\"]\n        ServiceDB[\"Service Database\"]\n        BillingDB[\"Billing Database\"]\n        AuditLog[\"Payment Audit Log\"]\n    end\n    \n    CustomerUI --\u003e PaymentReq\n    PaymentReq --\u003e PaymentSvc\n    PaymentSvc --\u003e Gateway\n    Gateway --\u003e BankNet\n    \n    PaymentSvc -.-\u003e|\"Success: Reservation\"| FactoryOrder\n    PaymentSvc -.-\u003e|\"Success: Final\"| VehicleReg\n    PaymentSvc -.-\u003e|\"Success: Service\"| OTAActivation\n    PaymentSvc -.-\u003e|\"Period End\"| BillingInvoice\n    \n    FactoryOrder --\u003e OrderDB\n    VehicleReg --\u003e OrderDB\n    OTAActivation --\u003e ServiceDB\n    BillingInvoice --\u003e BillingDB\n    \n    PaymentSvc --\u003e AuditLog\n```\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\nThis document provides a comprehensive overview of all payment types and flows within the CaaS system. For detailed information on specific aspects:\n- Risk management strategies: see [Risk Management and Settlement](#7.2)\n- Refund processing: see [Service Cancellation and Refunds](#6.4)\n- Payment failure scenarios: see [Payment Failure Scenarios](#9.2)\n- OTA activation failures: see [OTA Activation Failures](#9.1)"])</script><script>self.__next_f.push([1,"2e:T718b,"])</script><script>self.__next_f.push([1,"# Risk Management and Settlement\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document explains how the CaaS platform manages the financial risks associated with asynchronous payment settlement and describes the settlement reconciliation processes. Specifically, this covers:\n\n- The temporal gap between payment initiation and bank settlement confirmation\n- CaaS's strategic decision to deliver services immediately despite settlement delays\n- Risk profiles for different payment types (reservation, final, service, subscription)\n- Settlement reconciliation processes and state management\n- Customer protection mechanisms that prevent charging for undelivered services\n\nFor information about the different payment types and their flows, see [Payment Types and Flows](#7.1). For handling of payment failure scenarios, see [Payment Failure Scenarios](#9.2). For the OTA activation process that integrates with payment, see [OTA Service Activation](#6.2).\n\n**Sources:** Diagram 6 from high-level architecture, [pasame las preguntas y sus respuestas a markdown.md:76-82]()\n\n---\n\n## Asynchronous Settlement Architecture\n\nThe CaaS platform operates on a fundamental architectural principle: **immediate service delivery despite asynchronous payment settlement**. This creates a temporal gap between when a customer initiates payment and when the bank confirms settlement.\n\n### Payment Initiation vs. Settlement Timeline\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant CaaS\n    participant PaymentGateway\n    participant Bank\n    participant VehicleIoT\n\n    Customer-\u003e\u003eCaaS: \"Request Service Purchase\"\n    CaaS-\u003e\u003ePaymentGateway: \"Initiate Payment\"\n    PaymentGateway--\u003e\u003eCaaS: \"Payment Initiated (Immediate)\"\n    \n    Note over CaaS: DECISION POINT:\u003cbr/\u003eDeliver immediately or wait?\n    \n    CaaS-\u003e\u003eVehicleIoT: \"OTA Activation Command\"\n    VehicleIoT--\u003e\u003eCaaS: \"Activation Confirmed\"\n    CaaS--\u003e\u003eCustomer: \"Service Activated\"\n    \n    Note over CaaS,Bank: Asynchronous Settlement\u003cbr/\u003e(Seconds to Days)\n    \n    PaymentGateway-\u003e\u003eBank: \"Process Settlement\"\n    Bank--\u003e\u003ePaymentGateway: \"Settlement Confirmed\"\n    PaymentGateway--\u003e\u003eCaaS: \"Settlement Notification (Async)\"\n    \n    Note over CaaS: Reconciliation Required\n```\n\n**Strategic Decision:** CaaS delivers the service immediately upon payment initiation, before receiving settlement confirmation from the bank. This optimizes customer experience but introduces financial risk.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-82](), Diagram 6 from high-level architecture\n\n---\n\n## Risk Assumption Strategy\n\nCaaS explicitly assumes settlement risk to provide immediate service delivery. This business decision prioritizes customer satisfaction over financial risk mitigation.\n\n### Risk Assumption Model\n\n```mermaid\ngraph TD\n    PaymentInit[\"Payment Initiated\"]\n    RiskDecision{\"Risk\u003cbr/\u003eAssumption\u003cbr/\u003eStrategy\"}\n    ImmediateDelivery[\"Immediate Service\u003cbr/\u003eDelivery\"]\n    WaitSettlement[\"Wait for\u003cbr/\u003eSettlement\"]\n    \n    SettlementSuccess[\"Settlement\u003cbr/\u003eConfirmed\"]\n    SettlementFail[\"Settlement\u003cbr/\u003eFailed\"]\n    \n    Reconcile[\"Reconciliation\u003cbr/\u003eProcess\"]\n    CustomerCharged[\"Customer\u003cbr/\u003eCharged\"]\n    CustomerNotCharged[\"Customer\u003cbr/\u003eNOT Charged\"]\n    \n    PaymentInit --\u003e RiskDecision\n    RiskDecision --\u003e|\"CaaS Strategy:\u003cbr/\u003eAccept Risk\"| ImmediateDelivery\n    RiskDecision --\u003e|\"Conservative\u003cbr/\u003eAlternative\"| WaitSettlement\n    \n    ImmediateDelivery --\u003e SettlementSuccess\n    ImmediateDelivery --\u003e SettlementFail\n    WaitSettlement --\u003e SettlementSuccess\n    \n    SettlementSuccess --\u003e Reconcile\n    SettlementFail --\u003e Reconcile\n    \n    Reconcile --\u003e CustomerCharged\n    Reconcile --\u003e CustomerNotCharged\n    \n    Note1[\"Service Already\u003cbr/\u003eDelivered\"]\n    Note2[\"Risk:\u003cbr/\u003eChargeback\u003cbr/\u003ePossible\"]\n    \n    ImmediateDelivery -.-\u003e Note1\n    SettlementFail -.-\u003e Note2\n```\n\n### Business Rationale\n\n| Factor | Impact |\n|--------|--------|\n| **Customer Experience** | Immediate service activation eliminates waiting periods and improves satisfaction |\n| **Competitive Advantage** | Faster service delivery differentiates CaaS from competitors requiring settlement confirmation |\n| **Risk Exposure** | Potential for chargebacks, declined payments, and fraud |\n| **Risk Magnitude** | Limited to service payment amounts (typically lower than vehicle purchase) |\n| **Mitigation** | Known customer base (no anonymous transactions), payment history tracking |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-82](), Diagram 6 from high-level architecture\n\n---\n\n## Risk Profiles by Payment Type\n\nDifferent payment types have different risk profiles and settlement handling strategies.\n\n### Payment Type Risk Matrix\n\n| Payment Type | Settlement Model | Risk Level | Delivery Timing | Risk Owner |\n|--------------|------------------|------------|-----------------|------------|\n| **Reservation Signal** | Synchronous required | Low | Blocking | Customer |\n| **Final Vehicle Payment** | Synchronous required | High | Blocking (no vehicle without payment) | Customer |\n| **One-Time Service** | Asynchronous | Medium | Immediate delivery | CaaS |\n| **Subscription (Mes Vencido)** | Post-paid | High | Deliver first, charge later | CaaS |\n\n### Detailed Risk Analysis\n\n```mermaid\ngraph LR\n    subgraph \"Low Risk: Synchronous Settlement\"\n        ReservationPay[\"Reservation\u003cbr/\u003ePayment\"]\n        FinalPay[\"Final Vehicle\u003cbr/\u003ePayment\"]\n        BlockingValidation[\"Blocking\u003cbr/\u003eValidation\"]\n        \n        ReservationPay --\u003e BlockingValidation\n        FinalPay --\u003e BlockingValidation\n        BlockingValidation --\u003e NoDeliveryWithoutConfirm[\"No Delivery\u003cbr/\u003eWithout Confirmation\"]\n    end\n    \n    subgraph \"Medium Risk: Service Payments\"\n        ServicePay[\"One-Time\u003cbr/\u003eService Payment\"]\n        ImmediateDeliver[\"Immediate\u003cbr/\u003eOTA Delivery\"]\n        AsyncSettle[\"Asynchronous\u003cbr/\u003eSettlement\"]\n        \n        ServicePay --\u003e ImmediateDeliver\n        ImmediateDeliver --\u003e AsyncSettle\n        AsyncSettle --\u003e RiskAssumed[\"CaaS Assumes\u003cbr/\u003eSettlement Risk\"]\n    end\n    \n    subgraph \"High Risk: Subscription\"\n        SubActivate[\"Subscription\u003cbr/\u003eActivation\"]\n        MonthUsage[\"Customer\u003cbr/\u003eUses Service\"]\n        MonthEnd[\"Month\u003cbr/\u003eEnds\"]\n        ChargeVencido[\"Charge\u003cbr/\u003eMes Vencido\"]\n        \n        SubActivate --\u003e MonthUsage\n        MonthUsage --\u003e MonthEnd\n        MonthEnd --\u003e ChargeVencido\n        ChargeVencido --\u003e CollectionRisk[\"Collection\u003cbr/\u003eRisk\"]\n    end\n```\n\n### Risk Mitigation by Type\n\n**Reservation and Final Payments:**\n- **Strategy:** Synchronous settlement required before proceeding\n- **Rationale:** High value transactions (vehicle purchase) require confirmed payment\n- **Consequence of Failure:** Vehicle marked \"sin asignar\" (unassigned), becomes stock for immediate sale, customer loses reservation\n\n**One-Time Service Payments:**\n- **Strategy:** Immediate delivery with asynchronous settlement\n- **Rationale:** Lower transaction values, known customer base, improved experience\n- **Mitigation:** Customer already owns vehicle and has payment history with CaaS\n- **Consequence of Failure:** Potential chargeback, but service already delivered\n\n**Subscription Payments (Mes Vencido):**\n- **Strategy:** Post-paid billing (charge at month end for consumed services)\n- **Rationale:** Reduces upfront friction, aligns with utility billing models\n- **Risk:** Customer uses service for entire month before being charged\n- **Mitigation:** Subscription cancellation upon payment failure, dunning processes required\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-82](), [pasame las preguntas y sus respuestas a markdown.md:26-28]()\n\n---\n\n## Settlement State Machine\n\nEach payment transaction progresses through multiple states from initiation to final reconciliation.\n\n### Settlement State Diagram\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e PaymentInitiated: \"Customer Submits Payment\"\n    \n    PaymentInitiated --\u003e ServiceDelivered: \"CaaS Delivers\u003cbr/\u003eService Immediately\"\n    PaymentInitiated --\u003e WaitingSettlement: \"For High-Value\u003cbr/\u003eTransactions\"\n    \n    ServiceDelivered --\u003e SettlementPending: \"Settlement\u003cbr/\u003eIn Progress\"\n    WaitingSettlement --\u003e SettlementPending: \"Processing\"\n    \n    SettlementPending --\u003e SettlementConfirmed: \"Bank Confirms\"\n    SettlementPending --\u003e SettlementFailed: \"Bank Declines\"\n    SettlementPending --\u003e SettlementTimeout: \"No Response\u003cbr/\u003e(Rare)\"\n    \n    SettlementConfirmed --\u003e Reconciled: \"Match Payment\u003cbr/\u003eto Service\"\n    \n    SettlementFailed --\u003e RefundRequired: \"If Service\u003cbr/\u003eDelivered\"\n    SettlementFailed --\u003e PaymentRetry: \"If Service\u003cbr/\u003eNot Delivered\"\n    SettlementTimeout --\u003e ManualReview: \"Escalate to\u003cbr/\u003eFinance Team\"\n    \n    PaymentRetry --\u003e PaymentInitiated: \"Retry Payment\"\n    RefundRequired --\u003e Reconciled: \"Process Refund\"\n    ManualReview --\u003e Reconciled: \"Manual Resolution\"\n    \n    Reconciled --\u003e [*]\n    \n    note right of ServiceDelivered\n        Risk Assumption Point:\n        Service delivered before\n        settlement confirmation\n    end note\n    \n    note right of SettlementFailed\n        Critical: Service already\n        delivered cannot be\n        revoked remotely\n    end note\n```\n\n### State Definitions\n\n| State | Description | System Actions Required |\n|-------|-------------|------------------------|\n| `PaymentInitiated` | Payment gateway has accepted the transaction | Log transaction, generate reference ID |\n| `ServiceDelivered` | OTA activation completed successfully | Update service database, send confirmation to customer |\n| `SettlementPending` | Awaiting bank confirmation | Monitor settlement notifications, track timeout |\n| `SettlementConfirmed` | Bank has confirmed money transfer | Update billing database, close transaction |\n| `SettlementFailed` | Bank declined or payment reversed | Alert finance team, evaluate refund necessity |\n| `SettlementTimeout` | No settlement notification received within expected timeframe | Escalate to manual review, query payment gateway |\n| `Reconciled` | Payment matched to service, transaction complete | Archive transaction, update reporting |\n\n**Sources:** Diagram 6 from high-level architecture\n\n---\n\n## Customer Protection Mechanisms\n\nCaaS implements strict customer protection rules that override financial considerations in specific scenarios.\n\n### The \"No Charge for Failed Delivery\" Rule\n\n**Critical Business Rule:** If service activation fails (OTA activation unsuccessful after all retries), **DO NOT CHARGE the customer**.\n\n```mermaid\ngraph TD\n    ServicePurchase[\"Service\u003cbr/\u003ePurchase Initiated\"]\n    PaymentProcessed[\"Payment\u003cbr/\u003eInitiated\"]\n    \n    OTAAttempt[\"OTA Activation\u003cbr/\u003eAttempt\"]\n    OTASuccess{\"OTA\u003cbr/\u003eSuccess?\"}\n    OTARetry[\"Retry\u003cbr/\u003eLogic\"]\n    AllRetriesFailed[\"All Retries\u003cbr/\u003eFailed\"]\n    \n    TechSupport[\"Escalate to\u003cbr/\u003eTech Support\"]\n    ReverseCharge[\"REVERSE CHARGE\u003cbr/\u003eCustomer NOT Charged\"]\n    NotifyCustomer[\"Notify Customer:\u003cbr/\u003eService Unavailable\"]\n    \n    ServiceActive[\"Service\u003cbr/\u003eActivated\"]\n    ChargeConfirmed[\"Customer\u003cbr/\u003eCharged\"]\n    \n    ServicePurchase --\u003e PaymentProcessed\n    PaymentProcessed --\u003e OTAAttempt\n    \n    OTAAttempt --\u003e OTASuccess\n    OTASuccess --\u003e|\"Yes\"| ServiceActive\n    OTASuccess --\u003e|\"No\"| OTARetry\n    \n    OTARetry --\u003e OTAAttempt\n    OTARetry --\u003e AllRetriesFailed\n    \n    AllRetriesFailed --\u003e TechSupport\n    TechSupport --\u003e ReverseCharge\n    ReverseCharge --\u003e NotifyCustomer\n    \n    ServiceActive --\u003e ChargeConfirmed\n    \n    Note1[\"Critical Rule:\u003cbr/\u003eNever charge for\u003cbr/\u003eundelivered service\"]\n    Note2[\"Payment may already\u003cbr/\u003ebe settled - refund\u003cbr/\u003emust be processed\"]\n    \n    ReverseCharge -.-\u003e Note1\n    AllRetriesFailed -.-\u003e Note2\n```\n\n### Implementation Requirements\n\nThe \"no charge\" rule requires specific implementation capabilities:\n\n| Scenario | Payment Status | Required Action | Implementation |\n|----------|---------------|-----------------|----------------|\n| **Pre-Settlement Failure** | Payment initiated but not settled | Cancel payment transaction | Call payment gateway cancel API |\n| **Post-Settlement Failure** | Payment already settled with bank | Issue refund | Process refund transaction |\n| **Partial Settlement** | Payment in settlement process | Cancel if possible, otherwise refund | Check settlement state, then cancel or refund |\n\n### Reconciliation Process for Failed Activations\n\n```mermaid\nsequenceDiagram\n    participant OTAEngine as \"OTA Engine\"\n    participant PaymentSystem as \"Payment System\"\n    participant PaymentGateway as \"Payment Gateway\"\n    participant Customer\n    \n    OTAEngine-\u003e\u003eOTAEngine: \"All Retries Failed\"\n    OTAEngine-\u003e\u003ePaymentSystem: \"Query Payment Status\"\n    \n    alt Payment NOT Yet Settled\n        PaymentSystem-\u003e\u003ePaymentGateway: \"Cancel Transaction\"\n        PaymentGateway--\u003e\u003ePaymentSystem: \"Cancellation Confirmed\"\n        PaymentSystem--\u003e\u003eOTAEngine: \"Payment Cancelled\"\n    else Payment Already Settled\n        PaymentSystem-\u003e\u003ePaymentGateway: \"Issue Refund\"\n        PaymentGateway--\u003e\u003ePaymentSystem: \"Refund Processed\"\n        PaymentSystem--\u003e\u003eOTAEngine: \"Customer Refunded\"\n    end\n    \n    OTAEngine-\u003e\u003eCustomer: \"Notify: Service Unavailable,\u003cbr/\u003eNo Charge Applied\"\n    \n    Note over OTAEngine,Customer: Customer Protection:\u003cbr/\u003eNever charged for undelivered service\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:47-53](), Diagram 6 from high-level architecture\n\n---\n\n## Settlement Reconciliation Process\n\nThe reconciliation process matches payment settlements to delivered services and resolves discrepancies.\n\n### Reconciliation Architecture\n\n```mermaid\ngraph TD\n    subgraph \"Data Sources\"\n        ServiceDB[(\"Service Database\u003cbr/\u003eActivations \u0026 History\")]\n        PaymentDB[(\"Payment Database\u003cbr/\u003eInitiated Transactions\")]\n        SettlementFeed[\"Settlement Notifications\u003cbr/\u003efrom Gateway\"]\n    end\n    \n    subgraph \"Reconciliation Engine\"\n        MatchProcess[\"Match Settlement\u003cbr/\u003eto Service\"]\n        StateCheck{\"States\u003cbr/\u003eMatch?\"}\n        \n        MatchProcess --\u003e StateCheck\n    end\n    \n    subgraph \"Reconciliation Outcomes\"\n        Matched[\"Matched:\u003cbr/\u003eService Delivered\u003cbr/\u003ePayment Settled\"]\n        \n        SettledNoService[\"Settled but\u003cbr/\u003eNo Service\u003cbr/\u003eDelivered\"]\n        \n        ServiceNoSettlement[\"Service Delivered\u003cbr/\u003ebut No Settlement\"]\n        \n        SettlementFailed[\"Settlement\u003cbr/\u003eFailed\"]\n    end\n    \n    subgraph \"Resolution Actions\"\n        IssueRefund[\"Issue\u003cbr/\u003eRefund\"]\n        RetryPayment[\"Retry Payment\u003cbr/\u003eCollection\"]\n        DeactivateService[\"Deactivate\u003cbr/\u003eService\"]\n        ManualReview[\"Manual\u003cbr/\u003eReview\"]\n    end\n    \n    ServiceDB --\u003e MatchProcess\n    PaymentDB --\u003e MatchProcess\n    SettlementFeed --\u003e MatchProcess\n    \n    StateCheck --\u003e|\"Yes\"| Matched\n    StateCheck --\u003e|\"No\"| SettledNoService\n    StateCheck --\u003e|\"No\"| ServiceNoSettlement\n    StateCheck --\u003e|\"No\"| SettlementFailed\n    \n    SettledNoService --\u003e IssueRefund\n    ServiceNoSettlement --\u003e RetryPayment\n    SettlementFailed --\u003e DeactivateService\n    \n    IssueRefund --\u003e ManualReview\n    RetryPayment --\u003e ManualReview\n    \n    SettlementFailed --\u003e IssueRefund\n```\n\n### Reconciliation Scenarios\n\n| Scenario | Service Status | Payment Status | Settlement Status | Action Required |\n|----------|---------------|----------------|-------------------|-----------------|\n| **Normal Flow** | Delivered | Initiated | Confirmed | Close transaction (no action) |\n| **OTA Failure** | Failed | Initiated | Pending | Cancel payment or refund if settled |\n| **Settlement Failure** | Delivered | Initiated | Failed | Contact customer for alternate payment |\n| **Orphan Settlement** | Not Found | Initiated | Confirmed | Investigate missing service record |\n| **Orphan Service** | Delivered | Not Found | N/A | Investigate missing payment record |\n| **Chargeback** | Delivered | Initiated | Reversed | Service remains active, accept loss |\n\n### Reconciliation Timing\n\n```mermaid\ngantt\n    title Settlement Reconciliation Timeline\n    dateFormat HH:mm\n    axisFormat %H:%M\n    \n    section Payment\n    Payment Initiated           :milestone, m1, 00:00, 0m\n    \n    section Service\n    OTA Activation Started      :active, ota1, 00:01, 5m\n    Service Delivered           :milestone, m2, 00:06, 0m\n    \n    section Settlement\n    Settlement Processing       :settlement, 00:00, 4h\n    Settlement Confirmed        :milestone, m3, 04:00, 0m\n    \n    section Reconciliation\n    Initial State Check         :recon1, 00:06, 10m\n    Settlement Notification     :milestone, m4, 04:00, 0m\n    Final Reconciliation        :recon2, 04:00, 30m\n    Transaction Closed          :milestone, m5, 04:30, 0m\n```\n\n**Reconciliation Windows:**\n- **Immediate:** Service delivery triggers initial reconciliation check (confirm payment initiated)\n- **Short-Term:** Hourly reconciliation batch to identify pending settlements\n- **Medium-Term:** Daily reconciliation to identify failed settlements or timeouts\n- **Long-Term:** Weekly review of unreconciled transactions for manual intervention\n\n**Sources:** Diagram 6 from high-level architecture\n\n---\n\n## Risk Management Strategies\n\nCaaS employs multiple strategies to mitigate the financial risks associated with immediate service delivery.\n\n### Multi-Layered Risk Mitigation\n\n| Layer | Strategy | Effectiveness |\n|-------|----------|---------------|\n| **1. Customer Verification** | Only registered customers who purchased vehicles can access services | Eliminates anonymous fraud risk |\n| **2. Payment History** | Track customer payment behavior, flag problematic accounts | Identifies high-risk customers |\n| **3. Transaction Limits** | Cap maximum one-time service value | Limits per-transaction exposure |\n| **4. Fraud Detection** | Monitor for unusual patterns (rapid purchases, geographic anomalies) | Proactive fraud prevention |\n| **5. Settlement Monitoring** | Real-time tracking of settlement confirmations | Early detection of issues |\n| **6. Subscription Dunning** | Automated collection process for failed subscription payments | Reduces subscription payment risk |\n| **7. Service Deactivation** | Remote deactivation of services for non-payment (subscriptions only) | Recovers unpaid subscription services |\n\n### Financial Risk Controls\n\n```mermaid\ngraph LR\n    subgraph \"Pre-Transaction Controls\"\n        CustomerCheck[\"Customer\u003cbr/\u003eVerification\"]\n        PaymentHistory[\"Payment\u003cbr/\u003eHistory Check\"]\n        FraudCheck[\"Fraud\u003cbr/\u003eDetection\"]\n    end\n    \n    subgraph \"Transaction Monitoring\"\n        RealTimeMonitor[\"Real-Time\u003cbr/\u003eSettlement Monitor\"]\n        AlertThreshold[\"Alert\u003cbr/\u003eThresholds\"]\n    end\n    \n    subgraph \"Post-Transaction Controls\"\n        ReconciliationBatch[\"Reconciliation\u003cbr/\u003eBatch Jobs\"]\n        DunningProcess[\"Dunning\u003cbr/\u003eProcess\"]\n        ManualReview[\"Manual\u003cbr/\u003eReview Queue\"]\n    end\n    \n    subgraph \"Risk Metrics\"\n        ChargebackRate[\"Chargeback\u003cbr/\u003eRate\"]\n        SettlementFailRate[\"Settlement\u003cbr/\u003eFail Rate\"]\n        CollectionRate[\"Collection\u003cbr/\u003eSuccess Rate\"]\n    end\n    \n    CustomerCheck --\u003e RealTimeMonitor\n    PaymentHistory --\u003e RealTimeMonitor\n    FraudCheck --\u003e RealTimeMonitor\n    \n    RealTimeMonitor --\u003e AlertThreshold\n    AlertThreshold --\u003e ManualReview\n    \n    RealTimeMonitor --\u003e ReconciliationBatch\n    ReconciliationBatch --\u003e DunningProcess\n    DunningProcess --\u003e ManualReview\n    \n    ReconciliationBatch --\u003e ChargebackRate\n    ReconciliationBatch --\u003e SettlementFailRate\n    DunningProcess --\u003e CollectionRate\n```\n\n### Key Risk Metrics\n\n**Operational Metrics:**\n- **Settlement Confirmation Rate:** Percentage of payments that settle successfully\n- **Settlement Delay:** Average time between payment initiation and settlement confirmation\n- **Chargeback Rate:** Percentage of settled payments later reversed by customer/bank\n- **OTA Failure Rate:** Percentage of service deliveries requiring refund due to activation failure\n\n**Financial Metrics:**\n- **Risk Exposure:** Total value of services delivered but not yet settled\n- **Outstanding Receivables:** Total value of settled payments awaiting reconciliation\n- **Write-Off Rate:** Percentage of delivered services never collected (chargebacks, failed settlements)\n- **Subscription Collection Rate:** Percentage of mes vencido charges successfully collected\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-82](), Diagram 6 from high-level architecture\n\n---\n\n## Subscription-Specific Risk Management\n\nSubscription services (mes vencido billing) present unique risk challenges requiring specialized handling.\n\n### Mes Vencido (Post-Paid) Risk Profile\n\n```mermaid\ngraph TD\n    SubStart[\"Subscription\u003cbr/\u003eActivated\"]\n    Month1[\"Month 1:\u003cbr/\u003eService Used\"]\n    MonthEnd[\"Month End\"]\n    \n    ChargeAttempt[\"Attempt Charge\u003cbr/\u003efor Consumed Services\"]\n    ChargeSuccess{\"Payment\u003cbr/\u003eSuccessful?\"}\n    \n    Month2[\"Month 2:\u003cbr/\u003eContinue Service\"]\n    \n    Dunning[\"Dunning\u003cbr/\u003eProcess\"]\n    DunningRetry[\"Retry Payment\u003cbr/\u003e(Multiple Attempts)\"]\n    DunningFail{\"Payment\u003cbr/\u003eRecovered?\"}\n    \n    CancelSub[\"Cancel\u003cbr/\u003eSubscription\"]\n    DeactivateService[\"Deactivate\u003cbr/\u003eService via OTA\"]\n    \n    SubStart --\u003e Month1\n    Month1 --\u003e MonthEnd\n    MonthEnd --\u003e ChargeAttempt\n    \n    ChargeAttempt --\u003e ChargeSuccess\n    ChargeSuccess --\u003e|\"Yes\"| Month2\n    ChargeSuccess --\u003e|\"No\"| Dunning\n    \n    Dunning --\u003e DunningRetry\n    DunningRetry --\u003e DunningFail\n    \n    DunningFail --\u003e|\"Yes\"| Month2\n    DunningFail --\u003e|\"No\"| CancelSub\n    \n    CancelSub --\u003e DeactivateService\n    \n    Month2 --\u003e MonthEnd\n    \n    RiskNote[\"Risk: Customer uses\u003cbr/\u003eservice entire month\u003cbr/\u003ebefore being charged\"]\n    CollectionNote[\"Collection difficult:\u003cbr/\u003eNo leverage until\u003cbr/\u003enext month\"]\n    \n    Month1 -.-\u003e RiskNote\n    Dunning -.-\u003e CollectionNote\n```\n\n### Subscription Risk Mitigation\n\n| Risk Factor | Mitigation Strategy | Implementation |\n|-------------|-------------------|----------------|\n| **Usage Before Payment** | Accept risk as part of business model | Monitor usage patterns, flag excessive use |\n| **Payment Failure** | Automated dunning process with multiple retry attempts | Retry on days 1, 3, 7, 14 after month end |\n| **Chronic Non-Payment** | Service deactivation and subscription cancellation | OTA deactivation command after dunning failure |\n| **Reactivation After Default** | Require upfront payment for reinstatement | Block subscription reactivation without payment |\n| **Multiple Subscription Fraud** | Limit subscriptions per customer | System validation on subscription purchase |\n\n### Dunning Process Flow\n\n```mermaid\nsequenceDiagram\n    participant System as \"Billing System\"\n    participant Gateway as \"Payment Gateway\"\n    participant Customer\n    participant OTA as \"OTA Engine\"\n    \n    Note over System: Month End Reached\n    System-\u003e\u003eGateway: \"Charge for Month's Usage\"\n    Gateway--\u003e\u003eSystem: \"Payment Failed\"\n    \n    System-\u003e\u003eCustomer: \"Payment Failed Notification\u003cbr/\u003e(Day 1)\"\n    \n    Note over System: Wait 2 Days\n    \n    System-\u003e\u003eGateway: \"Retry Payment (Attempt 2)\"\n    Gateway--\u003e\u003eSystem: \"Payment Failed\"\n    System-\u003e\u003eCustomer: \"2nd Failure Notice (Day 3)\"\n    \n    Note over System: Wait 4 Days\n    \n    System-\u003e\u003eGateway: \"Retry Payment (Attempt 3)\"\n    Gateway--\u003e\u003eSystem: \"Payment Failed\"\n    System-\u003e\u003eCustomer: \"Final Notice (Day 7)\"\n    \n    Note over System: Wait 7 Days\n    \n    System-\u003e\u003eGateway: \"Final Retry (Attempt 4)\"\n    Gateway--\u003e\u003eSystem: \"Payment Failed\"\n    \n    System-\u003e\u003eOTA: \"Deactivate Subscription Services\"\n    OTA--\u003e\u003eSystem: \"Services Deactivated\"\n    System-\u003e\u003eCustomer: \"Subscription Cancelled\u003cbr/\u003eServices Deactivated\"\n    \n    Note over System,Customer: Customer must pay arrears\u003cbr/\u003efor reactivation\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-82]()\n\n---\n\n## Settlement Risk Dashboard (Conceptual)\n\nFor operational monitoring, CaaS requires a real-time risk dashboard tracking settlement health and financial exposure.\n\n### Dashboard Metrics\n\n| Metric Category | Key Indicators | Alert Thresholds |\n|----------------|----------------|------------------|\n| **Exposure** | Total unsettled service value | \u003e 50,000 |\n| | Number of unreconciled transactions | \u003e 100 |\n| | Average settlement delay | \u003e 48 hours |\n| **Performance** | Settlement success rate | \u003c 95% |\n| | OTA activation success rate | \u003c 98% |\n| | Reconciliation error rate | \u003e 2% |\n| **Collections** | Subscription payment failure rate | \u003e 10% |\n| | Dunning recovery rate | \u003c 60% |\n| | Chargeback rate | \u003e 1% |\n| **Customer Impact** | Failed activation refunds (last 7 days) | \u003e 10 |\n| | Customer complaints related to payment | \u003e 5 per week |\n\n### Risk Trend Analysis\n\n```mermaid\ngraph LR\n    subgraph \"Daily Monitoring\"\n        UnsettledValue[\"Unsettled\u003cbr/\u003eService Value\"]\n        PendingRecon[\"Pending\u003cbr/\u003eReconciliation\u003cbr/\u003eCount\"]\n        FailedSettlements[\"Failed\u003cbr/\u003eSettlements\"]\n    end\n    \n    subgraph \"Weekly Analysis\"\n        TrendAnalysis[\"Trend\u003cbr/\u003eAnalysis\"]\n        RiskScore[\"Risk\u003cbr/\u003eScore\u003cbr/\u003eCalculation\"]\n    end\n    \n    subgraph \"Monthly Review\"\n        WriteOffAnalysis[\"Write-Off\u003cbr/\u003eAnalysis\"]\n        PolicyReview[\"Policy\u003cbr/\u003eAdjustment\"]\n        LimitReview[\"Transaction\u003cbr/\u003eLimit Review\"]\n    end\n    \n    UnsettledValue --\u003e TrendAnalysis\n    PendingRecon --\u003e TrendAnalysis\n    FailedSettlements --\u003e TrendAnalysis\n    \n    TrendAnalysis --\u003e RiskScore\n    RiskScore --\u003e WriteOffAnalysis\n    \n    WriteOffAnalysis --\u003e PolicyReview\n    WriteOffAnalysis --\u003e LimitReview\n```\n\n**Sources:** Based on risk management best practices for asynchronous payment systems\n\n---\n\n## Integration with Other Financial Processes\n\nSettlement reconciliation integrates with multiple financial and operational processes within CaaS.\n\n### Cross-Functional Dependencies\n\n```mermaid\ngraph TD\n    Settlement[\"Settlement\u003cbr/\u003eReconciliation\"]\n    \n    subgraph \"Upstream Dependencies\"\n        PaymentProc[\"Payment\u003cbr/\u003eProcessing\"]\n        OTAActivation[\"OTA\u003cbr/\u003eActivation\"]\n        ServiceCatalog[\"Service\u003cbr/\u003eCatalog\"]\n    end\n    \n    subgraph \"Downstream Consumers\"\n        Invoicing[\"Invoice\u003cbr/\u003eGeneration\"]\n        Accounting[\"Accounting\u003cbr/\u003eSystem\"]\n        CustomerSupport[\"Customer\u003cbr/\u003eSupport\"]\n        Reporting[\"Financial\u003cbr/\u003eReporting\"]\n    end\n    \n    subgraph \"Parallel Processes\"\n        RefundMgmt[\"Refund\u003cbr/\u003eManagement\"]\n        DesistimientoProc[\"Desistimiento\u003cbr/\u003eProcessing\"]\n        WarrantyMgmt[\"Warranty\u003cbr/\u003eManagement\"]\n    end\n    \n    PaymentProc --\u003e Settlement\n    OTAActivation --\u003e Settlement\n    ServiceCatalog --\u003e Settlement\n    \n    Settlement --\u003e Invoicing\n    Settlement --\u003e Accounting\n    Settlement --\u003e CustomerSupport\n    Settlement --\u003e Reporting\n    \n    Settlement \u003c--\u003e RefundMgmt\n    Settlement \u003c--\u003e DesistimientoProc\n    DesistimientoProc \u003c--\u003e RefundMgmt\n```\n\n### Integration Points\n\n| System | Integration Type | Data Exchange | Timing |\n|--------|-----------------|---------------|---------|\n| **Payment Processing** | Inbound | Payment initiation events, settlement notifications | Real-time + batch |\n| **OTA Engine** | Inbound | Activation success/failure events | Real-time |\n| **Refund Management** | Bidirectional | Refund requests (outbound), refund confirmations (inbound) | Near real-time |\n| **Invoice Generation** | Outbound | Confirmed payment records | Daily batch |\n| **Accounting System** | Outbound | Revenue recognition, receivables | Daily batch |\n| **Customer Support** | Outbound | Payment status, refund status | On-demand API |\n| **Financial Reporting** | Outbound | Settlement metrics, write-offs | Daily/Monthly batch |\n\n**Sources:** Diagram 2 from high-level architecture\n\n---\n\n## Summary\n\nThe CaaS risk management and settlement strategy represents a deliberate business decision to prioritize customer experience over financial risk minimization. Key principles include:\n\n1. **Immediate Service Delivery:** Services are activated upon payment initiation, before settlement confirmation\n2. **Risk Assumption:** CaaS accepts settlement risk, potential chargebacks, and collection challenges\n3. **Customer Protection:** Failed service activations never result in customer charges, even if payment has settled\n4. **Differentiated Risk:** Payment types have different risk profiles (synchronous for vehicle, asynchronous for services)\n5. **Post-Paid Subscriptions:** Mes vencido billing maximizes customer convenience but increases collection risk\n6. **Robust Reconciliation:** Comprehensive reconciliation processes ensure payment-service matching and resolve discrepancies\n\nThis architecture requires sophisticated monitoring, reconciliation, and dunning capabilities to manage the inherent financial risks while maintaining the customer-first service delivery model.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:76-96](), Diagrams 2 and 6 from high-level architecture"])</script><script>self.__next_f.push([1,"2f:T6921,"])</script><script>self.__next_f.push([1,"# Operational Processes\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document provides a comprehensive overview of the key operational workflows and business processes that execute within the CaaS platform. It describes how different operational activities coordinate to deliver the Car as a Service business model from initial sale through ongoing service delivery.\n\nThis page focuses on the **operational execution layer** - the concrete processes, workflows, and procedural steps that implement the business model described in [Business Model and Concept](#2). For detailed information on specific operational areas, see:\n- Sales and order management procedures: [Sales and Order Management](#8.1)\n- Manufacturing tracking and vehicle delivery: [Manufacturing and Delivery Workflow](#8.2)\n- Maintenance plan execution: [Maintenance Management](#8.3)\n\nFor payment-specific workflows, see [Payment and Billing](#7). For service lifecycle processes, see [Service Lifecycle Management](#6).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Overview of Operational Workflows\n\nThe CaaS system orchestrates multiple concurrent operational workflows that span from initial customer acquisition through the complete vehicle ownership lifecycle. These processes involve coordination between dealerships, factories, transport companies, administrative bodies, workshops, and customers.\n\n### Primary Operational Domains\n\n| Operational Domain | Key Activities | Primary Systems | External Actors |\n|-------------------|----------------|-----------------|-----------------|\n| **Sales Operations** | Customer registration, plan configuration, credential generation, reservation processing | Corporate Intranet | Dealership employees, customers |\n| **Order Fulfillment** | Factory order placement, manufacturing tracking, status notifications | Factory API, notification engine | Factory, transport companies |\n| **Vehicle Registration** | Administrative registration, matriculation processing | Admin API | Government administrative bodies |\n| **Delivery Operations** | Transport coordination, home delivery, customer handoff, mobile app linking | Transport coordination system, mobile app | Transport companies, customers |\n| **Service Operations** | Service catalog browsing, payment processing, OTA activation, retry handling | Service catalog, OTA engine, API IoT | Customers, vehicles |\n| **Maintenance Operations** | Maintenance status tracking, service eligibility verification, warranty management | VSS integration | Workshops, customers |\n| **Notification Operations** | Multi-channel customer communication, status updates, alert delivery | Notification engine | Customers |\n\n**Sources:** [enunciado.md:8-23](), [pasame las preguntas y sus respuestas a markdown.md:18-53]()\n\n---\n\n## Complete Customer Lifecycle Workflow\n\nThe following diagram illustrates the end-to-end operational workflow from initial sale through ongoing service delivery, showing the sequence of operational steps and decision points.\n\n**Diagram: Complete Operational Process Flow**\n\n```mermaid\nflowchart TD\n    Start[\"Customer visits dealership\"]\n    \n    subgraph \"Sales Operations (8.1)\"\n        SalesReg[\"Employee registers sale\u003cbr/\u003ein corporate intranet\"]\n        CaptureData[\"Capture customer data\u003cbr/\u003e+ plan comercial\"]\n        GenCreds[\"System generates\u003cbr/\u003eaccess credentials\"]\n        EmailCreds[\"Email credentials\u003cbr/\u003eto customer\"]\n        PayReserv[\"Customer pays\u003cbr/\u003ereservation signal\"]\n    end\n    \n    subgraph \"Order Fulfillment (8.2)\"\n        AutoOrder[\"System automatically places\u003cbr/\u003efactory order via API\"]\n        MfgTracking[\"Track manufacturing status\u003cbr/\u003evia async notifications\"]\n        NotifyProgress[\"Send status updates\u003cbr/\u003eto customer\"]\n        VehicleReady[\"Vehicle ready\u003cbr/\u003eat factory\"]\n    end\n    \n    subgraph \"Payment and Registration\"\n        NotifyAvail[\"Notify customer\u003cbr/\u003evehicle available\"]\n        FinalPayment[\"Customer completes\u003cbr/\u003efinal payment\"]\n        PaymentCheck{Payment\u003cbr/\u003esuccessful?}\n        RegisterVehicle[\"Register vehicle\u003cbr/\u003ewith admin bodies\"]\n        MarkUnassigned[\"Mark vehicle\u003cbr/\u003e'sin asignar'\"]\n        MoveStock[\"Move to dealership\u003cbr/\u003estock for sale\"]\n    end\n    \n    subgraph \"Delivery Operations (8.2)\"\n        ArrangeTransport[\"Arrange transport\u003cbr/\u003eto customer address\"]\n        AttemptDelivery[\"Attempt home\u003cbr/\u003edelivery\"]\n        DeliveryCheck{Customer\u003cbr/\u003epresent?}\n        LinkMobile[\"Link mobile app\u003cbr/\u003eto vehicle\"]\n        ReturnDealer[\"Return vehicle\u003cbr/\u003eto dealership\"]\n        CustomerPickup[\"Customer picks up\u003cbr/\u003eat dealership\"]\n    end\n    \n    subgraph \"Service Operations (6.2)\"\n        VehicleActive[\"Vehicle operational\u003cbr/\u003ewith plataforma base\"]\n        CustomerBrowse[\"Customer browses\u003cbr/\u003eservice catalog\"]\n        CheckMaint[\"Check maintenance\u003cbr/\u003estatus via VSS\"]\n        MaintOK{Maintenance\u003cbr/\u003ecurrent?}\n        SelectService[\"Customer selects\u003cbr/\u003eservice and pays\"]\n        OTAActivation[\"OTA activation\u003cbr/\u003evia API IoT\"]\n        RetryLogic[\"Retry activation\u003cbr/\u003eif failed\"]\n        TechSupport[\"Escalate to\u003cbr/\u003etech support\"]\n        NoCharge[\"Do not charge\u003cbr/\u003ecustomer\"]\n    end\n    \n    subgraph \"Maintenance Operations (8.3)\"\n        MaintSchedule[\"Maintenance scheduled\u003cbr/\u003eper plan\"]\n        CustomerMaint[\"Customer takes vehicle\u003cbr/\u003eto workshop\"]\n        WorkshopRecord[\"Workshop records service\u003cbr/\u003ein VSS system\"]\n        UpdateStatus[\"VSS updates\u003cbr/\u003emaintenance status\"]\n    end\n    \n    Start --\u003e SalesReg\n    SalesReg --\u003e CaptureData\n    CaptureData --\u003e GenCreds\n    GenCreds --\u003e EmailCreds\n    EmailCreds --\u003e PayReserv\n    \n    PayReserv --\u003e AutoOrder\n    AutoOrder --\u003e MfgTracking\n    MfgTracking --\u003e NotifyProgress\n    NotifyProgress --\u003e VehicleReady\n    \n    VehicleReady --\u003e NotifyAvail\n    NotifyAvail --\u003e FinalPayment\n    FinalPayment --\u003e PaymentCheck\n    PaymentCheck --\u003e|Yes| RegisterVehicle\n    PaymentCheck --\u003e|No| MarkUnassigned\n    MarkUnassigned --\u003e MoveStock\n    MoveStock --\u003e End1[\"Customer loses\u003cbr/\u003ereservation\"]\n    \n    RegisterVehicle --\u003e ArrangeTransport\n    ArrangeTransport --\u003e AttemptDelivery\n    AttemptDelivery --\u003e DeliveryCheck\n    DeliveryCheck --\u003e|Yes| LinkMobile\n    DeliveryCheck --\u003e|No| ReturnDealer\n    ReturnDealer --\u003e CustomerPickup\n    CustomerPickup --\u003e LinkMobile\n    \n    LinkMobile --\u003e VehicleActive\n    \n    VehicleActive --\u003e CustomerBrowse\n    CustomerBrowse --\u003e CheckMaint\n    CheckMaint --\u003e MaintOK\n    MaintOK --\u003e|Yes| SelectService\n    MaintOK --\u003e|No| DenyService[\"Deny service\u003cbr/\u003eactivation\"]\n    DenyService --\u003e VehicleActive\n    \n    SelectService --\u003e OTAActivation\n    OTAActivation --\u003e ActivationCheck{Activation\u003cbr/\u003esuccessful?}\n    ActivationCheck --\u003e|Yes| ServiceActive[\"Service active\u003cbr/\u003eon vehicle\"]\n    ActivationCheck --\u003e|No| RetryLogic\n    RetryLogic --\u003e RetryCheck{Retries\u003cbr/\u003eremaining?}\n    RetryCheck --\u003e|Yes| OTAActivation\n    RetryCheck --\u003e|No| TechSupport\n    TechSupport --\u003e NoCharge\n    NoCharge --\u003e VehicleActive\n    \n    ServiceActive --\u003e VehicleActive\n    \n    VehicleActive --\u003e MaintSchedule\n    MaintSchedule --\u003e CustomerMaint\n    CustomerMaint --\u003e WorkshopRecord\n    WorkshopRecord --\u003e UpdateStatus\n    UpdateStatus --\u003e VehicleActive\n```\n\n**Sources:** [enunciado.md:8-23](), [pasame las preguntas y sus respuestas a markdown.md:18-96]()\n\n---\n\n## Process Integration and System Interactions\n\nThe operational processes require integration with multiple external systems and internal components. This section documents how processes interact with system components.\n\n**Diagram: Operational Process to System Component Mapping**\n\n```mermaid\ngraph TB\n    subgraph \"Operational Processes\"\n        SalesOps[\"Sales Operations\"]\n        OrderOps[\"Order Fulfillment\"]\n        DeliveryOps[\"Delivery Operations\"]\n        ServiceOps[\"Service Operations\"]\n        MaintOps[\"Maintenance Operations\"]\n        NotifOps[\"Notification Operations\"]\n    end\n    \n    subgraph \"Internal Systems\"\n        Intranet[\"Corporate Intranet\u003cbr/\u003eSales registration\"]\n        ExpedienteDB[\"Expediente de Compra\u003cbr/\u003eCustomer records\"]\n        ServiceCatalog[\"Service Catalog\u003cbr/\u003eOpciones disponibles\"]\n        PaymentProc[\"Payment Processing\"]\n        OTAEngine[\"OTA Activation Engine\u003cbr/\u003eRetry logic\"]\n        NotifEngine[\"Notification Engine\u003cbr/\u003eMulti-channel\"]\n    end\n    \n    subgraph \"External System APIs\"\n        FactoryAPI[\"Factory API\u003cbr/\u003eOrder + Status\"]\n        VSSAPI[\"VSS API\u003cbr/\u003eMaintenance queries\"]\n        IoTAPI[\"API IoT\u003cbr/\u003eVehicle communication\"]\n        AdminAPI[\"Admin API\u003cbr/\u003eRegistration\"]\n        PaymentGW[\"Payment Gateway\"]\n        TransportSys[\"Transport Coordination\u003cbr/\u003e(subcontracted)\"]\n    end\n    \n    subgraph \"Infrastructure\"\n        EmailSys[\"Email Service\"]\n        SMSSys[\"SMS Gateway\"]\n        PushSys[\"Push Notifications\"]\n        VehicleNetwork[\"IoT Network\u003cbr/\u003eVehicle fleet\"]\n    end\n    \n    SalesOps --\u003e Intranet\n    SalesOps --\u003e ExpedienteDB\n    SalesOps --\u003e EmailSys\n    SalesOps --\u003e PaymentProc\n    \n    OrderOps --\u003e FactoryAPI\n    OrderOps --\u003e NotifEngine\n    OrderOps --\u003e ExpedienteDB\n    \n    DeliveryOps --\u003e TransportSys\n    DeliveryOps --\u003e AdminAPI\n    DeliveryOps --\u003e NotifEngine\n    \n    ServiceOps --\u003e ServiceCatalog\n    ServiceOps --\u003e PaymentProc\n    ServiceOps --\u003e VSSAPI\n    ServiceOps --\u003e OTAEngine\n    \n    MaintOps --\u003e VSSAPI\n    \n    NotifOps --\u003e NotifEngine\n    NotifOps --\u003e EmailSys\n    NotifOps --\u003e SMSSys\n    NotifOps --\u003e PushSys\n    \n    PaymentProc --\u003e PaymentGW\n    OTAEngine --\u003e IoTAPI\n    IoTAPI --\u003e VehicleNetwork\n    \n    NotifEngine --\u003e EmailSys\n    NotifEngine --\u003e SMSSys\n    NotifEngine --\u003e PushSys\n```\n\n**Sources:** [enunciado.md:8-23](), [pasame las preguntas y sus respuestas a markdown.md:31-56]()\n\n---\n\n## Automated vs Manual Operational Steps\n\nUnderstanding which operational steps are automated versus manual is critical for system design and resource planning.\n\n| Process Step | Automation Level | Actor/System | Trigger |\n|--------------|-----------------|--------------|---------|\n| Sales registration in intranet | Manual entry | Dealership employee | Customer completes sale |\n| Customer credential generation | Fully automated | System | Sales registration complete |\n| Credential email delivery | Fully automated | Email service | Credentials generated |\n| Factory order placement | Fully automated | Factory API integration | Reservation payment received |\n| Manufacturing status notifications | Fully automated | Factory webhooks | Manufacturing milestones |\n| Customer status notifications | Fully automated | Notification engine | Factory status received |\n| Final payment processing | Manual initiation | Customer | Vehicle ready notification |\n| Vehicle registration with admin bodies | Automated API call | Admin API integration | Final payment confirmed |\n| Transport arrangement | Manual/Semi-automated | Dealership + Transport company | Vehicle registered |\n| Home delivery attempt | Manual | Transport driver | Transport scheduled |\n| Mobile app linking | Manual | Customer + Support | Vehicle delivered |\n| Service browsing | Manual | Customer | Customer initiative |\n| Maintenance status check | Fully automated | VSS API integration | Service selection |\n| Service payment processing | Automated | Payment gateway | Customer confirms purchase |\n| OTA service activation | Fully automated | OTA engine + API IoT | Payment successful |\n| OTA retry logic | Fully automated | OTA engine | Activation failure |\n| Technical support escalation | Automated alert | System  Support team | All retries failed |\n| Maintenance recording | Manual | Workshop technician | Service completed |\n\n**Sources:** [enunciado.md:8-23](), [pasame las preguntas y sus respuestas a markdown.md:18-53]()\n\n---\n\n## Operational State Tracking\n\nThe CaaS system must track multiple operational states across different entities. This section documents the key state machines that govern operational processes.\n\n### Vehicle Operational States\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Ordered: \"Factory order placed\"\n    \n    Ordered --\u003e InManufacturing: \"Manufacturing started\"\n    InManufacturing --\u003e ReadyAtFactory: \"Manufacturing complete\"\n    \n    ReadyAtFactory --\u003e PaymentPending: \"Customer notified\"\n    PaymentPending --\u003e Registered: \"Final payment received\"\n    PaymentPending --\u003e SinAsignar: \"Payment failed\"\n    \n    SinAsignar --\u003e DealershipStock: \"Marked for immediate sale\"\n    DealershipStock --\u003e [*]: \"Sold to different customer\"\n    \n    Registered --\u003e InTransit: \"Transport arranged\"\n    InTransit --\u003e DeliveryAttempt: \"Arrived at customer address\"\n    \n    DeliveryAttempt --\u003e Delivered: \"Customer present\"\n    DeliveryAttempt --\u003e AtDealership: \"Customer absent\"\n    \n    AtDealership --\u003e Delivered: \"Customer pickup\"\n    \n    Delivered --\u003e Operational: \"Mobile app linked\"\n    \n    Operational --\u003e Operational: \"Services activated/deactivated\"\n    \n    Operational --\u003e [*]: \"End of vehicle life\"\n```\n\n### Service Activation States\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ServiceSelected: \"Customer selects service\"\n    \n    ServiceSelected --\u003e MaintenanceCheck: \"System validates\"\n    MaintenanceCheck --\u003e PaymentInitiated: \"Maintenance OK\"\n    MaintenanceCheck --\u003e ServiceDenied: \"Maintenance overdue\"\n    \n    ServiceDenied --\u003e [*]: \"Service unavailable\"\n    \n    PaymentInitiated --\u003e OTAQueue: \"Payment successful\"\n    PaymentInitiated --\u003e PaymentFailed: \"Payment rejected\"\n    \n    PaymentFailed --\u003e [*]: \"Process terminated\"\n    \n    OTAQueue --\u003e OTAAttempt: \"Activation started\"\n    OTAAttempt --\u003e ServiceActive: \"Activation successful\"\n    OTAAttempt --\u003e RetryQueue: \"Activation failed\"\n    \n    RetryQueue --\u003e OTAAttempt: \"Retry N times\"\n    RetryQueue --\u003e TechnicalSupport: \"All retries exhausted\"\n    \n    TechnicalSupport --\u003e CustomerNotified: \"Support ticket created\"\n    CustomerNotified --\u003e NoCharge: \"Refund processed\"\n    \n    NoCharge --\u003e [*]: \"Service not delivered\"\n    \n    ServiceActive --\u003e [*]: \"Service delivered\"\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-96]()\n\n---\n\n## Notification Workflows\n\nNotifications are a critical operational component that keeps customers, employees, and support staff informed throughout all processes.\n\n**Diagram: Notification Triggers and Channels**\n\n```mermaid\nflowchart LR\n    subgraph \"Operational Triggers\"\n        T1[\"Sale registered\"]\n        T2[\"Manufacturing milestone\"]\n        T3[\"Vehicle ready\"]\n        T4[\"Payment confirmed\"]\n        T5[\"Vehicle in transit\"]\n        T6[\"Delivery attempted\"]\n        T7[\"Service activated\"]\n        T8[\"OTA failed\"]\n        T9[\"Maintenance due\"]\n    end\n    \n    subgraph \"Notification Engine\"\n        Router[\"Notification Router\u003cbr/\u003eRoute to channels\"]\n        Template[\"Template Engine\u003cbr/\u003eGenerate content\"]\n    end\n    \n    subgraph \"Delivery Channels\"\n        Email[\"Email Service\"]\n        SMS[\"SMS Gateway\"]\n        Push[\"Push Notifications\u003cbr/\u003eMobile app\"]\n        InApp[\"In-vehicle Display\u003cbr/\u003eVia API IoT\"]\n    end\n    \n    subgraph \"Recipients\"\n        Customer[\"Customer\"]\n        Employee[\"Dealership Staff\"]\n        Support[\"Technical Support\"]\n    end\n    \n    T1 --\u003e Router\n    T2 --\u003e Router\n    T3 --\u003e Router\n    T4 --\u003e Router\n    T5 --\u003e Router\n    T6 --\u003e Router\n    T7 --\u003e Router\n    T8 --\u003e Router\n    T9 --\u003e Router\n    \n    Router --\u003e Template\n    \n    Template --\u003e Email\n    Template --\u003e SMS\n    Template --\u003e Push\n    Template --\u003e InApp\n    \n    Email --\u003e Customer\n    Email --\u003e Employee\n    SMS --\u003e Customer\n    Push --\u003e Customer\n    InApp --\u003e Customer\n    Email --\u003e Support\n```\n\n### Notification Types and Timing\n\n| Event | Recipient | Channels | Timing | Priority |\n|-------|-----------|----------|--------|----------|\n| Credentials generated | Customer | Email | Immediate | High |\n| Order placed with factory | Customer | Email, Push | Immediate | Medium |\n| Manufacturing status update | Customer | Email, Push | As received from factory | Low |\n| Vehicle ready at factory | Customer | Email, SMS, Push | Immediate | High |\n| Payment successful | Customer | Email | Immediate | Medium |\n| Vehicle registered | Customer | Email | Immediate | Medium |\n| Vehicle in transit | Customer | Email, SMS, Push | When transport starts | High |\n| Delivery attempted - failed | Customer | SMS, Push | Immediate | High |\n| Mobile app linked | Customer | Push, In-app | Immediate | Medium |\n| Service activated | Customer | Push, In-app, Email | Immediate | Medium |\n| OTA activation failed | Customer | Email | After all retries | High |\n| OTA activation failed | Support | Email | After all retries | Critical |\n| Maintenance due soon | Customer | Email, Push | Based on schedule | Low |\n| Maintenance overdue | Customer | Email, SMS, Push | When overdue | High |\n| Service denied - maintenance | Customer | Push, In-app | Immediate | High |\n\n**Sources:** [enunciado.md:11-14](), [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n## Process Dependencies and Sequencing\n\nCertain operational processes have strict dependencies and must occur in specific sequences. Violations of these sequences can result in operational failures or business rule violations.\n\n### Critical Process Dependencies\n\n```mermaid\ngraph TD\n    subgraph \"Must Complete Before Vehicle Delivery\"\n        FinalPay[\"Final payment\u003cbr/\u003ereceived\"]\n        VehReg[\"Vehicle\u003cbr/\u003eregistered\"]\n        Transport[\"Transport\u003cbr/\u003earranged\"]\n    end\n    \n    subgraph \"Must Complete Before Service Activation\"\n        ServiceSel[\"Service\u003cbr/\u003eselected\"]\n        MaintCheck[\"Maintenance\u003cbr/\u003evalidated\"]\n        Payment[\"Payment\u003cbr/\u003eprocessed\"]\n    end\n    \n    subgraph \"Cannot Proceed Without\"\n        Reservation[\"Reservation\u003cbr/\u003epayment\"]\n        FactoryOrder[\"Factory\u003cbr/\u003eorder\"]\n        Manufacturing[\"Manufacturing\u003cbr/\u003ecomplete\"]\n    end\n    \n    Reservation --\u003e FactoryOrder\n    FactoryOrder --\u003e Manufacturing\n    Manufacturing --\u003e FinalPay\n    FinalPay --\u003e VehReg\n    VehReg --\u003e Transport\n    Transport --\u003e Delivery[\"Vehicle\u003cbr/\u003edelivery\"]\n    \n    ServiceSel --\u003e MaintCheck\n    MaintCheck --\u003e Payment\n    Payment --\u003e OTA[\"OTA\u003cbr/\u003eactivation\"]\n```\n\n### Dependency Rules\n\n| Dependent Process | Must Wait For | Reason | Exception Handling |\n|-------------------|---------------|--------|-------------------|\n| Factory order placement | Reservation payment | Financial commitment | None - hard requirement |\n| Vehicle registration | Final payment | Legal ownership transfer | Vehicle becomes \"sin asignar\" if payment fails |\n| Transport arrangement | Vehicle registration | Cannot transport unregistered vehicle | None |\n| Mobile app linking | Physical delivery | Security - customer must possess vehicle | None |\n| Service activation | Maintenance validation | Safety and warranty | Service denied if maintenance overdue |\n| Service delivery (OTA) | Payment confirmation | Business rule - pay before use | None - hard requirement |\n| Maintenance-dependent service | Current maintenance status | Safety and warranty | Blocks only specific services, not all |\n\n**Sources:** [enunciado.md:14-19](), [pasame las preguntas y sus respuestas a markdown.md:24-73]()\n\n---\n\n## Failure Handling and Operational Recovery\n\nOperational processes must handle various failure scenarios. This section documents the standard recovery procedures.\n\n### Standard Failure Recovery Patterns\n\n| Failure Scenario | Detection Method | Recovery Procedure | Customer Impact |\n|------------------|------------------|-------------------|-----------------|\n| Factory order API failure | Synchronous API error response | Retry with exponential backoff; alert dealership staff | Manual order placement if API down |\n| Payment gateway timeout | Timeout on payment confirmation | Assume success, reconcile async; deliver service | Service delivered; rare chargeback risk |\n| OTA activation failure | Status query after timeout | Retry N times; escalate to support; **do not charge** | No charge for failed service |\n| Delivery - customer absent | Driver contact attempt | Return to dealership; customer picks up | Slight delay; customer inconvenience |\n| Final payment failure | Payment gateway rejection | Mark vehicle \"sin asignar\"; move to stock | Customer loses reservation |\n| Maintenance status check failure | VSS API timeout/error | Deny service activation (fail-safe) | Service temporarily unavailable |\n| Vehicle registration API failure | Synchronous API error | Retry; manual registration if persistent | Delivery delayed |\n| Transport coordination failure | Manual escalation | Dealership arranges alternate transport | Delivery delayed |\n\n### Operational Escalation Paths\n\n```mermaid\nflowchart TD\n    OpFailure[\"Operational\u003cbr/\u003eFailure Detected\"]\n    \n    AutoRetry{Auto-retry\u003cbr/\u003epossible?}\n    RetryLogic[\"Execute retry\u003cbr/\u003ewith backoff\"]\n    RetrySuccess{Retry\u003cbr/\u003esuccessful?}\n    \n    ManualCheck{Manual\u003cbr/\u003eintervention\u003cbr/\u003epossible?}\n    AlertStaff[\"Alert dealership\u003cbr/\u003eor support staff\"]\n    ManualResolve[\"Staff resolves\u003cbr/\u003emanually\"]\n    \n    CustomerNotify[\"Notify customer\u003cbr/\u003eof issue\"]\n    CompensateCustomer[\"Apply customer\u003cbr/\u003ecompensation\"]\n    ProcessTerminate[\"Terminate process\u003cbr/\u003egracefully\"]\n    \n    OpFailure --\u003e AutoRetry\n    AutoRetry --\u003e|Yes| RetryLogic\n    AutoRetry --\u003e|No| ManualCheck\n    \n    RetryLogic --\u003e RetrySuccess\n    RetrySuccess --\u003e|Yes| Success[\"Process\u003cbr/\u003econtinues\"]\n    RetrySuccess --\u003e|No| ManualCheck\n    \n    ManualCheck --\u003e|Yes| AlertStaff\n    ManualCheck --\u003e|No| CustomerNotify\n    \n    AlertStaff --\u003e ManualResolve\n    ManualResolve --\u003e Resolution{Resolved?}\n    Resolution --\u003e|Yes| Success\n    Resolution --\u003e|No| CustomerNotify\n    \n    CustomerNotify --\u003e CompensateCustomer\n    CompensateCustomer --\u003e ProcessTerminate\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53](), [pasame las preguntas y sus respuestas a markdown.md:24-29]()\n\n---\n\n## Data Flow Across Operational Processes\n\nUnderstanding how data flows through operational processes is essential for maintaining data consistency and traceability.\n\n**Diagram: Data Entities and Process Flow**\n\n```mermaid\nflowchart LR\n    subgraph \"Sales Process Data\"\n        CustomerData[\"Customer Data\u003cbr/\u003eName, email, address\"]\n        PlanComercial[\"Plan Comercial\u003cbr/\u003eBase + options\"]\n        Credentials[\"Access Credentials\u003cbr/\u003eUsername, password\"]\n        ReservationPayment[\"Reservation Payment\u003cbr/\u003eAmount, method\"]\n    end\n    \n    subgraph \"Order Process Data\"\n        FactoryOrder[\"Factory Order\u003cbr/\u003eOrder ID, config\"]\n        MfgStatus[\"Manufacturing Status\u003cbr/\u003eProgress, ETA\"]\n        VehicleID[\"Vehicle ID\u003cbr/\u003eVIN assigned\"]\n    end\n    \n    subgraph \"Delivery Process Data\"\n        FinalPayment[\"Final Payment\u003cbr/\u003eFull amount\"]\n        RegistrationDoc[\"Registration Document\u003cbr/\u003eAdmin body ID\"]\n        TransportDetails[\"Transport Details\u003cbr/\u003eDate, driver, route\"]\n        DeliveryStatus[\"Delivery Status\u003cbr/\u003eSuccess/failed\"]\n    end\n    \n    subgraph \"Service Process Data\"\n        ServiceSelection[\"Service Selection\u003cbr/\u003eService ID, duration\"]\n        MaintenanceStatus[\"Maintenance Status\u003cbr/\u003eCurrent, overdue\"]\n        ServicePayment[\"Service Payment\u003cbr/\u003eAmount, timestamp\"]\n        OTACommand[\"OTA Command\u003cbr/\u003eConfig to push\"]\n        ActivationStatus[\"Activation Status\u003cbr/\u003eSuccess/retry/failed\"]\n    end\n    \n    subgraph \"Persistent Storage\"\n        ExpedienteDB[(\"Expediente de Compra\u003cbr/\u003eComplete customer record\")]\n        OrderDB[(\"Order Database\u003cbr/\u003eFactory orders\")]\n        ServiceDB[(\"Service Database\u003cbr/\u003eActivations\")]\n        BillingDB[(\"Billing Database\u003cbr/\u003eAll payments\")]\n    end\n    \n    CustomerData --\u003e ExpedienteDB\n    PlanComercial --\u003e ExpedienteDB\n    Credentials --\u003e ExpedienteDB\n    ReservationPayment --\u003e BillingDB\n    \n    ReservationPayment --\u003e FactoryOrder\n    FactoryOrder --\u003e OrderDB\n    MfgStatus --\u003e OrderDB\n    VehicleID --\u003e OrderDB\n    VehicleID --\u003e ExpedienteDB\n    \n    MfgStatus --\u003e FinalPayment\n    FinalPayment --\u003e BillingDB\n    FinalPayment --\u003e RegistrationDoc\n    RegistrationDoc --\u003e ExpedienteDB\n    RegistrationDoc --\u003e TransportDetails\n    \n    TransportDetails --\u003e DeliveryStatus\n    DeliveryStatus --\u003e ExpedienteDB\n    \n    DeliveryStatus --\u003e ServiceSelection\n    ServiceSelection --\u003e MaintenanceStatus\n    MaintenanceStatus --\u003e ServicePayment\n    ServicePayment --\u003e BillingDB\n    ServicePayment --\u003e OTACommand\n    OTACommand --\u003e ActivationStatus\n    ActivationStatus --\u003e ServiceDB\n    ActivationStatus --\u003e ExpedienteDB\n```\n\n**Sources:** [enunciado.md:8-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Operational Metrics and Monitoring\n\nKey metrics that should be tracked for operational health and performance:\n\n### Process Performance Metrics\n\n| Process | Key Metrics | Target | Monitoring Frequency |\n|---------|-------------|--------|---------------------|\n| Sales registration | Time from sale to credentials sent | \u003c 1 hour | Real-time |\n| Factory order | API success rate | \u003e 99% | Real-time |\n| Manufacturing tracking | Notification delivery rate | \u003e 99.5% | Daily |\n| Payment processing | Settlement success rate | \u003e 98% | Real-time |\n| Vehicle registration | Registration time | \u003c 24 hours | Daily |\n| Delivery operations | First-attempt success rate | \u003e 85% | Weekly |\n| OTA activation | First-attempt success rate | \u003e 95% | Real-time |\n| OTA retry | Success rate after retries | \u003e 99% | Daily |\n| Technical escalation | Resolution time | \u003c 48 hours | Daily |\n| Maintenance status check | API response time | \u003c 2 seconds | Real-time |\n\n### Operational Health Indicators\n\n- **End-to-end sales cycle time**: Dealership sale  vehicle delivered\n- **Customer satisfaction score**: Post-delivery survey\n- **Service activation success rate**: Including retries\n- **Payment failure rate**: By payment type\n- **Manufacturing status update frequency**: From factory webhooks\n- **Notification delivery success rate**: By channel\n- **Manual intervention frequency**: Escalations requiring staff action\n- **Process automation percentage**: Automated vs manual steps\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Related Pages\n\nFor detailed information on specific operational processes:\n- **Sales and customer onboarding**: [Sales and Order Management](#8.1)\n- **Manufacturing tracking and delivery**: [Manufacturing and Delivery Workflow](#8.2)\n- **Maintenance operations**: [Maintenance Management](#8.3)\n- **Payment processing details**: [Payment and Billing](#7)\n- **OTA activation procedures**: [OTA Service Activation](#6.2)\n- **Failure handling specifics**: [Failure Handling and Edge Cases](#9)"])</script><script>self.__next_f.push([1,"30:T4ae1,"])</script><script>self.__next_f.push([1,"# Sales and Order Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents the dealership-initiated sales workflow, encompassing customer registration, credential generation, reservation processing, and factory order placement. This is the entry point for all vehicle sales in the CaaS system, occurring before manufacturing and delivery.\n\nFor information about the subsequent manufacturing tracking and delivery processes, see [Manufacturing and Delivery Workflow](#8.2). For details on service purchases after vehicle delivery, see [Service Acquisition and Management](#4.2).\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:8-29]()\n\n---\n\n## Overview of Sales Process\n\nThe sales process is initiated exclusively at **concesionarios** (dealerships) by **employees** (commercial staff), who are external actors using the corporate intranet system. The process transforms a customer interaction into a registered sale, generates system credentials, and automatically triggers factory manufacturing.\n\n```mermaid\ngraph TB\n    CUSTOMER[\"Customer Visits\u003cbr/\u003eDealership\"]\n    EMPLOYEE[\"Dealership Employee\u003cbr/\u003e(External Actor)\"]\n    INTRANET[\"Corporate Intranet\u003cbr/\u003eSales Registration System\"]\n    \n    subgraph \"Sales Registration Phase\"\n        CAPTURE[\"Capture Customer Data\u003cbr/\u003e+ Plan Comercial\"]\n        GENERATE[\"Generate System\u003cbr/\u003eCredentials\"]\n        SEND_EMAIL[\"Send Credentials\u003cbr/\u003evia Email\"]\n    end\n    \n    subgraph \"Reservation Phase\"\n        PAY_SIGNAL[\"Customer Pays\u003cbr/\u003eReservation Signal\"]\n        ORDER_API[\"Factory Order API\u003cbr/\u003e(Synchronous)\"]\n        FACTORY[\"Factory Systems\u003cbr/\u003eBegin Manufacturing\"]\n    end\n    \n    CUSTOMER --\u003e EMPLOYEE\n    EMPLOYEE --\u003e INTRANET\n    INTRANET --\u003e CAPTURE\n    CAPTURE --\u003e GENERATE\n    GENERATE --\u003e SEND_EMAIL\n    SEND_EMAIL --\u003e PAY_SIGNAL\n    PAY_SIGNAL --\u003e ORDER_API\n    ORDER_API --\u003e FACTORY\n```\n\n**Diagram: End-to-End Sales Workflow from Dealership to Factory**\n\n**Sources:** [enunciado.md:8-13](), [pasame las preguntas y sus respuestas a markdown.md:41-44]()\n\n---\n\n## Customer Registration and Data Capture\n\n### Registration Process\n\nWhen an employee closes a sale at a dealership, they register it in the **corporate intranet servers**. This registration is mandatory before any further processing can occur.\n\n**Data Captured During Registration:**\n\n| Data Category | Description | Purpose |\n|--------------|-------------|---------|\n| Customer Identification | Full name, contact information, address | System authentication and delivery logistics |\n| Email Address | Primary contact email | Credential delivery and notifications |\n| Plan Comercial | Selected base platform model | Defines vehicle to manufacture |\n| Optional Services | Pre-selected opciones disponibles | Initial service configuration |\n| Payment Information | Reservation payment details | Order validation |\n\n### Credential Generation\n\nUpon successful registration, the system automatically generates access credentials for the customer. These credentials provide access to both the **web platform** and **mobile application**.\n\n**Credential Components:**\n- Username (typically derived from email)\n- Initial password (auto-generated, secure)\n- Account activation link\n\nThe credentials are sent to the customer's registered email address, enabling them to access their **expediente de compra** (purchase dossier) immediately.\n\n**Important System Rule:** The CaaS system does NOT support self-registration or external OAuth (Google, Microsoft, etc.). All users must be explicitly registered by dealership staff. Anonymous or public access is not permitted.\n\n**Sources:** [enunciado.md:8-11](), [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n---\n\n## Reservation Payment Processing\n\n### Payment Structure\n\nThe vehicle purchase follows a two-stage payment model:\n\n```mermaid\ngraph LR\n    SALE_REGISTERED[\"Sale Registered\u003cbr/\u003ein Intranet\"]\n    PAY_SIGNAL[\"Payment 1:\u003cbr/\u003eReservation Signal\u003cbr/\u003e(Seal)\"]\n    FACTORY_ORDER[\"Automatic\u003cbr/\u003eFactory Order\"]\n    MANUFACTURING[\"Manufacturing\u003cbr/\u003eProcess\"]\n    VEHICLE_READY[\"Vehicle Ready\u003cbr/\u003eat Dealership\"]\n    PAY_FINAL[\"Payment 2:\u003cbr/\u003eFinal Amount\u003cbr/\u003e(Before Registration)\"]\n    REGISTRATION[\"Vehicle\u003cbr/\u003eRegistration\"]\n    \n    SALE_REGISTERED --\u003e PAY_SIGNAL\n    PAY_SIGNAL --\u003e FACTORY_ORDER\n    FACTORY_ORDER --\u003e MANUFACTURING\n    MANUFACTURING --\u003e VEHICLE_READY\n    VEHICLE_READY --\u003e PAY_FINAL\n    PAY_FINAL --\u003e REGISTRATION\n```\n\n**Diagram: Two-Stage Payment Model for Vehicle Purchase**\n\n### Reservation Signal (Seal)\n\nThe **seal** (reservation payment) is the first payment made by the customer. This payment:\n- Confirms customer commitment to the purchase\n- Triggers automatic factory order placement\n- Is non-refundable once the factory order is placed\n- Represents a partial payment toward the total vehicle cost\n\n### Final Payment\n\nThe final payment occurs when the vehicle is ready and available at the dealership. This payment:\n- Covers the remaining balance of the vehicle purchase\n- Must be completed before vehicle registration\n- Is blocking for all subsequent operations (registration, delivery)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:80-82](), [enunciado.md:13-15]()\n\n---\n\n## Factory Order Placement\n\n### Automatic Order Submission\n\nOnce the customer pays the reservation signal, the system **automatically** places an order with the factory through the **Factory Order API**. This is not a manual processno employee intervention is required.\n\n### API Communication Pattern\n\nThe factory integration uses a **synchronous** (request-response) pattern for order placement:\n\n```mermaid\nsequenceDiagram\n    participant INTRANET as \"Corporate Intranet\"\n    participant ORDER_API as \"Factory Order API\"\n    participant FACTORY as \"Factory Systems\"\n    \n    Note over INTRANET: Customer pays\u003cbr/\u003ereservation signal\n    \n    INTRANET-\u003e\u003eORDER_API: POST /orders\u003cbr/\u003eSynchronous Request\u003cbr/\u003e{customer_id, base_platform,\u003cbr/\u003eoptions, delivery_location}\n    \n    ORDER_API-\u003e\u003eFACTORY: Create Manufacturing Order\n    \n    FACTORY--\u003e\u003eORDER_API: Order ID + Confirmation\n    \n    ORDER_API--\u003e\u003eINTRANET: 200 OK\u003cbr/\u003e{order_id, estimated_delivery}\n    \n    Note over INTRANET: Order confirmed\u003cbr/\u003eCustomer notified\n    \n    Note over FACTORY: Manufacturing begins\n    \n    FACTORY--\u003e\u003eINTRANET: Status Updates\u003cbr/\u003e(Asynchronous Webhooks)\n```\n\n**Diagram: Factory Order API Integration Pattern**\n\n**Key Integration Characteristics:**\n\n1. **Initiative:** CaaS initiates the order (synchronous call)\n2. **Response:** Factory returns immediate confirmation with order ID\n3. **Status Updates:** Factory sends asynchronous notifications as manufacturing progresses\n4. **Blocking:** Order placement must succeed for the sale to proceed\n\n### Order Data Structure\n\nThe order submitted to the factory includes:\n\n| Field | Description | Source |\n|-------|-------------|--------|\n| `customer_id` | Internal customer identifier | Generated during registration |\n| `base_platform` | Vehicle model/platform code | From plan comercial |\n| `options` | List of pre-selected opciones disponibles | From plan comercial |\n| `delivery_location` | Dealership or customer address | Customer registration data |\n| `order_date` | Timestamp of order creation | System timestamp |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [enunciado.md:13]()\n\n---\n\n## Manufacturing Status Notifications\n\nAfter the order is placed, the factory sends **asynchronous notifications** to update the status of the vehicle manufacturing process. These notifications enable the customer to track their vehicle's progress.\n\n### Notification Flow\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e OrderPlaced: Factory API\u003cbr/\u003eConfirms Order\n    \n    OrderPlaced --\u003e InProduction: Factory Begins\u003cbr/\u003eManufacturing\n    \n    InProduction --\u003e QualityCheck: Assembly\u003cbr/\u003eComplete\n    \n    QualityCheck --\u003e ReadyForShipment: QC Passed\n    \n    ReadyForShipment --\u003e InTransit: Loaded on\u003cbr/\u003eTransport\n    \n    InTransit --\u003e AtDealership: Arrived at\u003cbr/\u003eDealership\n    \n    AtDealership --\u003e AvailableForCustomer: Notified\u003cbr/\u003eCustomer\n    \n    AvailableForCustomer --\u003e [*]: Awaiting Final\u003cbr/\u003ePayment\n    \n    note right of OrderPlaced\n        Async webhook from Factory\n        Customer notified via email/app\n    end note\n    \n    note right of InProduction\n        Periodic status updates\n        Estimated completion date\n    end note\n    \n    note right of AtDealership\n        System triggers notification\n        Customer can complete payment\n    end note\n```\n\n**Diagram: Vehicle Manufacturing State Transitions with Notifications**\n\n### Customer Notification System\n\nThe system provides **automatic notifications** to customers throughout the manufacturing process. This is identified as a key value differentiator for the CaaS platform.\n\n**Notification Channels:**\n- Email notifications\n- Mobile app push notifications\n- Web platform status updates (visible in expediente de compra)\n\n**Notification Triggers:**\n- Order placed confirmation\n- Manufacturing started\n- Manufacturing milestones reached\n- Quality check completed\n- Vehicle ready for shipment\n- Vehicle arrived at dealership\n- Vehicle available for final payment\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29](), [enunciado.md:13]()\n\n---\n\n## Final Payment and Vehicle Assignment\n\n### Final Payment Requirement\n\nWhen the vehicle arrives at the dealership and is ready for delivery, the customer receives a notification and must complete the **final payment** (remaining balance). This payment is a **blocking operation**no further steps can proceed until payment is confirmed.\n\n### Payment Success Scenario\n\n```mermaid\ngraph TD\n    VEHICLE_READY[\"Vehicle Ready\u003cbr/\u003eat Dealership\"]\n    NOTIFY_CUSTOMER[\"Notify Customer\u003cbr/\u003ePayment Required\"]\n    CUSTOMER_PAYS[\"Customer Completes\u003cbr/\u003eFinal Payment\"]\n    PAYMENT_SUCCESS[\"Payment\u003cbr/\u003eConfirmed\"]\n    REGISTER_VEHICLE[\"Register Vehicle\u003cbr/\u003ewith Admin Bodies\"]\n    PREPARE_DELIVERY[\"Prepare Vehicle\u003cbr/\u003efor Delivery\"]\n    \n    VEHICLE_READY --\u003e NOTIFY_CUSTOMER\n    NOTIFY_CUSTOMER --\u003e CUSTOMER_PAYS\n    CUSTOMER_PAYS --\u003e PAYMENT_SUCCESS\n    PAYMENT_SUCCESS --\u003e REGISTER_VEHICLE\n    REGISTER_VEHICLE --\u003e PREPARE_DELIVERY\n```\n\n**Diagram: Successful Final Payment Flow**\n\n### Payment Failure Scenario\n\nIf the customer **does not have the money** or fails to complete the final payment, the system implements a strict business rule:\n\n**Actions on Payment Failure:**\n\n1. **Vehicle Status Change:** The vehicle is marked as **\"sin asignar\"** (unassigned) in the system\n2. **Customer Loses Reservation:** The customer loses all rights to the reserved vehicle\n3. **Vehicle Becomes Stock:** The dealership retains the vehicle as available stock for immediate sale to other customers\n4. **Reservation Payment Not Refunded:** The initial seal is forfeited\n\n```mermaid\ngraph TD\n    VEHICLE_READY[\"Vehicle Ready\u003cbr/\u003eat Dealership\"]\n    NOTIFY_CUSTOMER[\"Notify Customer\u003cbr/\u003ePayment Required\"]\n    CUSTOMER_NO_PAY[\"Customer Cannot\u003cbr/\u003eComplete Payment\"]\n    MARK_UNASSIGNED[\"Mark Vehicle\u003cbr/\u003eStatus: 'Sin Asignar'\"]\n    STOCK_AVAILABLE[\"Add to Dealership\u003cbr/\u003eStock for Sale\"]\n    CUSTOMER_LOSES[\"Customer Loses\u003cbr/\u003eReservation\u003cbr/\u003e(No Refund)\"]\n    \n    VEHICLE_READY --\u003e NOTIFY_CUSTOMER\n    NOTIFY_CUSTOMER --\u003e CUSTOMER_NO_PAY\n    CUSTOMER_NO_PAY --\u003e MARK_UNASSIGNED\n    MARK_UNASSIGNED --\u003e STOCK_AVAILABLE\n    MARK_UNASSIGNED --\u003e CUSTOMER_LOSES\n```\n\n**Diagram: Final Payment Failure Flow**\n\n**System State Implications:**\n- The vehicle record exists in the system but has no associated customer\n- The vehicle can be immediately reassigned to a new customer\n- The original customer's expediente shows the failed purchase\n- The customer retains access to the platform but has no active vehicle\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27](), [enunciado.md:14-15]()\n\n---\n\n## Vehicle Registration with Administrative Bodies\n\nAfter successful final payment, the **dealership** (not the customer) is responsible for registering the vehicle with the appropriate **government administrative bodies**. This registration process varies by country.\n\n### Registration Process\n\nThe registration includes:\n- Obtaining official license plates\n- Registering ownership in government databases\n- Completing tax declarations\n- Obtaining circulation permits\n\n### Multi-Country Considerations\n\nSince the CaaS system operates in multiple countries, the registration process must accommodate country-specific requirements. The system likely maintains configuration for:\n- Country-specific administrative API endpoints\n- Required documentation per jurisdiction\n- Registration fees and tax structures\n- Processing timelines\n\n**Integration Point:** The system integrates with administrative registration systems (see [Administrative Registration Integration](#5.5) for technical details).\n\n**Sources:** [enunciado.md:15-16](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n---\n\n## Order and Vehicle State Management\n\n### Core State Entities\n\nThe sales and order management system tracks several concurrent state machines:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e SaleRegistered: Employee Registers\u003cbr/\u003eSale in Intranet\n    \n    SaleRegistered --\u003e ReservationPaid: Customer Pays\u003cbr/\u003eSeal\n    \n    ReservationPaid --\u003e OrderPlaced: Automatic Factory\u003cbr/\u003eOrder via API\n    \n    OrderPlaced --\u003e Manufacturing: Factory Confirms\u003cbr/\u003eOrder\n    \n    Manufacturing --\u003e VehicleReady: Manufacturing\u003cbr/\u003eComplete\n    \n    VehicleReady --\u003e FinalPaymentPending: At Dealership,\u003cbr/\u003eAwaiting Payment\n    \n    FinalPaymentPending --\u003e PaymentReceived: Customer Pays\u003cbr/\u003eFinal Amount\n    FinalPaymentPending --\u003e PaymentFailed: Customer Cannot\u003cbr/\u003ePay\n    \n    PaymentReceived --\u003e VehicleRegistered: Admin Registration\u003cbr/\u003eComplete\n    \n    VehicleRegistered --\u003e ReadyForDelivery: Prepared for\u003cbr/\u003eTransport\n    \n    ReadyForDelivery --\u003e [*]: Delivery Process\u003cbr/\u003eBegins\n    \n    PaymentFailed --\u003e VehicleSinAsignar: Marked Unassigned\n    \n    VehicleSinAsignar --\u003e SaleRegistered: Resold to New\u003cbr/\u003eCustomer\n    \n    note right of OrderPlaced\n        Order ID stored\n        Customer notified\n    end note\n    \n    note right of PaymentFailed\n        Vehicle becomes stock\n        Customer loses reservation\n        No refund of seal\n    end note\n    \n    note right of VehicleSinAsignar\n        Vehicle exists in system\n        No customer assigned\n        Available for immediate sale\n    end note\n```\n\n**Diagram: Order and Vehicle State Machine**\n\n### State Persistence\n\nThe system must persist the following state information throughout the sales process:\n\n| State Data | Storage Purpose | Used By |\n|-----------|-----------------|---------|\n| Sale Registration Record | Customer + plan comercial details | Corporate intranet, expediente |\n| Order ID | Factory order tracking | Manufacturing notifications, customer queries |\n| Payment Status | Reservation and final payment confirmation | Order progression, vehicle assignment |\n| Vehicle Status | Assigned/unassigned, registration status | Delivery scheduling, stock management |\n| Customer Credentials | System access | Web platform, mobile app authentication |\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n---\n\n## Integration Points Summary\n\nThe Sales and Order Management subsystem integrates with multiple external and internal systems:\n\n```mermaid\ngraph TB\n    subgraph \"Sales and Order Management\"\n        SALES_REG[\"Sales Registration\u003cbr/\u003eModule\"]\n        CRED_GEN[\"Credential Generation\u003cbr/\u003eModule\"]\n        ORDER_MGT[\"Order Management\u003cbr/\u003eModule\"]\n        PAYMENT_PROC[\"Payment Processing\u003cbr/\u003eModule\"]\n    end\n    \n    subgraph \"External Systems\"\n        FACTORY_API[\"Factory Order API\u003cbr/\u003e(Synchronous)\"]\n        FACTORY_WEBHOOK[\"Factory Status\u003cbr/\u003e(Asynchronous)\"]\n        PAYMENT_GW[\"Payment Gateway\"]\n        ADMIN_API[\"Administrative\u003cbr/\u003eRegistration API\"]\n    end\n    \n    subgraph \"Internal Systems\"\n        CUSTOMER_DB[\"Customer Database\"]\n        ORDER_DB[\"Order Database\"]\n        NOTIFICATION[\"Notification Engine\u003cbr/\u003e(Email, Push, SMS)\"]\n        EXPEDIENTE[\"Expediente System\"]\n    end\n    \n    SALES_REG --\u003e CRED_GEN\n    SALES_REG --\u003e CUSTOMER_DB\n    \n    CRED_GEN --\u003e NOTIFICATION\n    NOTIFICATION --\u003e |\"Email\"| CUSTOMER[\"Customer\u003cbr/\u003e(External Actor)\"]\n    \n    PAYMENT_PROC --\u003e ORDER_MGT\n    ORDER_MGT --\u003e ORDER_DB\n    ORDER_MGT --\u003e FACTORY_API\n    \n    FACTORY_WEBHOOK --\u003e ORDER_MGT\n    ORDER_MGT --\u003e NOTIFICATION\n    \n    PAYMENT_PROC --\u003e PAYMENT_GW\n    PAYMENT_PROC --\u003e ADMIN_API\n    \n    SALES_REG --\u003e EXPEDIENTE\n    ORDER_MGT --\u003e EXPEDIENTE\n```\n\n**Diagram: Sales and Order Management Integration Architecture**\n\n**Key Integration Characteristics:**\n\n1. **Factory API:** Synchronous order placement initiated by CaaS\n2. **Factory Webhooks:** Asynchronous status updates pushed by factory\n3. **Payment Gateway:** Processes reservation and final payments\n4. **Admin Registration:** Handles vehicle registration with government bodies\n5. **Notification Engine:** Multi-channel customer communication\n6. **Expediente System:** Customer-facing purchase dossier\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:41-44]()\n\n---\n\n## Business Rules Summary\n\n### Critical Business Rules\n\n| Rule | Description | Enforcement |\n|------|-------------|-------------|\n| **No Self-Registration** | All users must be registered by dealership employees | System does not provide registration UI |\n| **Automatic Order Placement** | Factory order placed automatically upon reservation payment | No manual intervention allowed |\n| **Synchronous Order API** | Order placement must receive immediate confirmation | Blocking operation, error handling required |\n| **Final Payment Blocking** | Vehicle registration cannot proceed without final payment | State transition guard condition |\n| **Payment Failure Penalty** | Failed final payment results in lost reservation | Vehicle marked \"sin asignar\", no refund |\n| **Dealership Registration** | Only dealership can register vehicles, not customers | Role-based access control |\n\n### State Transition Guards\n\nThe following conditions must be met for state transitions:\n\n- **Sale Registration  Reservation Paid:** Valid customer data captured\n- **Reservation Paid  Order Placed:** Payment confirmation received\n- **Order Placed  Manufacturing:** Factory API returns success\n- **Vehicle Ready  Final Payment Pending:** Vehicle physically at dealership\n- **Final Payment Pending  Payment Received:** Full payment confirmed\n- **Payment Received  Vehicle Registered:** Admin registration successful\n\n**Sources:** [enunciado.md:8-17](), [pasame las preguntas y sus respuestas a markdown.md:15-16, 26-27, 41-44, 80-82]()"])</script><script>self.__next_f.push([1,"31:T5611,"])</script><script>self.__next_f.push([1,"# Manufacturing and Delivery Workflow\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes the manufacturing tracking, transport coordination, and delivery procedures that occur after a customer has completed the sales process at a dealership. It covers the workflow from the moment an order is placed with the factory through final delivery of the vehicle to the customer.\n\n**Scope boundaries:**\n- For the initial sales registration and order placement process, see [Sales and Order Management](#8.1)\n- For detailed failure handling and edge cases during delivery, see [Delivery and Transport Issues](#9.3)\n- For the factory integration API specifications, see [Factory Integration](#5.1)\n- For administrative registration with government bodies, see [Administrative Registration Integration](#5.5)\n\nThis page focuses on the operational workflow, status tracking mechanisms, and the various delivery scenarios including successful delivery and fallback procedures.\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n---\n\n## Workflow Overview\n\nThe manufacturing and delivery workflow spans from order placement through final customer possession of the vehicle. This process involves multiple external actors and systems working in coordination.\n\n### High-Level Process Flow\n\n```mermaid\nsequenceDiagram\n    participant DLR as Dealership\n    participant CAAS as CaaS Platform\n    participant FACTORY as Factory API\n    participant MFG as Manufacturing Facility\n    participant ADMIN as Administrative Bodies\n    participant TRANS as Transport Company\n    participant CUST as Customer\n\n    Note over DLR,CUST: Phase 1: Order and Manufacturing\n    DLR-\u003e\u003eCAAS: Register Sale with Reservation Payment\n    CAAS-\u003e\u003eFACTORY: POST /orders (Synchronous)\n    FACTORY-\u003e\u003eMFG: Queue Production Order\n    MFG--\u003e\u003eFACTORY: Update Manufacturing Status\n    FACTORY--\u003e\u003eCAAS: Manufacturing Status Webhooks (Async)\n    CAAS--\u003e\u003eCUST: Email/Push: Manufacturing Progress\n    \n    Note over DLR,CUST: Phase 2: Vehicle Ready\n    MFG-\u003e\u003eFACTORY: Vehicle Complete\n    FACTORY--\u003e\u003eCAAS: Webhook: Vehicle Ready\n    CAAS--\u003e\u003eCUST: Notification: Vehicle Available\n    \n    Note over DLR,CUST: Phase 3: Payment and Registration\n    CUST-\u003e\u003eCAAS: Complete Final Payment\n    alt Payment Successful\n        CAAS-\u003e\u003eADMIN: Register Vehicle\n        ADMIN--\u003e\u003eCAAS: Registration Confirmed\n    else Payment Failed\n        CAAS-\u003e\u003eCAAS: Mark Vehicle \"Sin Asignar\"\n        CAAS-\u003e\u003eDLR: Vehicle Available as Stock\n        Note over CUST: Customer Loses Reservation\n    end\n    \n    Note over DLR,CUST: Phase 4: Transport and Delivery\n    CAAS-\u003e\u003eTRANS: Schedule Transport to Customer Address\n    TRANS-\u003e\u003eCUST: Attempt Home Delivery\n    alt Customer Present\n        TRANS-\u003e\u003eCUST: Deliver Vehicle\n        CUST-\u003e\u003eCAAS: Link Mobile App to Vehicle\n        Note over CUST: Vehicle Operational\n    else Customer Absent\n        TRANS-\u003e\u003eCUST: Phone Call Attempt\n        alt Customer Reachable\n            TRANS-\u003e\u003eDLR: Return to Dealership\n            Note over CUST: Must Pickup from Dealership\n            CUST-\u003e\u003eDLR: Pickup Vehicle\n        else Customer Not Reachable\n            TRANS-\u003e\u003eDLR: Return to Dealership\n            CAAS--\u003e\u003eCUST: Notification: Pickup Required\n        end\n    end\n```\n\n**Sources:** [enunciado.md:9-17](), [pasame las preguntas y sus respuestas a markdown.md:20-29]()\n\n---\n\n## Manufacturing Phase\n\n### Order Placement to Factory\n\nOnce a sale is registered in the dealership and the customer has paid the reservation signal (seal), the CaaS platform automatically places an order with the manufacturing facility via the Factory API.\n\n**Integration Pattern:**\n- **Direction:** CaaS  Factory\n- **Communication Mode:** Synchronous (Request-Response)\n- **API Endpoint:** `POST /orders` on Factory API\n- **Initiative:** CaaS system initiates the order\n\n**Order Data Transmitted:**\n- Customer identification (linked to purchase record)\n- Selected plataforma base (vehicle model)\n- Optional features included in plan comercial\n- Dealership location for final delivery coordination\n- Expected delivery locality\n\nThe synchronous nature of this API call ensures that CaaS receives immediate confirmation that the order has been accepted into the factory's production queue. Any immediate validation errors (e.g., invalid model configuration, unavailable components) are returned synchronously.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [enunciado.md:13-14]()\n\n### Manufacturing Status Tracking\n\nAfter the order is placed, the factory provides ongoing status updates about the manufacturing progress through an asynchronous notification mechanism.\n\n**Integration Pattern:**\n- **Direction:** Factory  CaaS\n- **Communication Mode:** Asynchronous (Event-Driven)\n- **Delivery Method:** Webhooks\n- **Initiative:** Factory pushes status updates when state changes occur\n\n**Typical Manufacturing States:**\n- Order received and queued\n- Production started\n- Vehicle assembly in progress\n- Quality control and testing\n- Vehicle completed and ready\n- Vehicle dispatched to locality/dealership\n\nThe CaaS platform must implement webhook endpoints to receive these asynchronous notifications. Upon receiving a status update, the system:\n1. Updates the internal order/vehicle state\n2. Triggers customer notifications\n3. Logs the state transition in the purchase record (expediente de compra)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [enunciado.md:13-14]()\n\n### Customer Notifications During Manufacturing\n\nA key value proposition of the CaaS system is keeping customers informed throughout the manufacturing process. The notification system is triggered by incoming factory status updates.\n\n```mermaid\nflowchart LR\n    FACTORY[\"Factory API\"] --\u003e|\"Webhook: Status Update\"| LISTENER[\"Webhook Listener\"]\n    LISTENER --\u003e PARSER[\"Status Parser\"]\n    PARSER --\u003e DB[\"Order Database\"]\n    PARSER --\u003e NOTIF[\"Notification Engine\"]\n    \n    NOTIF --\u003e EMAIL[\"Email Service\"]\n    NOTIF --\u003e PUSH[\"Push Notification Service\"]\n    NOTIF --\u003e SMS[\"SMS Gateway\"]\n    \n    EMAIL --\u003e CUST[\"Customer\"]\n    PUSH --\u003e MOBILE[\"Mobile App\"]\n    SMS --\u003e CUST\n    MOBILE --\u003e CUST\n    \n    NOTIF --\u003e EXPEDIENTE[\"Expediente de Compra\"]\n    EXPEDIENTE --\u003e WEB[\"Web Platform\"]\n    WEB --\u003e CUST\n```\n\n**Notification Channels:**\n- **Email:** Detailed status updates with estimated timelines\n- **Push Notifications:** Brief real-time alerts via mobile app\n- **SMS:** Optional for critical milestones\n- **Web Platform:** Status visible in expediente de compra\n\n**Critical Business Rule:** Automated manufacturing notifications are considered a differentiating value feature of the CaaS platform and must be reliable and timely.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29](), [enunciado.md:11-14]()\n\n---\n\n## Vehicle Readiness and Final Payment\n\nWhen the factory notifies CaaS that the vehicle manufacturing is complete and the vehicle is available in the customer's locality, the system triggers a notification to the customer that final payment is required.\n\n### Payment Requirement Before Registration\n\n```mermaid\nflowchart TD\n    READY[\"Factory: Vehicle Ready\"] --\u003e NOTIFY[\"Notify Customer\"]\n    NOTIFY --\u003e WAIT[\"Wait for Customer Action\"]\n    WAIT --\u003e PAYMENT{\"Final Payment\u003cbr/\u003eReceived?\"}\n    \n    PAYMENT --\u003e|\"Yes\"| VALIDATE[\"Validate Payment\"]\n    VALIDATE --\u003e SUCCESS{\"Payment\u003cbr/\u003eSuccessful?\"}\n    \n    SUCCESS --\u003e|\"Yes\"| REGISTER[\"Proceed to Registration\"]\n    REGISTER --\u003e ADMIN[\"Administrative Registration\"]\n    \n    SUCCESS --\u003e|\"No\"| FAILURE[\"Payment Failed\"]\n    FAILURE --\u003e UNASSIGN[\"Mark Vehicle 'Sin Asignar'\"]\n    UNASSIGN --\u003e STOCK[\"Vehicle Becomes Dealership Stock\"]\n    STOCK --\u003e LOST[\"Customer Loses Reservation\"]\n    \n    PAYMENT --\u003e|\"No\"| WAIT\n```\n\n**Critical Business Rules:**\n\n1. **No Registration Without Full Payment:** The dealership cannot proceed with administrative registration until the customer has completed 100% of the vehicle purchase price (reservation signal + remaining amount).\n\n2. **Payment Failure Consequences:** If the customer cannot or does not complete the final payment:\n   - The vehicle is immediately marked as \"sin asignar\" (unassigned) in the system\n   - The vehicle becomes available stock for the dealership to sell to other customers\n   - The original customer loses their reservation entirely\n   - The reservation signal payment may or may not be refunded depending on dealership policy (not specified in system requirements)\n\n3. **Vehicle State in System:** The vehicle entity exists in the CaaS database but its assignment status transitions from \"assigned to customer X\" to \"unassigned stock.\"\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27](), [enunciado.md:15-16]()\n\n---\n\n## Administrative Registration\n\nAfter successful final payment, the dealership must register the vehicle with the appropriate administrative bodies before delivery can occur.\n\n### Registration Process\n\nThe registration process varies by country but typically involves:\n- Vehicle identification documentation\n- Proof of ownership transfer\n- Tax payments\n- License plate assignment\n- Environmental compliance certification\n\n**Integration Pattern:**\n- CaaS integrates with administrative registration systems via country-specific APIs\n- The registration process is **synchronous and blocking**\n- Delivery cannot proceed until registration is confirmed\n\n**System Behavior:**\nThe CaaS platform calls the administrative registration integration layer, which routes requests to the appropriate country-specific registration authority based on the customer's location and dealership jurisdiction.\n\n**Sources:** [enunciado.md:15-16]()\n\n---\n\n## Transport Coordination\n\nOnce the vehicle is registered, the CaaS platform coordinates transport from the factory/dealership location to the customer's address.\n\n### Transport Subcontracting\n\n**Key Facts:**\n- Transport is **subcontracted to external transport companies**\n- CaaS does not operate its own vehicle transport fleet\n- The system must track two critical events:\n  1. **Embarkation:** When vehicle leaves factory/dealership (provider records)\n  2. **Reception:** When vehicle arrives at destination (dealership/customer records)\n\n### Transport Scheduling\n\n```mermaid\nflowchart LR\n    REG[\"Vehicle Registered\"] --\u003e SCHEDULE[\"Schedule Transport\"]\n    SCHEDULE --\u003e SELECT[\"Select Transport Provider\"]\n    SELECT --\u003e BOOK[\"Book Transport Slot\"]\n    BOOK --\u003e EMBARK[\"Record Embarkation\"]\n    EMBARK --\u003e TRANSIT[\"Vehicle in Transit\"]\n    TRANSIT --\u003e ARRIVE[\"Arrival at Destination\"]\n    ARRIVE --\u003e ATTEMPT[\"Attempt Delivery\"]\n```\n\nThe system must maintain transport tracking information including:\n- Transport company assigned\n- Scheduled delivery date/time\n- Embarkation timestamp\n- Expected arrival timestamp\n- Actual delivery outcome\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-21]()\n\n---\n\n## Delivery Procedures\n\nThe final phase of the workflow is physical delivery of the vehicle to the customer. The standard procedure is home delivery to the customer's registered address.\n\n### Successful Home Delivery\n\nWhen delivery proceeds as planned:\n\n1. **Transport Arrival:** Transport company arrives at customer address\n2. **Customer Verification:** Customer identity is verified\n3. **Vehicle Handover:** Physical transfer of vehicle and documentation\n4. **Mobile App Linking:** Customer links their mobile application to the vehicle\n5. **Vehicle Activation:** Vehicle becomes operational with plataforma base features active\n\n**Mobile App Linking Process:**\n- The mobile application establishes direct communication with the vehicle\n- This link enables operational control and service management\n- The linking occurs through the existing IoT network infrastructure\n- Once linked, the customer can access vehicle features and request service activations\n\n### Vehicle Operational State\n\nAfter successful delivery and app linking, the vehicle transitions to \"Operational\" state where:\n- Plataforma base features are fully active\n- Customer can use the vehicle immediately\n- Customer can browse and purchase opciones disponibles via web or mobile platforms\n- Maintenance tracking begins\n\n**Sources:** [enunciado.md:17-19](), [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n---\n\n## Fallback Scenarios\n\nThe delivery process includes comprehensive fallback logic for handling various failure scenarios.\n\n### Customer Absence at Delivery\n\n```mermaid\nflowchart TD\n    ARRIVE[\"Transport Arrives at Address\"] --\u003e PRESENT{\"Customer\u003cbr/\u003ePresent?\"}\n    \n    PRESENT --\u003e|\"Yes\"| DELIVER[\"Deliver Vehicle\"]\n    DELIVER --\u003e LINK[\"Link Mobile App\"]\n    LINK --\u003e OPERATIONAL[\"Vehicle Operational\"]\n    \n    PRESENT --\u003e|\"No\"| CALL[\"Transport Calls Customer\"]\n    CALL --\u003e REACHABLE{\"Customer\u003cbr/\u003eReachable?\"}\n    \n    REACHABLE --\u003e|\"Yes, Can Reschedule\"| RESCHEDULE[\"Schedule New Delivery\"]\n    RESCHEDULE --\u003e RETRY[\"Retry Delivery\"]\n    RETRY --\u003e ARRIVE\n    \n    REACHABLE --\u003e|\"No/Cannot Accept\"| RETURN[\"Return to Dealership\"]\n    \n    RETURN --\u003e NOTIFY[\"Notify Customer: Pickup Required\"]\n    NOTIFY --\u003e WAIT[\"Vehicle Held at Dealership\"]\n    WAIT --\u003e PICKUP[\"Customer Arrives for Pickup\"]\n    PICKUP --\u003e VERIFY[\"Verify Customer Identity\"]\n    VERIFY --\u003e DELIVER_DLR[\"Deliver at Dealership\"]\n    DELIVER_DLR --\u003e LINK\n```\n\n**Fallback Logic:**\n\n1. **Initial Contact Attempt:** If customer is not present, transport company immediately calls the customer\n2. **Rescheduling Option:** If customer is reachable and can arrange a specific time, delivery is rescheduled\n3. **Return to Dealership:** If customer cannot be reached or cannot accept delivery, vehicle is returned to dealership\n4. **Security Requirement:** Vehicle is **never left unattended** at customer address due to security and liability risks\n5. **Customer Notification:** CaaS system sends notification that pickup at dealership is required\n6. **Dealership Pickup:** Customer must go to dealership to collect the vehicle\n\n**Critical Business Rule:** Security and risk management prohibit leaving a vehicle unattended. The fallback to dealership pickup ensures controlled handover.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n### Payment Failure After Manufacturing\n\nIf the customer fails to complete final payment after the vehicle is manufactured and ready:\n\n**Immediate Consequences:**\n- Vehicle assignment to customer is removed in the system\n- Vehicle status changes to \"sin asignar\" (unassigned)\n- Vehicle becomes available inventory for dealership\n- Dealership can immediately sell to other customers as stock\n\n**System State Transitions:**\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Reserved: Reservation Signal Paid\n    Reserved --\u003e Manufacturing: Order Placed to Factory\n    Manufacturing --\u003e Ready: Vehicle Manufactured\n    Ready --\u003e AwaitingPayment: Customer Notified\n    \n    AwaitingPayment --\u003e Registered: Final Payment Successful\n    AwaitingPayment --\u003e Unassigned: Payment Failed/Timeout\n    \n    Registered --\u003e InTransit: Transport Scheduled\n    InTransit --\u003e Delivered: Successful Delivery\n    InTransit --\u003e AtDealership: Failed Delivery\n    \n    AtDealership --\u003e Delivered: Customer Pickup\n    \n    Unassigned --\u003e DealershipStock: Available for Immediate Sale\n    DealershipStock --\u003e Reserved: New Customer Purchases\n    \n    Delivered --\u003e [*]: Customer Operational\n```\n\n**Database Representation:**\nThe vehicle record persists in the database with:\n- `status`: \"unassigned\" or \"stock\"\n- `assigned_customer_id`: NULL\n- `available_for_sale`: TRUE\n- `dealership_id`: Original dealership location\n\nThis allows the dealership to manage the vehicle as regular inventory while maintaining full manufacturing and configuration history.\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:26-27]()\n\n---\n\n## Factory Date Planning\n\nThe delivery timeline is fundamentally driven by factory production scheduling.\n\n**Key Principle:** The delivery date for the vehicle is always determined by the factory based on their production planning and capacity. Neither the dealership nor the transport provider controls this date.\n\n**Workflow:**\n1. Factory receives order and evaluates production capacity\n2. Factory assigns production slot based on internal scheduling\n3. Factory communicates expected completion date to CaaS\n4. CaaS shares estimated delivery timeframe with customer\n5. Factory provides updated estimates as manufacturing progresses\n6. Final \"ready\" notification triggers customer payment and delivery coordination\n\nThis constraint means the CaaS system must:\n- Display estimated delivery dates to customers with appropriate disclaimers\n- Update estimated dates as factory provides revised information\n- Handle customer inquiries about delays with factory-provided information\n- Not guarantee specific delivery dates until vehicle is actually completed\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:22-23]()\n\n---\n\n## Manufacturing and Delivery State Machine\n\nThe following comprehensive state diagram shows all possible states and transitions for a vehicle from order through delivery:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e SaleRegistered: \"Dealership: Sale Completed\"\n    \n    SaleRegistered --\u003e ReservationPaid: \"Customer: Reservation Signal\"\n    ReservationPaid --\u003e OrderPlaced: \"CaaS: POST /orders to Factory\"\n    \n    OrderPlaced --\u003e InProduction: \"Factory: Production Started\"\n    InProduction --\u003e QualityControl: \"Factory: Assembly Complete\"\n    QualityControl --\u003e ManufacturingComplete: \"Factory: QC Passed\"\n    \n    ManufacturingComplete --\u003e AwaitingFinalPayment: \"Factory Webhook: Vehicle Ready\"\n    \n    state AwaitingFinalPayment {\n        [*] --\u003e PendingPayment\n        PendingPayment --\u003e PaymentProcessing: \"Customer Initiates Payment\"\n        PaymentProcessing --\u003e PaymentSuccess: \"Payment Confirmed\"\n        PaymentProcessing --\u003e PaymentFailed: \"Payment Rejected\"\n    }\n    \n    AwaitingFinalPayment --\u003e VehicleUnassigned: \"Payment Failed or Timeout\"\n    VehicleUnassigned --\u003e DealershipStock: \"Mark as Available Inventory\"\n    \n    AwaitingFinalPayment --\u003e AdministrativeRegistration: \"Payment Successful\"\n    AdministrativeRegistration --\u003e Registered: \"Government: Registration Complete\"\n    \n    Registered --\u003e TransportScheduled: \"CaaS: Book Transport\"\n    TransportScheduled --\u003e InTransit: \"Transport: Vehicle Embarked\"\n    \n    InTransit --\u003e AtCustomerAddress: \"Transport: Arrived at Address\"\n    \n    state AtCustomerAddress {\n        [*] --\u003e CustomerPresent\n        CustomerPresent --\u003e DeliverySuccessful: \"Customer Verified\"\n        CustomerPresent --\u003e CustomerAbsent: \"No Customer Present\"\n        CustomerAbsent --\u003e PhoneContact: \"Call Customer\"\n        PhoneContact --\u003e RescheduleDelivery: \"Customer Reachable\"\n        PhoneContact --\u003e ReturnToDealership: \"Cannot Reach/No Solution\"\n    }\n    \n    AtCustomerAddress --\u003e MobileAppLinked: \"Delivery Successful\"\n    AtCustomerAddress --\u003e DealershipHolding: \"Delivery Failed\"\n    \n    RescheduleDelivery --\u003e InTransit: \"New Delivery Attempt\"\n    \n    DealershipHolding --\u003e CustomerPickup: \"Customer Arrives\"\n    CustomerPickup --\u003e MobileAppLinked: \"Verify \u0026 Deliver\"\n    \n    MobileAppLinked --\u003e VehicleOperational: \"App Linked to Vehicle\"\n    \n    VehicleOperational --\u003e [*]: \"Customer Uses Vehicle\"\n```\n\n**Sources:** [enunciado.md:9-19](), [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n---\n\n## Integration Points Summary\n\nThe manufacturing and delivery workflow integrates with multiple external systems and internal CaaS components:\n\n| Integration Point | Direction | Pattern | Purpose |\n|------------------|-----------|---------|---------|\n| **Factory Order API** | CaaS  Factory | Synchronous | Place manufacturing orders |\n| **Factory Status Webhooks** | Factory  CaaS | Asynchronous | Receive manufacturing status updates |\n| **Payment Gateway** | CaaS  Gateway | Async Settlement | Process final payment before registration |\n| **Administrative Bodies** | CaaS  Admin | Synchronous | Register vehicle with government |\n| **Transport Companies** | CaaS  Transport | Coordination | Schedule and track vehicle transport |\n| **Notification Engine** | Internal | Event-Driven | Send customer updates via email/push/SMS |\n| **IoT Network** | CaaS  Vehicle | Bidirectional | Enable mobile app linking and activation |\n| **Expediente System** | Internal | Data Storage | Maintain purchase records and history |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:41-44](), [enunciado.md:1-23]()\n\n---\n\n## Key Takeaways\n\n1. **Hybrid Factory Integration:** Order placement is synchronous while status tracking is asynchronous via webhooks\n\n2. **Payment is Blocking:** Vehicle cannot be registered or delivered until full payment is received\n\n3. **Factory Controls Timeline:** Delivery dates are determined by factory production scheduling, not by CaaS or customer requests\n\n4. **Security-First Delivery:** Vehicles are never abandoned; failed home delivery results in dealership pickup requirement\n\n5. **Payment Failure Consequences:** Customers who fail to complete payment lose their reservation and the vehicle becomes dealership stock\n\n6. **Automatic Notifications:** Manufacturing status updates are automatically communicated to customers as a value-added service\n\n7. **Mobile App Linking:** Final delivery step includes linking customer's mobile application to the vehicle for operational control\n\n8. **Transport Tracking:** System must record embarkation and reception events for transport coordination\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:18-29](), [enunciado.md:9-19]()"])</script><script>self.__next_f.push([1,"32:T5724,"])</script><script>self.__next_f.push([1,"# Maintenance Management\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document describes how the CaaS system integrates with maintenance service providers and uses maintenance status to manage service availability, warranty compliance, and customer safety. It covers the VSS (Vehicle Service System) integration, maintenance plan tracking, service gating rules, and warranty implications.\n\nFor information about how maintenance status affects individual service purchases, see [Maintenance-Linked Service Access](#6.3). For details on the workshop service recording workflow from the customer perspective, see [Vehicle Purchase and Delivery Process](#4.1). For technical details on VSS API integration patterns, see [VSS Integration](#5.2).\n\n**Sources:** [enunciado.md:23](), [pasame las preguntas y sus respuestas a markdown.md:58-74]()\n\n---\n\n## Maintenance System Overview\n\nThe CaaS maintenance management system operates on several key architectural principles:\n\n1. **External Service Recording**: Maintenance work is performed by a network of official and approved workshops who record service events in the **VSS (Vehicle Service System)**, which is an external system independent of CaaS.\n\n2. **Query-Based Status**: CaaS does not receive maintenance data from vehicles via IoT. Instead, it queries the VSS system when service status validation is required.\n\n3. **Service Gating**: Maintenance status directly affects the availability of certain optional services (`opciones disponibles`). Services with safety implications require current maintenance to be activated.\n\n4. **Warranty Management**: Missing scheduled maintenance results in warranty loss for affected functional blocks, but does not affect vehicle operability or already-activated services.\n\n5. **No Vehicle Blocking**: CaaS can never prevent a vehicle from being driven. Only service activation for maintenance-dependent services can be blocked.\n\n**Sources:** [enunciado.md:23](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## VSS Integration Architecture\n\nThe following diagram shows how CaaS integrates with the VSS system and workshop network for maintenance tracking:\n\n```mermaid\ngraph TB\n    subgraph \"Customer Domain\"\n        CUSTOMER[\"Customer\"]\n        VEHICLE[\"Vehicle\"]\n    end\n    \n    subgraph \"Workshop Network\"\n        OFFICIAL[\"Official Workshops\u003cbr/\u003e(Red de Talleres Oficiales)\"]\n        APPROVED[\"Approved Multi-brand\u003cbr/\u003eWorkshops\u003cbr/\u003e(Talleres Multimarca\u003cbr/\u003eHomologados)\"]\n    end\n    \n    subgraph \"VSS System (External)\"\n        VSS_API[\"VSS API\u003cbr/\u003e(Vehicle Service System)\"]\n        VSS_DB[(\"VSS Database\u003cbr/\u003eService History\u003cbr/\u003eCompliance %\u003cbr/\u003eby Functional Block\")]\n    end\n    \n    subgraph \"CaaS Platform\"\n        SERVICE_CAT[\"ServiceCatalogService\"]\n        MAINT_CHECK[\"MaintenanceValidationService\"]\n        WARRANTY_MGR[\"WarrantyManager\"]\n        CACHE[\"MaintenanceStatusCache\"]\n    end\n    \n    subgraph \"Service Activation Flow\"\n        OTA_ENGINE[\"OTAActivationEngine\"]\n        SERVICE_GATE[\"ServiceGatingRules\"]\n    end\n    \n    CUSTOMER --\u003e|\"Brings vehicle for service\"| OFFICIAL\n    CUSTOMER --\u003e|\"Brings vehicle for service\"| APPROVED\n    VEHICLE -.-\u003e|\"No IoT reporting\u003cbr/\u003eof maintenance\"| VSS_API\n    \n    OFFICIAL --\u003e|\"Record service event\"| VSS_API\n    APPROVED --\u003e|\"Record service event\"| VSS_API\n    VSS_API --\u003e VSS_DB\n    \n    SERVICE_CAT --\u003e|\"Check service eligibility\"| MAINT_CHECK\n    MAINT_CHECK --\u003e|\"Query maintenance status\u003cbr/\u003eGET /vehicles/{vin}/maintenance\"| VSS_API\n    VSS_API --\u003e|\"Status + compliance %\u003cbr/\u003eby functional blocks\"| MAINT_CHECK\n    \n    MAINT_CHECK --\u003e CACHE\n    MAINT_CHECK --\u003e|\"Validate warranty status\"| WARRANTY_MGR\n    \n    MAINT_CHECK --\u003e|\"Maintenance OK\"| SERVICE_GATE\n    MAINT_CHECK --\u003e|\"Maintenance overdue\"| SERVICE_GATE\n    \n    SERVICE_GATE --\u003e|\"Allow/Block activation\"| OTA_ENGINE\n    \n    WARRANTY_MGR --\u003e VSS_DB\n```\n\n**Architecture Components:**\n\n| Component | Responsibility | Integration Pattern |\n|-----------|---------------|---------------------|\n| `ServiceCatalogService` | Displays available services to customers | Calls `MaintenanceValidationService` before showing maintenance-dependent services |\n| `MaintenanceValidationService` | Queries VSS for maintenance status | Synchronous HTTP GET to VSS API, caches results |\n| `MaintenanceStatusCache` | Caches maintenance status | TTL-based cache to reduce VSS API calls |\n| `WarrantyManager` | Determines warranty validity | Analyzes compliance percentages from VSS |\n| `ServiceGatingRules` | Enforces service availability rules | Blocks activation of maintenance-dependent services if status is not current |\n| `OTAActivationEngine` | Executes service activation | Only proceeds if `ServiceGatingRules` approves |\n\n**Key VSS API Endpoints (External, Pre-existing):**\n\n- `GET /vehicles/{vin}/maintenance` - Returns current maintenance status and compliance percentage by functional block\n- `GET /vehicles/{vin}/service-history` - Returns complete service event history\n- `GET /maintenance-schedules/{model}/{year}` - Returns scheduled maintenance intervals\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Maintenance Plans and Schedules\n\nMaintenance plans are programmed schedules that define required service intervals. These may or may not be included in the customer's commercial plan (`plan comercial`).\n\n### Maintenance Plan Structure\n\n```mermaid\nerDiagram\n    COMMERCIAL_PLAN ||--o| MAINTENANCE_PLAN : \"may include\"\n    MAINTENANCE_PLAN ||--|{ MAINTENANCE_INTERVAL : \"defines\"\n    MAINTENANCE_INTERVAL ||--|{ FUNCTIONAL_BLOCK : \"covers\"\n    VEHICLE ||--|| MAINTENANCE_STATUS : \"has\"\n    MAINTENANCE_STATUS ||--|{ BLOCK_COMPLIANCE : \"tracks\"\n    FUNCTIONAL_BLOCK ||--o{ OPTIONAL_SERVICE : \"gates\"\n    \n    COMMERCIAL_PLAN {\n        string plan_id\n        string vehicle_model\n        boolean includes_maintenance\n        int maintenance_years\n    }\n    \n    MAINTENANCE_PLAN {\n        string plan_id\n        string vehicle_model\n        string model_year\n    }\n    \n    MAINTENANCE_INTERVAL {\n        int interval_number\n        int kilometers\n        int months\n        string description\n    }\n    \n    FUNCTIONAL_BLOCK {\n        string block_id\n        string name\n        string category\n        boolean safety_critical\n    }\n    \n    MAINTENANCE_STATUS {\n        string vin\n        date last_service_date\n        int current_kilometers\n        string overall_status\n    }\n    \n    BLOCK_COMPLIANCE {\n        string block_id\n        float compliance_percentage\n        date last_service\n        boolean is_current\n    }\n    \n    OPTIONAL_SERVICE {\n        string service_id\n        string service_name\n        string required_block_id\n        boolean requires_current_maintenance\n    }\n```\n\n### Maintenance Interval Configuration\n\nMaintenance intervals are defined per vehicle model and include:\n\n- **Interval number** (e.g., 1st service, 2nd service)\n- **Distance-based trigger** (e.g., every 15,000 km)\n- **Time-based trigger** (e.g., every 12 months)\n- **Functional blocks covered** (e.g., engine, brakes, suspension)\n- **Safety-critical flag** (determines if services are gated)\n\n### Commercial Plan Integration\n\nWhen a customer purchases a vehicle, their `plan comercial` may include:\n\n| Plan Component | Description | Impact on Maintenance |\n|----------------|-------------|----------------------|\n| **Included maintenance** | Pre-paid service intervals | Customer has no additional cost for scheduled services |\n| **Maintenance duration** | Number of years/km covered | After expiration, customer pays for services directly |\n| **Service network** | Official vs. approved workshops | All workshops must record in VSS regardless |\n\n**Critical Business Rule**: Even if maintenance is not included in the commercial plan, the customer must still complete maintenance to maintain warranty and unlock maintenance-dependent services. The CaaS system does not prevent the customer from skipping maintenance, but it does enforce consequences.\n\n**Sources:** [enunciado.md:23](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Service Gating Rules and Logic\n\nThe following state diagram illustrates how maintenance status affects service activation requests:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ServiceRequested: \"Customer selects\u003cbr/\u003eoptional service\"\n    \n    ServiceRequested --\u003e CheckServiceType: \"ServiceCatalogService\u003cbr/\u003eretrieves service metadata\"\n    \n    CheckServiceType --\u003e DirectActivation: \"Service does NOT\u003cbr/\u003erequire maintenance\"\n    CheckServiceType --\u003e QueryVSS: \"Service REQUIRES\u003cbr/\u003ecurrent maintenance\"\n    \n    QueryVSS --\u003e CheckCache: \"MaintenanceValidationService\u003cbr/\u003echecks cache\"\n    CheckCache --\u003e VSSAPICall: \"Cache miss or expired\"\n    CheckCache --\u003e EvaluateStatus: \"Cache hit\"\n    \n    VSSAPICall --\u003e EvaluateStatus: \"GET /vehicles/{vin}/maintenance\"\n    \n    EvaluateStatus --\u003e CheckCompliance: \"VSS returns status\"\n    \n    CheckCompliance --\u003e MaintenanceCurrent: \"All required blocks\u003cbr/\u003ecompliance \u003e= 100%\"\n    CheckCompliance --\u003e MaintenanceOverdue: \"Any required block\u003cbr/\u003ecompliance \u003c 100%\"\n    \n    MaintenanceCurrent --\u003e DirectActivation: \"ServiceGatingRules\u003cbr/\u003eallows activation\"\n    MaintenanceOverdue --\u003e BlockActivation: \"ServiceGatingRules\u003cbr/\u003eblocks activation\"\n    \n    DirectActivation --\u003e PaymentProcessing: \"Proceed to payment\"\n    \n    BlockActivation --\u003e NotifyCustomer: \"ServiceCatalogService\u003cbr/\u003eshows error message\"\n    NotifyCustomer --\u003e DisplayMaintenanceRequired: \"Show required service\u003cbr/\u003eand workshop locator\"\n    DisplayMaintenanceRequired --\u003e [*]: \"Customer must complete\u003cbr/\u003emaintenance first\"\n    \n    PaymentProcessing --\u003e OTAActivation: \"Payment successful\"\n    OTAActivation --\u003e [*]: \"Service activated\"\n    \n    note right of CheckServiceType\n        Service metadata includes:\n        - requires_maintenance: boolean\n        - required_functional_blocks: array\n        - safety_critical: boolean\n    end note\n    \n    note right of CheckCompliance\n        Compliance calculated by VSS:\n        compliance % = (services_completed / services_required) * 100\n        \n        Per functional block\n    end note\n```\n\n### Service Gating Implementation\n\nThe `ServiceGatingRules` component implements the following logic:\n\n```\nAlgorithm: CheckServiceEligibility(service_id, vin)\n\n1. service_metadata = ServiceCatalog.GetService(service_id)\n\n2. IF service_metadata.requires_maintenance == false:\n     RETURN ALLOW\n\n3. required_blocks = service_metadata.required_functional_blocks\n\n4. maintenance_status = MaintenanceValidationService.GetStatus(vin)\n   // This queries VSS API or cache\n\n5. FOR EACH block IN required_blocks:\n     block_compliance = maintenance_status.GetBlockCompliance(block.id)\n     \n     IF block_compliance.compliance_percentage \u003c 100:\n       RETURN DENY_MAINTENANCE_REQUIRED(block.name, block_compliance.last_service)\n\n6. RETURN ALLOW\n```\n\n### Maintenance-Dependent Service Categories\n\nExamples of services that typically require current maintenance:\n\n| Service Category | Required Functional Block(s) | Safety Rationale |\n|------------------|------------------------------|------------------|\n| **50% Power Increase** | Engine, Transmission | High-performance operation requires verified mechanical condition |\n| **Autonomous Driving** | Brakes, Sensors, ADAS | Critical safety systems must be certified operational |\n| **Off-road/Winter Modes** | Suspension, Drivetrain | Extreme conditions require validated component integrity |\n| **High-speed Limiter Removal** | Brakes, Tires, Suspension | High-speed operation requires safety system certification |\n\nServices that do NOT require maintenance:\n\n| Service Category | Rationale |\n|------------------|-----------|\n| **Entertainment Systems** | No safety impact |\n| **Climate Control Upgrades** | No mechanical dependencies |\n| **Interior Lighting** | No safety impact |\n| **Navigation Enhancements** | No mechanical dependencies |\n\n**Sources:** [enunciado.md:23](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Workshop Network and Service Recording\n\n### Workshop Types and Authorization\n\nThe CaaS system recognizes two types of authorized workshops:\n\n1. **Official Workshops (Red de Talleres Oficiales)**\n   - Manufacturer-owned or franchised locations\n   - Full access to all service procedures\n   - Automatically authorized in VSS\n\n2. **Approved Multi-brand Workshops (Talleres Multimarca Homologados)**\n   - Independent workshops with manufacturer certification\n   - Must meet technical standards\n   - Registered in VSS with approval status\n\n### Service Recording Workflow\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant Vehicle\n    participant Workshop\n    participant VSS as \"VSS System\"\n    participant CaaS as \"CaaS Platform\"\n    \n    Customer-\u003e\u003eWorkshop: \"Brings vehicle for service\"\n    Workshop-\u003e\u003eVehicle: \"Perform maintenance work\"\n    Workshop-\u003e\u003eVehicle: \"Diagnostic scan and verification\"\n    \n    Workshop-\u003e\u003eVSS: \"POST /service-events\u003cbr/\u003e{vin, service_type, blocks_serviced}\"\n    VSS-\u003e\u003eVSS: \"Update service history\"\n    VSS-\u003e\u003eVSS: \"Recalculate compliance %\"\n    VSS--\u003e\u003eWorkshop: \"Service recorded\"\n    \n    Workshop-\u003e\u003eCustomer: \"Provide service receipt\"\n    \n    Note over Customer,CaaS: \"Later: Customer attempts to activate service\"\n    \n    Customer-\u003e\u003eCaaS: \"Request service activation\u003cbr/\u003evia web/mobile\"\n    CaaS-\u003e\u003eVSS: \"GET /vehicles/{vin}/maintenance\"\n    VSS--\u003e\u003eCaaS: \"Updated compliance status\"\n    CaaS-\u003e\u003eCaaS: \"Evaluate service eligibility\"\n    \n    alt Maintenance Current\n        CaaS-\u003e\u003eCustomer: \"Service available for purchase\"\n    else Maintenance Overdue\n        CaaS-\u003e\u003eCustomer: \"Service blocked - maintenance required\"\n    end\n```\n\n### VSS Service Event Data Structure\n\nWhen workshops record service in VSS, the following data is captured:\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `vin` | String | Vehicle identification number |\n| `service_date` | DateTime | Date service was completed |\n| `workshop_id` | String | Authorized workshop identifier |\n| `service_type` | Enum | Scheduled, corrective, warranty, recall |\n| `interval_number` | Integer | Which scheduled service (1st, 2nd, 3rd, etc.) |\n| `kilometers` | Integer | Vehicle odometer at service time |\n| `functional_blocks_serviced` | Array | List of functional blocks worked on |\n| `parts_replaced` | Array | Parts replaced during service |\n| `technician_id` | String | Certified technician who performed work |\n| `notes` | String | Free-text service notes |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-65]()\n\n---\n\n## Warranty Management and Implications\n\n### Warranty Status Calculation\n\nThe `WarrantyManager` component determines warranty validity based on maintenance compliance:\n\n```mermaid\nflowchart TD\n    START[\"Vehicle warranty check\"] --\u003e GET_COMPLIANCE[\"Query VSS for\u003cbr/\u003ecompliance by block\"]\n    \n    GET_COMPLIANCE --\u003e ANALYZE[\"WarrantyManager\u003cbr/\u003eanalyzes compliance\"]\n    \n    ANALYZE --\u003e CHECK_BLOCKS{\"For each\u003cbr/\u003efunctional block\"}\n    \n    CHECK_BLOCKS --\u003e BLOCK_CURRENT{\"compliance \u003e= 100%\"}\n    \n    BLOCK_CURRENT --\u003e|Yes| BLOCK_WARRANTY_VALID[\"Block warranty: VALID\"]\n    BLOCK_CURRENT --\u003e|No| BLOCK_WARRANTY_VOID[\"Block warranty: VOID\"]\n    \n    BLOCK_WARRANTY_VALID --\u003e MORE_BLOCKS{\"More blocks?\"}\n    BLOCK_WARRANTY_VOID --\u003e MORE_BLOCKS\n    \n    MORE_BLOCKS --\u003e|Yes| CHECK_BLOCKS\n    MORE_BLOCKS --\u003e|No| GENERATE_STATUS[\"Generate warranty status report\"]\n    \n    GENERATE_STATUS --\u003e STORE[\"Store in warranty_status table\"]\n    STORE --\u003e NOTIFY{\"Any warranty voided?\"}\n    \n    NOTIFY --\u003e|Yes| SEND_WARNING[\"Send customer notification\u003cbr/\u003eWarrantyWarningEmail\"]\n    NOTIFY --\u003e|No| END[\"End\"]\n    SEND_WARNING --\u003e END\n```\n\n### Warranty Rules\n\n| Scenario | Warranty Status | Service Activation | Vehicle Operation |\n|----------|----------------|-------------------|-------------------|\n| All maintenance current | **Full warranty on all blocks** | All services available | Unrestricted |\n| Engine maintenance overdue | **Engine warranty VOID**\u003cbr/\u003eOther blocks still covered | Power increase service blocked\u003cbr/\u003eOther services available | Unrestricted |\n| Multiple blocks overdue | **Affected blocks warranty VOID** | All safety-critical services blocked | Unrestricted |\n| No maintenance ever done | **All warranty VOID** | Only non-maintenance services available | Unrestricted |\n\n### Critical Constraints\n\n1. **Cannot Block Vehicle Operation**: Even with zero warranty and no maintenance, the vehicle's base platform (`plataforma base`) continues to function. The customer can still drive the vehicle.\n\n2. **Cannot Block Paid Services**: Already activated services continue to work regardless of maintenance status. Only NEW service activations are blocked.\n\n3. **Granular Warranty**: Warranty is voided per functional block, not globally. A customer who skips engine maintenance loses engine warranty but retains brake warranty if brake maintenance is current.\n\n### Customer Notification Requirements\n\nWhen warranty status changes due to maintenance non-compliance, the system must:\n\n1. **Immediate notification** via email and push notification\n2. **Display warning** in expediente de compra\n3. **Show in mobile app** vehicle status screen\n4. **List affected services** that can no longer be activated\n5. **Provide workshop locator** to schedule service\n\n**Notification Template Components:**\n- `WarrantyWarningEmail` - Email notification\n- `PushNotificationService.SendWarrantyAlert()` - Mobile push\n- `ExpedienteService.AddWarrantyWarning()` - Web platform display\n- `VehicleStatusWidget.ShowWarrantyStatus()` - Mobile app widget\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Maintenance Management Business Rules Summary\n\nThe following table consolidates all business rules related to maintenance management:\n\n| Rule ID | Category | Rule Statement | Enforcement Point |\n|---------|----------|----------------|------------------|\n| **MNT-001** | Service Gating | Services requiring maintenance can only be activated if all required functional blocks have compliance \u003e= 100% | `ServiceGatingRules.CheckServiceEligibility()` |\n| **MNT-002** | Vehicle Operation | The vehicle can NEVER be blocked from driving, regardless of maintenance status | System-wide constraint - no blocking logic exists |\n| **MNT-003** | Paid Services | Already activated services continue to function even if maintenance becomes overdue | `OTAActivationEngine` - no deactivation on maintenance lapse |\n| **MNT-004** | Base Platform | The plataforma base always functions regardless of maintenance | System design - base platform independent of maintenance |\n| **MNT-005** | Warranty Granularity | Warranty is voided per functional block, not globally | `WarrantyManager.CalculateBlockWarranty()` |\n| **MNT-006** | Customer Decision | Customer decides when to perform maintenance - system cannot force it | Business policy - no enforcement mechanism |\n| **MNT-007** | Data Source | Maintenance status comes from VSS system, NOT from vehicle IoT | `MaintenanceValidationService` queries VSS API only |\n| **MNT-008** | Workshop Network | Both official and approved multi-brand workshops can record service | VSS system authorization - CaaS queries all authorized workshops |\n| **MNT-009** | Commercial Plan | Maintenance may or may not be included in customer's plan, but compliance is required either way | `ServiceGatingRules` checks compliance regardless of payment source |\n| **MNT-010** | Cache Policy | Maintenance status can be cached but must be revalidated before service activation | `MaintenanceStatusCache` with TTL, invalidated on activation attempt |\n| **MNT-011** | Notification | Customer must be notified when warranty is voided due to maintenance non-compliance | `WarrantyManager` triggers notification on status change |\n| **MNT-012** | Service Display | Web and mobile platforms must show maintenance requirements clearly for blocked services | `ServiceCatalogService.GetServiceDetails()` includes maintenance metadata |\n\n**Sources:** [enunciado.md:23](), [pasame las preguntas y sus respuestas a markdown.md:58-97]()\n\n---\n\n## Integration Touch Points\n\nThe maintenance management system integrates with multiple other CaaS subsystems:\n\n```mermaid\ngraph LR\n    subgraph \"Maintenance Management\"\n        VSS[\"VSS Integration\"]\n        MAINT_VAL[\"MaintenanceValidationService\"]\n        WARRANTY[\"WarrantyManager\"]\n    end\n    \n    subgraph \"Service Lifecycle\"\n        CATALOG[\"ServiceCatalogService\"]\n        GATING[\"ServiceGatingRules\"]\n        OTA[\"OTAActivationEngine\"]\n    end\n    \n    subgraph \"Customer Engagement\"\n        WEB[\"Web Platform\"]\n        MOBILE[\"Mobile Application\"]\n        EXPEDIENTE[\"Expediente de Compra\"]\n    end\n    \n    subgraph \"Notifications\"\n        EMAIL[\"Email Service\"]\n        PUSH[\"Push Notifications\"]\n    end\n    \n    WEB --\u003e CATALOG\n    MOBILE --\u003e CATALOG\n    CATALOG --\u003e GATING\n    GATING --\u003e MAINT_VAL\n    MAINT_VAL --\u003e VSS\n    MAINT_VAL --\u003e WARRANTY\n    GATING --\u003e OTA\n    \n    WARRANTY --\u003e EMAIL\n    WARRANTY --\u003e PUSH\n    WARRANTY --\u003e EXPEDIENTE\n    \n    EXPEDIENTE --\u003e WEB\n    EXPEDIENTE --\u003e MOBILE\n```\n\n### Key Integration Points\n\n1. **Service Catalog Integration** - `ServiceCatalogService` calls `ServiceGatingRules` before displaying service as available\n2. **Payment Integration** - Payment proceeds only after maintenance validation passes (see [Payment Types and Flows](#7.1))\n3. **OTA Integration** - `OTAActivationEngine` requires gating approval before attempting activation (see [OTA Service Activation](#6.2))\n4. **Expediente Integration** - Maintenance status and warranty information displayed in customer purchase record (see [Customer-Facing Platforms](#4.3))\n5. **Notification Integration** - Warranty status changes trigger multi-channel notifications (see [Core Technical Components](#3.2))\n\n**Sources:** [enunciado.md:23](), [pasame las preguntas y sus respuestas a markdown.md:60-73]()"])</script><script>self.__next_f.push([1,"33:T681f,"])</script><script>self.__next_f.push([1,"# Failure Handling and Edge Cases\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document provides a comprehensive overview of failure handling mechanisms and edge case behaviors across the CaaS platform. The system is designed with a customer-first philosophy where technical failures should never result in customer charges for undelivered services, while business logic failures (e.g., payment issues) follow strict policies to protect company assets.\n\nThis page covers:\n- Core failure handling philosophy and design principles\n- Critical failure detection and recovery mechanisms\n- Customer communication requirements during failures\n- System state management during error conditions\n\nFor detailed information on specific failure scenarios:\n- OTA activation failures and retry logic: see [OTA Activation Failures](#9.1)\n- Payment processing failures across different payment types: see [Payment Failure Scenarios](#9.2)\n- Delivery and transport logistics issues: see [Delivery and Transport Issues](#9.3)\n- Special edge cases including theft and warranty loss: see [Special Scenarios (Theft, Warranty Loss)](#9.4)\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:1-104\n\n---\n\n## Failure Handling Philosophy\n\nThe CaaS platform implements two distinct failure handling strategies based on the nature of the failure:\n\n| Failure Category | Handling Strategy | Customer Impact | Business Rationale |\n|------------------|-------------------|-----------------|-------------------|\n| **Technical Failures** | Customer-favorable defaults | No charge for undelivered services | Build trust, legal compliance, maintain reputation |\n| **Business Logic Failures** | Strict policy enforcement | Full consequences (e.g., lose vehicle reservation) | Protect company assets, ensure financial integrity |\n| **Third-Party Integration Failures** | Retry with exponential backoff | Transparent status communication | Resilience against external system unavailability |\n| **Partial Service Delivery** | Conservative approach | Service marked as failed if not 100% delivered | Avoid customer dissatisfaction with partial functionality |\n\n### Core Principles\n\n1. **Never charge for undelivered services**: If OTA activation fails after all retries, the customer is not charged and receives full notification (lines 48-53).\n\n2. **Immediate service delivery despite async settlement**: CaaS assumes payment settlement risk to optimize customer experience, delivering services before bank confirmation (lines 77-82).\n\n3. **Cannot block vehicle operation**: Only police can prevent a vehicle from circulating. CaaS can only prevent new service activations, never disable base platform or already-paid services (lines 66-73).\n\n4. **Maintenance as safety gate**: Services requiring specific maintenance can be blocked from activation until maintenance is current, but this is a preventive measure, not a punitive one (lines 66-73).\n\n5. **Legal compliance built-in**: Desistimiento (right of withdrawal) rules are enforced automatically based on service duration and purchase date (lines 84-89).\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:48-53, 66-82, 84-89\n\n---\n\n## Failure Detection and Classification\n\n### Failure Detection Matrix\n\n```mermaid\ngraph TB\n    subgraph \"Failure Detection Sources\"\n        OTA_RESP[\"OTA API Response\u003cbr/\u003eHTTP Status Codes\"]\n        PAYMENT_WEBHOOK[\"Payment Gateway\u003cbr/\u003eWebhook Events\"]\n        TRANSPORT_UPDATE[\"Transport Subcontractor\u003cbr/\u003eStatus Updates\"]\n        VSS_QUERY[\"VSS System\u003cbr/\u003eMaintenance Queries\"]\n        TIMEOUT[\"Timeout Monitoring\u003cbr/\u003eAsync Operations\"]\n    end\n    \n    subgraph \"Failure Classification\"\n        TECH_FAIL[\"Technical Failure\u003cbr/\u003eRetry + No Charge\"]\n        BIZ_FAIL[\"Business Failure\u003cbr/\u003eEnforce Policy\"]\n        DATA_FAIL[\"Data Validation Failure\u003cbr/\u003eBlock Operation\"]\n        EXTERNAL_FAIL[\"External System Failure\u003cbr/\u003eCompensating Action\"]\n    end\n    \n    subgraph \"Response Actions\"\n        RETRY[\"Retry Logic\u003cbr/\u003eExponential Backoff\"]\n        NOTIFY_CUSTOMER[\"Customer Notification\u003cbr/\u003eMulti-channel\"]\n        TECH_SUPPORT[\"Technical Support\u003cbr/\u003eEscalation\"]\n        REFUND[\"Automatic Refund\u003cbr/\u003eProcessing\"]\n        STATE_ROLLBACK[\"State Rollback\u003cbr/\u003eCompensating Transaction\"]\n    end\n    \n    OTA_RESP --\u003e TECH_FAIL\n    PAYMENT_WEBHOOK --\u003e BIZ_FAIL\n    TRANSPORT_UPDATE --\u003e EXTERNAL_FAIL\n    VSS_QUERY --\u003e DATA_FAIL\n    TIMEOUT --\u003e TECH_FAIL\n    \n    TECH_FAIL --\u003e RETRY\n    TECH_FAIL --\u003e NOTIFY_CUSTOMER\n    RETRY --\u003e TECH_SUPPORT\n    \n    BIZ_FAIL --\u003e NOTIFY_CUSTOMER\n    BIZ_FAIL --\u003e STATE_ROLLBACK\n    \n    DATA_FAIL --\u003e NOTIFY_CUSTOMER\n    \n    EXTERNAL_FAIL --\u003e RETRY\n    EXTERNAL_FAIL --\u003e NOTIFY_CUSTOMER\n    \n    TECH_SUPPORT --\u003e REFUND\n```\n\n**Failure Classification Logic:**\n\n- **Technical Failures**: OTA timeout, API IoT unavailability, network errors  Retry with backoff, escalate to technical support, never charge customer\n- **Business Failures**: Payment declined, customer absent at delivery, final payment failure  Enforce business rules strictly (e.g., lose reservation)\n- **Data Validation Failures**: Maintenance overdue for requested service, user not authorized  Block operation preventively, communicate requirements\n- **External System Failures**: Factory API down, VSS unreachable, payment gateway timeout  Implement circuit breaker pattern, queue for retry\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:48-53, 24-29\n\n---\n\n## Critical Failure Scenarios Overview\n\n### OTA Activation Failure Flow\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant WebPlatform as \"Web Platform\"\n    participant PaymentGateway as \"Payment Gateway\"\n    participant ServiceActivation as \"Service Activation Module\"\n    participant OTARetryEngine as \"OTA Retry Engine\"\n    participant APIIoT as \"API IoT\"\n    participant Vehicle\n    participant TechSupport as \"Technical Support Queue\"\n    participant NotificationEngine as \"Notification Engine\"\n    \n    Customer-\u003e\u003eWebPlatform: \"Purchase Service\"\n    WebPlatform-\u003e\u003ePaymentGateway: \"Initiate Payment\"\n    PaymentGateway--\u003e\u003eWebPlatform: \"Payment Initiated (Async)\"\n    \n    WebPlatform-\u003e\u003eServiceActivation: \"Deliver Service Immediately\"\n    ServiceActivation-\u003e\u003eOTARetryEngine: \"Activate via OTA\"\n    \n    OTARetryEngine-\u003e\u003eAPIIoT: \"Attempt 1: Send Config\"\n    APIIoT-\u003e\u003eVehicle: \"OTA Command\"\n    Vehicle--\u003e\u003eAPIIoT: \"FAILURE (Timeout/Error)\"\n    APIIoT--\u003e\u003eOTARetryEngine: \"Activation Failed\"\n    \n    Note over OTARetryEngine: \"Wait: Exponential Backoff\"\n    \n    OTARetryEngine-\u003e\u003eAPIIoT: \"Attempt 2: Send Config\"\n    APIIoT-\u003e\u003eVehicle: \"OTA Command\"\n    Vehicle--\u003e\u003eAPIIoT: \"FAILURE\"\n    APIIoT--\u003e\u003eOTARetryEngine: \"Activation Failed\"\n    \n    Note over OTARetryEngine: \"Wait: Longer Backoff\"\n    \n    OTARetryEngine-\u003e\u003eAPIIoT: \"Attempt N: Send Config\"\n    APIIoT-\u003e\u003eVehicle: \"OTA Command\"\n    Vehicle--\u003e\u003eAPIIoT: \"FAILURE\"\n    APIIoT--\u003e\u003eOTARetryEngine: \"All Retries Exhausted\"\n    \n    OTARetryEngine-\u003e\u003eAPIIoT: \"Get Vehicle State\"\n    APIIoT-\u003e\u003eVehicle: \"Query Status\"\n    Vehicle--\u003e\u003eAPIIoT: \"Current State\"\n    APIIoT--\u003e\u003eOTARetryEngine: \"Diagnostic Info\"\n    \n    OTARetryEngine-\u003e\u003eTechSupport: \"Create Ticket + Diagnostic Data\"\n    OTARetryEngine-\u003e\u003eServiceActivation: \"Activation Failed Permanently\"\n    \n    ServiceActivation-\u003e\u003ePaymentGateway: \"DO NOT CHARGE Customer\"\n    ServiceActivation-\u003e\u003eNotificationEngine: \"Send Failure Notification\"\n    \n    NotificationEngine-\u003e\u003eCustomer: \"Email: Service Unavailable\"\n    NotificationEngine-\u003e\u003eCustomer: \"App Push: Technical Issue\"\n    NotificationEngine-\u003e\u003eCustomer: \"Refund Processed (if charged)\"\n```\n\n**Key Implementation Requirements:**\n- **Retry count**: Configurable N attempts (suggested: 3-5)\n- **Backoff strategy**: Exponential (e.g., 1min, 5min, 15min, 1hr)\n- **State capture**: Query vehicle diagnostic state after final failure\n- **No-charge rule**: Must prevent payment capture or issue automatic refund\n- **Customer communication**: Multi-channel notification within 15 minutes of final failure\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:48-56\n\n---\n\n### Payment Failure Decision Tree\n\n```mermaid\ngraph TD\n    PaymentFail[\"Payment Failure Detected\"]\n    \n    PaymentType{\"Payment Type?\"}\n    \n    ReservationFail[\"Reservation Payment Failed\"]\n    FinalFail[\"Final Payment Failed\"]\n    ServiceFail[\"Service Payment Failed\"]\n    SubscriptionFail[\"Subscription Payment Failed\"]\n    \n    ReservationAction[\"Block: Order Not Placed\u003cbr/\u003eNotify: Cannot Reserve Vehicle\u003cbr/\u003eState: Order Cancelled\"]\n    \n    FinalAction[\"Action: Vehicle  Stock\u003cbr/\u003eState: Mark 'sin asignar'\u003cbr/\u003eCustomer: Loses Reservation\u003cbr/\u003eNotify: Vehicle Available for Sale\"]\n    \n    ServiceDelayed{\"Service Already\u003cbr/\u003eDelivered?\"}\n    ServiceYesDelivered[\"Attempt Collection\u003cbr/\u003eEmail Payment Update Required\u003cbr/\u003eIf Fails: Mark Debt, No New Services\"]\n    ServiceNotDelivered[\"Cancel Service Activation\u003cbr/\u003eNo OTA Command Sent\u003cbr/\u003eNotify Payment Required\"]\n    \n    SubscriptionCurrent{\"Current Month\u003cbr/\u003eor Renewal?\"}\n    SubscriptionCurrentMonth[\"Charge at Mes Vencido\u003cbr/\u003eIf Fails: Cancel Subscription\u003cbr/\u003eMark Account Suspended\"]\n    SubscriptionRenewal[\"Cancel Auto-Renewal\u003cbr/\u003eServices Continue Until End\u003cbr/\u003eNotify Cancellation\"]\n    \n    PaymentFail --\u003e PaymentType\n    \n    PaymentType --\u003e|\"Reservation\"| ReservationFail\n    PaymentType --\u003e|\"Final\"| FinalFail\n    PaymentType --\u003e|\"Service\"| ServiceFail\n    PaymentType --\u003e|\"Subscription\"| SubscriptionFail\n    \n    ReservationFail --\u003e ReservationAction\n    FinalFail --\u003e FinalAction\n    \n    ServiceFail --\u003e ServiceDelayed\n    ServiceDelayed --\u003e|\"Yes (Risk Assumed)\"| ServiceYesDelivered\n    ServiceDelayed --\u003e|\"No\"| ServiceNotDelivered\n    \n    SubscriptionFail --\u003e SubscriptionCurrent\n    SubscriptionCurrent --\u003e|\"Current\"| SubscriptionCurrentMonth\n    SubscriptionCurrent --\u003e|\"Renewal\"| SubscriptionRenewal\n```\n\n**Critical Business Rules:**\n- **Final payment failure**: Customer immediately loses vehicle reservation; vehicle becomes available stock marked \"sin asignar\" (unassigned) (lines 26-27)\n- **Service payment with assumed risk**: If service already delivered (immediate delivery strategy), attempt collection but never disable already-activated service\n- **Subscription mes vencido**: Charge at month end; if fails, cancel subscription but services continue until period expires\n- **No blocking of base platform**: Payment failures for optional services never affect the plataforma base functionality\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:26-27, 77-82\n\n---\n\n### Delivery Failure Handling\n\n```mermaid\nflowchart TD\n    VehicleReady[\"Vehicle Ready for Delivery\u003cbr/\u003eTransport Scheduled\"]\n    \n    TransportAttempt[\"Transport Company\u003cbr/\u003eArrives at Customer Address\"]\n    \n    CustomerPresent{\"Customer Present\u003cbr/\u003eand Ready?\"}\n    \n    SuccessfulDelivery[\"Successful Delivery\u003cbr/\u003eLink Mobile App to Vehicle\u003cbr/\u003eVehicle Status: Operational\"]\n    \n    ContactCustomer[\"Transport Calls Customer\u003cbr/\u003eAttempt to Arrange Pickup\"]\n    \n    CustomerAvailable{\"Customer Can\u003cbr/\u003eReceive Now?\"}\n    \n    WaitAndDeliver[\"Wait for Customer\u003cbr/\u003eComplete Delivery\"]\n    \n    ReturnToDealership[\"Return Vehicle to Dealership\u003cbr/\u003eState: Awaiting Customer Pickup\u003cbr/\u003eLocation: Concesionario\"]\n    \n    NotifyDealership[\"Notify Customer:\u003cbr/\u003eVehicle at Dealership\u003cbr/\u003eCoordinate Pickup Appointment\"]\n    \n    CustomerPickup[\"Customer Picks Up\u003cbr/\u003eat Dealership\"]\n    \n    LinkApp[\"Link Mobile App to Vehicle\u003cbr/\u003eComplete Delivery Process\"]\n    \n    NeverStreet[\"NEVER Leave Vehicle\u003cbr/\u003eon Street (Risk)\"]\n    \n    VehicleReady --\u003e TransportAttempt\n    TransportAttempt --\u003e CustomerPresent\n    \n    CustomerPresent --\u003e|\"Yes\"| SuccessfulDelivery\n    CustomerPresent --\u003e|\"No\"| ContactCustomer\n    \n    ContactCustomer --\u003e CustomerAvailable\n    \n    CustomerAvailable --\u003e|\"Yes - Short Wait\"| WaitAndDeliver\n    CustomerAvailable --\u003e|\"No\"| ReturnToDealership\n    \n    WaitAndDeliver --\u003e SuccessfulDelivery\n    \n    ReturnToDealership --\u003e NotifyDealership\n    NotifyDealership --\u003e CustomerPickup\n    CustomerPickup --\u003e LinkApp\n    LinkApp --\u003e SuccessfulDelivery\n    \n    CustomerPresent -.-\u003e|\"FORBIDDEN\"| NeverStreet\n```\n\n**Delivery Failure Protocol:**\n1. Transport company arrives at customer address\n2. If customer absent, transport calls customer phone\n3. If customer cannot receive vehicle immediately, **return to dealership** (never leave on street due to security risks)\n4. Customer notified that vehicle awaits pickup at dealership\n5. Customer collects vehicle at dealership at their convenience\n6. Mobile app linking occurs at point of actual delivery (home or dealership)\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:24-25\n\n---\n\n### Maintenance-Gated Service Blocking\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e VehicleOperational: \"Vehicle in Use\"\n    \n    state VehicleOperational {\n        [*] --\u003e MaintenanceCurrent\n        MaintenanceCurrent --\u003e ServiceRequestReceived: \"Customer Requests\u003cbr/\u003eOptional Service\"\n        \n        state ServiceRequestReceived {\n            [*] --\u003e CheckServiceType\n            CheckServiceType --\u003e MaintenanceRequired: \"Service Requires\u003cbr/\u003eCurrent Maintenance\"\n            CheckServiceType --\u003e NoMaintenanceRequired: \"Service Does NOT\u003cbr/\u003eRequire Maintenance\"\n            \n            state MaintenanceRequired {\n                [*] --\u003e QueryVSS\n                QueryVSS --\u003e VSSResponse: \"VSS API Call\"\n                VSSResponse --\u003e MaintenanceOK: \"All Required\u003cbr/\u003eMaintenance Current\"\n                VSSResponse --\u003e MaintenanceOverdue: \"Maintenance Block\u003cbr/\u003eExists for Service\"\n                \n                MaintenanceOK --\u003e AllowActivation\n                MaintenanceOverdue --\u003e BlockActivation\n                \n                BlockActivation --\u003e NotifyMaintenanceRequired: \"Explain Requirement\u003cbr/\u003eList Outstanding Items\"\n                NotifyMaintenanceRequired --\u003e [*]\n                \n                AllowActivation --\u003e ProcessPayment\n                ProcessPayment --\u003e [*]\n            }\n            \n            NoMaintenanceRequired --\u003e ProcessPayment\n            ProcessPayment --\u003e [*]\n        }\n        \n        ServiceRequestReceived --\u003e MaintenanceCurrent: \"Service Processed\"\n    }\n    \n    state WarrantyManagement {\n        MaintenanceCurrent --\u003e WarrantyValid: \"Maintenance Up-to-Date\"\n        WarrantyValid --\u003e WarrantyVoid: \"Maintenance Overdue\u003cbr/\u003eBeyond Threshold\"\n        WarrantyVoid --\u003e WarrantyValid: \"Maintenance Completed\u003cbr/\u003eWithin Grace Period\"\n    }\n    \n    VehicleOperational --\u003e WarrantyManagement: \"Parallel State\"\n    \n    state CriticalConstraint {\n        state \"CANNOT Block Vehicle Operation\" as CannotBlock\n        state \"CANNOT Disable Base Platform\" as CannotDisableBase\n        state \"CANNOT Disable Paid Services\" as CannotDisablePaid\n        state \"CAN ONLY Block New Service Activation\" as CanBlock\n    }\n    \n    note right of CriticalConstraint\n        Only police can prevent\n        vehicle from circulating.\n        CaaS can only gate NEW\n        service purchases for safety.\n    end note\n```\n\n**Maintenance Blocking Rules:**\n\n| Scenario | Allowed Action | Forbidden Action |\n|----------|----------------|------------------|\n| Maintenance overdue, customer requests new service requiring maintenance | Block new service activation, explain requirement | Disable vehicle operation |\n| Maintenance overdue, customer has active paid services | Allow continued use of paid services | Revoke already-activated services |\n| Maintenance overdue, customer using base platform | Allow base platform operation | Disable base functionality |\n| Warranty voided due to missed maintenance | Mark warranty void, communicate to customer | Prevent vehicle use |\n\n**VSS Integration for Maintenance Checks:**\n- CaaS queries VSS system to determine maintenance status (VSS is external, maintained by workshops)\n- Vehicle does NOT self-report maintenance status via IoT\n- VSS maintains historical records and compliance percentage by functional block\n- Each service definition specifies required maintenance blocks\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:60-73\n\n---\n\n## Customer Communication During Failures\n\n### Multi-Channel Notification Requirements\n\nAll critical failures require immediate multi-channel notification to ensure customer awareness:\n\n| Failure Type | Email | Push Notification | SMS | In-App Alert | Timeframe |\n|--------------|-------|-------------------|-----|--------------|-----------|\n| OTA Activation Failed (Final) |  Required |  Required | Optional |  Required | \u003c 15 minutes |\n| Payment Declined |  Required |  Required |  Required |  Required | Immediate |\n| Delivery Failed (Return to Dealership) |  Required |  Required |  Required | Optional | \u003c 1 hour |\n| Maintenance Blocking Service |  Required | Optional | Optional |  Required | At request time |\n| Subscription Cancelled (Payment Fail) |  Required |  Required | Optional |  Required | \u003c 24 hours |\n\n### Notification Content Requirements\n\n**OTA Failure Notification Template:**\n```\nSubject: Service Activation Issue - [Service Name]\n\nDear [Customer Name],\n\nWe encountered a technical issue activating the [Service Name] on your vehicle.\n\nStatus: Activation unsuccessful after multiple attempts\nAction: You have NOT been charged for this service\nNext Steps: Our technical team is investigating. We will contact you within 24 hours.\n\nIf you have questions, contact support at [Contact Info].\n```\n\n**Payment Failure Notification Template:**\n```\nSubject: Payment Issue - Action Required\n\nDear [Customer Name],\n\nYour payment for [Service/Vehicle] could not be processed.\n\nAmount: [Amount]\nReason: [Decline Reason]\nAction Required: Update payment method within [Timeframe]\n\n[For final payment]: Without payment, your vehicle reservation will be cancelled.\n[For service]: Service activation has been postponed until payment succeeds.\n```\n\n**Delivery Failure Notification Template:**\n```\nSubject: Vehicle Delivery Update - Pickup at Dealership\n\nDear [Customer Name],\n\nWe attempted delivery of your vehicle to [Address] but were unable to complete delivery.\n\nCurrent Location: [Dealership Name and Address]\nStatus: Vehicle ready for pickup\nAction: Please contact us to schedule pickup at your convenience\n\nYour vehicle is secure at the dealership.\n```\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:48-53, 24-29\n\n---\n\n## State Management During Failures\n\n### Entity State Transitions on Failure\n\n```mermaid\ngraph LR\n    subgraph \"Vehicle State Failures\"\n        VehicleAssigned[\"Vehicle State:\u003cbr/\u003eAssigned to Customer\"]\n        VehicleSinAsignar[\"Vehicle State:\u003cbr/\u003esin asignar\u003cbr/\u003e(unassigned)\"]\n        VehicleStock[\"Vehicle State:\u003cbr/\u003eStock para Venta\u003cbr/\u003e(available for sale)\"]\n        \n        VehicleAssigned --\u003e|\"Final Payment Failed\"| VehicleSinAsignar\n        VehicleSinAsignar --\u003e VehicleStock\n    end\n    \n    subgraph \"Service State Failures\"\n        ServicePending[\"Service State:\u003cbr/\u003ePayment Initiated\"]\n        ServiceActivating[\"Service State:\u003cbr/\u003eOTA in Progress\"]\n        ServiceActive[\"Service State:\u003cbr/\u003eActive\"]\n        ServiceFailed[\"Service State:\u003cbr/\u003eActivation Failed\"]\n        ServiceCancelled[\"Service State:\u003cbr/\u003eCancelled - No Charge\"]\n        \n        ServicePending --\u003e|\"Payment Success\"| ServiceActivating\n        ServiceActivating --\u003e|\"OTA Success\"| ServiceActive\n        ServiceActivating --\u003e|\"All Retries Failed\"| ServiceFailed\n        ServiceFailed --\u003e ServiceCancelled\n        \n        ServicePending --\u003e|\"Payment Failed\"| ServiceCancelled\n    end\n    \n    subgraph \"Order State Failures\"\n        OrderReservation[\"Order State:\u003cbr/\u003eReservation Paid\"]\n        OrderManufacturing[\"Order State:\u003cbr/\u003eIn Manufacturing\"]\n        OrderReady[\"Order State:\u003cbr/\u003eReady for Delivery\"]\n        OrderCancelled[\"Order State:\u003cbr/\u003eCancelled\"]\n        \n        OrderReservation --\u003e|\"Reservation Payment Failed\"| OrderCancelled\n        OrderReservation --\u003e|\"Factory Order Placed\"| OrderManufacturing\n        OrderManufacturing --\u003e OrderReady\n        OrderReady --\u003e|\"Final Payment Failed\"| OrderCancelled\n    end\n    \n    subgraph \"Subscription State Failures\"\n        SubActive[\"Subscription State:\u003cbr/\u003eActive\"]\n        SubPendingCancellation[\"Subscription State:\u003cbr/\u003ePending Cancellation\"]\n        SubCancelled[\"Subscription State:\u003cbr/\u003eCancelled\"]\n        \n        SubActive --\u003e|\"Mes Vencido Payment Failed\"| SubPendingCancellation\n        SubPendingCancellation --\u003e|\"Retry Failed\"| SubCancelled\n        SubActive --\u003e|\"Customer Cancels\"| SubPendingCancellation\n    end\n```\n\n**State Persistence Requirements:**\n- All state transitions must be atomic and logged for audit\n- Failed transactions must include rollback mechanisms\n- Customer-visible states must be consistent across all channels (web, mobile, intranet)\n- State transitions during failures must trigger appropriate notification workflows\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:26-27, 48-53, 77-82\n\n---\n\n## Integration Failure Handling\n\n### External System Circuit Breaker Pattern\n\n```mermaid\ngraph TB\n    subgraph \"API IoT Integration\"\n        OTARequest[\"OTA Activation Request\"]\n        CircuitClosed[\"Circuit: CLOSED\u003cbr/\u003eNormal Operation\"]\n        CircuitOpen[\"Circuit: OPEN\u003cbr/\u003eFail Fast\"]\n        CircuitHalfOpen[\"Circuit: HALF-OPEN\u003cbr/\u003eTesting Recovery\"]\n        \n        OTARequest --\u003e CircuitClosed\n        CircuitClosed --\u003e|\"Repeated Failures\u003cbr/\u003e\u003e Threshold\"| CircuitOpen\n        CircuitOpen --\u003e|\"After Timeout\u003cbr/\u003ePeriod\"| CircuitHalfOpen\n        CircuitHalfOpen --\u003e|\"Success\"| CircuitClosed\n        CircuitHalfOpen --\u003e|\"Failure\"| CircuitOpen\n        \n        CircuitOpen --\u003e FailFast[\"Return Failure Immediately\u003cbr/\u003eQueue for Retry Later\"]\n    end\n    \n    subgraph \"Factory API Integration\"\n        FactoryRequest[\"Order Placement Request\"]\n        FactoryRetry[\"Retry with\u003cbr/\u003eExponential Backoff\"]\n        FactoryQueue[\"Queue for\u003cbr/\u003eManual Processing\"]\n        \n        FactoryRequest --\u003e|\"Timeout/Error\"| FactoryRetry\n        FactoryRetry --\u003e|\"Max Retries\"| FactoryQueue\n    end\n    \n    subgraph \"VSS Integration\"\n        VSSQuery[\"Maintenance Status Query\"]\n        VSSCache[\"Use Cached Data\u003cbr/\u003eIf Recent\"]\n        VSSFallback[\"Allow Service\u003cbr/\u003ewith Warning\"]\n        \n        VSSQuery --\u003e|\"VSS Unavailable\"| VSSCache\n        VSSCache --\u003e|\"No Cache\"| VSSFallback\n    end\n    \n    subgraph \"Payment Gateway Integration\"\n        PaymentRequest[\"Payment Request\"]\n        PaymentAsync[\"Async Settlement\u003cbr/\u003eAssume Risk\"]\n        PaymentWebhook[\"Await Webhook\u003cbr/\u003eConfirmation\"]\n        PaymentReconcile[\"Daily Reconciliation\u003cbr/\u003eHandle Discrepancies\"]\n        \n        PaymentRequest --\u003e PaymentAsync\n        PaymentAsync --\u003e PaymentWebhook\n        PaymentWebhook --\u003e PaymentReconcile\n    end\n```\n\n**Integration Failure Strategies by System:**\n\n| External System | Primary Strategy | Fallback Strategy | Maximum Retry | Recovery Action |\n|-----------------|------------------|-------------------|---------------|-----------------|\n| **API IoT** | Circuit breaker with 5-failure threshold | Queue for later retry | N attempts over 24 hours | Technical support escalation |\n| **Factory API** | Exponential backoff retry | Manual order queue | 10 attempts | Human intervention required |\n| **VSS System** | Cache recent maintenance data (TTL: 1 hour) | Allow with warning notification | 3 attempts | Proceed with customer acknowledgment |\n| **Payment Gateway** | Async processing with reconciliation | Manual payment verification | Immediate + daily batch | Accounting team resolution |\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:33-44, 60-73\n\n---\n\n## Monitoring and Alerting for Failures\n\n### Failure Metrics and Thresholds\n\nCritical failures that require immediate operational alerts:\n\n| Metric | Threshold | Alert Severity | Response Team |\n|--------|-----------|----------------|---------------|\n| OTA activation failure rate | \u003e 5% in 1 hour | CRITICAL | Technical operations + IoT team |\n| Payment gateway availability | \u003c 95% in 15 minutes | CRITICAL | Finance + IT operations |\n| Factory API timeout rate | \u003e 10% in 30 minutes | HIGH | Integration team + factory liaison |\n| VSS query failures | \u003e 20% in 1 hour | MEDIUM | Integration team |\n| Customer notification delivery failures | \u003e 2% | HIGH | Communications team |\n| Final payment failure rate | \u003e 15% in 1 day | HIGH | Finance + sales teams |\n\n### Failure Audit Trail Requirements\n\nAll failures must be logged with:\n- Timestamp (UTC)\n- Customer identifier (hashed for privacy)\n- Failure type and category\n- System component that detected failure\n- Retry attempts made (if applicable)\n- Final resolution status\n- Customer communication sent\n- Financial impact (charged/not charged)\n\n**Sources:** pasame las preguntas y suas respuestas a markdown.md:48-53\n\n---\n\n## Summary and Sub-Page Navigation\n\nThis page provides a comprehensive overview of failure handling philosophy and critical scenarios across the CaaS platform. The system implements customer-favorable defaults for technical failures while enforcing strict business rules for policy violations.\n\n**For detailed implementation guidance on specific failure scenarios:**\n\n- **[OTA Activation Failures](#9.1)**: Detailed retry algorithms, backoff strategies, technical support escalation procedures, and the critical no-charge guarantee\n- **[Payment Failure Scenarios](#9.2)**: Comprehensive handling of reservation payment failures, final payment failures, service payment issues, and subscription billing failures\n- **[Delivery and Transport Issues](#9.3)**: Complete protocols for failed home delivery, customer absence, return to dealership procedures, and fallback scenarios\n- **[Special Scenarios (Theft, Warranty Loss)](#9.4)**: Edge case handling for vehicle theft, warranty voiding due to missed maintenance, and service blocking rules\n\n**Key Architectural Principles:**\n- Technical failures favor the customer (no charge, automatic refunds)\n- Business failures enforce policy strictly (lose reservation, cancel services)\n- External system failures use circuit breakers and retry logic\n- All failures trigger multi-channel customer communication\n- State management ensures consistency across all platforms\n\n**Sources:** pasame las preguntas y sus respuestas a markdown.md:1-104"])</script><script>self.__next_f.push([1,"34:T6d6d,"])</script><script>self.__next_f.push([1,"# OTA Activation Failures\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details how the CaaS system handles failures during Over-The-Air (OTA) service activation. It covers the retry logic, technical support escalation procedures, and the critical business rule that **customers must never be charged for services that fail to activate**.\n\nFor information about the normal OTA activation process and successful service delivery, see [OTA Service Activation](#6.2). For technical details about the IoT infrastructure and communication protocols, see [Vehicle Communication (IoT and OTA)](#5.3). For payment risk management strategies, see [Risk Management and Settlement](#7.2).\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n---\n\n## OTA Activation Failure Overview\n\nOTA activation failures occur when the system cannot successfully deliver a purchased service configuration to the customer's vehicle via the IoT network. These failures can happen due to various reasons including connectivity issues, vehicle state problems, or IoT network disruptions.\n\n### Critical Business Rule\n\n**The customer must NEVER be charged for a service that fails to activate.** This is a fundamental customer protection policy that ensures CaaS only charges for successfully delivered functionality.\n\n### Failure Categories\n\n| Failure Type | Description | System Response |\n|--------------|-------------|-----------------|\n| **Transient Connectivity** | Temporary network issues, vehicle offline | Automatic retry with backoff |\n| **Vehicle State Issues** | Vehicle in incompatible state (e.g., driving, powered off) | Automatic retry when state changes |\n| **Configuration Conflicts** | Service conflicts with existing vehicle configuration | Technical support escalation |\n| **Persistent IoT Failures** | API IoT system errors or vehicle communication module failure | Technical support escalation |\n| **Timeout Errors** | Command sent but no acknowledgment received | Retry with status query |\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n---\n\n## OTA Activation State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e PaymentSuccessful: \"Customer pays for service\"\n    \n    PaymentSuccessful --\u003e OTAQueuedForActivation: \"Service queued for OTA delivery\"\n    \n    OTAQueuedForActivation --\u003e OTAAttempt1: \"Begin activation attempt 1\"\n    \n    OTAAttempt1 --\u003e VehicleStatusCheck: \"Check vehicle connectivity/state\"\n    \n    VehicleStatusCheck --\u003e SendOTACommand: \"Vehicle ready\"\n    VehicleStatusCheck --\u003e WaitForVehicleReady: \"Vehicle not ready\"\n    \n    WaitForVehicleReady --\u003e VehicleStatusCheck: \"Poll vehicle status\"\n    WaitForVehicleReady --\u003e OTAAttempt2: \"Timeout - move to attempt 2\"\n    \n    SendOTACommand --\u003e AwaitAcknowledgment: \"Command sent via API IoT\"\n    \n    AwaitAcknowledgment --\u003e ServiceActivated: \"ACK received, success\"\n    AwaitAcknowledgment --\u003e OTAAttempt2: \"Timeout or NACK\"\n    \n    OTAAttempt2 --\u003e VehicleStatusCheck2: \"Begin attempt 2\"\n    VehicleStatusCheck2 --\u003e SendOTACommand2: \"Vehicle ready\"\n    VehicleStatusCheck2 --\u003e OTAAttemptN: \"Vehicle not ready, skip to final attempt\"\n    \n    SendOTACommand2 --\u003e AwaitAcknowledgment2: \"Command sent\"\n    AwaitAcknowledgment2 --\u003e ServiceActivated: \"Success\"\n    AwaitAcknowledgment2 --\u003e OTAAttemptN: \"Failed\"\n    \n    OTAAttemptN --\u003e VehicleStatusCheckN: \"Begin final attempt N\"\n    VehicleStatusCheckN --\u003e SendOTACommandN: \"Vehicle ready\"\n    VehicleStatusCheckN --\u003e ProactiveStatusQuery: \"Vehicle not ready, query detailed status\"\n    \n    SendOTACommandN --\u003e AwaitAcknowledgmentN: \"Command sent\"\n    AwaitAcknowledgmentN --\u003e ServiceActivated: \"Success\"\n    AwaitAcknowledgmentN --\u003e ProactiveStatusQuery: \"Failed\"\n    \n    ProactiveStatusQuery --\u003e GatherDiagnostics: \"Retrieve vehicle logs/status via API IoT\"\n    GatherDiagnostics --\u003e EscalateToTechSupport: \"Package diagnostics\"\n    \n    EscalateToTechSupport --\u003e NotifyCustomerFailure: \"Create tech support ticket\"\n    NotifyCustomerFailure --\u003e ProcessRefund: \"Send failure notification\"\n    \n    ProcessRefund --\u003e ServiceActivationFailed: \"Reverse charge or mark as no-charge\"\n    \n    ServiceActivated --\u003e NotifyCustomerSuccess: \"Log successful activation\"\n    NotifyCustomerSuccess --\u003e [*]: \"Service operational\"\n    \n    ServiceActivationFailed --\u003e [*]: \"Customer not charged\"\n```\n\n**Diagram: OTA Activation State Machine with Retry Logic**\n\nThis state machine shows how the system progresses through multiple activation attempts, proactively gathers diagnostics on final failure, and ensures the customer is never charged for failed activations.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n---\n\n## Retry Logic and Configuration\n\n### Retry Mechanism\n\nThe system implements a configurable retry mechanism with the following characteristics:\n\n1. **Multiple Attempts**: The system attempts OTA activation a predetermined number of times (N attempts)\n2. **Proactive Status Queries**: Between attempts, the system actively queries vehicle status via the API IoT\n3. **Exponential Backoff**: Delays between retries increase progressively to avoid overwhelming the IoT network\n4. **State-Aware Retries**: The system checks vehicle readiness before each attempt\n\n### Retry Flow Sequence\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant PaymentSystem as \"Payment System\"\n    participant OTAEngine as \"OTA Activation Engine\"\n    participant APIIoT as \"API IoT\"\n    participant Vehicle\n    participant TechSupport as \"Technical Support\"\n    participant NotificationEngine as \"Notification Engine\"\n    \n    Customer-\u003e\u003ePaymentSystem: \"Purchase service\"\n    PaymentSystem-\u003e\u003eOTAEngine: \"Payment successful, activate service\"\n    \n    Note over OTAEngine: Attempt 1\n    OTAEngine-\u003e\u003eAPIIoT: \"Query vehicle status\"\n    APIIoT-\u003e\u003eVehicle: \"GET /vehicle/{id}/status\"\n    Vehicle--\u003e\u003eAPIIoT: \"Status: online, ready\"\n    APIIoT--\u003e\u003eOTAEngine: \"Vehicle ready\"\n    \n    OTAEngine-\u003e\u003eAPIIoT: \"POST /vehicle/{id}/activate-service\"\n    APIIoT-\u003e\u003eVehicle: \"Send OTA command\"\n    Vehicle--\u003e\u003eAPIIoT: \"NACK - busy\"\n    APIIoT--\u003e\u003eOTAEngine: \"Activation failed: vehicle busy\"\n    \n    Note over OTAEngine: Wait (backoff delay)\n    \n    Note over OTAEngine: Attempt 2\n    OTAEngine-\u003e\u003eAPIIoT: \"Query vehicle status\"\n    APIIoT-\u003e\u003eVehicle: \"GET /vehicle/{id}/status\"\n    Vehicle--\u003e\u003eAPIIoT: \"Status: offline\"\n    APIIoT--\u003e\u003eOTAEngine: \"Vehicle offline\"\n    \n    Note over OTAEngine: Wait (longer backoff)\n    \n    Note over OTAEngine: Attempt N (final)\n    OTAEngine-\u003e\u003eAPIIoT: \"Query vehicle status\"\n    APIIoT-\u003e\u003eVehicle: \"GET /vehicle/{id}/status\"\n    Vehicle--\u003e\u003eAPIIoT: \"Status: online\"\n    APIIoT--\u003e\u003eOTAEngine: \"Vehicle online\"\n    \n    OTAEngine-\u003e\u003eAPIIoT: \"POST /vehicle/{id}/activate-service\"\n    APIIoT-\u003e\u003eVehicle: \"Send OTA command\"\n    Vehicle--\u003e\u003eAPIIoT: \"Timeout - no response\"\n    APIIoT--\u003e\u003eOTAEngine: \"Activation failed: timeout\"\n    \n    Note over OTAEngine: All retries exhausted\n    \n    OTAEngine-\u003e\u003eAPIIoT: \"GET /vehicle/{id}/diagnostics\"\n    APIIoT-\u003e\u003eVehicle: \"Request detailed diagnostics\"\n    Vehicle--\u003e\u003eAPIIoT: \"Diagnostic data\"\n    APIIoT--\u003e\u003eOTAEngine: \"Vehicle diagnostics\"\n    \n    OTAEngine-\u003e\u003eTechSupport: \"Create ticket with diagnostics\"\n    OTAEngine-\u003e\u003eNotificationEngine: \"Trigger failure notification\"\n    NotificationEngine-\u003e\u003eCustomer: \"Service activation failed (email/app/SMS)\"\n    \n    OTAEngine-\u003e\u003ePaymentSystem: \"Mark as NO CHARGE\"\n    \n    Note over Customer: Customer NOT charged\n```\n\n**Diagram: OTA Activation Retry Sequence with Final Failure**\n\nThis sequence diagram illustrates the multiple retry attempts, vehicle status checks, and eventual escalation when all retries are exhausted.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n### Retry Configuration Parameters\n\n| Parameter | Typical Value | Description |\n|-----------|--------------|-------------|\n| `max_retry_attempts` | 3-5 | Maximum number of activation attempts before escalation |\n| `initial_backoff_seconds` | 60 | Delay before first retry |\n| `backoff_multiplier` | 2.0 | Exponential backoff factor |\n| `max_backoff_seconds` | 3600 | Maximum delay between retries (1 hour) |\n| `status_query_timeout` | 30 | Timeout for vehicle status queries (seconds) |\n| `activation_command_timeout` | 120 | Timeout for OTA activation command acknowledgment (seconds) |\n\n---\n\n## Technical Support Escalation\n\n### Escalation Trigger\n\nTechnical support escalation occurs when:\n1. All retry attempts have been exhausted\n2. The service still cannot be activated\n3. The system has gathered proactive diagnostic information from the vehicle\n\n### Escalation Workflow\n\n```mermaid\nflowchart TD\n    AllRetriesFailed[\"All OTA retry attempts failed\"]\n    \n    GatherDiagnostics[\"Gather vehicle diagnostics\u003cbr/\u003evia API IoT\"]\n    \n    CreatePackage[\"Create diagnostic package:\u003cbr/\u003e- Activation attempt log\u003cbr/\u003e- Vehicle status history\u003cbr/\u003e- API IoT error responses\u003cbr/\u003e- Service configuration details\u003cbr/\u003e- Customer information\"]\n    \n    CreateTicket[\"Create technical support ticket\u003cbr/\u003ein support system\"]\n    \n    AssignTicket[\"Auto-assign to OTA support queue\"]\n    \n    NotifyCustomer[\"Send customer notification:\u003cbr/\u003e'Technical issue detected,\u003cbr/\u003eour team is investigating'\"]\n    \n    MarkNoCharge[\"Mark service as NO CHARGE\u003cbr/\u003ein billing system\"]\n    \n    LogFailure[\"Log failure metrics\u003cbr/\u003efor monitoring\"]\n    \n    TechReview{\"Technical\u003cbr/\u003esupport review\"}\n    \n    VehicleIssue[\"Vehicle hardware/firmware issue\"]\n    ContactCustomer[\"Contact customer for\u003cbr/\u003edealership appointment\"]\n    \n    ConfigIssue[\"Configuration or service\u003cbr/\u003ecompatibility issue\"]\n    UpdateCatalog[\"Update service catalog rules\"]\n    \n    IoTIssue[\"API IoT or network issue\"]\n    EscalateToIoT[\"Escalate to IoT infrastructure team\"]\n    \n    ManualActivation[\"Attempt manual activation\u003cbr/\u003evia support tools\"]\n    \n    ManualSuccess{\"Manual activation\u003cbr/\u003esuccessful?\"}\n    \n    ActivateService[\"Service activated successfully\"]\n    NotifySuccess[\"Notify customer: service now active\"]\n    \n    ScheduleFollowup[\"Schedule followup to prevent\u003cbr/\u003esimilar failures\"]\n    \n    AllRetriesFailed --\u003e GatherDiagnostics\n    GatherDiagnostics --\u003e CreatePackage\n    CreatePackage --\u003e CreateTicket\n    CreateTicket --\u003e AssignTicket\n    AssignTicket --\u003e NotifyCustomer\n    NotifyCustomer --\u003e MarkNoCharge\n    MarkNoCharge --\u003e LogFailure\n    LogFailure --\u003e TechReview\n    \n    TechReview --\u003e VehicleIssue\n    TechReview --\u003e ConfigIssue\n    TechReview --\u003e IoTIssue\n    \n    VehicleIssue --\u003e ContactCustomer\n    ConfigIssue --\u003e UpdateCatalog\n    IoTIssue --\u003e EscalateToIoT\n    \n    ContactCustomer --\u003e ManualActivation\n    UpdateCatalog --\u003e ManualActivation\n    EscalateToIoT --\u003e ManualActivation\n    \n    ManualActivation --\u003e ManualSuccess\n    ManualSuccess --\u003e|Yes| ActivateService\n    ManualSuccess --\u003e|No| ScheduleFollowup\n    \n    ActivateService --\u003e NotifySuccess\n    NotifySuccess --\u003e ScheduleFollowup\n```\n\n**Diagram: Technical Support Escalation Workflow**\n\nThis flowchart shows the complete escalation process from failure detection through technical support resolution.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n### Diagnostic Package Contents\n\nThe system proactively gathers the following information to include in the technical support ticket:\n\n| Diagnostic Data | Source | Purpose |\n|-----------------|--------|---------|\n| **Activation Attempt Log** | OTA Engine internal logs | Complete history of all retry attempts with timestamps and results |\n| **Vehicle Status Snapshots** | API IoT queries | Vehicle connectivity, power state, active services at each retry |\n| **API IoT Error Responses** | API IoT integration layer | Detailed error codes and messages from the IoT API |\n| **Service Configuration** | Service Catalog | Exact service definition and configuration parameters attempted |\n| **Vehicle Model/Firmware** | Vehicle registry | Vehicle identification, model, and firmware version |\n| **Customer Information** | Customer database | Customer contact details and vehicle purchase date |\n| **Network Metrics** | IoT Gateway logs | Network latency, packet loss, connection stability |\n\n---\n\n## Customer Protection: The \"Do Not Charge\" Rule\n\n### Business Rule Implementation\n\nThe fundamental business rule states: **If a service fails to activate via OTA, the customer must NOT be charged for that service.**\n\nThis rule is implemented at multiple layers to ensure customer protection:\n\n```mermaid\nflowchart LR\n    PaymentInitiated[\"Payment initiated\u003cbr/\u003eby customer\"]\n    \n    HoldPayment[\"Hold payment in\u003cbr/\u003ePENDING state\"]\n    \n    OTAActivation[\"OTA activation\u003cbr/\u003eprocess\"]\n    \n    ActivationSuccess{\"Activation\u003cbr/\u003esuccessful?\"}\n    \n    CompleteCharge[\"Complete payment:\u003cbr/\u003ePENDING  CHARGED\"]\n    \n    ReverseCharge[\"Reverse payment:\u003cbr/\u003ePENDING  CANCELLED\"]\n    \n    AlreadyCharged{\"Payment already\u003cbr/\u003esettled?\"}\n    \n    IssueRefund[\"Issue immediate refund\u003cbr/\u003eto customer\"]\n    \n    MarkNoCharge[\"Mark as NO CHARGE\u003cbr/\u003ein billing system\"]\n    \n    UpdateAccountingState[\"Update service state:\u003cbr/\u003ePAID  FAILED_NO_CHARGE\"]\n    \n    NotifyCustomer[\"Notify customer:\u003cbr/\u003e'No charge for failed service'\"]\n    \n    UpdateExpediente[\"Update expediente de compra:\u003cbr/\u003eShow failed activation,\u003cbr/\u003eno charge applied\"]\n    \n    PaymentInitiated --\u003e HoldPayment\n    HoldPayment --\u003e OTAActivation\n    OTAActivation --\u003e ActivationSuccess\n    \n    ActivationSuccess --\u003e|Yes| CompleteCharge\n    ActivationSuccess --\u003e|No| ReverseCharge\n    \n    ReverseCharge --\u003e AlreadyCharged\n    AlreadyCharged --\u003e|Yes| IssueRefund\n    AlreadyCharged --\u003e|No| MarkNoCharge\n    \n    IssueRefund --\u003e UpdateAccountingState\n    MarkNoCharge --\u003e UpdateAccountingState\n    \n    UpdateAccountingState --\u003e NotifyCustomer\n    NotifyCustomer --\u003e UpdateExpediente\n```\n\n**Diagram: Payment Protection Flow for Failed OTA Activations**\n\nThis diagram shows how the payment system protects customers from being charged for failed service activations.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n### Payment State Management\n\nThe system manages payment states carefully to implement the \"do not charge\" rule:\n\n| Payment State | Description | Transition Conditions |\n|--------------|-------------|----------------------|\n| `INITIATED` | Customer clicked \"pay\" but payment not yet sent to gateway | Initial state when service purchase begins |\n| `PENDING` | Payment sent to gateway, awaiting settlement | Payment gateway accepted the payment request |\n| `HELD_FOR_ACTIVATION` | Payment held until OTA activation completes | OTA activation process started |\n| `CHARGED` | Payment completed, service successfully activated | OTA activation successful |\n| `CANCELLED` | Payment cancelled before settlement | OTA activation failed before payment settled |\n| `REFUNDED` | Payment settled but refunded due to activation failure | OTA activation failed after payment settled |\n| `FAILED_NO_CHARGE` | Service purchase failed, customer never charged | Final state for failed activations |\n\n### Implementation Across System Layers\n\nThe \"do not charge\" rule is enforced at multiple levels:\n\n1. **OTA Engine Layer**: Marks service activation as failed and triggers payment reversal\n2. **Payment Processing Layer**: Cancels pending charges or issues refunds for settled charges\n3. **Billing System Layer**: Records the service as \"FAILED_NO_CHARGE\" in billing records\n4. **Customer Expediente Layer**: Updates the customer's purchase file to reflect the failed activation and zero charge\n5. **Notification Layer**: Sends clear communication to customer about the failure and no-charge status\n\n---\n\n## Notification and Communication Flow\n\n### Customer Communication Strategy\n\nWhen OTA activation fails, the system must communicate clearly with the customer to maintain trust and transparency.\n\n```mermaid\nflowchart TD\n    ActivationFailed[\"OTA activation failed\u003cbr/\u003eafter all retries\"]\n    \n    DetermineChannels[\"Determine notification channels:\u003cbr/\u003e- Email (always)\u003cbr/\u003e- Mobile app push (if app installed)\u003cbr/\u003e- SMS (if critical)\"]\n    \n    ComposeMessage[\"Compose customer message:\u003cbr/\u003e'Service activation issue,\u003cbr/\u003eno charge applied,\u003cbr/\u003etechnical team working on it'\"]\n    \n    SendEmail[\"Send email notification\"]\n    SendPush[\"Send app push notification\"]\n    SendSMS[\"Send SMS (optional)\"]\n    \n    UpdateExpediente[\"Update expediente de compra:\u003cbr/\u003eShow activation status\"]\n    \n    RecordNotification[\"Record notification sent\u003cbr/\u003ein customer communication log\"]\n    \n    TechSupportResolution{\"Technical support\u003cbr/\u003eresolves issue?\"}\n    \n    ManualActivationSuccess[\"Service manually activated\"]\n    NotifySuccess[\"Notify customer:\u003cbr/\u003e'Service now active'\"]\n    UpdateExpedienteSuccess[\"Update expediente:\u003cbr/\u003eService now operational\"]\n    \n    PermanentFailure[\"Cannot activate service\"]\n    NotifyPermanentFailure[\"Notify customer:\u003cbr/\u003e'Service unavailable for\u003cbr/\u003eyour vehicle, full refund'\"]\n    OfferAlternative[\"Offer alternative service\u003cbr/\u003eor future discount\"]\n    \n    ActivationFailed --\u003e DetermineChannels\n    DetermineChannels --\u003e ComposeMessage\n    ComposeMessage --\u003e SendEmail\n    ComposeMessage --\u003e SendPush\n    ComposeMessage --\u003e SendSMS\n    \n    SendEmail --\u003e UpdateExpediente\n    SendPush --\u003e UpdateExpediente\n    SendSMS --\u003e UpdateExpediente\n    \n    UpdateExpediente --\u003e RecordNotification\n    RecordNotification --\u003e TechSupportResolution\n    \n    TechSupportResolution --\u003e|Resolved| ManualActivationSuccess\n    TechSupportResolution --\u003e|Cannot resolve| PermanentFailure\n    \n    ManualActivationSuccess --\u003e NotifySuccess\n    NotifySuccess --\u003e UpdateExpedienteSuccess\n    \n    PermanentFailure --\u003e NotifyPermanentFailure\n    NotifyPermanentFailure --\u003e OfferAlternative\n```\n\n**Diagram: Customer Notification Flow for OTA Failures**\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n### Notification Message Templates\n\n| Notification Type | Channel | Message Content | Timing |\n|------------------|---------|-----------------|--------|\n| **Initial Failure** | Email, App | \"We're experiencing a technical issue activating [Service Name] on your vehicle. Our technical team is working to resolve this. You will NOT be charged for this service.\" | Immediately after final retry fails |\n| **Technical Support Ticket Created** | Email | \"We've created a support ticket (#[TICKET_ID]) for your service activation issue. Our team will contact you if we need any information.\" | After escalation |\n| **Manual Resolution Success** | Email, App, SMS | \"Good news! We've successfully activated [Service Name] on your vehicle. The service is now available for use.\" | After technical support manually activates |\n| **Permanent Failure** | Email, Phone | \"Unfortunately, we cannot activate [Service Name] on your vehicle due to technical compatibility. We've issued a full refund and would like to offer you [Alternative].\" | After technical support determines permanent failure |\n\n---\n\n## System State Management During Failures\n\n### Service Activation State Lifecycle\n\nThe system maintains detailed state information for each service activation attempt:\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ServicePurchaseInitiated: \"Customer requests service\"\n    \n    ServicePurchaseInitiated --\u003e PaymentPending: \"Payment initiated\"\n    \n    PaymentPending --\u003e ActivationQueued: \"Payment held, OTA queued\"\n    \n    ActivationQueued --\u003e AttemptInProgress: \"Begin first attempt\"\n    \n    AttemptInProgress --\u003e AttemptFailed: \"Attempt failed\"\n    AttemptInProgress --\u003e ServiceActive: \"Attempt succeeded\"\n    \n    AttemptFailed --\u003e RetryScheduled: \"Retries remaining\"\n    AttemptFailed --\u003e EscalatedToSupport: \"All retries exhausted\"\n    \n    RetryScheduled --\u003e AttemptInProgress: \"Next retry attempt\"\n    \n    EscalatedToSupport --\u003e AwaitingSupportResolution: \"Ticket created\"\n    EscalatedToSupport --\u003e PaymentCancelled: \"Cancel/refund payment\"\n    \n    PaymentCancelled --\u003e FailedNoCharge: \"Mark as no charge\"\n    \n    AwaitingSupportResolution --\u003e ManualActivationAttempt: \"Support investigates\"\n    \n    ManualActivationAttempt --\u003e ServiceActive: \"Manual activation successful\"\n    ManualActivationAttempt --\u003e PermanentFailure: \"Cannot activate\"\n    \n    PermanentFailure --\u003e FailedNoCharge: \"Ensure no charge\"\n    \n    FailedNoCharge --\u003e [*]: \"Failure recorded, customer protected\"\n    \n    ServiceActive --\u003e [*]: \"Service operational\"\n```\n\n**Diagram: Service Activation State Lifecycle with Failure Handling**\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()\n\n### State Tracking Tables\n\nThe system maintains several state tracking mechanisms:\n\n#### Service Activation Attempts Table\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `attempt_id` | UUID | Unique identifier for each activation attempt |\n| `service_activation_id` | UUID | Foreign key to service activation request |\n| `attempt_number` | Integer | Sequential attempt number (1, 2, ..., N) |\n| `attempt_timestamp` | Timestamp | When the attempt was made |\n| `vehicle_status_at_attempt` | JSON | Vehicle status snapshot from API IoT |\n| `ota_command_sent` | Boolean | Whether OTA command was successfully sent |\n| `ota_response_code` | String | Response code from API IoT |\n| `ota_response_message` | Text | Detailed response message |\n| `attempt_result` | Enum | `SUCCESS`, `FAILED_RETRY`, `FAILED_ESCALATE` |\n\n#### Service Activation State Table\n\n| Field | Type | Description |\n|-------|------|-------------|\n| `service_activation_id` | UUID | Unique identifier for service activation |\n| `customer_id` | UUID | Customer who purchased the service |\n| `vehicle_id` | UUID | Target vehicle |\n| `service_id` | UUID | Service being activated |\n| `payment_id` | UUID | Associated payment record |\n| `current_state` | Enum | Current state in lifecycle |\n| `activation_queued_at` | Timestamp | When activation was queued |\n| `total_attempts` | Integer | Total number of attempts made |\n| `tech_support_ticket_id` | String | Support ticket if escalated |\n| `final_result` | Enum | `ACTIVE`, `FAILED_NO_CHARGE`, `MANUAL_ACTIVATION` |\n| `created_at` | Timestamp | Record creation time |\n| `updated_at` | Timestamp | Last update time |\n\n---\n\n## Integration with Payment and Service Systems\n\n### Cross-System Coordination\n\nOTA activation failures require coordination across multiple system components:\n\n```mermaid\ngraph TB\n    subgraph \"Customer Layer\"\n        WebApp[\"Web Platform\"]\n        MobileApp[\"Mobile Application\"]\n        Expediente[\"Expediente de Compra\"]\n    end\n    \n    subgraph \"Business Logic Layer\"\n        ServiceCatalog[\"Service Catalog\"]\n        OTAEngine[\"OTA Activation Engine\"]\n        NotificationEngine[\"Notification Engine\"]\n    end\n    \n    subgraph \"Payment Layer\"\n        PaymentProcessor[\"Payment Processor\"]\n        BillingSystem[\"Billing System\"]\n        RefundProcessor[\"Refund Processor\"]\n    end\n    \n    subgraph \"Integration Layer\"\n        APIIoT[\"API IoT Gateway\"]\n        TechSupportSystem[\"Technical Support System\"]\n    end\n    \n    subgraph \"Data Layer\"\n        ServiceDB[(\"Service Activation\u003cbr/\u003eState Database\")]\n        PaymentDB[(\"Payment\u003cbr/\u003eState Database\")]\n        VehicleDB[(\"Vehicle\u003cbr/\u003eRegistry\")]\n    end\n    \n    subgraph \"External\"\n        Vehicle[\"Connected Vehicle\"]\n    end\n    \n    WebApp --\u003e ServiceCatalog\n    MobileApp --\u003e ServiceCatalog\n    \n    ServiceCatalog --\u003e OTAEngine\n    OTAEngine --\u003e APIIoT\n    APIIoT --\u003e Vehicle\n    \n    OTAEngine --\u003e ServiceDB\n    OTAEngine --\u003e NotificationEngine\n    OTAEngine --\u003e PaymentProcessor\n    OTAEngine --\u003e TechSupportSystem\n    \n    PaymentProcessor --\u003e PaymentDB\n    PaymentProcessor --\u003e RefundProcessor\n    RefundProcessor --\u003e BillingSystem\n    \n    NotificationEngine --\u003e WebApp\n    NotificationEngine --\u003e MobileApp\n    NotificationEngine --\u003e Expediente\n    \n    ServiceDB --\u003e Expediente\n    PaymentDB --\u003e Expediente\n    \n    TechSupportSystem --\u003e OTAEngine\n    \n    APIIoT --\u003e VehicleDB\n```\n\n**Diagram: System Integration for OTA Failure Handling**\n\nThis diagram shows how OTA activation failures trigger coordinated actions across payment, notification, and technical support systems.\n\nSources: [pasame las preguntas y suas respuestas a markdown.md:48-56]()\n\n### Failure Event Propagation\n\nWhen OTA activation fails, events propagate through the system:\n\n| Source Component | Event Type | Target Components | Action Triggered |\n|-----------------|------------|-------------------|------------------|\n| **OTA Engine** | `OTA_ACTIVATION_FAILED` | Payment Processor | Cancel or refund payment |\n| **OTA Engine** | `OTA_ACTIVATION_FAILED` | Notification Engine | Send customer failure notification |\n| **OTA Engine** | `OTA_ACTIVATION_ESCALATED` | Technical Support System | Create support ticket with diagnostics |\n| **OTA Engine** | `OTA_ACTIVATION_FAILED` | Service Database | Update service state to `FAILED_NO_CHARGE` |\n| **OTA Engine** | `OTA_ACTIVATION_FAILED` | Expediente System | Update customer purchase file |\n| **Technical Support System** | `MANUAL_ACTIVATION_SUCCESSFUL` | OTA Engine | Mark service as active |\n| **Technical Support System** | `PERMANENT_ACTIVATION_FAILURE` | Payment Processor | Ensure refund completed |\n| **Payment Processor** | `PAYMENT_CANCELLED` | Billing System | Record zero-charge transaction |\n| **Payment Processor** | `REFUND_ISSUED` | Notification Engine | Notify customer of refund |\n\n---\n\n## Monitoring and Metrics\n\n### Key Failure Metrics\n\nThe system should track the following metrics to monitor OTA activation health:\n\n| Metric | Description | Alert Threshold |\n|--------|-------------|----------------|\n| **OTA Success Rate** | Percentage of successful first-attempt activations | \u003c 95% |\n| **Average Retries to Success** | Average number of attempts before success | \u003e 2.0 |\n| **Escalation Rate** | Percentage of activations escalated to tech support | \u003e 5% |\n| **Time to Activation** | Average time from payment to successful activation | \u003e 15 minutes |\n| **Permanent Failure Rate** | Percentage of activations that never succeed | \u003e 1% |\n| **Customer Impact Rate** | Activations that failed after payment settled (requiring refund) | \u003e 0.5% |\n\n### Failure Analysis Dashboard\n\nTechnical teams should monitor:\n\n1. **Failure by Reason**: Breakdown of failure types (connectivity, timeout, vehicle state)\n2. **Failure by Vehicle Model**: Which vehicle models have higher failure rates\n3. **Failure by Service Type**: Which services fail more frequently\n4. **Failure by Time of Day**: Temporal patterns in failures\n5. **Retry Success Rate by Attempt**: How many succeed on attempt 1, 2, 3, etc.\n6. **Tech Support Resolution Time**: Time from escalation to resolution\n\n---\n\n## Summary\n\nOTA activation failures are handled through a multi-layered approach that prioritizes customer protection:\n\n1. **Automatic Retry Logic**: Multiple attempts with progressive backoff and proactive vehicle status checks\n2. **Diagnostic Gathering**: Proactive collection of vehicle and system diagnostics for troubleshooting\n3. **Technical Support Escalation**: Automatic ticket creation with comprehensive diagnostic packages\n4. **Payment Protection**: Strict enforcement of the \"do not charge\" rule through payment state management\n5. **Customer Communication**: Clear, multi-channel notifications keeping customers informed\n6. **State Tracking**: Comprehensive state management across all system components\n7. **Monitoring**: Metrics and alerting to detect and address systemic issues\n\nThe critical business rule**never charge for failed activations**is enforced at multiple system layers to ensure customer trust and legal compliance.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-56]()"])</script><script>self.__next_f.push([1,"35:T5739,"])</script><script>self.__next_f.push([1,"# Payment Failure Scenarios\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details the system's behavior when payment transactions fail at various stages of the customer journey. It covers three distinct payment failure scenarios: final vehicle payments, one-time service payments, and subscription billing failures. Each scenario has different business implications and system responses.\n\nFor information about the payment processing architecture and risk management strategy, see [Risk Management and Settlement](#7.2). For details about payment types and normal flows, see [Payment Types and Flows](#7.1). For OTA activation failures (which may trigger payment reversals), see [OTA Activation Failures](#9.1).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Final Payment Failure (Vehicle Purchase)\n\n### Business Context\n\nWhen a customer completes the vehicle purchase process, two payments are required:\n1. **Reservation payment (seal)** - Initial deposit to secure the vehicle order\n2. **Final payment** - Remaining balance, due before vehicle registration and delivery\n\nThe final payment is a critical checkpoint. Failure at this stage has severe consequences for the customer and triggers specific system state transitions.\n\n### System Behavior on Final Payment Failure\n\nWhen the final payment fails or the customer cannot provide payment at delivery time:\n\n1. **Vehicle ownership reverts to dealership** - The vehicle is immediately reclaimed\n2. **Vehicle status changes to \"sin asignar\" (unassigned)** - System marks vehicle as no longer assigned to any customer\n3. **Vehicle becomes stock for immediate sale** - Vehicle enters dealership inventory for sale to other customers\n4. **Customer loses reservation entirely** - No refund of reservation payment, no vehicle delivery\n5. **Customer record remains but vehicle link is severed** - Customer account exists but has no associated vehicle\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Final Payment Failure State Diagram\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e ReservationPaid: \"Reservation Payment Successful\"\n    ReservationPaid --\u003e VehicleManufacturing: \"Factory Order Placed\"\n    VehicleManufacturing --\u003e VehicleReady: \"Manufacturing Complete\"\n    VehicleReady --\u003e FinalPaymentRequested: \"Vehicle Ready for Delivery\"\n    \n    FinalPaymentRequested --\u003e FinalPaymentAttempt: \"Customer Attempts Final Payment\"\n    \n    FinalPaymentAttempt --\u003e PaymentSuccess: \"Payment Successful\"\n    FinalPaymentAttempt --\u003e PaymentFailed: \"Payment Failed or Customer Absent\"\n    \n    PaymentSuccess --\u003e VehicleRegistered: \"Register with Admin Bodies\"\n    VehicleRegistered --\u003e VehicleDelivered: \"Transport to Customer\"\n    VehicleDelivered --\u003e [*]: \"Customer Receives Vehicle\"\n    \n    PaymentFailed --\u003e VehicleMarkedSinAsignar: \"Mark Vehicle 'sin asignar'\"\n    VehicleMarkedSinAsignar --\u003e VehicleBecomesStock: \"Add to Dealership Inventory\"\n    VehicleBecomesStock --\u003e CustomerLosesReservation: \"Customer Record Updated\"\n    CustomerLosesReservation --\u003e AvailableForResale: \"Vehicle Ready for New Sale\"\n    AvailableForResale --\u003e [*]: \"Customer Loses Vehicle and Reservation\"\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Database State Transitions\n\nThe following table shows the critical state changes in the system when final payment fails:\n\n| Entity | Field | Before Failure | After Failure |\n|--------|-------|----------------|---------------|\n| Vehicle | `assignment_status` | `ASSIGNED_TO_CUSTOMER` | `SIN_ASIGNAR` |\n| Vehicle | `inventory_status` | `IN_MANUFACTURING` or `AWAITING_DELIVERY` | `DEALERSHIP_STOCK` |\n| Customer Order | `status` | `AWAITING_FINAL_PAYMENT` | `CANCELLED_PAYMENT_FAILURE` |\n| Customer Order | `vehicle_id` | `\u003cvehicle_id\u003e` | `NULL` |\n| Vehicle | `customer_id` | `\u003ccustomer_id\u003e` | `NULL` |\n| Dealership Inventory | `available_stock` | `N` | `N + 1` |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Business Rules for Final Payment Failure\n\n1. **No grace period** - Payment must succeed at the designated time; no payment plans or extensions\n2. **Reservation payment is non-refundable** - Customer forfeits the initial deposit\n3. **Immediate inventory transition** - Vehicle must be available for resale without delay\n4. **No customer recourse** - Customer cannot reclaim the vehicle by later providing payment\n5. **Dealership bears no loss** - Vehicle returns to saleable inventory at full value\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n---\n\n## Service Payment Failure (One-Time Services)\n\n### Business Context\n\nWhen customers purchase optional services (opciones disponibles) as one-time activations, payment is processed through the payment gateway. Due to the asynchronous nature of payment settlement, CaaS assumes risk by delivering services before bank confirmation.\n\n### System Behavior on Service Payment Failure\n\nThe service payment failure scenario differs significantly from final payment failures because of the **customer-protection policy** and **OTA activation dependency**.\n\n```mermaid\nflowchart TD\n    Start[\"Customer Selects Service\"] --\u003e CheckMaintenance[\"Check Maintenance Status via VSS\"]\n    CheckMaintenance --\u003e MaintenanceOK{\"Maintenance Current?\"}\n    \n    MaintenanceOK --\u003e|\"No\"| BlockService[\"Block Service Purchase\"]\n    MaintenanceOK --\u003e|\"Yes\"| InitiatePayment[\"Initiate Payment via Gateway\"]\n    \n    InitiatePayment --\u003e PaymentAttempt{\"Payment Gateway Response\"}\n    \n    PaymentAttempt --\u003e|\"Immediate Failure\"| PaymentRejected[\"Payment Rejected\"]\n    PaymentAttempt --\u003e|\"Accepted (Pending Settlement)\"| QueueOTA[\"Queue OTA Activation\"]\n    \n    PaymentRejected --\u003e NotifyCustomerFailure[\"Notify Customer: Payment Failed\"]\n    NotifyCustomerFailure --\u003e NoService[\"NO Service Delivered\"]\n    NotifyCustomerFailure --\u003e NoCharge[\"NO Charge Applied\"]\n    \n    QueueOTA --\u003e AttemptOTA[\"Attempt OTA Activation\"]\n    AttemptOTA --\u003e OTAResult{\"OTA Activation Result\"}\n    \n    OTAResult --\u003e|\"Success\"| ServiceActive[\"Service Activated\"]\n    OTAResult --\u003e|\"Failure After Retries\"| OTAFailed[\"OTA Failed - See Section 9.1\"]\n    \n    ServiceActive --\u003e SettlementCheck{\"Payment Settlement Status\"}\n    SettlementCheck --\u003e|\"Settlement Confirmed\"| ChargeCustomer[\"Charge Customer\"]\n    SettlementCheck --\u003e|\"Settlement Failed\"| RiskAssumed[\"CaaS Assumes Loss\"]\n    \n    OTAFailed --\u003e ReversePayment[\"Reverse Payment Authorization\"]\n    ReversePayment --\u003e RefundCustomer[\"Refund Customer\"]\n    RefundCustomer --\u003e NoChargeOTA[\"DO NOT CHARGE Customer\"]\n    \n    BlockService --\u003e End1[\"End - No Purchase\"]\n    NoService --\u003e End2[\"End - Payment Failed\"]\n    NoChargeOTA --\u003e End3[\"End - OTA Failed\"]\n    ChargeCustomer --\u003e End4[\"End - Service Delivered and Paid\"]\n    RiskAssumed --\u003e End5[\"End - Service Delivered, CaaS Risk\"]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82, 48-53]()\n\n### Critical Business Rule: No Charge for Undelivered Services\n\nThe most important rule for service payment failures is:\n\n**If OTA activation fails after all retries, the customer MUST NOT be charged, even if payment was initially authorized.**\n\nThis rule protects customers from paying for functionality they did not receive and is implemented through:\n1. Payment authorization hold (not immediate capture)\n2. OTA activation attempt with retries (see [OTA Activation Failures](#9.1))\n3. Payment reversal if OTA ultimately fails\n4. Customer notification of both OTA failure and payment reversal\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:48-53]()\n\n### Payment-OTA Coordination Logic\n\n```mermaid\nsequenceDiagram\n    participant Customer\n    participant PaymentGateway\n    participant CaaS\n    participant OTAEngine\n    participant IoTNetwork\n    participant Vehicle\n    \n    Customer-\u003e\u003eCaaS: \"Request Service Purchase\"\n    CaaS-\u003e\u003ePaymentGateway: \"Authorize Payment (Hold)\"\n    PaymentGateway--\u003e\u003eCaaS: \"Authorization Successful\"\n    \n    Note over CaaS: \"Payment authorized but NOT captured\"\n    \n    CaaS-\u003e\u003eOTAEngine: \"Queue OTA Activation\"\n    OTAEngine-\u003e\u003eIoTNetwork: \"Send OTA Command (Attempt 1)\"\n    IoTNetwork-\u003e\u003eVehicle: \"Configure Service\"\n    Vehicle--\u003e\u003eIoTNetwork: \"ACK or Timeout\"\n    IoTNetwork--\u003e\u003eOTAEngine: \"Result\"\n    \n    alt \"OTA Success\"\n        OTAEngine--\u003e\u003eCaaS: \"Activation Successful\"\n        CaaS-\u003e\u003ePaymentGateway: \"Capture Payment\"\n        PaymentGateway--\u003e\u003eCaaS: \"Payment Captured\"\n        CaaS-\u003e\u003eCustomer: \"Notify: Service Active\"\n    else \"OTA Failure After Retries\"\n        OTAEngine--\u003e\u003eCaaS: \"Activation Failed (All Retries Exhausted)\"\n        CaaS-\u003e\u003ePaymentGateway: \"Reverse Authorization\"\n        PaymentGateway--\u003e\u003eCaaS: \"Authorization Reversed\"\n        CaaS-\u003e\u003eCustomer: \"Notify: Service Failed, No Charge\"\n        Note over Customer: \"Customer sees temporary charge reversal\"\n    end\n```\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:48-53, 77-82]()\n\n### Asynchronous Settlement Risk\n\nCaaS assumes settlement risk by delivering services before final bank settlement confirmation. This creates a potential failure scenario:\n\n| Scenario | Payment Gateway Status | OTA Status | System Action |\n|----------|----------------------|------------|---------------|\n| Happy Path | Authorized  Settled | Success | Charge confirmed, service active |\n| OTA Failure | Authorized  Reversed | Failed all retries | NO CHARGE, customer notified |\n| Settlement Failure | Authorized  Settlement Failed | Success | **CaaS absorbs loss**, service remains active |\n| Authorization Failure | Rejected immediately | Not attempted | No service, no charge, notify customer |\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n### Key Difference from Final Payment Failure\n\nUnlike final payment failure (which revokes vehicle ownership), service payment failure:\n- **Does not revoke existing services** - Previously activated services remain active\n- **Does not block future purchases** - Customer can attempt to purchase again\n- **Protects customer from OTA failures** - No charge if service cannot be delivered\n- **Allows CaaS to assume settlement risk** - Prioritizes customer experience over financial guarantee\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82, 48-53]()\n\n---\n\n## Subscription Payment Failure\n\n### Business Context\n\nSubscription services use a **mes vencido** (post-paid) billing model where customers are charged at the end of each billing period for services consumed during that period. This creates a unique payment failure scenario where the service has already been delivered before payment is attempted.\n\n### System Behavior on Subscription Payment Failure\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e SubscriptionActive: \"Customer Subscribes to Service\"\n    SubscriptionActive --\u003e MonthlyUsage: \"Customer Uses Service During Month\"\n    MonthlyUsage --\u003e MonthEnd: \"Billing Period Ends\"\n    \n    MonthEnd --\u003e AttemptBilling: \"Generate Invoice, Attempt Charge\"\n    \n    AttemptBilling --\u003e PaymentSuccess: \"Payment Successful\"\n    AttemptBilling --\u003e PaymentFailed: \"Payment Failed\"\n    \n    PaymentSuccess --\u003e SubscriptionActive: \"Continue Subscription for Next Month\"\n    \n    PaymentFailed --\u003e RetryPayment: \"Retry Payment (Configurable Attempts)\"\n    RetryPayment --\u003e RetrySuccess: \"Retry Successful\"\n    RetryPayment --\u003e AllRetriesFailed: \"All Retries Failed\"\n    \n    RetrySuccess --\u003e SubscriptionActive: \"Continue Subscription\"\n    \n    AllRetriesFailed --\u003e SuspendService: \"Suspend Subscription Service\"\n    SuspendService --\u003e NotifyCustomer: \"Notify Customer: Payment Failed, Service Suspended\"\n    NotifyCustomer --\u003e CancelSubscription: \"Cancel Subscription\"\n    \n    CancelSubscription --\u003e OutstandingDebt: \"Record Outstanding Debt\"\n    OutstandingDebt --\u003e [*]: \"Subscription Terminated\"\n```\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n### Mes Vencido Billing Implications\n\nThe **mes vencido** (end-of-month) billing model creates specific challenges:\n\n1. **Service already consumed** - Customer has used the service for the entire billing period before payment is attempted\n2. **Cannot revoke delivered service** - Unlike one-time services where OTA can be reversed, subscription services consumed during the month cannot be \"taken back\"\n3. **Debt accumulation** - Failed payment creates an outstanding debt for services already rendered\n4. **Subscription cancellation** - Failure to pay results in automatic subscription cancellation for future periods\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n### Subscription Payment Failure Decision Tree\n\n```mermaid\nflowchart TD\n    BillingCycle[\"End of Monthly Billing Cycle\"] --\u003e GenerateInvoice[\"Generate Invoice for Month's Usage\"]\n    GenerateInvoice --\u003e AttemptCharge[\"Attempt to Charge Customer\"]\n    \n    AttemptCharge --\u003e PaymentResult{\"Initial Payment Attempt\"}\n    \n    PaymentResult --\u003e|\"Success\"| PaymentConfirmed[\"Payment Confirmed\"]\n    PaymentResult --\u003e|\"Failure\"| FirstRetry[\"Wait 24-48 Hours, Retry\"]\n    \n    PaymentConfirmed --\u003e ContinueService[\"Continue Subscription Next Month\"]\n    PaymentConfirmed --\u003e UpdateBilling[\"Update Billing History\"]\n    \n    FirstRetry --\u003e Retry1Result{\"Retry 1 Result\"}\n    Retry1Result --\u003e|\"Success\"| PaymentConfirmed\n    Retry1Result --\u003e|\"Failure\"| SecondRetry[\"Wait 24-48 Hours, Retry\"]\n    \n    SecondRetry --\u003e Retry2Result{\"Retry 2 Result\"}\n    Retry2Result --\u003e|\"Success\"| PaymentConfirmed\n    Retry2Result --\u003e|\"Failure\"| FinalRetry[\"Wait 24-48 Hours, Final Retry\"]\n    \n    FinalRetry --\u003e Retry3Result{\"Retry 3 Result\"}\n    Retry3Result --\u003e|\"Success\"| PaymentConfirmed\n    Retry3Result --\u003e|\"Failure\"| AllFailed[\"All Payment Attempts Failed\"]\n    \n    AllFailed --\u003e SuspendAccess[\"Suspend Subscription Access\"]\n    SuspendAccess --\u003e RecordDebt[\"Record Outstanding Debt in System\"]\n    RecordDebt --\u003e NotifyCustomerDebt[\"Notify Customer: Debt + Cancellation\"]\n    NotifyCustomerDebt --\u003e CancelSub[\"Cancel Subscription\"]\n    \n    CancelSub --\u003e DebtCollection{\"Debt Collection Policy\"}\n    DebtCollection --\u003e|\"Pursue Collection\"| CollectionProcess[\"External Collection Process\"]\n    DebtCollection --\u003e|\"Write Off\"| WriteOff[\"Write Off Debt\"]\n    \n    ContinueService --\u003e NextMonth[\"Start Next Billing Cycle\"]\n    CollectionProcess --\u003e End1[\"End - Debt Collection\"]\n    WriteOff --\u003e End2[\"End - Debt Written Off\"]\n    NextMonth --\u003e End3[\"End - Subscription Continues\"]\n```\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n### Subscription vs One-Time Payment Failure Comparison\n\n| Aspect | One-Time Service Payment Failure | Subscription Payment Failure |\n|--------|----------------------------------|------------------------------|\n| **Timing** | Payment before service delivery | Payment after service consumption (mes vencido) |\n| **Service Delivery** | NO service if payment fails | Service already delivered for the period |\n| **Customer Impact** | Customer doesn't get service | Customer gets service but owes payment |\n| **System Action** | Reverse authorization, no charge | Record debt, cancel future subscription |\n| **Future Access** | Can purchase again immediately | Subscription cancelled, no future access until resolved |\n| **Financial Risk** | Low - no service delivered | High - service consumed without payment |\n| **Retry Logic** | Single payment attempt at purchase | Multiple retry attempts over days/weeks |\n| **Customer Protection** | Strong - no charge for failed delivery | Standard - customer responsible for consumed services |\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n### Outstanding Debt Management\n\nWhen subscription payment fails after all retries, the system must:\n\n1. **Record the debt** - Store outstanding amount, billing period, and service consumed\n2. **Cancel future billing** - Prevent new charges while debt exists\n3. **Suspend service access** - Deactivate subscription service via OTA\n4. **Block new subscriptions** - Prevent customer from subscribing to other services until debt resolved\n5. **Notify customer** - Send notification of debt, cancellation, and resolution options\n6. **Track debt status** - Monitor whether customer pays outstanding amount or debt is written off\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n---\n\n## Payment Failure Impact Matrix\n\nThe following table summarizes the system-wide impacts of different payment failure scenarios:\n\n| Payment Type | Failure Point | Vehicle Access | Service Access | Customer Status | Financial Impact | Recovery Path |\n|--------------|---------------|----------------|----------------|-----------------|------------------|---------------|\n| **Final Payment** | Before registration | Customer loses vehicle | No services (no vehicle) | Reservation cancelled | Customer loses deposit | Cannot recover - must purchase new vehicle |\n| **One-Time Service** | Before OTA activation | No impact | Service not activated | Active customer | No charge to customer | Can attempt purchase again immediately |\n| **One-Time Service** | After OTA failure | No impact | Service not activated | Active customer | CaaS absorbs auth/reversal costs | Can attempt purchase again after tech support resolution |\n| **One-Time Service** | Settlement failure after OTA success | No impact | Service remains active | Active customer | **CaaS absorbs full cost** | Customer keeps service, CaaS takes loss |\n| **Subscription Billing** | End of month (mes vencido) | No impact | Subscription cancelled after retries | Active but in debt | Customer owes for consumed month | Pay debt to restore subscription access |\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:26-27, 48-53, 77-82]()\n\n---\n\n## Technical Implementation Considerations\n\n### Payment Authorization vs Capture\n\nThe system must implement a two-phase payment protocol for one-time services:\n\n1. **Authorization Phase** - Hold funds on customer's payment method but do not capture\n2. **OTA Activation Phase** - Attempt service delivery with retries\n3. **Capture Phase** - Only capture if OTA succeeds; otherwise reverse authorization\n\nThis pattern prevents charging customers for services that fail to activate.\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:48-53, 77-82]()\n\n### Idempotency and Retry Safety\n\nPayment operations must be idempotent to handle:\n- Network failures during payment processing\n- Duplicate webhook notifications from payment gateway\n- System crashes between payment and OTA activation\n- Multiple retry attempts for subscription billing\n\nEach payment transaction should have a unique `idempotency_key` to prevent duplicate charges.\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n### State Consistency Between Payment and OTA Systems\n\nThe system must maintain consistency between payment state and OTA activation state:\n\n```mermaid\nflowchart LR\n    subgraph \"Payment System State\"\n        PayAuth[\"AUTHORIZED\"]\n        PayCaptured[\"CAPTURED\"]\n        PayReversed[\"REVERSED\"]\n        PaySettled[\"SETTLED\"]\n    end\n    \n    subgraph \"OTA System State\"\n        OTAQueued[\"QUEUED\"]\n        OTAInProgress[\"IN_PROGRESS\"]\n        OTASuccess[\"SUCCESS\"]\n        OTAFailed[\"FAILED\"]\n    end\n    \n    subgraph \"Service State\"\n        ServicePending[\"PENDING_ACTIVATION\"]\n        ServiceActive[\"ACTIVE\"]\n        ServiceFailed[\"FAILED_ACTIVATION\"]\n    end\n    \n    PayAuth --\u003e OTAQueued\n    OTAQueued --\u003e OTAInProgress\n    OTAInProgress --\u003e OTASuccess\n    OTAInProgress --\u003e OTAFailed\n    \n    OTASuccess --\u003e PayCaptured\n    PayCaptured --\u003e PaySettled\n    \n    OTAFailed --\u003e PayReversed\n    \n    OTASuccess --\u003e ServiceActive\n    OTAFailed --\u003e ServiceFailed\n    OTAQueued --\u003e ServicePending\n```\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:48-53, 77-82]()\n\n### Notification Requirements\n\nThe system must send customer notifications for all payment failure scenarios:\n\n| Scenario | Notification Channels | Message Content | Timing |\n|----------|----------------------|-----------------|--------|\n| Final payment failure | Email + SMS | Vehicle reservation lost, no refund | Immediate |\n| Service payment rejected | Email + Push notification | Payment declined, no service delivered, no charge | Immediate |\n| OTA failure after payment | Email + Push notification | Service failed to activate, payment reversed, no charge | After final retry fails |\n| Subscription payment failure | Email | Payment failed, will retry, subscription at risk | After each failed attempt |\n| Subscription cancelled | Email + Push notification | Payment failed after retries, subscription cancelled, debt owed | After final retry fails |\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:26-27, 48-53, 77-82]()\n\n### Reconciliation Process\n\nDue to asynchronous payment settlement, the system requires a reconciliation process:\n\n1. **Daily reconciliation** - Compare payment gateway settlement reports with CaaS internal records\n2. **Identify discrepancies** - Flag transactions where settlement status differs from expected\n3. **Handle settlement failures** - Mark services as \"CaaS absorbed cost\" when settlement fails after delivery\n4. **Report for accounting** - Generate financial reports showing risk assumption costs\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:77-82]()\n\n---\n\n## Integration with Other Failure Scenarios\n\nPayment failures often interact with other failure scenarios:\n\n- **OTA Failures** - See [OTA Activation Failures](#9.1) for details on retry logic and technical support escalation\n- **Delivery Failures** - Final payment typically occurs at delivery; see [Delivery and Transport Issues](#9.3) for coordination\n- **Theft/Loss** - Outstanding subscription debts may exist when vehicle is stolen; see [Special Scenarios](#9.4)\n\n**Sources:** [pasame las preguntas y suas respuestas a markdown.md:26-27, 48-53, 77-82, 91-96]()"])</script><script>self.__next_f.push([1,"36:T3a29,"])</script><script>self.__next_f.push([1,"# Delivery and Transport Issues\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document details the procedures and system behaviors for handling vehicle delivery failures and transport complications in the CaaS system. It covers scenarios where home delivery cannot be completed, customer absence at delivery time, return-to-dealership procedures, and related status management.\n\nFor information about the normal manufacturing and delivery workflow, see [Manufacturing and Delivery Workflow](#8.2). For payment-related failures that occur during final payment before registration, see [Payment Failure Scenarios](#9.2).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Overview\n\nVehicle delivery in the CaaS system involves coordination between the factory, a subcontracted transport company, the dealership, and the customer. The system must handle several failure scenarios while maintaining strict security policies that prohibit leaving vehicles unattended in unsecured locations.\n\nThe primary failure scenario occurs when home delivery is attempted but the customer is not present to receive the vehicle. This triggers a fallback procedure where the vehicle returns to the dealership for customer pickup.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-29]()\n\n---\n\n## Transport Coordination Architecture\n\n### Transport Subcontracting Model\n\nThe CaaS system does not manage its own vehicle transport fleet. Instead, transport is **subcontracted to specialized transport companies** (\"empresa de transporte\"). The system's responsibility is to track critical handoff points:\n\n| Tracking Point | Location | Recording Responsibility |\n|---|---|---|\n| **Shipment (Embarcacin)** | Factory/Manufacturer | Factory system notifies CaaS |\n| **Receipt (Recepcin)** | Dealership | Dealership records in CaaS intranet |\n| **Delivery Attempt** | Customer Address | Transport company/Dealership logs outcome |\n| **Final Delivery** | Customer Address or Dealership | Customer acceptance recorded |\n\n### Delivery Scheduling\n\n**The factory determines the delivery date** based on its manufacturing schedule and logistics planning. Neither the dealership nor the transport subcontractor has authority to modify this schedule unilaterally. The CaaS system receives delivery date information asynchronously from the factory API.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-23]()\n\n---\n\n## Home Delivery Process\n\n### Normal Delivery Flow\n\n```mermaid\nsequenceDiagram\n    participant Factory as \"Factory System\"\n    participant CaaS as \"CaaS Platform\"\n    participant Transport as \"Transport Company\"\n    participant Customer as \"Customer\"\n    participant Dealership as \"Dealership\"\n    \n    Factory-\u003e\u003eCaaS: \"Vehicle Ready for Shipment\"\n    Factory-\u003e\u003eTransport: \"Ship Vehicle to Customer Address\"\n    Transport-\u003e\u003eCaaS: \"Shipment Initiated\"\n    \n    Note over Transport: \"In Transit\"\n    \n    Transport-\u003e\u003eCustomer: \"Call: Delivery Scheduled\"\n    Customer--\u003e\u003eTransport: \"Confirm Availability\"\n    \n    Transport-\u003e\u003eCustomer: \"Arrive at Address\"\n    Customer-\u003e\u003eTransport: \"Accept Delivery\"\n    \n    Transport-\u003e\u003eCaaS: \"Delivery Successful\"\n    CaaS-\u003e\u003eCustomer: \"Delivery Complete - Link Mobile App\"\n    CaaS-\u003e\u003eDealership: \"Vehicle Delivered to Customer\"\n```\n\n**Delivery Successful Flow Diagram**\n\nIn the successful scenario, the transport company contacts the customer in advance, confirms availability, completes delivery, and notifies the CaaS system. The customer can then proceed to link their mobile application to the vehicle.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-29]()\n\n---\n\n### Failed Delivery Scenarios\n\n#### Customer Absence at Delivery Time\n\nThe most common delivery failure occurs when the transport arrives at the customer's address and the customer is not present or cannot receive the vehicle.\n\n**Procedure:**\n\n1. **Transport attempts contact**: The transport company (\"la gra\") calls the customer upon arrival\n2. **Customer unavailable**: If the customer cannot come to receive the vehicle immediately\n3. **Security policy enforced**: The vehicle is **never left on the street** due to theft and liability risks\n4. **Return to dealership**: The transport returns the vehicle to the dealership\n5. **Customer notification**: CaaS system notifies the customer that delivery failed and the vehicle awaits pickup at the dealership\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n#### Critical Security Rule\n\n\u003e **The vehicle is NEVER left unattended on the street.** This is a firm security policy to prevent theft, vandalism, and liability issues. If delivery cannot be completed, return to dealership is mandatory.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n---\n\n## Return to Dealership Procedure\n\n### Delivery Failure State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e \"In Transit to Customer\"\n    \n    \"In Transit to Customer\" --\u003e \"Delivery Attempted\"\n    \n    \"Delivery Attempted\" --\u003e \"Delivery Successful\": \"Customer Present \u0026 Accepts\"\n    \"Delivery Attempted\" --\u003e \"Customer Contact Failed\": \"Customer Absent/Unavailable\"\n    \n    \"Customer Contact Failed\" --\u003e \"Returning to Dealership\": \"Security Policy: Never Leave Unattended\"\n    \n    \"Returning to Dealership\" --\u003e \"At Dealership - Awaiting Pickup\": \"Vehicle Stored Securely\"\n    \n    \"At Dealership - Awaiting Pickup\" --\u003e \"Customer Notified\": \"CaaS Sends Notification\"\n    \n    \"Customer Notified\" --\u003e \"Customer Pickup Scheduled\": \"Customer Contacts Dealership\"\n    \n    \"Customer Pickup Scheduled\" --\u003e \"Vehicle Handed Over\": \"Customer Arrives at Dealership\"\n    \n    \"Vehicle Handed Over\" --\u003e \"Delivery Successful\"\n    \n    \"Delivery Successful\" --\u003e [*]: \"Link Mobile App to Vehicle\"\n```\n\n**Vehicle Delivery State Machine**\n\nThis state machine illustrates the complete delivery lifecycle including the fallback path through dealership pickup.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n---\n\n### Status Tracking and Notifications\n\nThe CaaS system must track vehicle status throughout the delivery process and provide automatic notifications to customers.\n\n#### Vehicle Status Values During Delivery\n\n| Status Value | Meaning | Next Valid States |\n|---|---|---|\n| `IN_TRANSIT_TO_CUSTOMER` | Vehicle en route to customer address | `DELIVERY_ATTEMPTED`, `AT_DEALERSHIP_AWAITING_PICKUP` |\n| `DELIVERY_ATTEMPTED` | Transport attempted delivery | `DELIVERED_TO_CUSTOMER`, `RETURNING_TO_DEALERSHIP` |\n| `RETURNING_TO_DEALERSHIP` | Transport returning vehicle | `AT_DEALERSHIP_AWAITING_PICKUP` |\n| `AT_DEALERSHIP_AWAITING_PICKUP` | Vehicle stored at dealership waiting for customer | `CUSTOMER_PICKUP_SCHEDULED`, `IN_TRANSIT_TO_CUSTOMER` (retry) |\n| `CUSTOMER_PICKUP_SCHEDULED` | Customer has scheduled pickup time | `DELIVERED_TO_CUSTOMER` |\n| `DELIVERED_TO_CUSTOMER` | Customer has accepted vehicle | `OPERATIONAL` (after app linking) |\n\n#### Automatic Notifications\n\n**Notification Type: Delivery Failure**\n\nThe notification system must automatically inform the customer when delivery fails:\n\n- **Channel**: Email, SMS, and push notification (if app installed)\n- **Content**: \n  - Delivery was attempted at [address]\n  - Vehicle returned to dealership: [dealership name and address]\n  - Instructions for scheduling pickup\n  - Contact information for dealership\n- **Timing**: Immediately upon transport company reporting return to dealership\n\n**Notification Type: Pickup Reminder**\n\nFollow-up notifications may be sent if customer does not schedule pickup within a reasonable timeframe.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n## Customer Pickup at Dealership\n\n### Pickup Process Flow\n\n```mermaid\nflowchart TD\n    START[\"Vehicle at Dealership\u003cbr/\u003eStatus: AT_DEALERSHIP_AWAITING_PICKUP\"] --\u003e NOTIFY[\"CaaS Sends Notification\u003cbr/\u003eto Customer\"]\n    \n    NOTIFY --\u003e CONTACT[\"Customer Contacts\u003cbr/\u003eDealership\"]\n    \n    CONTACT --\u003e SCHEDULE[\"Dealership Schedules\u003cbr/\u003ePickup Appointment\"]\n    SCHEDULE --\u003e UPDATE[\"Update Status:\u003cbr/\u003eCUSTOMER_PICKUP_SCHEDULED\"]\n    \n    UPDATE --\u003e ARRIVE[\"Customer Arrives\u003cbr/\u003eat Dealership\"]\n    ARRIVE --\u003e VERIFY[\"Verify Customer Identity\u003cbr/\u003eand Documentation\"]\n    \n    VERIFY --\u003e VERIFY_OK{\"Verification\u003cbr/\u003eSuccessful?\"}\n    \n    VERIFY_OK --\u003e|\"Yes\"| HANDOVER[\"Hand Over Vehicle Keys\u003cbr/\u003eand Documentation\"]\n    VERIFY_OK --\u003e|\"No\"| DENY[\"Deny Pickup\u003cbr/\u003eNotify CaaS\"]\n    \n    HANDOVER --\u003e LINK[\"Customer Links\u003cbr/\u003eMobile App to Vehicle\"]\n    LINK --\u003e COMPLETE[\"Update Status:\u003cbr/\u003eDELIVERED_TO_CUSTOMER\"]\n    \n    COMPLETE --\u003e OPERATIONAL[\"Vehicle Becomes\u003cbr/\u003eOperational\"]\n    \n    DENY --\u003e CONTACT\n```\n\n**Customer Pickup at Dealership Process**\n\nWhen home delivery fails, the customer must physically visit the dealership to receive the vehicle. This process includes identity verification and the same mobile app linking that would have occurred at home delivery.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-25]()\n\n---\n\n### Dealership Responsibilities During Pickup\n\nThe dealership must:\n\n1. **Secure Storage**: Store the vehicle securely until customer pickup\n2. **Status Updates**: Record in the CaaS intranet system when customer schedules pickup\n3. **Customer Verification**: Verify customer identity matches purchase records\n4. **Vehicle Handover**: Provide keys, documentation, and basic vehicle orientation\n5. **Mobile App Linking**: Assist customer in linking mobile app to vehicle if needed\n6. **Status Confirmation**: Mark delivery as complete in the CaaS system\n\n---\n\n## Vehicle Status Management\n\n### Database State Transitions\n\nThe system must maintain accurate vehicle status throughout the delivery process. While actual code implementation is not provided, the system would typically maintain:\n\n#### Vehicle Delivery Record Fields\n\n```\nVehicle.delivery_status: ENUM\nVehicle.delivery_address: String (customer address)\nVehicle.assigned_customer_id: Foreign Key\nVehicle.delivery_attempted_at: Timestamp\nVehicle.delivery_failure_reason: String\nVehicle.at_dealership_since: Timestamp\nVehicle.dealership_id: Foreign Key (for storage location)\n```\n\n#### Delivery Attempt Logging\n\nEach delivery attempt should be logged for tracking and analytics:\n\n```\nDeliveryAttempt.vehicle_id: Foreign Key\nDeliveryAttempt.attempt_number: Integer\nDeliveryAttempt.attempted_at: Timestamp\nDeliveryAttempt.outcome: ENUM (SUCCESS, CUSTOMER_ABSENT, ADDRESS_INACCESSIBLE, etc.)\nDeliveryAttempt.notes: Text\nDeliveryAttempt.transport_company_id: Foreign Key\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-29]()\n\n---\n\n## Integration Points\n\n### Transport Company Communication\n\nThe CaaS system must integrate with transport companies to receive delivery status updates. This may involve:\n\n- **Webhooks**: Transport company posts delivery outcomes to CaaS API\n- **Status Polling**: CaaS queries transport company API for status updates\n- **Manual Entry**: Dealership staff record delivery outcomes in intranet\n\n### Factory Integration\n\nThe factory system notifies CaaS when vehicles are ready for shipment. This triggers the delivery workflow:\n\n- **Factory  CaaS**: Asynchronous notification of shipment\n- **Data Included**: Vehicle VIN, expected delivery date, transport company assigned\n- **CaaS Action**: Create delivery tracking record, schedule customer notifications\n\nRelated to factory integration documented in [Factory Integration](#5.1).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:20-23, 42-44]()\n\n---\n\n## Related Failure Scenarios\n\n### Payment Failure at Pickup\n\nIf the customer arrives at the dealership for pickup but cannot complete the final payment:\n\n- **Outcome**: Vehicle is **not delivered** to customer\n- **Vehicle Status**: Changes to `SIN_ASIGNAR` (unassigned)\n- **Business Impact**: Vehicle becomes available stock for immediate sale\n- **Customer Impact**: Customer loses their reservation\n\nThis scenario is detailed in [Payment Failure Scenarios](#9.2).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:26-27]()\n\n### Repeated Delivery Failures\n\nIf a customer repeatedly fails to receive delivery or pickup the vehicle, the dealership may:\n\n1. Contact customer to understand availability constraints\n2. Offer alternative delivery times or locations\n3. As last resort, consider the purchase abandoned and mark vehicle as stock\n\nThe system should track number of delivery attempts and flag vehicles requiring management attention.\n\n---\n\n## Operational Metrics\n\n### Key Performance Indicators for Delivery\n\nThe CaaS system should track:\n\n| Metric | Description | Business Value |\n|---|---|---|\n| **First-Attempt Delivery Rate** | Percentage of deliveries successful on first attempt | Customer satisfaction, cost efficiency |\n| **Average Time to Pickup** | Days from failed delivery to customer pickup at dealership | Process efficiency |\n| **Failed Delivery Rate** | Percentage requiring return to dealership | Transport cost, customer inconvenience |\n| **Delivery to Operational Time** | Time from vehicle receipt to customer using vehicle | End-to-end customer experience |\n\n### Reporting Requirements\n\nDealerships and management should have access to:\n\n- **Vehicles awaiting pickup**: List of vehicles at dealership waiting for customers\n- **Delivery failure trends**: Analysis of failure reasons by region, time of day, etc.\n- **Customer contact effectiveness**: Success rate of customer contact before delivery\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:18-29]()\n\n---\n\n## Summary\n\nDelivery and transport issues in the CaaS system primarily center on the **customer absence scenario** during home delivery. The system enforces a strict security policy that vehicles are never left unattended, requiring a fallback to dealership pickup when the customer is unavailable.\n\n**Key Principles:**\n\n1. **Security First**: Never leave vehicles unsecured on streets\n2. **Customer Communication**: Proactive notifications about delivery status and pickup requirements\n3. **Status Tracking**: Accurate recording of delivery attempts and vehicle location\n4. **Flexible Recovery**: Dealership pickup provides reliable fallback for failed home delivery\n5. **Payment Enforcement**: Final payment must be completed before vehicle handover\n\nThe delivery process integrates with factory systems, transport companies, and dealership operations, requiring careful coordination and status management across organizational boundaries.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"37:T4056,"])</script><script>self.__next_f.push([1,"# Special Scenarios (Theft, Warranty Loss)\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page documents system behavior for exceptional scenarios that affect service availability and customer rights: **vehicle theft** and **warranty loss due to missed maintenance**. These scenarios require special handling because they alter the normal service lifecycle without following standard cancellation or refund paths.\n\nFor standard service cancellation and refund processes, see [Service Cancellation and Refunds](#6.4). For maintenance-gated service access during normal operations, see [Maintenance-Linked Service Access](#6.3). For warranty rules during normal operations, see [Business Rules and Policies](#2.3).\n\nThis page covers:\n- How vehicle theft affects active and pending services\n- Warranty loss implications when mandatory maintenance is missed\n- Service blocking rules that prevent unsafe activations\n- System constraints that protect customer mobility rights\n\n---\n\n## Vehicle Theft Scenarios\n\n### Business Rules for Stolen Vehicles\n\nWhen a vehicle is reported stolen, the CaaS system applies distinct rules for different service states:\n\n| Service State | System Behavior | Refund Eligibility |\n|---------------|-----------------|-------------------|\n| **Delivered Services** | No automatic cancellation | Subject to standard desistimiento rules (14-day window if service \u003e 14 days) |\n| **Pending Services** | Customer can cancel future activations | Full refund for undelivered services |\n| **Active Subscriptions** | Customer can cancel auto-renewal | No refund for current billing period (already consumed) |\n| **Future Subscription Periods** | Can be cancelled preemptively | Full refund (service not yet delivered) |\n\n**Critical Rule**: Vehicle theft does **not** trigger automatic service cancellation or refunds. The customer must explicitly cancel services through normal channels.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:91-96]()\n\n### Theft Handling State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e VehicleOperational\n    \n    VehicleOperational --\u003e TheftReported: \"Customer Reports Theft\"\n    \n    state TheftReported {\n        [*] --\u003e EvaluateServices\n        \n        EvaluateServices --\u003e DeliveredServices: \"Check Already Delivered\"\n        EvaluateServices --\u003e PendingServices: \"Check Future/Pending\"\n        EvaluateServices --\u003e ActiveSubscriptions: \"Check Subscriptions\"\n        \n        state DeliveredServices {\n            [*] --\u003e CheckDesistimientoWindow\n            CheckDesistimientoWindow --\u003e WithinWindow: \"\u003c 14 Days Since Activation\"\n            CheckDesistimientoWindow --\u003e OutsideWindow: \"\u003e 14 Days Since Activation\"\n            \n            WithinWindow --\u003e RefundEligible: \"Customer Can Request Refund\"\n            OutsideWindow --\u003e NoRefundAvailable: \"Service Considered Consumed\"\n        }\n        \n        state PendingServices {\n            [*] --\u003e CustomerCancels: \"Customer Initiates Cancellation\"\n            CustomerCancels --\u003e FullRefund: \"Refund Pending Payment\"\n            FullRefund --\u003e ServiceCancelled\n        }\n        \n        state ActiveSubscriptions {\n            [*] --\u003e CurrentPeriod: \"Evaluate Current Month\"\n            CurrentPeriod --\u003e NoRefundCurrentPeriod: \"Already Consumed (Mes Vencido)\"\n            CurrentPeriod --\u003e CancelFuturePeriods: \"Customer Cancels Auto-Renewal\"\n            CancelFuturePeriods --\u003e NoFutureCharges\n        }\n    }\n    \n    TheftReported --\u003e SystemContinuesNormally: \"No Automatic Actions\"\n    SystemContinuesNormally --\u003e [*]\n```\n\n**Diagram: Vehicle Theft Service Lifecycle Impact**\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:91-96]()\n\n### System Implementation Requirements\n\nThe system **must not**:\n- Automatically cancel or refund services upon theft report\n- Block access to the customer's expediente or service history\n- Prevent customer from managing their services\n\nThe system **must**:\n- Allow customer to manually cancel pending services via web/mobile platforms\n- Apply standard desistimiento rules to delivered services\n- Process cancellation requests for future subscription periods\n- Maintain full service history for insurance and legal purposes\n\n**Integration Points**: \n- No special API integration with police or insurance systems required\n- Customer must initiate all actions through standard customer-facing platforms\n- Theft status is not tracked as a vehicle state in CaaS (external concern)\n\n---\n\n## Warranty Loss Due to Missed Maintenance\n\n### Maintenance-Warranty Relationship\n\nThe CaaS system integrates with the VSS (Vehicle Service System) to enforce maintenance requirements. When a vehicle's maintenance falls behind schedule, warranty coverage is affected:\n\n| Maintenance Status | Warranty Status | Base Platform | Already Active Services | New Service Activation |\n|-------------------|-----------------|---------------|------------------------|------------------------|\n| **Current** | Valid |  Available |  Functional |  Allowed (if maintenance-linked) |\n| **Overdue (Minor)** | Valid |  Available |  Functional |  Warning Shown |\n| **Overdue (Critical)** | **Lost** |  Available |  Functional |  **Blocked for safety-critical services** |\n\n**Fundamental Constraint**: The system **cannot** block vehicle circulation or disable the plataforma base. Only law enforcement has authority to immobilize vehicles.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n### Warranty Loss State Diagram\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e MaintenanceCurrent\n    \n    MaintenanceCurrent --\u003e MaintenanceOverdue: \"Scheduled Maintenance Date Passed\"\n    \n    state MaintenanceOverdue {\n        [*] --\u003e MinorOverdue\n        MinorOverdue --\u003e CriticalOverdue: \"Grace Period Expired\"\n        \n        state MinorOverdue {\n            [*] --\u003e ShowWarnings\n            ShowWarnings --\u003e AllowServices: \"Services Still Available\"\n            AllowServices --\u003e LogWarningInExpediente\n        }\n        \n        state CriticalOverdue {\n            [*] --\u003e WarrantyLost\n            WarrantyLost --\u003e BlockNewActivations: \"Block Safety-Critical Services Only\"\n            BlockNewActivations --\u003e MaintainExistingServices: \"Active Services Continue\"\n            \n            note right of BlockNewActivations\n                System queries VSS for maintenance\n                status before service activation.\n                If critical maintenance overdue,\n                activation is denied.\n            end note\n        }\n    }\n    \n    MaintenanceOverdue --\u003e MaintenanceCurrent: \"Customer Completes Maintenance\"\n    MaintenanceCurrent --\u003e [*]\n    \n    state MaintainExistingServices {\n        [*] --\u003e BasePlatform: \"Always Available\"\n        [*] --\u003e ActiveServices: \"Already Paid - Continue\"\n        \n        note right of ActiveServices\n            Cannot revoke already\n            delivered and paid services\n        end note\n    }\n```\n\n**Diagram: Warranty Loss and Service Blocking Logic**\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n### Service Blocking Rules\n\nWhen warranty is lost due to missed maintenance, the system applies **selective blocking**:\n\n**Always Available (Cannot Block)**:\n- Plataforma base functionality\n- Services already activated and paid\n- Vehicle's ability to circulate\n- Access to expediente and service history\n\n**May Be Blocked (Safety-Critical Services)**:\n- New service activations requiring specific maintenance (e.g., advanced suspension requires suspension maintenance)\n- Services that could create safety hazards without proper maintenance\n- Premium performance features dependent on specific subsystem health\n\n**Implementation Logic**:\n```\nBefore OTA Activation:\n  1. Query VSS API for vehicle maintenance status\n  2. Check service's maintenance dependencies\n  3. IF (maintenance required AND maintenance overdue) THEN\n       Block activation\n       Notify customer with specific maintenance needed\n       DO NOT charge customer\n     ELSE\n       Proceed with normal activation flow\n```\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n### VSS Integration for Maintenance Status\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Platform\"\n        ServiceRequest[\"Service Activation Request\"]\n        MaintenanceCheck[\"Maintenance Check Logic\"]\n        ActivationDecision{\"Maintenance OK?\"}\n        OTAEngine[\"OTA Activation Engine\"]\n        CustomerNotification[\"Notification Engine\"]\n    end\n    \n    subgraph \"VSS System (External)\"\n        VSSApi[\"VSS API\"]\n        VSSDatabase[(\"VSS Database\u003cbr/\u003eMaintenance History\u003cbr/\u003ePer Vehicle\")]\n    end\n    \n    subgraph \"Workshop Network\"\n        OfficialWorkshop[\"Official Workshops\"]\n        ApprovedWorkshop[\"Approved Multi-brand Workshops\"]\n    end\n    \n    ServiceRequest --\u003e MaintenanceCheck\n    MaintenanceCheck --\u003e|\"Query maintenance status\u003cbr/\u003efor Vehicle VIN\"| VSSApi\n    VSSApi --\u003e VSSDatabase\n    VSSDatabase --\u003e|\"Return maintenance %\u003cbr/\u003eby functional block\"| VSSApi\n    VSSApi --\u003e|\"Maintenance status\u003cbr/\u003eresponse\"| MaintenanceCheck\n    \n    MaintenanceCheck --\u003e ActivationDecision\n    \n    ActivationDecision --\u003e|\"Yes - Current\"| OTAEngine\n    ActivationDecision --\u003e|\"No - Overdue\"| CustomerNotification\n    \n    OTAEngine --\u003e CustomerNotification\n    CustomerNotification --\u003e|\"Service Activated\"| Customer[\"Customer\"]\n    CustomerNotification --\u003e|\"Maintenance Required\u003cbr/\u003eService Blocked\u003cbr/\u003eNO CHARGE\"| Customer\n    \n    OfficialWorkshop --\u003e|\"Record service\"| VSSDatabase\n    ApprovedWorkshop --\u003e|\"Record service\"| VSSDatabase\n    \n    Customer --\u003e|\"Completes maintenance\"| OfficialWorkshop\n    Customer --\u003e|\"Completes maintenance\"| ApprovedWorkshop\n```\n\n**Diagram: Maintenance Status Check Integration Flow**\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n## Customer Communication Requirements\n\n### Notification Scenarios\n\nBoth theft and warranty loss scenarios require specific customer communications:\n\n| Scenario | Trigger | Notification Channel | Message Content |\n|----------|---------|---------------------|-----------------|\n| **Theft Reported** | Customer reports via customer service | Email + App Push | Instructions for service cancellation process, link to expediente |\n| **Warranty Lost** | Critical maintenance overdue detected | Email + App Push | Warning about warranty loss, required maintenance, services at risk |\n| **Service Blocked (Maintenance)** | Attempted activation with overdue maintenance | Email + App Push + In-App Modal | Specific maintenance needed, no charge applied, how to restore access |\n| **Theft - Service Cancellation** | Customer cancels pending services | Email | Confirmation of cancellation, refund timeline |\n\n**Critical Customer Protection Rule**: When a service activation is blocked due to maintenance, the customer **must not be charged**. The system follows the same rule as OTA failures: no charge for undelivered services.\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:48-53](), [pasame las preguntas y sus respuestas a markdown.md:66-73]()\n\n---\n\n## Implementation Requirements Summary\n\n### Theft Scenario Implementation\n\n**Required System Components**:\n- Standard service cancellation flows (reuse existing cancellation logic)\n- Desistimiento rule engine (already exists for normal cancellations)\n- No new APIs or integrations required\n- Customer service must document theft in customer notes (external to CaaS)\n\n**No Automated Actions**: The system remains passive. Customer initiates all actions.\n\n### Warranty Loss Implementation\n\n**Required System Components**:\n- VSS API integration for maintenance status queries\n- Pre-activation maintenance check logic\n- Service-to-maintenance dependency mapping in service catalog\n- Customer notification engine for blocked activations\n- Warranty status tracking in vehicle records\n\n**Business Logic Flow**:\n```mermaid\nflowchart TD\n    Start[\"Service Activation Request\"] --\u003e CheckServiceType{\"Service Requires\u003cbr/\u003eMaintenance?\"}\n    \n    CheckServiceType --\u003e|\"No\"| ProceedNormal[\"Proceed with Normal\u003cbr/\u003eActivation Flow\"]\n    CheckServiceType --\u003e|\"Yes\"| QueryVSS[\"Query VSS API\u003cbr/\u003efor Vehicle Maintenance Status\"]\n    \n    QueryVSS --\u003e EvaluateStatus{\"Maintenance\u003cbr/\u003eCurrent?\"}\n    \n    EvaluateStatus --\u003e|\"Yes - Current\"| ProceedNormal\n    EvaluateStatus --\u003e|\"No - Overdue\"| BlockActivation[\"Block Service Activation\"]\n    \n    BlockActivation --\u003e NotifyCustomer[\"Notify Customer:\u003cbr/\u003e- Maintenance Required\u003cbr/\u003e- Specific Services Needed\u003cbr/\u003e- NO CHARGE Applied\"]\n    \n    BlockActivation --\u003e LogEvent[\"Log Event in Expediente\"]\n    \n    NotifyCustomer --\u003e End[\"End - Service Not Activated\"]\n    LogEvent --\u003e End\n    \n    ProceedNormal --\u003e OTA[\"Continue to OTA\u003cbr/\u003eActivation Process\"]\n    OTA --\u003e End\n```\n\n**Diagram: Warranty-Gated Service Activation Business Logic**\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:66-73](), [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Edge Cases and Special Considerations\n\n### Concurrent Scenarios\n\n**Theft + Active Subscription**:\n- Customer must cancel auto-renewal before next billing period\n- If theft occurs mid-month, current month charges still apply (mes vencido billing)\n- No prorated refunds for partial month usage\n\n**Warranty Loss + Theft**:\n- Maintenance obligations remain with vehicle owner (customer)\n- Warranty status irrelevant once vehicle is stolen\n- Insurance claims are external to CaaS system\n\n**Service Activated During Grace Period**:\n- If customer activates service when maintenance is \"minor overdue\" and then maintenance becomes \"critical overdue\", the already activated service continues\n- New activations of the same service are blocked until maintenance completed\n\n### Legal Compliance\n\n**Consumer Protection**:\n- Desistimiento (right of withdrawal) applies regardless of theft\n- Customer must be informed of warranty loss consequences\n- No charge for blocked services (failure to deliver = no payment)\n\n**Safety Requirements**:\n- System must prevent activation of safety-critical services without proper maintenance\n- Cannot override maintenance requirements (liability issue)\n- Base platform mobility must never be blocked (legal requirement)\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:66-73](), [pasame las preguntas y sus respuestas a markdown.md:85-96]()\n\n---\n\n## Related System Components\n\nThe following system components are involved in handling these special scenarios:\n\n| Component | Role in Theft Scenarios | Role in Warranty Loss |\n|-----------|-------------------------|----------------------|\n| **Expediente de Compra** | Displays service history, enables cancellations | Shows maintenance warnings and warranty status |\n| **Service Catalog** | Standard cancellation flows | Maintenance dependency definitions |\n| **VSS Integration** | Not involved | Primary data source for maintenance status |\n| **Payment Processing** | Processes refunds per desistimiento rules | Prevents charges for blocked activations |\n| **OTA Engine** | Not involved (no activations during theft) | Checks maintenance before activation |\n| **Notification Engine** | Sends theft-related communications | Sends maintenance warnings and block notifications |\n\nFor detailed information on these components, see [Core Technical Components](#3.2) and [External System Integrations](#5).\n\n---\n\n## Testing Considerations\n\n**Theft Scenario Tests**:\n- Verify no automatic service cancellations occur\n- Test desistimiento window calculations for delivered services\n- Validate refund processing for cancelled pending services\n- Confirm subscription auto-renewal cancellation\n\n**Warranty Loss Tests**:\n- Test VSS API integration and error handling\n- Verify service blocking when maintenance overdue\n- Confirm already-active services continue functioning\n- Test customer notification delivery for blocked activations\n- Validate NO CHARGE rule when service blocked\n\n**Integration Tests**:\n- VSS API timeout handling (maintenance check must not block UI)\n- Concurrent service activation attempts during maintenance updates\n- Theft report during pending OTA activation\n\nSources: [pasame las preguntas y sus respuestas a markdown.md:66-96]()"])</script><script>self.__next_f.push([1,"38:T950b,"])</script><script>self.__next_f.push([1,"# Technical Reference\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\nThis page provides technical reference material for developers and architects working with the CaaS system. It includes comprehensive terminology definitions, API documentation guidelines, technical constraints, and mappings between business concepts and code entities.\n\nFor operational workflows and business process details, see [Operational Processes](#8). For specific integration implementation details, see [Integration Architecture](#3.3) and [External System Integrations](#5).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Core Technical Terminology\n\nThis section defines all critical technical terms used throughout the CaaS system, bridging business language with technical implementation concepts.\n\n### Business Model Terms\n\n| Term | Spanish | Definition | Technical Implication |\n|------|---------|------------|----------------------|\n| **Platform Base** | Plataforma Base | The base vehicle model with essential features that make it fully operational | Represents the default vehicle configuration in the system; stored as `VehicleModel.baseConfiguration` |\n| **Available Options** | Opciones Disponibles | Optional features that can be enabled/disabled on-demand (e.g., 50% power boost, autonomous driving, climate control) | Catalog of configurable services; stored in `ServiceCatalog` with activation rules |\n| **Purchase Record** | Expediente de Compra | Customer's complete purchase dossier including manuals, maintenance history, invoices | Customer-facing data aggregation entity; accessed via web/mobile platforms |\n| **Pay-per-Use** | Pago por Uso | Payment model where customers pay only for optional services they activate | Billing model requiring usage tracking and flexible payment processing |\n| **Overdue Month Billing** | Mes Vencido | Post-paid billing model where subscription charges occur at month-end for consumed services | Delayed billing pattern requiring month-end batch processing |\n| **Right of Withdrawal** | Desistimiento | Legal right allowing customers to cancel services within specific timeframes | Business rule: 14-day window for services \u003e14 days duration, anytime for services \u003c14 days |\n\n### Technical Infrastructure Terms\n\n| Term | Definition | Code Entity Reference |\n|------|------------|----------------------|\n| **IoT Network** | Connectivity infrastructure enabling vehicle-to-server communication | `IoTGateway`, `VehicleConnectivityService` |\n| **OTA (Over The Air)** | Remote configuration system for activating/deactivating vehicle features without workshop visits | `OTAActivationEngine`, `OTACommandQueue` |\n| **API IoT** | Pre-existing, documented API for remote vehicle configuration | External constraint; must use as-is; documented in separate API specification |\n| **VSS (Vehicle Service System)** | External system maintained by workshops tracking maintenance records and compliance | `VSSIntegrationClient`, accessed via query API |\n| **Commercial Plan** | Plan Comercial | Customer's specific purchase agreement including base platform plus any permanent options | `CustomerPlan`, stored in `Order.commercialPlan` |\n| **Unassigned Vehicle** | Vehculo Sin Asignar | Vehicle that exists in inventory but is not allocated to a customer (e.g., after payment failure) | `Vehicle.status = UNASSIGNED` state |\n\n### Process and State Terms\n\n| Term | Definition | System State |\n|------|------------|--------------|\n| **Reservation Signal** | Initial payment to reserve a vehicle | `Order.status = RESERVED`, triggers factory order |\n| **Final Payment** | Complete payment required before vehicle registration | `Order.status = PAID`, triggers registration workflow |\n| **Vehicle Registration** | Process of registering vehicle with government administrative bodies | `Vehicle.registrationStatus`, country-specific implementation |\n| **Home Delivery** | Transport of vehicle to customer's address | `Delivery.type = HOME`, with fallback to dealership pickup |\n| **Service Activation** | OTA process to enable purchased optional features | `ServiceActivation.status`, with retry logic |\n| **Maintenance-Linked Service** | Service that requires up-to-date maintenance before activation | `Service.requiresMaintenanceCheck = true` |\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:16-104]()\n\n---\n\n## API Documentation Guidelines\n\nThe CaaS system integrates with multiple external systems via APIs. This section distinguishes between existing APIs (constraints) and APIs to be developed (requirements).\n\n### API Classification\n\n```mermaid\ngraph TB\n    subgraph \"Existing APIs - Restrictions\"\n        API_IOT[\"API IoT\u003cbr/\u003e(Vehicle Configuration)\"]\n        FACTORY_API[\"Factory Order API\u003cbr/\u003e(Order Management)\"]\n        VSS_API[\"VSS Query API\u003cbr/\u003e(Maintenance Status)\"]\n        PAYMENT_GW[\"Payment Gateway API\u003cbr/\u003e(Card Processing)\"]\n        ADMIN_API[\"Administrative Registration API\u003cbr/\u003e(Government Bodies)\"]\n    end\n    \n    subgraph \"APIs to Develop - Requirements\"\n        WEB_API[\"Web Platform API\u003cbr/\u003e(Customer-facing)\"]\n        MOBILE_API[\"Mobile App API\u003cbr/\u003e(Customer-facing)\"]\n        INTRANET_API[\"Corporate Intranet API\u003cbr/\u003e(Internal staff)\"]\n        WEBHOOK_RECEIVER[\"Factory Webhook Receiver\u003cbr/\u003e(Status notifications)\"]\n        IOT_CALLBACK[\"IoT Status Callback\u003cbr/\u003e(Vehicle telemetry)\"]\n    end\n    \n    API_IOT --\u003e NOTE1[\"Must use as documented\u003cbr/\u003eCannot be modified\u003cbr/\u003ePre-tested and approved\"]\n    FACTORY_API --\u003e NOTE1\n    VSS_API --\u003e NOTE1\n    PAYMENT_GW --\u003e NOTE1\n    ADMIN_API --\u003e NOTE1\n    \n    WEB_API --\u003e NOTE2[\"Part of CaaS project\u003cbr/\u003eFull control over design\u003cbr/\u003eMust document requirements\"]\n    MOBILE_API --\u003e NOTE2\n    INTRANET_API --\u003e NOTE2\n    WEBHOOK_RECEIVER --\u003e NOTE2\n    IOT_CALLBACK --\u003e NOTE2\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n### Existing APIs (Restrictions)\n\nThese APIs already exist and must be used as-is. They are external constraints on the CaaS project.\n\n#### API IoT (Vehicle Configuration)\n\n**Status:** Pre-existing, documented, tested  \n**Owner:** Factory IoT Infrastructure Team  \n**Purpose:** Remote configuration of vehicle features via OTA  \n**Integration Pattern:** Command-based, bidirectional  \n**Documentation:** Reference external API IoT specification document\n\n**Key Characteristics:**\n- All vehicle functionality is pre-installed in firmware\n- API only activates/deactivates features; does not install software\n- Supports configuration push and status query\n- Any integration issues are charged to the previous project (not CaaS)\n\n**Usage in CaaS:**\n```\nOTAActivationEngine -\u003e API IoT: sendActivationCommand(vehicleId, serviceConfig)\nAPI IoT -\u003e IoTNetwork: pushConfiguration(vehicleId, config)\nIoTNetwork -\u003e Vehicle: applyConfiguration(config)\nVehicle -\u003e IoTNetwork: reportStatus(newState)\nIoTNetwork -\u003e API IoT: updateStatus(vehicleId, status)\nAPI IoT -\u003e OTAActivationEngine: statusCallback(vehicleId, success/failure)\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:33-56]()\n\n#### Factory Order API\n\n**Status:** Pre-existing  \n**Owner:** Factory Order Management System  \n**Purpose:** Submit vehicle orders and receive manufacturing status updates  \n**Integration Pattern:** Hybrid (synchronous orders + asynchronous notifications)\n\n**Synchronous Operations:**\n```\nPOST /api/v1/orders\nRequest: { customerId, vehicleModel, baseConfig, options[], dealershipId }\nResponse: { orderId, estimatedDeliveryDate, factoryLocation }\n```\n\n**Asynchronous Notifications (Webhooks):**\n```\nPOST /caas/webhooks/factory-status\nPayload: { orderId, status, timestamp, location, estimatedCompletion }\nStatus values: ORDERED, IN_PRODUCTION, QUALITY_CHECK, READY_FOR_SHIPMENT, SHIPPED\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n#### VSS Query API\n\n**Status:** Pre-existing  \n**Owner:** Workshop Network  \n**Purpose:** Query vehicle maintenance status and compliance percentage  \n**Integration Pattern:** Pull-based (CaaS queries on-demand)\n\n**Important Constraint:** Vehicles do NOT self-report maintenance status via IoT. Workshops record service in VSS, and CaaS queries VSS when needed.\n\n```\nGET /api/v1/vehicles/{vin}/maintenance-status\nResponse: {\n  vin,\n  lastServiceDate,\n  nextServiceDue,\n  compliancePercentage,\n  functionalBlockCompliance: [\n    { block: \"ENGINE\", compliant: true, lastService: \"2024-01-15\" },\n    { block: \"BRAKES\", compliant: false, lastService: \"2023-06-10\" }\n  ]\n}\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n### APIs to Develop (Requirements)\n\nThese APIs are part of the CaaS project scope and must be designed, implemented, and documented.\n\n#### Customer-Facing APIs\n\n**Web Platform API** (`WebPlatformController`)\n- Authentication and session management\n- Expediente de compra retrieval\n- Service catalog browsing\n- Service purchase and payment initiation\n- Order history and invoice access\n\n**Mobile Application API** (`MobileAppController`)\n- All web platform features\n- Vehicle linking (QR code or manual pairing)\n- Direct vehicle status queries\n- Push notification registration\n\n#### Internal APIs\n\n**Corporate Intranet API** (`IntranetController`)\n- Sales registration (`POST /api/sales/register`)\n- Customer credential generation\n- Vehicle assignment to customers\n- Order management for dealership staff\n\n**Factory Status Webhook Receiver** (`FactoryWebhookHandler`)\n- Endpoint: `POST /api/webhooks/factory-status`\n- Handles asynchronous manufacturing status updates\n- Triggers customer notifications\n- Updates order state machine\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## System Component Mapping\n\nThis diagram bridges business concepts to actual code entities, showing how the system is structured technically.\n\n### Core Domain Model\n\n```mermaid\nclassDiagram\n    class Customer {\n        +UUID customerId\n        +String email\n        +AuthCredentials credentials\n        +CustomerProfile profile\n        +List~Order~ orders\n    }\n    \n    class Order {\n        +UUID orderId\n        +Customer customer\n        +OrderStatus status\n        +CommercialPlan commercialPlan\n        +Vehicle vehicle\n        +PaymentInfo reservationPayment\n        +PaymentInfo finalPayment\n        +createFactoryOrder()\n        +completePayment()\n    }\n    \n    class Vehicle {\n        +String vin\n        +VehicleModel model\n        +VehicleStatus status\n        +BaseConfiguration baseConfig\n        +Customer assignedCustomer\n        +RegistrationInfo registration\n        +markAsUnassigned()\n    }\n    \n    class VehicleModel {\n        +String modelId\n        +String name\n        +BaseConfiguration defaultBase\n        +List~AvailableOption~ availableOptions\n    }\n    \n    class AvailableOption {\n        +UUID serviceId\n        +String name\n        +ServiceType type\n        +PricingModel pricing\n        +boolean requiresMaintenance\n        +ActivationConfig activationConfig\n    }\n    \n    class ServiceActivation {\n        +UUID activationId\n        +Customer customer\n        +Vehicle vehicle\n        +AvailableOption service\n        +ActivationStatus status\n        +DateTime purchaseDate\n        +DateTime activationDate\n        +int retryCount\n        +initiateOTA()\n        +handleRetry()\n    }\n    \n    class OTACommand {\n        +UUID commandId\n        +Vehicle vehicle\n        +ConfigPayload payload\n        +CommandStatus status\n        +DateTime sentAt\n        +DateTime completedAt\n        +sendViaIoT()\n        +queryStatus()\n    }\n    \n    class ExpedienteDeCompra {\n        +Customer customer\n        +List~Order~ orders\n        +List~Invoice~ invoices\n        +List~Manual~ manuals\n        +MaintenanceHistory maintenance\n        +getFullHistory()\n    }\n    \n    class MaintenanceRecord {\n        +String vin\n        +DateTime serviceDate\n        +String serviceType\n        +WorkshopInfo workshop\n        +boolean compliant\n        +queryVSS()\n    }\n    \n    Customer \"1\" --\u003e \"*\" Order\n    Order \"1\" --\u003e \"1\" Vehicle\n    Vehicle \"1\" --\u003e \"1\" VehicleModel\n    VehicleModel \"1\" --\u003e \"*\" AvailableOption\n    Customer \"1\" --\u003e \"*\" ServiceActivation\n    ServiceActivation \"1\" --\u003e \"1\" AvailableOption\n    ServiceActivation \"1\" --\u003e \"0..1\" OTACommand\n    Customer \"1\" --\u003e \"1\" ExpedienteDeCompra\n    Vehicle \"1\" --\u003e \"*\" MaintenanceRecord\n```\n\n**Sources:** [enunciado.md:1-23]()\n\n### Integration Layer Components\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Core Services\"\n        ORDER_SVC[\"OrderManagementService\"]\n        SERVICE_SVC[\"ServiceCatalogService\"]\n        PAYMENT_SVC[\"PaymentProcessingService\"]\n        OTA_SVC[\"OTAActivationService\"]\n        NOTIF_SVC[\"NotificationService\"]\n    end\n    \n    subgraph \"Integration Clients\"\n        FACTORY_CLIENT[\"FactoryApiClient\u003cbr/\u003esynchronous orders\"]\n        FACTORY_WEBHOOK[\"FactoryWebhookHandler\u003cbr/\u003easync status updates\"]\n        VSS_CLIENT[\"VSSIntegrationClient\u003cbr/\u003emaintenance queries\"]\n        IOT_CLIENT[\"IoTGatewayClient\u003cbr/\u003eOTA commands\"]\n        IOT_CALLBACK[\"IoTStatusCallbackHandler\u003cbr/\u003evehicle telemetry\"]\n        PAYMENT_CLIENT[\"PaymentGatewayClient\u003cbr/\u003ecard processing\"]\n        ADMIN_CLIENT[\"AdminRegistrationClient\u003cbr/\u003evehicle registration\"]\n    end\n    \n    subgraph \"External Systems\"\n        FACTORY[\"Factory API\"]\n        VSS[\"VSS System\"]\n        IOT_NETWORK[\"IoT Network\u003cbr/\u003e\u0026 API IoT\"]\n        PAYMENT_GW[\"Payment Gateway\"]\n        ADMIN_BODIES[\"Administrative Bodies\"]\n    end\n    \n    ORDER_SVC --\u003e FACTORY_CLIENT\n    FACTORY_CLIENT --\u003e FACTORY\n    FACTORY -.webhook.-\u003e FACTORY_WEBHOOK\n    FACTORY_WEBHOOK --\u003e ORDER_SVC\n    \n    SERVICE_SVC --\u003e VSS_CLIENT\n    VSS_CLIENT --\u003e VSS\n    \n    OTA_SVC --\u003e IOT_CLIENT\n    IOT_CLIENT --\u003e IOT_NETWORK\n    IOT_NETWORK -.callback.-\u003e IOT_CALLBACK\n    IOT_CALLBACK --\u003e OTA_SVC\n    \n    PAYMENT_SVC --\u003e PAYMENT_CLIENT\n    PAYMENT_CLIENT --\u003e PAYMENT_GW\n    \n    ORDER_SVC --\u003e ADMIN_CLIENT\n    ADMIN_CLIENT --\u003e ADMIN_BODIES\n    \n    OTA_SVC --\u003e NOTIF_SVC\n    FACTORY_WEBHOOK --\u003e NOTIF_SVC\n    PAYMENT_SVC --\u003e NOTIF_SVC\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:33-82]()\n\n---\n\n## Technical Constraints and Rules\n\nThis section documents hard technical constraints that must be respected in the implementation.\n\n### Actor and System Boundaries\n\n**Constraint:** An entity cannot be both an actor and part of the system  \n**Rationale:** Actors are always external to the system; internal components collaborate but are not actors  \n**Implication:** \n- Customers and employees are actors (external users)\n- Vehicles are infrastructure components, not actors\n- Vehicles receive configurations and report status but do not initiate use cases\n\n**Implementation Guidance:**\n- Use case diagrams must show customers/employees as actors\n- Vehicles appear in sequence diagrams as passive infrastructure\n- IoT Network is the communication channel, not an actor\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:10-16]()\n\n### User Authentication and Registration\n\n**Constraint:** No public self-registration allowed  \n**Rationale:** CaaS is not a public system; all users must be known and controlled  \n**Implication:**\n- No integration with external SSO providers (Google, Microsoft, etc.)\n- All customers created through dealership sales process\n- Employees managed through internal user management\n\n**Implementation Approach:**\n```\n// User creation only via internal APIs\nPOST /api/internal/customers/create\nAuthorization: Required (dealership staff credentials)\n\n// No public registration endpoint\nPOST /api/public/register \u003c- NOT ALLOWED\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:15-16]()\n\n### OTA Activation Requirements\n\n**Constraint:** All services sold by CaaS are delivered via OTA; workshop visits never required  \n**Rationale:** Pre-installed functionality model where activation is remote  \n**Technical Requirements:**\n- All vehicle features pre-installed in firmware\n- CaaS only sends activation/deactivation commands\n- Software updates are independent of CaaS service sales\n\n**Failure Handling (Critical Rule):**\n```\nif (otaActivation.status == FAILED \u0026\u0026 retryCount \u003e= MAX_RETRIES) {\n    // CRITICAL: DO NOT CHARGE CUSTOMER\n    refundOrCancelPayment(serviceActivation.payment);\n    \n    // Escalate to technical support\n    createSupportTicket(serviceActivation);\n    \n    // Notify customer\n    notificationService.sendFailureNotification(customer, service);\n}\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:46-56]()\n\n### Maintenance Status Queries\n\n**Constraint:** Vehicles do NOT self-report maintenance status via IoT  \n**Rationale:** Maintenance records are maintained by workshops in external VSS system  \n**Technical Approach:**\n- Query VSS API when service requires maintenance check\n- Cache maintenance status with expiration\n- Block service activation if maintenance overdue\n\n```java\n// Before allowing service purchase\nMaintenanceStatus status = vssClient.queryMaintenanceStatus(vehicle.vin);\n\nif (service.requiresMaintenance \u0026\u0026 !status.isCompliant()) {\n    throw new MaintenanceRequiredException(\n        \"Service blocked: maintenance overdue for \" + status.getOutdatedBlocks()\n    );\n}\n```\n\n**Important:** Never block base platform or already-activated services; only prevent new service activation\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n### Payment Processing and Risk Assumption\n\n**Constraint:** Services delivered immediately despite asynchronous payment settlement  \n**Rationale:** Optimize customer experience by accepting settlement risk  \n**Technical Implementation:**\n\n```java\npublic class PaymentProcessingService {\n    \n    public ServiceActivation processServicePayment(Customer customer, Service service) {\n        // Initiate payment (async settlement)\n        PaymentInitiation payment = paymentGateway.initiatePayment(\n            customer.paymentMethod,\n            service.price\n        );\n        \n        // Assume risk: deliver immediately\n        ServiceActivation activation = serviceActivationService.create(\n            customer, service, payment\n        );\n        \n        // Queue OTA activation without waiting for settlement\n        otaService.queueActivation(activation);\n        \n        return activation;\n    }\n    \n    // Handle async settlement callback\n    public void handlePaymentSettlement(PaymentSettlement settlement) {\n        if (settlement.status == FAILED) {\n            // Handle failed settlement\n            riskManagement.recordSettlementFailure(settlement);\n            // May trigger collection/dunning process\n        }\n    }\n}\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:77-82]()\n\n---\n\n## State Machine Specifications\n\n### Order Status State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e CREATED: \"dealership creates order\"\n    CREATED --\u003e RESERVED: \"reservation payment successful\"\n    CREATED --\u003e CANCELLED: \"customer cancels before payment\"\n    \n    RESERVED --\u003e FACTORY_ORDERED: \"automatic factory order placement\"\n    FACTORY_ORDERED --\u003e IN_PRODUCTION: \"factory webhook: production started\"\n    IN_PRODUCTION --\u003e READY: \"factory webhook: vehicle ready\"\n    \n    READY --\u003e PAID: \"final payment successful\"\n    READY --\u003e UNASSIGNED: \"final payment failed\"\n    UNASSIGNED --\u003e STOCK: \"vehicle becomes available for sale\"\n    \n    PAID --\u003e REGISTERED: \"administrative registration complete\"\n    REGISTERED --\u003e IN_TRANSIT: \"transport to customer initiated\"\n    IN_TRANSIT --\u003e DELIVERED: \"successful home delivery\"\n    IN_TRANSIT --\u003e AT_DEALERSHIP: \"customer absent, return to dealer\"\n    AT_DEALERSHIP --\u003e DELIVERED: \"customer pickup from dealership\"\n    \n    DELIVERED --\u003e [*]: \"order complete\"\n    CANCELLED --\u003e [*]: \"order cancelled\"\n    STOCK --\u003e [*]: \"vehicle sold to different customer\"\n```\n\n**State Descriptions:**\n\n| State | Code Constant | Description | Triggers |\n|-------|--------------|-------------|----------|\n| CREATED | `OrderStatus.CREATED` | Initial order created by dealership | Sales registration |\n| RESERVED | `OrderStatus.RESERVED` | Reservation payment received | Payment confirmation |\n| FACTORY_ORDERED | `OrderStatus.FACTORY_ORDERED` | Order sent to factory API | Automatic after RESERVED |\n| IN_PRODUCTION | `OrderStatus.IN_PRODUCTION` | Vehicle being manufactured | Factory webhook |\n| READY | `OrderStatus.READY` | Vehicle available at dealership | Factory webhook |\n| PAID | `OrderStatus.PAID` | Final payment completed | Payment confirmation |\n| REGISTERED | `OrderStatus.REGISTERED` | Vehicle registered with authorities | Admin API success |\n| IN_TRANSIT | `OrderStatus.IN_TRANSIT` | Vehicle being transported | Transport initiated |\n| DELIVERED | `OrderStatus.DELIVERED` | Vehicle delivered to customer | Delivery confirmation |\n| UNASSIGNED | `OrderStatus.UNASSIGNED` | Payment failed, vehicle unassigned | Payment failure |\n| CANCELLED | `OrderStatus.CANCELLED` | Order cancelled before completion | Customer/system cancel |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:24-29](), [enunciado.md:13-17]()\n\n### Service Activation State Machine\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e PAYMENT_INITIATED: \"customer purchases service\"\n    PAYMENT_INITIATED --\u003e OTA_QUEUED: \"payment accepted (async settlement)\"\n    PAYMENT_INITIATED --\u003e PAYMENT_FAILED: \"payment immediately rejected\"\n    \n    OTA_QUEUED --\u003e OTA_ATTEMPT_1: \"first activation attempt\"\n    OTA_ATTEMPT_1 --\u003e ACTIVE: \"success on first try\"\n    OTA_ATTEMPT_1 --\u003e OTA_ATTEMPT_2: \"first attempt failed\"\n    \n    OTA_ATTEMPT_2 --\u003e ACTIVE: \"success on second try\"\n    OTA_ATTEMPT_2 --\u003e OTA_ATTEMPT_N: \"second attempt failed\"\n    \n    OTA_ATTEMPT_N --\u003e ACTIVE: \"success on retry N\"\n    OTA_ATTEMPT_N --\u003e TECHNICAL_SUPPORT: \"all retries exhausted\"\n    \n    TECHNICAL_SUPPORT --\u003e REFUNDED: \"DO NOT CHARGE - refund payment\"\n    REFUNDED --\u003e [*]: \"activation failed, customer notified\"\n    \n    ACTIVE --\u003e IN_USE: \"service delivered and operational\"\n    IN_USE --\u003e CANCELLED_REFUNDED: \"desistimiento within window\"\n    IN_USE --\u003e CANCELLED_NO_REFUND: \"cancellation after window\"\n    \n    CANCELLED_REFUNDED --\u003e [*]: \"refund processed\"\n    CANCELLED_NO_REFUND --\u003e [*]: \"no refund, service consumed\"\n    PAYMENT_FAILED --\u003e [*]: \"no activation attempted\"\n    \n    IN_USE --\u003e EXPIRED: \"temporary service duration ends\"\n    EXPIRED --\u003e [*]: \"service automatically deactivated\"\n```\n\n**Implementation Constants:**\n```java\npublic enum ServiceActivationStatus {\n    PAYMENT_INITIATED,      // Initial state after payment starts\n    OTA_QUEUED,            // Queued for OTA delivery\n    OTA_ATTEMPT_1,         // First activation attempt\n    OTA_ATTEMPT_2,         // Second attempt\n    OTA_ATTEMPT_N,         // Subsequent retries\n    TECHNICAL_SUPPORT,     // Escalated after all retries failed\n    ACTIVE,                // Successfully activated\n    IN_USE,                // Delivered and operational\n    REFUNDED,              // Failed activation - customer refunded\n    CANCELLED_REFUNDED,    // Customer cancelled within desistimiento window\n    CANCELLED_NO_REFUND,   // Customer cancelled after window\n    EXPIRED,               // Temporary service expired\n    PAYMENT_FAILED         // Payment rejected\n}\n\npublic static final int MAX_OTA_RETRIES = 3; // Configurable\npublic static final int DESISTIMIENTO_DAYS_LONG = 14; // For services \u003e 14 days\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-96]()\n\n---\n\n## Data Model Relationships\n\n### Core Entities and Relationships\n\n```mermaid\nerDiagram\n    CUSTOMER ||--o{ ORDER : \"places\"\n    CUSTOMER ||--|| EXPEDIENTE_DE_COMPRA : \"owns\"\n    CUSTOMER ||--o{ SERVICE_ACTIVATION : \"purchases\"\n    \n    ORDER ||--|| VEHICLE : \"reserves/assigns\"\n    ORDER ||--|| COMMERCIAL_PLAN : \"includes\"\n    ORDER }o--|| VEHICLE_MODEL : \"specifies\"\n    \n    VEHICLE ||--|| VEHICLE_MODEL : \"is instance of\"\n    VEHICLE ||--o{ MAINTENANCE_RECORD : \"has history\"\n    VEHICLE ||--o{ SERVICE_ACTIVATION : \"receives\"\n    VEHICLE }o--|| CUSTOMER : \"assigned to (nullable)\"\n    \n    VEHICLE_MODEL ||--o{ AVAILABLE_OPTION : \"offers\"\n    \n    SERVICE_ACTIVATION ||--|| AVAILABLE_OPTION : \"activates\"\n    SERVICE_ACTIVATION ||--o{ OTA_COMMAND : \"triggers\"\n    SERVICE_ACTIVATION ||--o{ PAYMENT : \"requires\"\n    \n    AVAILABLE_OPTION }o--|| MAINTENANCE_REQUIREMENT : \"may require\"\n    \n    EXPEDIENTE_DE_COMPRA ||--o{ ORDER : \"contains\"\n    EXPEDIENTE_DE_COMPRA ||--o{ INVOICE : \"includes\"\n    EXPEDIENTE_DE_COMPRA ||--o{ MANUAL : \"provides\"\n    EXPEDIENTE_DE_COMPRA ||--o{ MAINTENANCE_RECORD : \"tracks\"\n    \n    PAYMENT ||--|| PAYMENT_GATEWAY_TRANSACTION : \"maps to\"\n    \n    CUSTOMER {\n        uuid customer_id PK\n        string email UK\n        string password_hash\n        timestamp created_at\n    }\n    \n    ORDER {\n        uuid order_id PK\n        uuid customer_id FK\n        string vehicle_vin FK\n        enum status\n        uuid commercial_plan_id FK\n        timestamp reserved_at\n        timestamp paid_at\n    }\n    \n    VEHICLE {\n        string vin PK\n        string model_id FK\n        uuid assigned_customer_id FK \"nullable\"\n        enum status\n        jsonb base_configuration\n        timestamp manufactured_at\n    }\n    \n    VEHICLE_MODEL {\n        string model_id PK\n        string name\n        jsonb base_features\n        decimal base_price\n    }\n    \n    AVAILABLE_OPTION {\n        uuid service_id PK\n        string model_id FK\n        string name\n        enum service_type\n        enum pricing_model\n        decimal price\n        boolean requires_maintenance\n    }\n    \n    SERVICE_ACTIVATION {\n        uuid activation_id PK\n        uuid customer_id FK\n        string vehicle_vin FK\n        uuid service_id FK\n        enum status\n        timestamp purchased_at\n        timestamp activated_at\n        int retry_count\n    }\n    \n    OTA_COMMAND {\n        uuid command_id PK\n        uuid activation_id FK\n        string vehicle_vin FK\n        jsonb config_payload\n        enum command_status\n        timestamp sent_at\n        timestamp completed_at\n    }\n    \n    MAINTENANCE_RECORD {\n        uuid record_id PK\n        string vehicle_vin FK\n        timestamp service_date\n        string service_type\n        boolean compliant\n        string vss_reference\n    }\n    \n    PAYMENT {\n        uuid payment_id PK\n        uuid customer_id FK\n        enum payment_type\n        decimal amount\n        enum status\n        string gateway_transaction_id\n        timestamp initiated_at\n    }\n```\n\n**Key Relationships:**\n- `VEHICLE.assigned_customer_id` is nullable (supports \"sin asignar\" state)\n- `SERVICE_ACTIVATION.retry_count` tracks OTA retry attempts\n- `AVAILABLE_OPTION.requires_maintenance` flags maintenance-linked services\n- `MAINTENANCE_RECORD.vss_reference` links to external VSS system\n\n**Sources:** [enunciado.md:1-23]()\n\n---\n\n## Integration Patterns Summary\n\n### Synchronous vs Asynchronous Patterns\n\n| Integration Point | Pattern | Initiator | Response | Rationale |\n|------------------|---------|-----------|----------|-----------|\n| Factory Order Placement | Synchronous | CaaS  Factory | Immediate order confirmation | Need immediate orderId and estimated delivery |\n| Factory Status Updates | Asynchronous | Factory  CaaS | Webhook callbacks | Manufacturing is long-running; don't block |\n| VSS Maintenance Query | Synchronous | CaaS  VSS | Immediate status response | Needed for real-time service eligibility check |\n| OTA Command Send | Asynchronous | CaaS  IoT | Command queued, status via callback | Vehicle may be offline; unreliable network |\n| Vehicle Status Report | Asynchronous | IoT  CaaS | Telemetry push via callback | Vehicle-initiated when data available |\n| Payment Initiation | Asynchronous | CaaS  Gateway | Accepted, settlement delayed | Optimize UX; CaaS assumes risk |\n| Admin Registration | Synchronous | CaaS  Admin | Registration confirmation | Blocking operation; must complete before delivery |\n\n### Retry and Failure Patterns\n\n```mermaid\ngraph TB\n    START[\"Operation Initiated\"] --\u003e ATTEMPT[\"Attempt Execution\"]\n    ATTEMPT --\u003e SUCCESS{\"Success?\"}\n    SUCCESS --\u003e|Yes| COMPLETE[\"Operation Complete\"]\n    SUCCESS --\u003e|No| CHECK_RETRY{\"Retries\u003cbr/\u003eRemaining?\"}\n    \n    CHECK_RETRY --\u003e|Yes| BACKOFF[\"Exponential\u003cbr/\u003eBackoff Delay\"]\n    BACKOFF --\u003e ATTEMPT\n    \n    CHECK_RETRY --\u003e|No| CLASSIFY{\"Operation\u003cbr/\u003eType?\"}\n    \n    CLASSIFY --\u003e|\"OTA Activation\"| REFUND_CUSTOMER[\"DO NOT CHARGE\u003cbr/\u003eRefund Payment\"]\n    CLASSIFY --\u003e|\"Payment\"| NOTIFY_FAILURE[\"Notify Customer\u003cbr/\u003ePayment Failed\"]\n    CLASSIFY --\u003e|\"Factory Order\"| ESCALATE[\"Escalate to\u003cbr/\u003eManual Process\"]\n    \n    REFUND_CUSTOMER --\u003e SUPPORT_TICKET[\"Create Support Ticket\"]\n    NOTIFY_FAILURE --\u003e COMPLETE\n    ESCALATE --\u003e SUPPORT_TICKET\n    SUPPORT_TICKET --\u003e COMPLETE\n    \n    COMPLETE --\u003e END[\"End\"]\n```\n\n**Implementation Example:**\n```java\npublic class OTARetryStrategy {\n    private static final int MAX_RETRIES = 3;\n    private static final int BASE_DELAY_MS = 1000;\n    \n    public void executeWithRetry(ServiceActivation activation) {\n        int attempt = 0;\n        boolean success = false;\n        \n        while (attempt \u003c MAX_RETRIES \u0026\u0026 !success) {\n            try {\n                activation.setStatus(getAttemptStatus(attempt));\n                \n                OTACommand command = createOTACommand(activation);\n                iotClient.sendCommand(command);\n                \n                // Wait for callback or timeout\n                success = waitForActivationCallback(command, TIMEOUT_SECONDS);\n                \n            } catch (Exception e) {\n                attempt++;\n                if (attempt \u003c MAX_RETRIES) {\n                    sleep(calculateBackoff(attempt));\n                }\n            }\n        }\n        \n        if (!success) {\n            handleActivationFailure(activation); // DO NOT CHARGE\n        }\n    }\n    \n    private void handleActivationFailure(ServiceActivation activation) {\n        // Critical: customer protection\n        paymentService.refundPayment(activation.getPayment());\n        \n        supportTicketService.createTicket(\n            activation,\n            \"OTA activation failed after \" + MAX_RETRIES + \" attempts\"\n        );\n        \n        notificationService.notifyCustomer(\n            activation.getCustomer(),\n            \"Service activation failed. No charge applied. Support ticket created.\"\n        );\n    }\n}\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:48-53]()\n\n---\n\n## Business Rule Implementation Checklist\n\nThis checklist ensures critical business rules are implemented correctly in code.\n\n### Payment and Refund Rules\n\n- [ ] **Failed OTA Activation = No Charge**\n  - Implementation: `if (activation.status == TECHNICAL_SUPPORT) { refundPayment(activation.payment); }`\n  - Location: `OTAActivationService.handleActivationFailure()`\n  \n- [ ] **Desistimiento for Services \u003e 14 Days**\n  - Rule: 14-day refund window\n  - Implementation: `if (service.duration \u003e 14 \u0026\u0026 cancellationDate \u003c= purchaseDate + 14 days) { processRefund(); }`\n  - Location: `ServiceCancellationService.processCancellation()`\n\n- [ ] **Desistimiento for Services \u003c 14 Days**\n  - Rule: Refund anytime during service period\n  - Implementation: `if (service.duration \u003c= 14 \u0026\u0026 service.isActive()) { processRefund(); }`\n  - Location: `ServiceCancellationService.processCancellation()`\n\n- [ ] **Subscription Billing (Mes Vencido)**\n  - Rule: Charge at month-end for consumed services\n  - Implementation: Batch job at month-end: `subscriptionBillingJob.chargeForPreviousMonth()`\n  - Location: `SubscriptionBillingService.processMonthEndBilling()`\n\n- [ ] **Immediate Service Delivery Despite Async Settlement**\n  - Rule: Deliver service before payment confirmation\n  - Implementation: `paymentInitiated() -\u003e immediately queueOTAActivation()`\n  - Location: `PaymentProcessingService.processServicePayment()`\n\n### Vehicle and Order Rules\n\n- [ ] **Failed Final Payment = Vehicle Becomes Stock**\n  - Rule: Vehicle marked \"sin asignar\" and available for immediate sale\n  - Implementation: `if (finalPaymentFailed()) { vehicle.setStatus(UNASSIGNED); vehicle.setCustomer(null); }`\n  - Location: `OrderManagementService.handleFinalPaymentFailure()`\n\n- [ ] **Customer Absent = Return to Dealership**\n  - Rule: Never leave vehicle unattended\n  - Implementation: `if (customerNotPresent()) { delivery.setStatus(RETURNED_TO_DEALER); }`\n  - Location: `DeliveryService.handleFailedHomeDelivery()`\n\n- [ ] **Automatic Credential Generation**\n  - Rule: Customer receives email with platform access credentials after sales registration\n  - Implementation: `createOrder() -\u003e generateCredentials() -\u003e sendEmail()`\n  - Location: `CustomerOnboardingService.setupCustomerAccess()`\n\n### Maintenance and Service Eligibility Rules\n\n- [ ] **Maintenance Check Before Service Activation**\n  - Rule: Query VSS before allowing purchase of maintenance-linked services\n  - Implementation: `if (service.requiresMaintenance) { vssClient.checkMaintenance(vehicle.vin); }`\n  - Location: `ServiceEligibilityService.checkServiceAvailability()`\n\n- [ ] **Block Service Purchase If Maintenance Overdue**\n  - Rule: Prevent activation (not purchase display) if maintenance non-compliant\n  - Implementation: `if (!maintenanceStatus.isCompliant()) { throw MaintenanceRequiredException; }`\n  - Location: `ServiceActivationService.validateEligibility()`\n\n- [ ] **Never Block Base Platform**\n  - Rule: Maintenance issues never disable base vehicle functionality\n  - Implementation: Base platform activation is not conditional on maintenance\n  - Location: No blocking logic for `ServiceType.BASE_PLATFORM`\n\n- [ ] **Never Block Already-Activated Services**\n  - Rule: Maintenance only gates NEW service purchases, not existing ones\n  - Implementation: `activationCheck() only for status == PAYMENT_INITIATED`\n  - Location: `ServiceActivationService.initiateActivation()`\n\n### Notification Rules\n\n- [ ] **Automatic Factory Status Notifications**\n  - Rule: Customer notified at each manufacturing milestone\n  - Implementation: `factoryWebhookHandler() -\u003e sendCustomerNotification()`\n  - Location: `FactoryWebhookHandler.handleStatusUpdate()`\n\n- [ ] **Multi-Channel Notification Delivery**\n  - Rule: Critical notifications sent via email, push, and potentially SMS\n  - Implementation: `notificationService.sendMultiChannel(email, push, sms)`\n  - Location: `NotificationService.sendCriticalNotification()`\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:1-104](), [enunciado.md:1-23]()\n\n---\n\n## Configuration and Environment\n\n### External System Endpoints\n\nExpected configuration structure:\n\n```yaml\nexternal_systems:\n  factory_api:\n    base_url: \"${FACTORY_API_URL}\"\n    endpoints:\n      create_order: \"/api/v1/orders\"\n      query_status: \"/api/v1/orders/{orderId}/status\"\n    auth:\n      type: \"api_key\"\n      key: \"${FACTORY_API_KEY}\"\n    timeout_seconds: 30\n    \n  vss_api:\n    base_url: \"${VSS_API_URL}\"\n    endpoints:\n      maintenance_status: \"/api/v1/vehicles/{vin}/maintenance-status\"\n    auth:\n      type: \"bearer_token\"\n      token: \"${VSS_API_TOKEN}\"\n    timeout_seconds: 10\n    cache_ttl_seconds: 3600\n    \n  iot_api:\n    base_url: \"${IOT_API_URL}\"\n    endpoints:\n      send_command: \"/api/v2/vehicles/{vin}/commands\"\n      query_status: \"/api/v2/vehicles/{vin}/status\"\n    auth:\n      type: \"mutual_tls\"\n      cert_path: \"${IOT_CLIENT_CERT}\"\n      key_path: \"${IOT_CLIENT_KEY}\"\n    timeout_seconds: 60\n    \n  payment_gateway:\n    base_url: \"${PAYMENT_GW_URL}\"\n    merchant_id: \"${MERCHANT_ID}\"\n    auth:\n      type: \"api_key\"\n      key: \"${PAYMENT_API_KEY}\"\n    timeout_seconds: 45\n    \n  admin_registration:\n    endpoints:\n      spain: \"${SPAIN_ADMIN_URL}\"\n      france: \"${FRANCE_ADMIN_URL}\"\n      germany: \"${GERMANY_ADMIN_URL}\"\n    timeout_seconds: 120\n\ncaas_webhooks:\n  factory_status:\n    endpoint: \"/api/webhooks/factory-status\"\n    auth_token: \"${FACTORY_WEBHOOK_SECRET}\"\n  \n  iot_callback:\n    endpoint: \"/api/webhooks/iot-status\"\n    auth_token: \"${IOT_CALLBACK_SECRET}\"\n    \nota_configuration:\n  max_retries: 3\n  retry_delay_base_ms: 1000\n  retry_backoff_multiplier: 2.0\n  command_timeout_seconds: 300\n  \ndesistimiento_rules:\n  long_service_days: 14\n  refund_window_days: 14\n  \nsubscription_billing:\n  billing_day_of_month: 1\n  grace_period_days: 3\n```\n\n### Database Schema Conventions\n\n- Primary keys: UUID (`uuid` type in PostgreSQL)\n- Foreign keys: Suffix with `_id` (e.g., `customer_id`)\n- Timestamps: `created_at`, `updated_at`, use UTC timezone\n- Enums: Store as strings, not integers, for clarity\n- JSON/JSONB: Use for flexible configuration fields like `base_configuration`, `config_payload`\n- Nullable fields: `assigned_customer_id` for vehicles, `activated_at` for pending activations\n\n**Sources:** Inferred from system requirements\n\n---\n\n## Summary\n\nThis technical reference provides the foundational material needed for developers and architects working with the CaaS system. Key takeaways:\n\n1. **Terminology**: All Spanish business terms have precise technical mappings\n2. **API Classification**: Distinguish between existing APIs (constraints) and APIs to develop (requirements)\n3. **Critical Rules**: Failed OTA = no charge; maintenance gates new services only; vehicles never blocked\n4. **Integration Patterns**: Mix of synchronous and asynchronous based on use case requirements\n5. **State Machines**: Well-defined states for orders and service activations with clear transitions\n6. **Technical Constraints**: Actor boundaries, no self-registration, OTA-only delivery\n\nFor detailed implementation of specific subsystems, refer to the child pages: [API Documentation Guidelines](#10.1) and [Key Terminology and Glossary](#10.2).\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()"])</script><script>self.__next_f.push([1,"39:T8e0b,"])</script><script>self.__next_f.push([1,"# API Documentation Guidelines\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis document establishes standards for documenting APIs within the CaaS system architecture. It provides guidelines for technical specification writers, developers, and architects to ensure consistent, complete, and maintainable API documentation throughout the project lifecycle.\n\nThe scope covers:\n- Classification of APIs as **existing** (restrictions) vs **to develop** (requirements)\n- Documentation standards for each API category\n- Inventory of all external and internal APIs in the CaaS ecosystem\n- Integration patterns and communication models\n- Templates for API specification documents\n\nFor business rules governing API usage (e.g., maintenance-gated service access, payment settlement delays), see [Business Rules and Policies](#2.3). For integration architecture patterns, see [Integration Architecture](#3.3).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n---\n\n## API Categories in CaaS\n\nThe CaaS system distinguishes between two fundamentally different categories of APIs, which require different documentation approaches and have different implications for the project.\n\n### Existing APIs (Restrictions)\n\n**Existing APIs** are those that have already been developed, tested, documented, and deployed by other teams or systems. These APIs represent **restrictions** or **constraints** on the CaaS system design.\n\n**Key Characteristics:**\n- Already exist with defined contracts\n- Cannot be modified by the CaaS development team\n- Must be used as-is with existing behavior\n- Have their own external documentation\n- Integration problems are charged to the providing system's project\n- CaaS must adapt to their interface specifications\n\n**Examples in CaaS:**\n- **API IoT**: Existing, documented, tested API for vehicle configuration and telemetry\n- **Factory Order API**: Pre-existing API for order management\n- **VSS API**: External system for maintenance record queries\n- **Payment Gateway API**: Third-party payment processing service\n- **Administrative Registration API**: Government body APIs for vehicle registration\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:32-38](), [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n### APIs to Develop (Requirements)\n\n**APIs to Develop** are those that will be created as part of the CaaS project. These APIs form part of the project scope and have associated requirements, development effort, and quality criteria.\n\n**Key Characteristics:**\n- Part of the CaaS project deliverables\n- Have functional and non-functional requirements\n- Design decisions are under CaaS team control\n- Must be fully specified before development\n- Subject to testing and validation within the project\n- May evolve based on business needs\n\n**Examples in CaaS:**\n- **Web Platform API**: RESTful endpoints for customer web interface\n- **Mobile App API**: API endpoints for mobile application features\n- **Corporate Intranet API**: Internal endpoints for dealership operations\n- **Notification Service API**: Internal API for multi-channel notifications\n- **OTA Management API**: Internal service for orchestrating vehicle activations\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n---\n\n## API Inventory\n\nBelow is a comprehensive inventory of all APIs in the CaaS ecosystem, categorized by type and integration layer.\n\n| API Name | Category | Owner | Direction | Protocol | Sync/Async | Purpose |\n|----------|----------|-------|-----------|----------|------------|---------|\n| **Factory Order API** | Existing | Factory Systems | CaaS  Factory | REST/HTTP | Synchronous | Order placement and management |\n| **Factory Status Webhook** | Existing | Factory Systems | Factory  CaaS | Webhook/HTTP | Asynchronous | Manufacturing status notifications |\n| **API IoT** | Existing | Vehicle Infrastructure | CaaS  IoT Network | Proprietary/Documented | Bidirectional | Vehicle configuration and telemetry |\n| **VSS API** | Existing | Workshop Network | CaaS  VSS | REST/HTTP | Synchronous | Maintenance record queries |\n| **Payment Gateway API** | Existing | Payment Provider | CaaS  Gateway | REST/HTTPS | Async Settlement | Payment processing |\n| **Admin Registration API** | Existing | Government Bodies | CaaS  Admin | SOAP/REST | Synchronous | Vehicle registration |\n| **Web Platform API** | To Develop | CaaS Core | Web Client  CaaS | REST/HTTP | Synchronous | Customer self-service features |\n| **Mobile App API** | To Develop | CaaS Core | Mobile Client  CaaS | REST/HTTP | Synchronous | Mobile application backend |\n| **Corporate Intranet API** | To Develop | CaaS Core | Intranet Client  CaaS | REST/HTTP | Synchronous | Dealership operations |\n| **Notification Service API** | To Develop | CaaS Core | Internal | Message Queue | Asynchronous | Multi-channel notifications |\n| **OTA Management API** | To Develop | CaaS Core | Internal | REST/HTTP | Async Processing | Service activation orchestration |\n| **Service Catalog API** | To Develop | CaaS Core | Internal/External | REST/HTTP | Synchronous | Service definitions and pricing |\n\n**Sources:** High-level architecture diagrams (Diagram 4), [pasame las preguntas y sus respuestas a markdown.md:32-44]()\n\n---\n\n## Integration Patterns and Communication Models\n\nThe following diagram illustrates the integration patterns and communication models used by CaaS APIs, distinguishing between synchronous, asynchronous, and bidirectional patterns.\n\n```mermaid\ngraph TB\n    subgraph \"CaaS Core System\"\n        CORE[\"CaaS Core Services\"]\n        OTA_MGR[\"OTA Management Service\"]\n        NOTIF[\"Notification Service\"]\n    end\n    \n    subgraph \"Synchronous Request-Response\"\n        CORE --\u003e|\"POST /orders\u003cbr/\u003eImmediate Response\"| FACTORY_API[\"Factory Order API\u003cbr/\u003e(Existing)\"]\n        CORE --\u003e|\"GET /maintenance/:vin\u003cbr/\u003eQuery Status\"| VSS_API[\"VSS API\u003cbr/\u003e(Existing)\"]\n        CORE --\u003e|\"POST /register\u003cbr/\u003eVehicle Registration\"| ADMIN_API[\"Admin API\u003cbr/\u003e(Existing)\"]\n        WEB[\"Web Platform\u003cbr/\u003e(Client)\"] --\u003e|\"GET/POST/PUT\u003cbr/\u003eRESTful\"| WEB_API[\"Web Platform API\u003cbr/\u003e(To Develop)\"]\n        MOBILE[\"Mobile App\u003cbr/\u003e(Client)\"] --\u003e|\"GET/POST/PUT\u003cbr/\u003eRESTful\"| MOBILE_API[\"Mobile App API\u003cbr/\u003e(To Develop)\"]\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Client)\"] --\u003e|\"GET/POST/PUT\u003cbr/\u003eRESTful\"| INTRANET_API[\"Intranet API\u003cbr/\u003e(To Develop)\"]\n    end\n    \n    subgraph \"Asynchronous Event-Driven\"\n        FACTORY_WEBHOOK[\"Factory System\"] -.-\u003e|\"POST /webhooks/manufacturing\u003cbr/\u003eStatus Updates\"| CORE\n        PAYMENT_GW[\"Payment Gateway\u003cbr/\u003e(Existing)\"] -.-\u003e|\"Async Settlement\u003cbr/\u003eEventual Confirmation\"| CORE\n        CORE -.-\u003e|\"Publish Events\u003cbr/\u003eOrder, Activation, Status\"| NOTIF\n        NOTIF -.-\u003e|\"Email/SMS/Push\"| CUSTOMERS[\"Customers\"]\n    end\n    \n    subgraph \"Bidirectional Real-Time\"\n        OTA_MGR \u003c--\u003e|\"Push Config\u003cbr/\u003ePull Status\"| IOT_API[\"API IoT\u003cbr/\u003e(Existing, Documented)\"]\n        IOT_API \u003c--\u003e|\"Commands \u0026 Telemetry\"| IOT_NET[\"IoT Network\"]\n        IOT_NET \u003c--\u003e|\"OTA \u0026 Monitoring\"| VEHICLES[\"Vehicle Fleet\"]\n    end\n    \n    subgraph \"Internal Service Communication\"\n        WEB_API --\u003e CORE\n        MOBILE_API --\u003e CORE\n        INTRANET_API --\u003e CORE\n        CORE --\u003e OTA_MGR\n        CORE --\u003e NOTIF\n        OTA_MGR --\u003e|\"Query Config\"| CONFIG_REPO[\"Configuration Repository\u003cbr/\u003e(Internal)\"]\n    end\n    \n    WEB_API -.-\u003e|\"Part of CaaS Project\"| CORE\n    MOBILE_API -.-\u003e|\"Part of CaaS Project\"| CORE\n    INTRANET_API -.-\u003e|\"Part of CaaS Project\"| CORE\n```\n\n**Communication Pattern Summary:**\n\n| Pattern | Use Case | APIs | Characteristics |\n|---------|----------|------|-----------------|\n| **Synchronous Request-Response** | Order placement, queries, CRUD operations | Factory Order API, VSS API, Admin API, all customer-facing APIs | Blocking, immediate response, error handling in same request |\n| **Asynchronous Event-Driven** | Status notifications, payment settlement, alerts | Factory webhooks, Payment Gateway, Notification Service | Non-blocking, eventual consistency, requires callback endpoints |\n| **Bidirectional Real-Time** | Vehicle communication, telemetry | API IoT | Push commands to vehicles, pull status updates, real-time monitoring |\n| **Internal Service-to-Service** | Microservice coordination | All To-Develop internal APIs | Synchronous or async based on use case, internal contracts |\n\n**Sources:** High-level architecture diagrams (Diagram 2, Diagram 4), [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n---\n\n## Documentation Standards\n\n### For Existing APIs (Restrictions)\n\nWhen documenting an existing API that CaaS must integrate with, the documentation should focus on **how CaaS uses** the API rather than **how the API works internally**.\n\n#### Required Documentation Elements:\n\n1. **API Identification**\n   - API name and version\n   - Owning system/team\n   - Reference to external documentation (URL or document ID)\n   - Contact information for support\n\n2. **Integration Summary** (Brief)\n   - What the API does from CaaS perspective\n   - Why CaaS needs it\n   - Which CaaS components call it\n\n3. **Usage Constraints**\n   - Rate limits\n   - Authentication/authorization requirements\n   - Network constraints (VPN, firewall rules)\n   - SLA or availability guarantees\n   - Known limitations or bugs\n\n4. **Integration Assumptions**\n   - Any problems or edge cases that are \"charged to the providing system's project\"\n   - Fallback behavior if API is unavailable\n   - Responsibility boundaries\n\n5. **Reference to Technical Documentation**\n   - Link to API specification (OpenAPI/Swagger, WSDL, etc.)\n   - Example requests/responses\n   - Error codes and handling\n\n#### Documentation Template for Existing APIs:\n\n```markdown\n## [API Name] Integration\n\n**Category:** Existing API (Restriction)  \n**Owner:** [Team/System Name]  \n**Documentation:** [Link to external docs]  \n**Version:** [Version number]\n\n### Purpose\nBrief 1-2 sentence description of what this API does and why CaaS needs it.\n\n### CaaS Usage\n- **Called by:** [Which CaaS component(s)]\n- **Frequency:** [How often / under what conditions]\n- **Critical Path:** [Yes/No - is this blocking for critical flows?]\n\n### Integration Pattern\n- **Protocol:** [REST/SOAP/etc]\n- **Authentication:** [Method used]\n- **Communication:** [Synchronous/Asynchronous]\n- **Retry Policy:** [How CaaS handles failures]\n\n### Constraints and Limitations\n- [List any rate limits, size restrictions, etc.]\n- [Known issues or workarounds]\n\n### Error Handling\n- [How CaaS handles API failures]\n- [Fallback behavior]\n\n### Reference\n- Full API Specification: [Link]\n- Example Requests: [Link or inline examples]\n- Support Contact: [Email/Team]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104](), [pasame las preguntas y sus respuestas a markdown.md:32-38]()\n\n### For APIs to Develop (Requirements)\n\nAPIs being developed as part of the CaaS project require full specification as requirements documents. These APIs form deliverables and must be specified before implementation.\n\n#### Required Documentation Elements:\n\n1. **Functional Requirements**\n   - API purpose and business context\n   - Endpoints/operations to be provided\n   - Request/response schemas\n   - Business rules and validation\n   - Data models\n\n2. **Non-Functional Requirements**\n   - Performance requirements (latency, throughput)\n   - Scalability requirements\n   - Security requirements (authentication, authorization, encryption)\n   - Availability and reliability targets\n   - Monitoring and logging requirements\n\n3. **API Contract Specification**\n   - Full OpenAPI 3.0 specification (or equivalent)\n   - All endpoints with HTTP methods\n   - Request parameters (path, query, header, body)\n   - Response codes and schemas\n   - Error response formats\n\n4. **Integration Requirements**\n   - Which systems/clients will consume this API\n   - Authentication/authorization mechanisms to implement\n   - API versioning strategy\n   - Backward compatibility requirements\n\n5. **Test Requirements**\n   - Acceptance criteria for each endpoint\n   - Edge cases and error scenarios\n   - Performance benchmarks\n\n#### Documentation Template for APIs to Develop:\n\n```markdown\n## [API Name] Specification\n\n**Category:** API to Develop  \n**Status:** [Draft/Review/Approved]  \n**Owner:** CaaS Development Team  \n**Version:** [Semantic version]\n\n### Business Context\n[Why this API is needed, what business problem it solves]\n\n### Functional Requirements\n\n#### FR-[ID]: [Requirement Name]\n**Description:** [Detailed description]  \n**Priority:** [Must/Should/Could]  \n**Acceptance Criteria:**\n- [Criterion 1]\n- [Criterion 2]\n\n### API Contract\n\n#### Base URL\n```\n[Environment]: [Base URL]\n```\n\n#### Authentication\n[Details of auth mechanism]\n\n#### Endpoints\n\n##### [HTTP METHOD] /path/to/resource\n**Description:** [What this endpoint does]  \n**Request:**\n```json\n{\n  \"field\": \"type\"\n}\n```\n**Response (200 OK):**\n```json\n{\n  \"field\": \"type\"\n}\n```\n**Error Responses:**\n- 400 Bad Request: [When and why]\n- 401 Unauthorized: [When and why]\n- 500 Internal Server Error: [When and why]\n\n### Non-Functional Requirements\n\n#### Performance\n- Latency: [p50, p95, p99 targets]\n- Throughput: [requests per second]\n\n#### Security\n- [Authentication mechanism]\n- [Authorization rules]\n- [Data encryption requirements]\n\n#### Availability\n- Target uptime: [percentage]\n- Maximum downtime per month: [duration]\n\n### Data Models\n[Entity schemas, relationships]\n\n### Dependencies\n- [External systems this API depends on]\n- [Internal services required]\n\n### Testing Strategy\n- [Unit test coverage requirements]\n- [Integration test scenarios]\n- [Performance test plan]\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104]()\n\n---\n\n## API-Specific Guidelines\n\n### Factory Integration APIs\n\n#### Factory Order API (Existing)\n\n```mermaid\nsequenceDiagram\n    participant CAAS as \"CaaS Core\"\n    participant FACTORY_API as \"Factory Order API\u003cbr/\u003e(Existing)\"\n    participant FACTORY_SYS as \"Factory Systems\"\n    \n    Note over CAAS,FACTORY_SYS: Synchronous Order Placement\n    CAAS-\u003e\u003eFACTORY_API: POST /orders\u003cbr/\u003e{vehicleSpec, customer, deadline}\n    FACTORY_API-\u003e\u003eFACTORY_SYS: Create Order\n    FACTORY_SYS--\u003e\u003eFACTORY_API: Order Confirmation\n    FACTORY_API--\u003e\u003eCAAS: 201 Created\u003cbr/\u003e{orderId, estimatedDate}\n    \n    Note over CAAS,FACTORY_SYS: Asynchronous Status Updates\n    FACTORY_SYS-\u003e\u003eFACTORY_API: Manufacturing Progress\n    FACTORY_API-\u003e\u003eCAAS: POST /webhooks/manufacturing\u003cbr/\u003e{orderId, status, timestamp}\n    CAAS--\u003e\u003eFACTORY_API: 200 OK\n    \n    Note over CAAS: Possible Status Updates:\n    Note over CAAS: - Order Confirmed\n    Note over CAAS: - Manufacturing Started\n    Note over CAAS: - Quality Check Passed\n    Note over CAAS: - Vehicle Ready\n    Note over CAAS: - Shipped to Dealership\n```\n\n**Documentation Requirements:**\n- **Category:** Existing API (Restriction)\n- **Pattern:** Hybrid - Synchronous for orders, Asynchronous for status\n- **CaaS Responsibility:** \n  - Call order API when customer pays reservation signal\n  - Expose webhook endpoint for status notifications\n  - Store manufacturing status in Order Management database\n  - Trigger customer notifications on status changes\n- **Constraint:** Factory determines delivery date, not CaaS\n- **Error Handling:** Any integration issues are charged to Factory API project\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44](), High-level architecture diagrams (Diagram 4)\n\n#### Factory Webhook Endpoint (To Develop)\n\n```markdown\nPOST /webhooks/manufacturing\n\nCategory: API to Develop (CaaS must implement receiver)\n\nRequest Body:\n{\n  \"orderId\": \"string\",\n  \"status\": \"enum[ORDER_CONFIRMED, MANUFACTURING_STARTED, QUALITY_CHECK, READY, SHIPPED]\",\n  \"timestamp\": \"ISO8601\",\n  \"estimatedDelivery\": \"ISO8601 (optional)\",\n  \"details\": \"string (optional)\"\n}\n\nResponse: 200 OK (acknowledge receipt)\n\nRequirements:\n- Must be idempotent (same update can arrive multiple times)\n- Must validate orderId exists in CaaS system\n- Must update order status in Order Management database\n- Must trigger notification to customer\n- Must log all incoming webhooks for audit\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:28-29]()\n\n---\n\n### Vehicle Communication: API IoT (Existing)\n\nThe **API IoT** is a pre-existing, documented, and tested API for vehicle configuration and telemetry. This is a critical constraint for the CaaS project.\n\n```mermaid\ngraph LR\n    subgraph \"CaaS System\"\n        OTA_SERVICE[\"OTA Management Service\u003cbr/\u003e(To Develop)\"]\n        RETRY_LOGIC[\"Retry Logic\u003cbr/\u003e(To Develop)\"]\n    end\n    \n    subgraph \"Existing Infrastructure\"\n        API_IOT[\"API IoT\u003cbr/\u003e(Existing, Documented)\"]\n        IOT_NETWORK[\"IoT Network\u003cbr/\u003e(Message Broker)\"]\n        VEHICLE[\"Vehicle\u003cbr/\u003e(Firmware Pre-installed)\"]\n    end\n    \n    OTA_SERVICE --\u003e|\"Push Configuration\u003cbr/\u003eactivateService()\"| API_IOT\n    API_IOT --\u003e|\"Command\"| IOT_NETWORK\n    IOT_NETWORK --\u003e|\"OTA Update\"| VEHICLE\n    VEHICLE --\u003e|\"Status Report\"| IOT_NETWORK\n    IOT_NETWORK --\u003e|\"Telemetry\"| API_IOT\n    API_IOT --\u003e|\"Query Status\u003cbr/\u003egetVehicleStatus()\"| OTA_SERVICE\n    \n    OTA_SERVICE --\u003e RETRY_LOGIC\n    RETRY_LOGIC --\u003e|\"On Failure\"| OTA_SERVICE\n```\n\n**Documentation Requirements:**\n\n**Category:** Existing API (Restriction)\n\n**Key Characteristics:**\n- **Pre-existing:** Developed, tested, and documented before CaaS project\n- **Cannot be modified:** CaaS must use as-is\n- **Integration problems:** Charged to the API IoT project, not CaaS\n- **Bidirectional:** Push commands to vehicles, pull status from vehicles\n- **Functionality model:** All features pre-installed in vehicle firmware; API only activates/deactivates\n\n**CaaS Usage:**\n- **Push Service Activation:** After successful payment, send activation command\n- **Pull Vehicle Status:** Query status after activation attempt to verify\n- **Retry Mechanism:** CaaS implements retry logic (N attempts before escalation)\n- **Failure Handling:** If all retries fail, escalate to technical support and DO NOT CHARGE customer\n\n**Critical Business Rule:** Never charge customer for services that cannot be activated due to OTA failures.\n\n**Integration Pattern:**\n```\n1. Customer pays for service\n2. CaaS calls API IoT to activate service\n3. API IoT queues command to IoT Network\n4. IoT Network sends OTA update to vehicle\n5. Vehicle attempts activation\n6. If success: Vehicle reports status back\n7. If failure: CaaS retries N times\n8. If all fail: Technical support escalation + no charge\n```\n\n**Reference:** External API IoT documentation (link to be provided by infrastructure team)\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:32-38](), [pasame las preguntas y sus respuestas a markdown.md:46-56]()\n\n---\n\n### VSS (Vehicle Service System) API (Existing)\n\n```mermaid\ngraph TB\n    subgraph \"Service Purchase Flow\"\n        CUSTOMER[\"Customer\"] --\u003e|\"Request Service\"| SERVICE_CAT[\"Service Catalog\u003cbr/\u003e(To Develop)\"]\n        SERVICE_CAT --\u003e|\"Check if maintenance required\"| MAINT_CHECK[\"Maintenance Check Logic\u003cbr/\u003e(To Develop)\"]\n    end\n    \n    subgraph \"VSS Integration\"\n        MAINT_CHECK --\u003e|\"GET /maintenance/:vin\"| VSS_API[\"VSS API\u003cbr/\u003e(Existing)\"]\n        VSS_API --\u003e|\"Query\"| VSS_SYSTEM[\"VSS System\u003cbr/\u003e(Workshop Network)\"]\n        VSS_SYSTEM --\u003e|\"Return compliance %\"| VSS_API\n        VSS_API --\u003e|\"Maintenance status\"| MAINT_CHECK\n    end\n    \n    subgraph \"Workshop Interaction\"\n        WORKSHOP[\"Official/Approved Workshops\"] --\u003e|\"Record service\"| VSS_SYSTEM\n        VEHICLE_CUSTOMER[\"Vehicle Owner\"] --\u003e|\"Takes vehicle\"| WORKSHOP\n    end\n    \n    subgraph \"Decision Logic\"\n        MAINT_CHECK --\u003e|\"Compliant\"| ALLOW[\"Allow Service Purchase\"]\n        MAINT_CHECK --\u003e|\"Non-compliant\"| BLOCK[\"Block Service\u003cbr/\u003e(Return error)\"]\n        BLOCK --\u003e|\"Notify customer\"| CUSTOMER\n        ALLOW --\u003e|\"Proceed\"| PAYMENT[\"Payment Processing\"]\n    end\n```\n\n**Documentation Requirements:**\n\n**Category:** Existing API (Restriction)\n\n**Purpose:** Query maintenance compliance status for maintenance-dependent services.\n\n**CaaS Usage:**\n- **When:** Before allowing purchase of services that require specific maintenance (e.g., performance enhancements, certain features)\n- **Query Pattern:** Pull-based; CaaS queries when needed\n- **NOT Used For:** Vehicles do NOT push maintenance status to CaaS\n- **Data Source:** Workshops record service in VSS; CaaS queries VSS\n\n**Integration Pattern:**\n```\nGET /maintenance/{vin}?subsystem={subsystemId}\n\nResponse:\n{\n  \"vin\": \"string\",\n  \"subsystem\": \"string\",\n  \"compliancePercentage\": \"number (0-100)\",\n  \"lastMaintenanceDate\": \"ISO8601\",\n  \"nextMaintenanceDue\": \"ISO8601\",\n  \"inWarranty\": \"boolean\"\n}\n```\n\n**Business Rules:**\n- **Blocking Services:** If `compliancePercentage \u003c 100` for required subsystem, deny service purchase\n- **No Vehicle Blocking:** Never block vehicle operation (police-only authority)\n- **Warranty Impact:** If maintenance overdue (`compliancePercentage \u003c 100`), vehicle loses warranty but can still operate\n- **Already-Paid Services:** Cannot revoke services already paid/activated, even if maintenance lapses\n\n**Error Handling:**\n- VSS API unavailable: Allow purchase (assume compliant) or deny (conservative)?  Business decision required\n- Invalid VIN: Return error to customer\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:60-73]()\n\n---\n\n### Payment Gateway API (Existing)\n\n```mermaid\nsequenceDiagram\n    participant CUSTOMER as \"Customer\"\n    participant CAAS as \"CaaS Payment Service\u003cbr/\u003e(To Develop)\"\n    participant GATEWAY as \"Payment Gateway\u003cbr/\u003e(Existing)\"\n    participant BANK as \"Bank Settlement\u003cbr/\u003e(Async)\"\n    participant OTA as \"OTA Service\u003cbr/\u003e(To Develop)\"\n    \n    Note over CUSTOMER,BANK: Immediate Service Delivery Pattern\n    \n    CUSTOMER-\u003e\u003eCAAS: Purchase Service\n    CAAS-\u003e\u003eGATEWAY: POST /payments\u003cbr/\u003e{amount, card, customer}\n    GATEWAY--\u003e\u003eCAAS: 200 OK\u003cbr/\u003e{paymentId, status: PENDING}\n    \n    Note over CAAS: CaaS Assumes Risk:\u003cbr/\u003eDeliver Immediately\n    CAAS-\u003e\u003eOTA: Activate Service\u003cbr/\u003e(before settlement)\n    OTA--\u003e\u003eCUSTOMER: Service Active\n    \n    Note over GATEWAY,BANK: Asynchronous Settlement\n    GATEWAY-\u003e\u003eBANK: Process Payment\n    BANK--\u003e\u003eGATEWAY: Settlement Confirmation\u003cbr/\u003e(hours/days later)\n    GATEWAY-\u003e\u003eCAAS: POST /webhooks/payment\u003cbr/\u003e{paymentId, status: CONFIRMED}\n    \n    Note over CAAS: Reconciliation\u003cbr/\u003eUpdate records\n```\n\n**Documentation Requirements:**\n\n**Category:** Existing API (Restriction)\n\n**Critical Characteristic:** **Asynchronous settlement** with immediate service delivery.\n\n**Risk Management Strategy:**\n- **CaaS assumes risk:** Services delivered before payment fully settles\n- **Business decision:** Better customer experience outweighs risk of chargebacks/failures\n- **Reconciliation required:** CaaS must implement settlement reconciliation process\n\n**Integration Pattern:**\n1. **Payment Initiation:** CaaS calls payment gateway synchronously\n2. **Initial Response:** Gateway returns `paymentId` and status `PENDING`\n3. **Immediate Delivery:** CaaS proceeds with service activation without waiting for settlement\n4. **Async Settlement:** Gateway eventually sends webhook with final status (`CONFIRMED` or `FAILED`)\n5. **Reconciliation:** CaaS reconciles payment records with bank settlements\n\n**Payment Types:**\n- **Reservation Signal:** Initial deposit for vehicle purchase\n- **Final Payment:** Balance before vehicle registration\n- **One-Time Service:** Immediate payment for temporary/permanent features\n- **Subscription (Mes Vencido):** Post-paid billing at month end for consumed services\n\n**Failure Scenarios:**\n- **Final Payment Fails:** Vehicle becomes stock (\"sin asignar\"), customer loses reservation\n- **Service Payment Fails (after activation):** CaaS absorbs loss (risk assumed)\n- **Subscription Payment Fails:** Cancel subscription, notify customer\n\n**Webhook Endpoint (To Develop):**\n```\nPOST /webhooks/payment\n\nRequest:\n{\n  \"paymentId\": \"string\",\n  \"status\": \"enum[CONFIRMED, FAILED, REFUNDED]\",\n  \"timestamp\": \"ISO8601\",\n  \"settlementAmount\": \"number\"\n}\n\nResponse: 200 OK\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:75-96](), High-level architecture diagrams (Diagram 6)\n\n---\n\n### Customer-Facing APIs (To Develop)\n\nThe CaaS system must develop three primary customer-facing APIs for different client interfaces.\n\n```mermaid\ngraph TB\n    subgraph \"Client Applications\"\n        WEB[\"Web Platform\u003cbr/\u003e(Browser)\"]\n        MOBILE[\"Mobile Application\u003cbr/\u003e(iOS/Android)\"]\n        INTRANET[\"Corporate Intranet\u003cbr/\u003e(Dealership)\"]\n    end\n    \n    subgraph \"API Layer (To Develop)\"\n        WEB_API[\"Web Platform API\u003cbr/\u003eRESTful\"]\n        MOBILE_API[\"Mobile App API\u003cbr/\u003eRESTful\"]\n        INTRANET_API[\"Intranet API\u003cbr/\u003eRESTful\"]\n    end\n    \n    subgraph \"Shared Services\"\n        AUTH[\"Authentication Service\u003cbr/\u003eJWT/OAuth\"]\n        EXPEDIENTE[\"Expediente Service\u003cbr/\u003e(Purchase Records)\"]\n        SERVICE_MGT[\"Service Management\"]\n        ORDER_MGT[\"Order Management\"]\n    end\n    \n    WEB --\u003e WEB_API\n    MOBILE --\u003e MOBILE_API\n    INTRANET --\u003e INTRANET_API\n    \n    WEB_API --\u003e AUTH\n    MOBILE_API --\u003e AUTH\n    INTRANET_API --\u003e AUTH\n    \n    WEB_API --\u003e EXPEDIENTE\n    MOBILE_API --\u003e EXPEDIENTE\n    \n    WEB_API --\u003e SERVICE_MGT\n    MOBILE_API --\u003e SERVICE_MGT\n    \n    INTRANET_API --\u003e ORDER_MGT\n    INTRANET_API --\u003e SERVICE_MGT\n```\n\n**Common Requirements for All Customer-Facing APIs:**\n\n1. **Authentication:**\n   - No self-registration; all users must be pre-registered\n   - Customers: Created when vehicle purchased\n   - Employees: Created by HR/IT systems\n   - No SSO with external providers (Google, Microsoft, etc.)\n\n2. **Authorization:**\n   - Role-based access control (RBAC)\n   - Customers: Access only their own expediente and vehicles\n   - Employees: Access based on dealership and role\n   - Admin users: Full system access\n\n3. **RESTful Design:**\n   - Standard HTTP methods (GET, POST, PUT, DELETE)\n   - JSON request/response bodies\n   - Versioned endpoints (`/api/v1/...`)\n   - Consistent error response format\n\n4. **Security:**\n   - HTTPS only (TLS 1.2+)\n   - JWT tokens for authentication\n   - Token expiration and refresh mechanism\n   - Rate limiting per user/IP\n\n5. **Error Handling:**\n   - Standard HTTP status codes\n   - Structured error responses with error codes and messages\n   - Client-friendly error messages (no internal details leaked)\n\n**Sources:** [pasame las preguntas y ses respuestas a markdown.md:10-16]()\n\n#### Web Platform API Specification (To Develop)\n\n**Primary Use Cases:**\n- Browse service catalog (opciones disponibles)\n- View expediente de compra (purchase records, manuals, invoices)\n- Purchase services (with maintenance check)\n- Manage subscriptions\n- View order status\n- Track vehicle delivery\n\n**Key Endpoints:**\n\n| Endpoint | Method | Purpose |\n|----------|--------|---------|\n| `/api/v1/expediente` | GET | Retrieve customer's purchase records |\n| `/api/v1/services/catalog` | GET | List available services for customer's vehicle |\n| `/api/v1/services/{serviceId}` | GET | Get service details |\n| `/api/v1/services/purchase` | POST | Purchase a service (triggers maintenance check) |\n| `/api/v1/orders/{orderId}` | GET | Get order status |\n| `/api/v1/orders/{orderId}/timeline` | GET | Get manufacturing timeline |\n| `/api/v1/subscriptions` | GET | List active subscriptions |\n| `/api/v1/subscriptions/{subId}/cancel` | POST | Cancel subscription |\n| `/api/v1/services/{serviceId}/cancel` | POST | Request refund (desistimiento) |\n\n**Sources:** High-level architecture diagrams (Diagram 2)\n\n#### Mobile App API Specification (To Develop)\n\n**Additional Use Cases Beyond Web:**\n- Vehicle status monitoring\n- Real-time notifications\n- Quick service purchase\n- Vehicle location tracking\n- Direct vehicle link (Bluetooth/NFC pairing)\n\n**Key Endpoints:**\n\n| Endpoint | Method | Purpose |\n|----------|--------|---------|\n| `/api/v1/mobile/vehicles/{vin}/status` | GET | Get real-time vehicle status |\n| `/api/v1/mobile/vehicles/{vin}/link` | POST | Link mobile app to vehicle |\n| `/api/v1/mobile/notifications/register` | POST | Register push notification token |\n| `/api/v1/mobile/services/quick-purchase` | POST | Streamlined service purchase flow |\n\n**Mobile-Specific Requirements:**\n- Offline capability for viewing expediente\n- Push notification support (APNs for iOS, FCM for Android)\n- Optimized payload sizes for mobile networks\n- Background sync for vehicle status\n\n**Sources:** High-level architecture diagrams (Diagram 1)\n\n#### Corporate Intranet API Specification (To Develop)\n\n**Primary Use Cases:**\n- Register new customer and vehicle sale\n- Generate customer credentials\n- Submit factory order\n- Track deliveries\n- Manage dealership inventory\n- View sales reports\n\n**Key Endpoints:**\n\n| Endpoint | Method | Purpose |\n|----------|--------|---------|\n| `/api/v1/intranet/customers` | POST | Register new customer |\n| `/api/v1/intranet/orders` | POST | Create order (triggers factory API) |\n| `/api/v1/intranet/orders/{orderId}/delivery` | PUT | Update delivery status |\n| `/api/v1/intranet/inventory` | GET | View dealership inventory |\n| `/api/v1/intranet/reports/sales` | GET | Generate sales reports |\n\n**Access Control:**\n- Employee-only access\n- Dealership-scoped data (employees see only their dealership)\n- Admin users can access all dealerships\n\n**Sources:** High-level architecture diagrams (Diagram 2), [pasame las preguntas y sus respuestas a markdown.md:10-16]()\n\n---\n\n## Internal Service APIs (To Develop)\n\n### OTA Management API\n\nInternal API for orchestrating service activation via API IoT.\n\n**Key Operations:**\n\n| Operation | Purpose | Implementation Notes |\n|-----------|---------|---------------------|\n| `activateService(vin, serviceId)` | Initiate service activation | Calls API IoT, starts retry timer |\n| `getActivationStatus(activationId)` | Query activation progress | Returns status: PENDING, SUCCESS, FAILED |\n| `retryActivation(activationId)` | Manual retry trigger | For technical support escalations |\n| `cancelActivation(activationId)` | Cancel pending activation | Refunds customer if not delivered |\n\n**Retry Logic Requirements:**\n- Automatic retry: N attempts (configurable)\n- Exponential backoff between retries\n- After all retries fail: Escalate to technical support\n- Critical rule: DO NOT CHARGE customer if activation fails\n\n**State Machine:**\n\n```mermaid\nstateDiagram-v2\n    [*] --\u003e Queued: activateService()\n    Queued --\u003e Attempting: Retry Timer\n    Attempting --\u003e Success: API IoT Confirms\n    Attempting --\u003e Failed: API IoT Error\n    Failed --\u003e Attempting: Retry (N times)\n    Failed --\u003e TechSupport: Max Retries Exceeded\n    TechSupport --\u003e ManualResolution: Tech Support Action\n    ManualResolution --\u003e Success: Manual Fix\n    ManualResolution --\u003e Cancelled: Cannot Fix\n    Success --\u003e [*]: Customer Charged\n    Cancelled --\u003e [*]: Customer NOT Charged\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:46-56](), High-level architecture diagrams (Diagram 5)\n\n### Notification Service API\n\nInternal API for sending multi-channel notifications.\n\n**Channels:**\n- Email\n- SMS\n- Push notifications (mobile app)\n- In-vehicle notifications (via API IoT)\n\n**Key Operations:**\n\n| Operation | Purpose | Triggers |\n|-----------|---------|----------|\n| `sendOrderStatusUpdate(customerId, orderId, status)` | Notify manufacturing progress | Factory webhook |\n| `sendServiceActivated(customerId, serviceId)` | Confirm service activation | OTA success |\n| `sendActivationFailed(customerId, serviceId)` | Alert activation failure | OTA failure escalation |\n| `sendPaymentConfirmation(customerId, paymentId)` | Confirm payment | Payment webhook |\n| `sendRefundProcessed(customerId, refundId)` | Confirm refund | Desistimiento processed |\n\n**Sources:** High-level architecture diagrams (Diagram 2)\n\n---\n\n## Version Control and API Evolution\n\n### Versioning Strategy\n\nAll APIs to develop must follow semantic versioning in the URL path:\n\n```\n/api/v1/resource\n/api/v2/resource\n```\n\n**Version Increment Rules:**\n- **Major version (v1  v2):** Breaking changes (remove field, change data type, rename endpoint)\n- **Minor version (internal):** Backward-compatible additions (new optional field, new endpoint)\n- **Patch version (internal):** Bug fixes with no schema changes\n\n**Deprecation Policy:**\n- Old versions supported for minimum 6 months after new version release\n- Deprecation warnings in response headers\n- Migration guide provided for breaking changes\n\n### Backward Compatibility\n\nFor APIs to develop, maintain backward compatibility whenever possible:\n\n**Additive Changes (Safe):**\n- Add new optional fields to request/response\n- Add new endpoints\n- Add new query parameters (optional)\n\n**Breaking Changes (Require New Version):**\n- Remove or rename fields\n- Change field data types\n- Make optional fields required\n- Remove endpoints\n- Change authentication mechanism\n\n**Sources:** Software engineering best practices\n\n---\n\n## API Security Standards\n\nAll APIs (both existing integrations and to develop) must implement these security standards:\n\n### Authentication\n\n| API Type | Authentication Method | Notes |\n|----------|----------------------|-------|\n| **Customer-facing (Web/Mobile)** | JWT tokens | Issued on login, expire after configurable period |\n| **Intranet** | JWT tokens + SSO integration | Integrated with corporate identity provider |\n| **API-to-API (CaaS  External)** | API keys or OAuth 2.0 | Based on external system requirements |\n| **Webhooks (External  CaaS)** | HMAC signatures | Verify webhook authenticity |\n\n### Authorization\n\n- **Role-Based Access Control (RBAC):** All endpoints require specific roles\n- **Resource-Level Authorization:** Users can only access their own resources\n- **Least Privilege:** Grant minimum necessary permissions\n\n### Data Protection\n\n- **Transport Security:** TLS 1.2+ for all API communication\n- **Data at Rest:** Encrypt sensitive data (PII, payment info)\n- **PII Handling:** GDPR compliance for customer data\n- **Logging:** Log access but redact sensitive fields (card numbers, passwords)\n\n**Sources:** Security best practices, GDPR compliance requirements\n\n---\n\n## API Monitoring and Observability\n\n### Logging Requirements\n\nAll APIs to develop must implement structured logging:\n\n```json\n{\n  \"timestamp\": \"ISO8601\",\n  \"level\": \"INFO|WARN|ERROR\",\n  \"service\": \"api-name\",\n  \"endpoint\": \"/path/to/endpoint\",\n  \"method\": \"GET|POST|PUT|DELETE\",\n  \"userId\": \"user-id\",\n  \"requestId\": \"correlation-id\",\n  \"duration\": \"milliseconds\",\n  \"statusCode\": 200,\n  \"message\": \"Human-readable message\"\n}\n```\n\n### Metrics\n\nTrack these metrics for all APIs:\n\n- **Request Rate:** Requests per second\n- **Error Rate:** Percentage of 4xx/5xx responses\n- **Latency:** p50, p95, p99 response times\n- **Availability:** Uptime percentage\n\n### Alerts\n\nConfigure alerts for:\n- Error rate \u003e 5%\n- p95 latency \u003e threshold\n- Availability \u003c 99.9%\n- External API integration failures\n\n**Sources:** SRE best practices\n\n---\n\n## Conclusion\n\nThis document establishes the standards for API documentation in the CaaS system, ensuring clear differentiation between existing APIs (constraints) and APIs to develop (requirements). All API documentation must follow these standards to maintain consistency, clarity, and maintainability throughout the project lifecycle.\n\n**Key Takeaways:**\n1. **Existing APIs** are restrictions; document how CaaS uses them, not how they work\n2. **APIs to Develop** are requirements; fully specify before implementation\n3. **Integration patterns** vary by use case: synchronous, asynchronous, bidirectional\n4. **Security, versioning, and monitoring** are mandatory for all developed APIs\n5. **Customer protection** is paramount: never charge for services that cannot be delivered\n\nFor implementation details of specific integrations, see [External System Integrations](#5). For the complete glossary of terms used in API documentation, see [Key Terminology and Glossary](#10.2).\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:100-104](), all high-level architecture diagrams"])</script><script>self.__next_f.push([1,"3a:T66ef,"])</script><script>self.__next_f.push([1,"# Key Terminology and Glossary\n\n\u003cdetails\u003e\n\u003csummary\u003eRelevant source files\u003c/summary\u003e\n\nThe following files were used as context for generating this wiki page:\n\n- [enunciado.md](enunciado.md)\n- [pasame las preguntas y sus respuestas a markdown.md](pasame las preguntas y sus respuestas a markdown.md)\n\n\u003c/details\u003e\n\n\n\n## Purpose and Scope\n\nThis page provides a comprehensive reference of all key terminology used throughout the CaaS (Car as a Service) system documentation and codebase. It serves as the authoritative source for understanding business domain terms, technical constructs, and Spanish terminology that appears in requirements and system communications.\n\nThis glossary is organized into thematic categories for easy navigation. For detailed explanations of business rules governing these concepts, see [Business Rules and Policies](#2.3). For technical implementation details of specific subsystems, refer to the appropriate architecture pages (sections 3-5).\n\n---\n\n## Business Model and Product Terms\n\nThese terms define the core business concepts that distinguish the CaaS model from traditional vehicle sales.\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Car as a Service (CaaS)** | Automvil como Servicio | The business model where customers purchase a base vehicle platform and can dynamically enable/disable optional features through pay-per-use subscriptions | [2](#2), [2.1](#2.1) |\n| **Base Platform** | Plataforma Base | The core vehicle configuration that includes all fundamental features required for basic operation. Purchased permanently by the customer | [2.1](#2.1) |\n| **Available Options** | Opciones Disponibles | Optional features and services that can be temporarily or permanently activated on vehicles with compatible base platforms (e.g., power boost, autonomous driving, entertainment systems) | [2.1](#2.1), [6.1](#6.1) |\n| **Pay-per-Use** | Pago por Uso | Payment model where customers pay only for the duration they use optional services, rather than purchasing them permanently upfront | [2.1](#2.1), [7.1](#7.1) |\n| **Commercial Plan** | Plan Comercial | The specific package selected by a customer during vehicle purchase, which may include the base platform plus permanently activated optional services | [8.1](#8.1) |\n| **Purchase Record** | Expediente de Compra | Comprehensive customer dossier containing vehicle manuals, maintenance history, invoices, and service records, accessible through web and mobile platforms | [4.3](#4.3) |\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Vehicle and Technical Infrastructure Terms\n\nThese terms describe the technical components and infrastructure that enable remote vehicle management.\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **OTA (Over The Air)** | Configuracin OTA | Remote configuration system that enables activation/deactivation of vehicle features without requiring physical workshop visits. All CaaS services are delivered via OTA | [5.3](#5.3), [6.2](#6.2) |\n| **IoT Network** | Red de IoT | Network infrastructure connecting all CaaS vehicles to central servers, enabling bidirectional communication for status monitoring and configuration | [5.3](#5.3) |\n| **API IoT** | API IoT | Pre-existing, documented API interface for vehicle communication. Handles OTA configuration commands and telemetry status reports | [5.3](#5.3) |\n| **VSS (Vehicle Service System)** | Sistema VSS | External system maintained by workshops that tracks maintenance history and compliance percentages by functional vehicle blocks | [5.2](#5.2), [8.3](#8.3) |\n| **Firmware** | Firmware | Pre-installed software on vehicles containing all optional features in disabled state. CaaS only activates/deactivates functionality; it does not install new software | [6.2](#6.2) |\n| **Telemetry** | Telemetra | Real-time operational status data transmitted from vehicles through the IoT network | [5.3](#5.3) |\n| **Connected Vehicle** | Vehculo Conectado | Vehicle equipped with IoT connectivity enabling remote monitoring and OTA configuration | [5.3](#5.3) |\n\n**Sources:** [enunciado.md:7-8, 19](), [pasame las preguntas y sus respuestas a markdown.md:31-57]()\n\n---\n\n## System Components and Actors\n\n### Terminology to Code Entity Mapping\n\n```mermaid\ngraph TB\n    subgraph \"Business Domain Terms\"\n        EXPEDIENTE[\"Expediente de Compra\u003cbr/\u003e(Purchase Record)\"]\n        PLATAFORMA_BASE[\"Plataforma Base\u003cbr/\u003e(Base Platform)\"]\n        OPCIONES[\"Opciones Disponibles\u003cbr/\u003e(Available Options)\"]\n        INTRANET[\"Intranet Corporativa\u003cbr/\u003e(Corporate Intranet)\"]\n    end\n    \n    subgraph \"Code Entity Space\"\n        CUSTOMER_PROFILE[\"CustomerProfile\u003cbr/\u003eEntity/Model\"]\n        ORDER_HISTORY[\"OrderHistory\u003cbr/\u003eService\"]\n        INVOICE_MANAGER[\"InvoiceManager\u003cbr/\u003eComponent\"]\n        \n        VEHICLE_CONFIG[\"VehicleConfiguration\u003cbr/\u003eEntity\"]\n        BASE_FEATURES[\"BaseFeatures\u003cbr/\u003eEnum/Config\"]\n        \n        SERVICE_CATALOG[\"ServiceCatalog\u003cbr/\u003eRepository\"]\n        AVAILABLE_SERVICES[\"AvailableService\u003cbr/\u003eEntity\"]\n        SERVICE_PRICING[\"ServicePricingRules\u003cbr/\u003eComponent\"]\n        \n        INTRANET_APP[\"IntranetApplication\u003cbr/\u003eWeb Module\"]\n        SALES_REGISTRATION[\"SalesRegistration\u003cbr/\u003eController\"]\n    end\n    \n    subgraph \"Database Layer\"\n        CUSTOMERS_DB[(\"customers_db\u003cbr/\u003eSchema\")]\n        SERVICES_DB[(\"services_db\u003cbr/\u003eSchema\")]\n        ORDERS_DB[(\"orders_db\u003cbr/\u003eSchema\")]\n    end\n    \n    EXPEDIENTE --\u003e CUSTOMER_PROFILE\n    EXPEDIENTE --\u003e ORDER_HISTORY\n    EXPEDIENTE --\u003e INVOICE_MANAGER\n    \n    CUSTOMER_PROFILE --\u003e CUSTOMERS_DB\n    ORDER_HISTORY --\u003e ORDERS_DB\n    INVOICE_MANAGER --\u003e ORDERS_DB\n    \n    PLATAFORMA_BASE --\u003e VEHICLE_CONFIG\n    PLATAFORMA_BASE --\u003e BASE_FEATURES\n    VEHICLE_CONFIG --\u003e SERVICES_DB\n    \n    OPCIONES --\u003e SERVICE_CATALOG\n    OPCIONES --\u003e AVAILABLE_SERVICES\n    OPCIONES --\u003e SERVICE_PRICING\n    SERVICE_CATALOG --\u003e SERVICES_DB\n    AVAILABLE_SERVICES --\u003e SERVICES_DB\n    \n    INTRANET --\u003e INTRANET_APP\n    INTRANET --\u003e SALES_REGISTRATION\n    SALES_REGISTRATION --\u003e CUSTOMERS_DB\n    SALES_REGISTRATION --\u003e ORDERS_DB\n```\n\n**Sources:** [enunciado.md:3-12](), [pasame las preguntas y sus respuestas a markdown.md:9-16]()\n\n---\n\n## Actor and External Entity Terms\n\n| Term | Spanish Equivalent | Definition | System Boundary |\n|------|-------------------|------------|-----------------|\n| **Customer** | Cliente | Individual or entity that has purchased a vehicle. Has credentials to access web/mobile platforms | External Actor |\n| **Employee** | Empleado | Dealership staff who process sales through the corporate intranet | External Actor |\n| **Dealership** | Concesionario | Physical sales location where vehicles are sold and delivered. Handles initial sales registration and final customer pickup | External Actor |\n| **Factory** | Fbrica | Manufacturing facility that produces vehicles based on orders received via API. Same company as CaaS | External System |\n| **Workshop** | Taller | Official or approved service centers that perform vehicle maintenance and record services in VSS | External Actor |\n| **Transport Company** | Empresa de Transporte | Subcontracted logistics provider that delivers vehicles from factory to dealership or customer address | External Actor |\n| **Administrative Bodies** | Organismos Administrativos | Government entities responsible for vehicle registration (country-specific) | External System |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:9-29]()\n\n---\n\n## Payment and Billing Terms\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Reservation Signal** | Seal (de Reserva) | Initial deposit payment that reserves a vehicle for a customer and triggers factory order | [7.1](#7.1), [8.1](#8.1) |\n| **Final Payment** | Pago Final | Complete payment for vehicle purchase, required before administrative registration. Failure results in vehicle becoming stock | [7.1](#7.1), [9.2](#9.2) |\n| **Service Payment** | Pago de Servicio | One-time payment for temporary or permanent service activation | [7.1](#7.1) |\n| **Post-Paid Billing** | Mes Vencido | Subscription billing model where customers are charged at month end for services consumed during that month | [7.1](#7.1) |\n| **Subscription** | Suscripcin | Recurring service model with automatic renewal and post-paid billing | [6.1](#6.1), [7.1](#7.1) |\n| **Settlement Risk** | Riesgo de Liquidacin | Financial risk CaaS assumes by delivering services immediately despite asynchronous payment confirmation from gateway | [7.2](#7.2) |\n| **Refund** | Reembolso/Devolucin | Return of payment to customer, governed by desistimiento rules based on service duration | [6.4](#6.4) |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:75-96]()\n\n---\n\n## Service Lifecycle and Status Terms\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Service Activation** | Activacin de Servicio | OTA process that enables a purchased optional feature on the vehicle | [6.2](#6.2) |\n| **Service Duration** | Duracin del Servicio | Time period for which a service is active: temporary (X days), permanent (vehicle lifetime), or subscription (recurring monthly) | [6.1](#6.1) |\n| **Planned Service** | Servicio Planificado | Service scheduled for future activation at a specified date/time | [6.1](#6.1) |\n| **Official Maintenance Status** | Estado Oficial de Mantenimiento | Vehicle's compliance with scheduled maintenance plan, tracked in VSS. Required for certain premium services | [6.3](#6.3), [8.3](#8.3) |\n| **Maintenance-Linked Service** | Servicio Vinculado a Mantenimiento | Optional service that can only be activated if the vehicle's maintenance is current (safety/warranty requirement) | [6.3](#6.3) |\n| **Service Blocking** | Bloqueo de Servicio | Prevention of new service purchases due to overdue maintenance. Does not affect already-activated services or base platform | [6.3](#6.3), [9.4](#9.4) |\n| **Unassigned Vehicle** | Vehculo Sin Asignar | Vehicle manufactured but not yet assigned to any customer (either new stock or returned after failed final payment) | [9.2](#9.2) |\n| **Stock Vehicle** | Vehculo en Stock | Vehicle available for immediate sale at dealership | [9.2](#9.2) |\n\n**Sources:** [enunciado.md:3-23](), [pasame las preguntas y sus respuestas a markdown.md:58-73]()\n\n---\n\n## Integration and API Terms\n\n### API Communication Patterns\n\n```mermaid\ngraph LR\n    subgraph \"Factory Integration Terms\"\n        SYNC_ORDER[\"Synchronous Order\u003cbr/\u003e(Pedido Sncrono)\u003cbr/\u003eCaaS  Factory\"]\n        ASYNC_STATUS[\"Asynchronous Status\u003cbr/\u003e(Notificaciones Asncronas)\u003cbr/\u003eFactory  CaaS\"]\n    end\n    \n    subgraph \"Code Implementation\"\n        POST_ORDER[\"POST /factory/orders\u003cbr/\u003eFactoryOrderAPI\u003cbr/\u003eSynchronous\"]\n        WEBHOOK[\"Webhook Endpoint\u003cbr/\u003e/webhooks/factory-status\u003cbr/\u003eStatusNotificationHandler\"]\n    end\n    \n    subgraph \"IoT Terms\"\n        OTA_COMMAND[\"OTA Command\u003cbr/\u003e(Comando OTA)\u003cbr/\u003eCaaS  Vehicle\"]\n        VEHICLE_STATUS[\"Vehicle Status\u003cbr/\u003e(Estado Vehculo)\u003cbr/\u003eVehicle  CaaS\"]\n    end\n    \n    subgraph \"IoT Implementation\"\n        IOT_CONFIG[\"POST /iot/configure\u003cbr/\u003eIoTConfigurationAPI\u003cbr/\u003eBidirectional\"]\n        IOT_TELEMETRY[\"GET /iot/telemetry\u003cbr/\u003eVehicleTelemetryAPI\"]\n    end\n    \n    SYNC_ORDER --\u003e POST_ORDER\n    ASYNC_STATUS --\u003e WEBHOOK\n    OTA_COMMAND --\u003e IOT_CONFIG\n    VEHICLE_STATUS --\u003e IOT_TELEMETRY\n```\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:40-44]()\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Factory API** | API de Fbrica | Synchronous API for order placement. Returns immediate confirmation of order acceptance | [5.1](#5.1) |\n| **Factory Webhook** | Webhook de Fbrica | Asynchronous callback mechanism where factory pushes manufacturing status updates to CaaS | [5.1](#5.1) |\n| **API IoT** | API IoT | Pre-existing, documented API for vehicle communication. Must be used as-is; restrictions apply | [5.3](#5.3), [10.1](#10.1) |\n| **OTA Configuration** | Configuracin OTA | Remote parameter update sent to vehicle through IoT network to activate/deactivate features | [5.3](#5.3), [6.2](#6.2) |\n| **VSS Query** | Consulta VSS | Pull-based API request to retrieve vehicle maintenance records from workshop system | [5.2](#5.2) |\n| **Payment Gateway** | Pasarela de Pago | External system for processing card/bank payments with asynchronous settlement | [5.4](#5.4) |\n| **Admin API** | API Administrativa | Interface for registering vehicles with government bodies (country-specific implementations) | [5.5](#5.5) |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:31-44, 100-104]()\n\n---\n\n## Process and Workflow Terms\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Sales Registration** | Registro de Venta | Initial dealership process of capturing customer data and commercial plan through corporate intranet | [8.1](#8.1) |\n| **Credential Generation** | Generacin de Credenciales | Automatic creation and emailing of customer access credentials for web/mobile platforms after sales registration | [8.1](#8.1) |\n| **Factory Order** | Pedido a Fbrica | Automatic order placement triggered by reservation payment | [8.1](#8.1), [5.1](#5.1) |\n| **Manufacturing Notification** | Notificacin de Fabricacin | Asynchronous status update from factory informing CaaS and customer of production progress | [8.2](#8.2), [5.1](#5.1) |\n| **Vehicle Registration** | Matriculacin | Process of registering vehicle with administrative bodies after final payment, required before delivery | [8.2](#8.2), [5.5](#5.5) |\n| **Home Delivery** | Entrega a Domicilio | Transport of vehicle to customer address. Falls back to dealership pickup if customer unavailable | [8.2](#8.2), [9.3](#9.3) |\n| **Mobile App Linking** | Vinculacin de App | Association of customer's mobile application with their specific vehicle, enabling direct vehicle control | [4.3](#4.3) |\n| **OTA Retry Logic** | Lgica de Reintentos OTA | Mechanism that attempts OTA activation multiple times before escalating to technical support | [6.2](#6.2), [9.1](#9.1) |\n\n**Sources:** [enunciado.md:9-19](), [pasame las preguntas y sus respuestas a markdown.md:18-29, 47-56]()\n\n---\n\n## Legal and Compliance Terms\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Right of Withdrawal** | Derecho de Desistimiento | Legal right allowing customers to cancel services within specified timeframes for distance selling | [6.4](#6.4), [2.3](#2.3) |\n| **14-Day Withdrawal Period** | Periodo de 14 Das | For services lasting more than 14 days, customers can request refund within first 14 days | [6.4](#6.4) |\n| **Anytime Cancellation** | Cancelacin en Cualquier Momento | For services lasting less than 14 days, customers can cancel and receive refund at any time | [6.4](#6.4) |\n| **Warranty** | Garanta | Vehicle warranty coverage, which can be voided by failure to follow official maintenance schedule | [8.3](#8.3), [9.4](#9.4) |\n| **Warranty Loss** | Prdida de Garanta | Consequence of not maintaining vehicle per official schedule. Does NOT block base platform or existing services | [9.4](#9.4) |\n| **Distance Selling Regulations** | Normativa de Venta a Distancia | Legal framework requiring desistimiento rights for services purchased without physical presence | [2.3](#2.3) |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:84-96]()\n\n---\n\n## Failure Handling and Edge Case Terms\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **OTA Activation Failure** | Fallo de Activacin OTA | Condition where remote service activation cannot complete successfully after all retry attempts | [9.1](#9.1) |\n| **Do Not Charge Rule** | Regla de No Cobrar | Critical business rule: customers must never be charged for services that fail OTA activation | [9.1](#9.1), [2.3](#2.3) |\n| **Technical Support Escalation** | Escalada a Soporte Tcnico | Process of forwarding failed OTA activations to human technicians after exhausting automatic retries | [9.1](#9.1) |\n| **Failed Final Payment** | Fallo de Pago Final | Scenario where customer cannot complete vehicle purchase. Vehicle becomes unassigned stock | [9.2](#9.2) |\n| **Failed Service Payment** | Fallo de Pago de Servicio | Payment failure for optional service. Service is not delivered | [9.2](#9.2) |\n| **Subscription Payment Failure** | Fallo de Pago de Suscripcin | Monthly subscription charge failure. Leads to subscription cancellation | [9.2](#9.2), [6.4](#6.4) |\n| **Customer Absence at Delivery** | Ausencia de Cliente en Entrega | Failed home delivery scenario. Vehicle returns to dealership for customer pickup | [9.3](#9.3) |\n| **Vehicle Theft** | Robo de Vehculo | Special scenario where customer can cancel pending/future services but cannot refund already-delivered services past desistimiento period | [9.4](#9.4) |\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:47-96]()\n\n---\n\n## Service Type and Duration Taxonomy\n\nThe CaaS system supports multiple service acquisition models:\n\n```mermaid\ngraph TB\n    subgraph \"Service Types (Tipos de Servicio)\"\n        ONETIME[\"One-Time Service\u003cbr/\u003e(Servicio nico)\"]\n        SUBSCRIPTION[\"Subscription Service\u003cbr/\u003e(Suscripcin)\"]\n        PLANNED[\"Planned Service\u003cbr/\u003e(Servicio Planificado)\"]\n    end\n    \n    subgraph \"Duration Models (Modelos de Duracin)\"\n        TEMPORARY[\"Temporary\u003cbr/\u003e(Temporal)\u003cbr/\u003eFixed days/months\"]\n        PERMANENT[\"Permanent\u003cbr/\u003e(Permanente)\u003cbr/\u003eVehicle lifetime\"]\n        RECURRING[\"Recurring\u003cbr/\u003e(Recurrente)\u003cbr/\u003eMonthly renewal\"]\n    end\n    \n    subgraph \"Maintenance Requirements\"\n        MAINT_FREE[\"No Maintenance Required\u003cbr/\u003e(Sin Requisito Mantenimiento)\"]\n        MAINT_LINKED[\"Maintenance-Linked\u003cbr/\u003e(Vinculado a Mantenimiento)\"]\n    end\n    \n    subgraph \"Cancellation Rights (Desistimiento)\"\n        SHORT_SERVICE[\"Service \u003c 14 Days\u003cbr/\u003eRefund anytime\"]\n        LONG_SERVICE[\"Service \u003e 14 Days\u003cbr/\u003eRefund within 14 days\"]\n        CONSUMED_SERVICE[\"After Refund Window\u003cbr/\u003eNo refund\"]\n    end\n    \n    ONETIME --\u003e TEMPORARY\n    ONETIME --\u003e PERMANENT\n    SUBSCRIPTION --\u003e RECURRING\n    PLANNED --\u003e TEMPORARY\n    PLANNED --\u003e PERMANENT\n    \n    TEMPORARY --\u003e MAINT_FREE\n    TEMPORARY --\u003e MAINT_LINKED\n    PERMANENT --\u003e MAINT_FREE\n    PERMANENT --\u003e MAINT_LINKED\n    RECURRING --\u003e MAINT_FREE\n    RECURRING --\u003e MAINT_LINKED\n    \n    TEMPORARY --\u003e SHORT_SERVICE\n    TEMPORARY --\u003e LONG_SERVICE\n    PERMANENT --\u003e LONG_SERVICE\n    RECURRING --\u003e CONSUMED_SERVICE\n```\n\n**Sources:** [enunciado.md:3-22](), [pasame las preguntas y sus respuestas a markdown.md:84-90]()\n\n| Term | Definition | Payment Model | Cancellation Rules |\n|------|------------|---------------|-------------------|\n| **Temporary Service** (Temporal) | Service active for fixed duration (X days/months), then automatically deactivates | Pay upfront for entire duration | Refund if service \u003e 14 days and within 14-day window; otherwise refund anytime if service \u003c 14 days |\n| **Permanent Service** (Permanente) | Service remains active for vehicle's entire operational lifetime | Pay once, never expires | Refund within 14 days of activation |\n| **Subscription Service** (Suscripcin) | Monthly recurring service with automatic renewal | Mes vencido (charged at month end) | Cancel anytime; no refund for consumed periods |\n| **Planned/Scheduled Service** (Planificado) | Service purchased now but activated at future date/time | Pay upfront, activation delayed | Refund follows same rules as temporary/permanent based on intended duration |\n| **Recurring Service** (Recurrente) | Synonym for subscription service with automatic monthly renewal | Mes vencido | Cancel anytime; no refund for consumed periods |\n\n**Sources:** [enunciado.md:21-22](), [pasame las preguntas y sus respuestas a markdown.md:82-90]()\n\n---\n\n## Vehicle State and Status Terms\n\n| Term | Spanish Equivalent | Definition | Transitions |\n|------|-------------------|------------|-------------|\n| **Ordered** | Pedido | Vehicle ordered from factory but not yet manufactured |  Manufacturing |\n| **Manufacturing** | En Fabricacin | Vehicle currently being produced at factory |  Ready |\n| **Ready** | Listo/Disponible | Vehicle manufactured and available at dealership location |  Awaiting Final Payment |\n| **Awaiting Final Payment** | Esperando Pago Final | Vehicle ready but customer has not completed purchase payment |  Registered OR Unassigned |\n| **Registered** | Matriculado | Vehicle paid for and registered with administrative bodies |  In Transit |\n| **In Transit** | En Trnsito | Vehicle being transported to customer address |  Delivered OR Returned to Dealership |\n| **Delivered** | Entregado | Vehicle successfully delivered to customer and mobile app linked |  Operational |\n| **Operational** | Operativo | Vehicle in normal customer use with base platform active |  (stays operational) |\n| **Unassigned** | Sin Asignar | Vehicle manufactured but customer failed final payment; available as stock |  Assigned to New Customer |\n| **Stock** | En Stock | Vehicle available for immediate sale at dealership |  Reserved by New Customer |\n\n**Sources:** [enunciado.md:13-17](), [pasame las preguntas y sus respuestas a markdown.md:24-28]()\n\n---\n\n## User Access and Authentication Terms\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Access Credentials** | Credenciales de Acceso | Username/password automatically generated and emailed to customer after sales registration | [8.1](#8.1) |\n| **Corporate Intranet** | Intranet Corporativa | Internal web platform used by dealership employees to register sales and manage inventory | [3.2](#3.2), [8.1](#8.1) |\n| **Customer Web Platform** | Plataforma Web | Public-facing website where customers access their expediente and purchase services | [4.3](#4.3) |\n| **Mobile Application** | Aplicacin Mvil | Smartphone app for customer access to expediente and direct vehicle communication | [4.3](#4.3) |\n| **Authenticated User** | Usuario Autenticado | Any customer or employee with valid credentials. No public/anonymous access allowed | N/A |\n\n**Important Note:** The CaaS system does NOT support:\n- Self-registration by users\n- Single Sign-On (SSO) with external providers (Google, Microsoft, etc.)\n- Anonymous/public access to any functionality\n\nAll users must be explicitly registered by dealership staff or system administrators.\n\n**Sources:** [pasame las preguntas y sus respuestas a markdown.md:14-16](), [enunciado.md:9-11]()\n\n---\n\n## Notification and Communication Terms\n\n| Term | Spanish Equivalent | Definition | Related Pages |\n|------|-------------------|------------|---------------|\n| **Manufacturing Status Notification** | Notificacin de Estado de Fabricacin | Automatic updates sent to customers throughout vehicle production process | [8.2](#8.2) |\n| **Service Activation Notification** | Notificacin de Activacin | Confirmation sent to customer via email, mobile app, and vehicle display when service successfully activates | [6.2](#6.2) |\n| **Vehicle Availability Notification** | Notificacin de Disponibilidad | Alert sent when manufactured vehicle arrives at customer's local dealership | [8.2](#8.2) |\n| **OTA Failure Notification** | Notificacin de Fallo OTA | Message to customer and technical support when service activation fails after all retries | [9.1](#9.1) |\n| **Multi-Channel Notification** | Notificacin Multicanal | Communication strategy using email, push notifications, and SMS for critical updates | [3.2](#3.2) |\n\n**Sources:** [enunciado.md:13, 19](), [pasame las preguntas y sus respuestas a markdown.md:28-29, 52-53]()\n\n---\n\n## Spanish-English Quick Reference\n\nFor international teams, here is a quick lookup table of Spanish business terms and their English equivalents:\n\n| Spanish Term | English Term | Category |\n|--------------|--------------|----------|\n| Automvil como Servicio | Car as a Service | Business Model |\n| Plataforma Base | Base Platform | Product |\n| Opciones Disponibles | Available Options | Product |\n| Pago por Uso | Pay-per-Use | Billing |\n| Expediente de Compra | Purchase Record | Customer Data |\n| Seal | Reservation Signal/Deposit | Payment |\n| Concesionario | Dealership | Actor |\n| Fbrica | Factory | Actor |\n| Taller | Workshop | Actor |\n| Mes Vencido | Post-Paid/Month End Billing | Billing |\n| Desistimiento | Right of Withdrawal | Legal |\n| Sin Asignar | Unassigned | Status |\n| Intranet Corporativa | Corporate Intranet | System |\n| Configuracin OTA | OTA Configuration | Technology |\n| Estado Oficial de Mantenimiento | Official Maintenance Status | Process |\n| Vinculacin de App | Mobile App Linking | Process |\n| Matriculacin | Vehicle Registration | Process |\n| Entrega a Domicilio | Home Delivery | Process |\n| Notificacin de Fabricacin | Manufacturing Notification | Communication |\n\n**Sources:** [enunciado.md:1-23](), [pasame las preguntas y sus respuestas a markdown.md:1-104]()\n\n---\n\n## Abbreviations and Acronyms\n\n| Acronym | Full Term | Definition |\n|---------|-----------|------------|\n| **CaaS** | Car as a Service | The business model and system name |\n| **OTA** | Over The Air | Remote wireless configuration technology |\n| **IoT** | Internet of Things | Network infrastructure connecting vehicles |\n| **VSS** | Vehicle Service System | External maintenance tracking system |\n| **API** | Application Programming Interface | Software integration interface |\n| **SSO** | Single Sign-On | Authentication method (NOT supported by CaaS) |\n| **TSP** | Telematics Service Provider | Third-party vehicle connectivity provider (NOT used; CaaS uses internal API IoT) |\n\n**Sources:** [enunciado.md:7, 19](), [pasame las preguntas y sus respuestas a markdown.md:31-38]()"])</script><script>self.__next_f.push([1,"5:[\"$\",\"$L12\",null,{\"repoName\":\"jaimedpdqufv/ADSI_CaaS\",\"hasConfig\":false,\"canSteer\":true,\"children\":[\"$\",\"$L13\",null,{\"wiki\":{\"metadata\":{\"repo_name\":\"jaimedpdqufv/ADSI_CaaS\",\"commit_hash\":\"003b3aa6\",\"generated_at\":\"2025-11-28T15:38:40.157991\",\"config\":null,\"config_source\":\"none\"},\"pages\":[{\"page_plan\":{\"id\":\"1\",\"title\":\"Overview\"},\"content\":\"$14\"},{\"page_plan\":{\"id\":\"2\",\"title\":\"Business Model and Concept\"},\"content\":\"$15\"},{\"page_plan\":{\"id\":\"2.1\",\"title\":\"Platform Base and Optional Services\"},\"content\":\"$16\"},{\"page_plan\":{\"id\":\"2.2\",\"title\":\"Key Actors and System Boundaries\"},\"content\":\"$17\"},{\"page_plan\":{\"id\":\"2.3\",\"title\":\"Business Rules and Policies\"},\"content\":\"$18\"},{\"page_plan\":{\"id\":\"3\",\"title\":\"System Architecture\"},\"content\":\"$19\"},{\"page_plan\":{\"id\":\"3.1\",\"title\":\"High-Level Architecture\"},\"content\":\"$1a\"},{\"page_plan\":{\"id\":\"3.2\",\"title\":\"Core Technical Components\"},\"content\":\"$1b\"},{\"page_plan\":{\"id\":\"3.3\",\"title\":\"Integration Architecture\"},\"content\":\"$1c\"},{\"page_plan\":{\"id\":\"4\",\"title\":\"Customer Journey\"},\"content\":\"$1d\"},{\"page_plan\":{\"id\":\"4.1\",\"title\":\"Vehicle Purchase and Delivery Process\"},\"content\":\"$1e\"},{\"page_plan\":{\"id\":\"4.2\",\"title\":\"Service Acquisition and Management\"},\"content\":\"$1f\"},{\"page_plan\":{\"id\":\"4.3\",\"title\":\"Customer-Facing Platforms\"},\"content\":\"$20\"},{\"page_plan\":{\"id\":\"5\",\"title\":\"External System Integrations\"},\"content\":\"$21\"},{\"page_plan\":{\"id\":\"5.1\",\"title\":\"Factory Integration\"},\"content\":\"$22\"},{\"page_plan\":{\"id\":\"5.2\",\"title\":\"VSS (Vehicle Service System) Integration\"},\"content\":\"$23\"},{\"page_plan\":{\"id\":\"5.3\",\"title\":\"Vehicle Communication (IoT and OTA)\"},\"content\":\"$24\"},{\"page_plan\":{\"id\":\"5.4\",\"title\":\"Payment Gateway Integration\"},\"content\":\"$25\"},{\"page_plan\":{\"id\":\"5.5\",\"title\":\"Administrative Registration Integration\"},\"content\":\"$26\"},{\"page_plan\":{\"id\":\"6\",\"title\":\"Service Lifecycle Management\"},\"content\":\"$27\"},{\"page_plan\":{\"id\":\"6.1\",\"title\":\"Service Catalog and Pricing\"},\"content\":\"$28\"},{\"page_plan\":{\"id\":\"6.2\",\"title\":\"OTA Service Activation\"},\"content\":\"$29\"},{\"page_plan\":{\"id\":\"6.3\",\"title\":\"Maintenance-Linked Service Access\"},\"content\":\"$2a\"},{\"page_plan\":{\"id\":\"6.4\",\"title\":\"Service Cancellation and Refunds\"},\"content\":\"$2b\"},{\"page_plan\":{\"id\":\"7\",\"title\":\"Payment and Billing\"},\"content\":\"$2c\"},{\"page_plan\":{\"id\":\"7.1\",\"title\":\"Payment Types and Flows\"},\"content\":\"$2d\"},{\"page_plan\":{\"id\":\"7.2\",\"title\":\"Risk Management and Settlement\"},\"content\":\"$2e\"},{\"page_plan\":{\"id\":\"8\",\"title\":\"Operational Processes\"},\"content\":\"$2f\"},{\"page_plan\":{\"id\":\"8.1\",\"title\":\"Sales and Order Management\"},\"content\":\"$30\"},{\"page_plan\":{\"id\":\"8.2\",\"title\":\"Manufacturing and Delivery Workflow\"},\"content\":\"$31\"},{\"page_plan\":{\"id\":\"8.3\",\"title\":\"Maintenance Management\"},\"content\":\"$32\"},{\"page_plan\":{\"id\":\"9\",\"title\":\"Failure Handling and Edge Cases\"},\"content\":\"$33\"},{\"page_plan\":{\"id\":\"9.1\",\"title\":\"OTA Activation Failures\"},\"content\":\"$34\"},{\"page_plan\":{\"id\":\"9.2\",\"title\":\"Payment Failure Scenarios\"},\"content\":\"$35\"},{\"page_plan\":{\"id\":\"9.3\",\"title\":\"Delivery and Transport Issues\"},\"content\":\"$36\"},{\"page_plan\":{\"id\":\"9.4\",\"title\":\"Special Scenarios (Theft, Warranty Loss)\"},\"content\":\"$37\"},{\"page_plan\":{\"id\":\"10\",\"title\":\"Technical Reference\"},\"content\":\"$38\"},{\"page_plan\":{\"id\":\"10.1\",\"title\":\"API Documentation Guidelines\"},\"content\":\"$39\"},{\"page_plan\":{\"id\":\"10.2\",\"title\":\"Key Terminology and Glossary\"},\"content\":\"$3a\"}]},\"children\":[\"$\",\"$L3\",null,{\"parallelRouterKey\":\"children\",\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L4\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]\n"])</script><script>self.__next_f.push([1,"c:null\n10:[[\"$\",\"title\",\"0\",{\"children\":\"jaimedpdqufv/ADSI_CaaS | DeepWiki\"}],[\"$\",\"meta\",\"1\",{\"name\":\"description\",\"content\":\"This page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how \"}],[\"$\",\"meta\",\"2\",{\"property\":\"og:title\",\"content\":\"jaimedpdqufv/ADSI_CaaS | DeepWiki\"}],[\"$\",\"meta\",\"3\",{\"property\":\"og:description\",\"content\":\"This page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how \"}],[\"$\",\"meta\",\"4\",{\"property\":\"og:url\",\"content\":\"https://deepwiki.com/jaimedpdqufv/ADSI_CaaS\"}],[\"$\",\"meta\",\"5\",{\"property\":\"og:site_name\",\"content\":\"DeepWiki\"}],[\"$\",\"meta\",\"6\",{\"property\":\"og:type\",\"content\":\"website\"}],[\"$\",\"meta\",\"7\",{\"name\":\"twitter:card\",\"content\":\"summary\"}],[\"$\",\"meta\",\"8\",{\"name\":\"twitter:title\",\"content\":\"jaimedpdqufv/ADSI_CaaS | DeepWiki\"}],[\"$\",\"meta\",\"9\",{\"name\":\"twitter:description\",\"content\":\"This page provides a technical introduction to the Car as a Service (CaaS) system, its architecture, and core capabilities. It establishes the system context, defines key components, and explains how \"}],[\"$\",\"link\",\"10\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"48x48\"}],[\"$\",\"link\",\"11\",{\"rel\":\"icon\",\"href\":\"/icon.png?66aaf51e0e68c818\",\"type\":\"image/png\",\"sizes\":\"16x16\"}],[\"$\",\"link\",\"12\",{\"rel\":\"apple-touch-icon\",\"href\":\"/apple-icon.png?a4f658907db0ab87\",\"type\":\"image/png\",\"sizes\":\"180x180\"}]]\n"])</script></body></html>